(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{8783:(e,t,s)=>{Promise.resolve().then(s.bind(s,164))},164:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>$,dynamic:()=>Q});var a=s(9233),r=s(5843),n=s(5155),i=s(2115),l=s(9654),c=s(7711),o=s(7581),d=s(4561),m=s(1289),h=s(795),u=s(8197),x=s(3950),g=s(3239),p=s(9136),f=s(9676),y=s(9257),b=s(6878),j=s(1476),v=s(767),w=s(7209);class N{static getInstance(e){return N.instance||(N.instance=new N(e)),N.instance}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4),c=r||this.config.defaultTtlMinutes;l<=this.config.freshThresholdMinutes?(t="fresh",s=!0):(t=l<=this.config.staleThresholdMinutes?"stale":l<=this.config.expiredThresholdMinutes?"stale":"expired",s=!1),l>c&&(t="expired",s=!1),"api"===a&&(t="fresh",s=!0);let o=new Date(i.getTime()+6e4*c);return{isFresh:s,lastUpdated:i,ageMinutes:l,cacheStatus:t,source:a,ttlMinutes:c,nextRefresh:o}}getFreshnessFromCacheMeta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache";return e.exists&&e.timestamp?this.getFreshnessInfo(e.timestamp,t,e.ttl):null}getCombinedFreshnessInfo(e){if(0===e.length)return{overallStatus:"all_expired",oldestData:null,freshCount:0,staleCount:0,expiredCount:0,totalCount:0};let t=e.filter(e=>e.isFresh).length,s=e.filter(e=>"stale"===e.cacheStatus).length,a=e.filter(e=>"expired"===e.cacheStatus).length,r=e.length;return{overallStatus:t===r?"all_fresh":a===r?"all_expired":s===r?"all_stale":"mixed",oldestData:e.reduce((e,t)=>t.ageMinutes>e.ageMinutes?t:e),freshCount:t,staleCount:s,expiredCount:a,totalCount:r}}getFreshnessBadgeStyle(e){switch(e){case"fresh":return{className:"bg-green-100 text-green-800 border-green-200",icon:"✓",text:"Fresh",color:"green"};case"stale":return{className:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"⚠",text:"Stale",color:"yellow"};case"expired":return{className:"bg-red-100 text-red-800 border-red-200",icon:"✗",text:"Expired",color:"red"};default:return{className:"bg-gray-100 text-gray-800 border-gray-200",icon:"?",text:"Unknown",color:"gray"}}}getRelativeTimeString(e){if(e<1)return"たった今";if(e<60)return"".concat(e,"分前");if(e<1440){let t=Math.floor(e/60);return"".concat(t,"時間前")}{let t=Math.floor(e/1440);return"".concat(t,"日前")}}getNextRefreshString(e){let t=new Date,s=Math.floor((e.getTime()-t.getTime())/6e4);if(s<=0)return"更新が必要";if(s<60)return"".concat(s,"分後に更新");{let e=Math.floor(s/60);return"".concat(e,"時間後に更新")}}constructor(e){this.config=(0,a._)({freshThresholdMinutes:15,staleThresholdMinutes:60,expiredThresholdMinutes:240,defaultTtlMinutes:60},e)}}let S=N.getInstance();var k=s(6889),_=s(5340),M=s(1773);class A{static getInstance(e){return A.instance||(A.instance=new A(e)),A.instance}registerDataSource(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.config.defaultTtlMinutes,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"cache",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:100;this.dataSources.set(e,{id:e,name:t,lastUpdated:s,ttlMinutes:a,source:r,qualityScore:n,isActive:!0})}registerRefreshCallback(e,t){this.refreshCallbacks.set(e,t)}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4),c=r||this.config.defaultTtlMinutes;l<=this.config.freshThresholdMinutes?(t="fresh",s=!0):(t=l<=this.config.staleThresholdMinutes?"stale":l<=this.config.expiredThresholdMinutes?"stale":"expired",s=!1),l>c&&(t="expired",s=!1),"api"===a&&(t="fresh",s=!0);let o=new Date(i.getTime()+6e4*c);return{isFresh:s,lastUpdated:i,ageMinutes:l,cacheStatus:t,source:a,ttlMinutes:c,nextRefresh:o}}getDataSourceFreshness(e){let t=this.dataSources.get(e);return t?this.getFreshnessInfo(t.lastUpdated,t.source,t.ttlMinutes):null}getAllFreshnessInfo(){let e=new Map;return this.dataSources.forEach((t,s)=>{let a=this.getDataSourceFreshness(s);a&&e.set(s,a)}),e}getFreshnessBadgeInfo(e){let t=this.getDataSourceFreshness(e);if(!t)return{status:"expired",color:"bg-red-100 text-red-800",text:"データなし",icon:"❌"};switch(t.cacheStatus){case"fresh":return{status:"fresh",color:"bg-green-100 text-green-800",text:"Fresh (".concat(t.ageMinutes,"分前)"),icon:"\uD83D\uDFE2"};case"stale":return{status:"stale",color:"bg-yellow-100 text-yellow-800",text:"Stale (".concat(t.ageMinutes,"分前)"),icon:"\uD83D\uDFE1"};case"expired":return{status:"expired",color:"bg-red-100 text-red-800",text:"Expired (".concat(t.ageMinutes,"分前)"),icon:"\uD83D\uDD34"};default:return{status:"expired",color:"bg-gray-100 text-gray-800",text:"不明",icon:"❓"}}}updateDataSource(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"api",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=this.dataSources.get(e);r&&(r.lastUpdated=t,r.source=s,r.qualityScore=a,this.dataSources.set(e,r))}startAutoRefresh(){this.config.enableAutoRefresh&&(this.refreshInterval=setInterval(()=>{this.performAutoRefresh()},this.config.refreshIntervalMs))}async performAutoRefresh(){let e=[];for(let t of(this.dataSources.forEach((t,s)=>{if(!t.isActive)return;let a=this.getDataSourceFreshness(s);a&&"stale"===a.cacheStatus&&e.push(s)}),e)){let e=this.refreshCallbacks.get(t);if(e)try{await e(),console.info("データソース ".concat(t," の自動リフレッシュ完了"))}catch(e){console.error("データソース ".concat(t," の自動リフレッシュエラー:"),e)}}}async refreshDataSource(e){let t=this.refreshCallbacks.get(e);if(!t)return console.warn("データソース ".concat(e," のリフレッシュコールバックが見つかりません")),!1;try{return await t(),this.updateDataSource(e,new Date,"api"),console.info("データソース ".concat(e," の手動リフレッシュ完了")),!0}catch(t){return console.error("データソース ".concat(e," の手動リフレッシュエラー:"),t),!1}}async refreshAllDataSources(){let e=0,t=0;for(let[s,a]of this.dataSources)a.isActive&&(await this.refreshDataSource(s)?e++:t++);return{success:e,failed:t}}deactivateDataSource(e){let t=this.dataSources.get(e);t&&(t.isActive=!1,this.dataSources.set(e,t))}activateDataSource(e){let t=this.dataSources.get(e);t&&(t.isActive=!0,this.dataSources.set(e,t))}getSystemHealth(){let e=this.dataSources.size,t=0,s=0,a=0,r=0,n=[];this.dataSources.forEach((e,i)=>{if(!e.isActive)return;t++;let l=this.getDataSourceFreshness(i);if(l)switch(l.cacheStatus){case"fresh":s++;break;case"stale":a++;break;case"expired":r++,n.push("データソース ".concat(i," が期限切れです"))}});let i="healthy";return r>0?i="critical":a>.5*t&&(i="warning"),{status:i,totalSources:e,activeSources:t,freshSources:s,staleSources:a,expiredSources:r,issues:n}}destroy(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null),this.dataSources.clear(),this.refreshCallbacks.clear()}constructor(e={}){this.dataSources=new Map,this.refreshCallbacks=new Map,this.refreshInterval=null,this.config=(0,a._)({freshThresholdMinutes:15,staleThresholdMinutes:60,expiredThresholdMinutes:240,defaultTtlMinutes:60,enableAutoRefresh:!0,refreshIntervalMs:3e4},e),this.startAutoRefresh()}}let T=e=>{let{className:t="",showRefreshButton:s=!0,onRefresh:a,freshnessInfos:r,onRefreshAll:l}=e,[c,o]=(0,i.useState)(new Map),[d,m]=(0,i.useState)(null),[h,u]=(0,i.useState)(!1),[p,f]=(0,i.useState)(null),y=A.getInstance();(0,i.useEffect)(()=>{let e=()=>{o(y.getAllFreshnessInfo()),m(y.getSystemHealth()),f(new Date)};e();let t=setInterval(e,3e4);return()=>{clearInterval(t)}},[]);let b=async()=>{if(!h)try{u(!0),l?await l():a?await a():await y.refreshAllDataSources(),f(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{u(!1)}},v=(()=>{let e=0,t=0,s=0;return c.forEach(a=>{switch(a.cacheStatus){case"fresh":e++;break;case"stale":t++;break;case"expired":s++}}),{freshCount:e,staleCount:t,expiredCount:s}})();return c.size,(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.A,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"データ鮮度サマリー"})]}),s&&(0,n.jsx)("button",{onClick:b,disabled:h,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(h?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(M.A,{className:"h-4 w-4 ".concat(h?"animate-spin":"")})})]}),d&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(()=>{if(!d)return(0,n.jsx)(k.A,{className:"h-4 w-4"});switch(d.status){case"healthy":return(0,n.jsx)(g.A,{className:"h-4 w-4 text-green-600"});case"warning":return(0,n.jsx)(x.A,{className:"h-4 w-4 text-yellow-600"});case"critical":return(0,n.jsx)(_.A,{className:"h-4 w-4 text-red-600"});default:return(0,n.jsx)(k.A,{className:"h-4 w-4"})}})(),(0,n.jsx)("span",{className:"text-sm font-medium ".concat((()=>{if(!d)return"text-gray-600";switch(d.status){case"healthy":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}})()),children:d.status.toUpperCase()}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",d.activeSources,"/",d.totalSources," アクティブ)"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,n.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-green-600",children:v.freshCount})]}),(0,n.jsx)("div",{className:"text-xs text-green-700 dark:text-green-300",children:"フレッシュ"})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(x.A,{className:"h-4 w-4 text-yellow-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-yellow-600",children:v.staleCount})]}),(0,n.jsx)("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"ステール"})]}),(0,n.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(_.A,{className:"h-4 w-4 text-red-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-red-600",children:v.expiredCount})]}),(0,n.jsx)("div",{className:"text-xs text-red-700 dark:text-red-300",children:"期限切れ"})]})]}),p&&(0,n.jsxs)("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400 text-center",children:["最終更新: ",p.toLocaleTimeString()]}),d&&d.issues.length>0&&(0,n.jsxs)("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,n.jsx)(_.A,{className:"h-3 w-3 text-red-600"}),(0,n.jsxs)("span",{className:"text-xs font-medium text-red-800 dark:text-red-200",children:[d.issues.length,"件の問題"]})]}),(0,n.jsxs)("div",{className:"text-xs text-red-700 dark:text-red-300",children:[d.issues[0],d.issues.length>1&&" 他".concat(d.issues.length-1,"件")]})]})]})},C=e=>{let{className:t="",showDetails:s=!0,showStats:a=!0,freshnessInfos:r,onRefreshAll:l}=e,[c,o]=(0,i.useState)({totalItems:0,totalSize:0,hitRate:0,missRate:0,lastCleanup:new Date}),[d,m]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=()=>{try{let e=Object.keys(localStorage).filter(e=>e.startsWith("stock_")||e.startsWith("cache_")),t=0,s=[];e.forEach(e=>{let a=localStorage.getItem(e);if(a){let r=new Blob([a]).size;t+=r;try{let t=JSON.parse(a),n=t.timestamp?new Date(t.timestamp):new Date,i=t.ttl||36e5,l=Date.now()-n.getTime()>i;s.push({key:e,size:r,lastAccessed:n,ttl:i,isExpired:l})}catch(e){}}}),o({totalItems:e.length,totalSize:t,hitRate:.85,missRate:.15,lastCleanup:new Date}),m(s)}catch(e){console.error("キャッシュ統計取得エラー:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]);let h=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},u=e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4),s=Math.floor(t/60),a=Math.floor(s/24);return t<1?"たった今":t<60?"".concat(t,"分前"):s<24?"".concat(s,"時間前"):"".concat(a,"日前")};return(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(j.A,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"キャッシュ可視化"})]}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200",title:"キャッシュを更新",children:(0,n.jsx)(M.A,{className:"h-4 w-4"})})]}),a&&(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.totalItems}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総アイテム数"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:h(c.totalSize)}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総サイズ"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-yellow-600",children:[(100*c.hitRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ヒット率"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[(100*c.missRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ミス率"})]})]}),s&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"キャッシュアイテム一覧"}),0===d.length?(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,n.jsx)(j.A,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,n.jsx)("p",{children:"キャッシュアイテムがありません"})]}):(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(e.isExpired?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-700"),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:e.isExpired?(0,n.jsx)(_.A,{className:"h-4 w-4 text-red-600"}):(0,n.jsx)(g.A,{className:"h-4 w-4 text-green-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:e.key}),(0,n.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[h(e.size)," • ",u(e.lastAccessed)]})]})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isExpired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.isExpired?"期限切れ":"有効"})})]},t))})]})]})};var I=s(7072),D=s(1556);let E=e=>{let{onRefresh:t,onForceRefresh:s,onRecalculate:a,onRecompute:r,isLoading:l=!1,lastUpdated:c,lastRefresh:o,showLastUpdated:d=!0,showLastRefresh:m=!0,variant:h="default",size:u="md",showProgress:x=!1,refreshInterval:p,className:f=""}=e,[y,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!1),[w,N]=(0,i.useState)(!1),[S,_]=(0,i.useState)(null),A=async()=>{if(!y&&t)try{b(!0),await t(),_(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{b(!1)}},T=async()=>{if(!j&&s)try{v(!0),await s(),_(new Date)}catch(e){console.error("強制リフレッシュエラー:",e)}finally{v(!1)}},C=async()=>{if(!w&&a)try{N(!0),await a(),_(new Date)}catch(e){console.error("再計算エラー:",e)}finally{N(!1)}},E=e=>{let t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4),r=Math.floor(a/60),n=Math.floor(r/24);return a<1?"たった今":a<60?"".concat(a,"分前"):r<24?"".concat(r,"時間前"):"".concat(n,"日前")};return"compact"===h?(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsx)("button",{onClick:A,disabled:y||l,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(M.A,{className:"h-4 w-4 ".concat(y?"animate-spin":"")})}),d&&c&&(0,n.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:E(c)})]}):"full"===h?(0,n.jsxs)("div",{className:"space-y-3 ".concat(f),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)("button",{onClick:A,disabled:y||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(M.A,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),s&&(0,n.jsxs)("button",{onClick:T,disabled:j||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-yellow-600 text-white hover:bg-yellow-700 transition-colors duration-200 ".concat(j||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(I.A,{className:"h-4 w-4 ".concat(j?"animate-pulse":"")}),(0,n.jsx)("span",{children:j?"強制更新中...":"強制更新"})]}),a&&(0,n.jsxs)("button",{onClick:C,disabled:w||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 ".concat(w||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(D.A,{className:"h-4 w-4 ".concat(w?"animate-spin":"")}),(0,n.jsx)("span",{children:w?"再計算中...":"再計算"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[d&&c&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(k.A,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["最終更新: ",E(c)]})]}),o&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(g.A,{className:"h-4 w-4 text-green-600"}),(0,n.jsxs)("span",{children:["更新完了: ",E(o)]})]})]})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsxs)("button",{onClick:A,disabled:y||l,className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(M.A,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),d&&c&&(0,n.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:E(c)})]})};var R=s(2320);function F(e){switch(function(e){var t;let s=e.message.toLowerCase(),a=(null===(t=e.stack)||void 0===t?void 0:t.toLowerCase())||"";return s.includes("rsc payload")||s.includes("server component")||s.includes("connection closed")||s.includes("failed to fetch rsc payload")?"rsc":s.includes("network")||s.includes("fetch")||s.includes("connection")||s.includes("timeout")||s.includes("aborted")||s.includes("cors")?"network":s.includes("data")||s.includes("json")||s.includes("parse")||s.includes("invalid")||s.includes("malformed")?"data":s.includes("auth")||s.includes("unauthorized")||s.includes("forbidden")||s.includes("token")?"auth":s.includes("validation")||s.includes("invalid input")||s.includes("required")||s.includes("format")?"validation":a.includes("react")||a.includes("component")||s.includes("render")||s.includes("hook")?"component":"unknown"}(e)){case"rsc":return{category:"rsc",severity:"high",title:"RSC Payload エラー",message:"サーバーコンポーネントの通信エラーが発生しました。自動的に復旧を試みています。",icon:"\uD83D\uDD04",canRetry:!0,autoRetry:!0,retryDelay:2e3,userAction:"ページを再読み込みしてください",technicalDetails:"React Server Componentsの通信に失敗しました"};case"network":return{category:"network",severity:"medium",title:"ネットワークエラー",message:"ネットワーク接続に問題があります。自動的に再試行しています。",icon:"\uD83C\uDF10",canRetry:!0,autoRetry:!0,retryDelay:1e3,userAction:"ネットワーク接続を確認してください",technicalDetails:"API呼び出しが失敗しました"};case"data":return{category:"data",severity:"medium",title:"データ取得エラー",message:"データの取得に失敗しました。キャッシュデータを表示します。",icon:"\uD83D\uDCCA",canRetry:!0,autoRetry:!1,userAction:"しばらく待ってから再試行してください",technicalDetails:"データの解析または取得に失敗しました"};case"auth":return{category:"auth",severity:"high",title:"認証エラー",message:"認証に問題があります。ログインし直してください。",icon:"\uD83D\uDD10",canRetry:!1,autoRetry:!1,userAction:"ログインし直してください",technicalDetails:"認証トークンが無効または期限切れです"};case"validation":return{category:"validation",severity:"low",title:"入力エラー",message:"入力内容に問題があります。入力内容を確認してください。",icon:"⚠️",canRetry:!1,autoRetry:!1,userAction:"入力内容を確認してください",technicalDetails:"入力値の検証に失敗しました"};case"component":return{category:"component",severity:"high",title:"コンポーネントエラー",message:"画面の表示に問題があります。ページを再読み込みしてください。",icon:"⚛️",canRetry:!0,autoRetry:!0,retryDelay:3e3,userAction:"ページを再読み込みしてください",technicalDetails:"Reactコンポーネントのレンダリングに失敗しました"};default:return{category:"unknown",severity:"medium",title:"システムエラー",message:"予期しないエラーが発生しました。自動的に復旧を試みています。",icon:"⚠️",canRetry:!0,autoRetry:!0,retryDelay:2e3,userAction:"ページを再読み込みしてください",technicalDetails:"不明なエラーが発生しました"}}}function L(e){let{error:t,onRetry:s,onDismiss:a,showDetails:r=!1,autoRetry:l=!0,maxRetries:c=3}=e,[o,d]=(0,i.useState)(0),[m,h]=(0,i.useState)(!1),[u,x]=(0,i.useState)(null);(0,i.useEffect)(()=>{x(F(t)),function(e,t){let s=F(e),a={timestamp:new Date().toISOString(),category:s.category,severity:s.severity,message:e.message,stack:e.stack,context:void 0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",url:window.location.href};console.error("Unified Error:",a);try{let e=JSON.parse(localStorage.getItem("error_logs")||"[]"),t=[a,...e].slice(0,10);localStorage.setItem("error_logs",JSON.stringify(t))}catch(e){console.warn("Failed to save error log:",e)}"critical"===s.severity&&console.error("Critical error detected:",a)}(t)},[t,l,c,o]),(0,i.useCallback)(()=>{!m&&!(o>=c)&&(null==u?void 0:u.autoRetry)&&(h(!0),d(e=>e+1),console.log("Auto retry attempt ".concat(o+1,"/").concat(c," for ").concat(u.category," error")),setTimeout(()=>{"caches"in window&&caches.keys().then(e=>{e.forEach(e=>caches.delete(e))});try{Object.keys(localStorage).forEach(e=>{(e.startsWith("app_cache:")||e.startsWith("next:"))&&localStorage.removeItem(e)})}catch(e){console.warn("Failed to clear localStorage cache:",e)}s&&s(),h(!1)},u.retryDelay||2e3))},[u,o,c,m,s]);let g=(0,i.useCallback)(()=>{m||(h(!0),d(e=>e+1),setTimeout(()=>{s&&s(),h(!1)},1e3))},[m,s]);return u?(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-xl w-full",children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,n.jsx)("div",{className:"text-3xl",children:u.icon}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:u.title}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["エラーカテゴリ: ",u.category," | 重要度: ",u.severity]})]})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("p",{className:"text-gray-700 mb-2",children:u.message}),m&&u.autoRetry&&(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,n.jsxs)("span",{className:"text-sm text-blue-800",children:["自動復旧を試行中... (",o,"/",c,")"]})]})}),u.userAction&&(0,n.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:(0,n.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,n.jsx)("strong",{children:"推奨アクション:"})," ",u.userAction]})})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[u.canRetry&&(0,n.jsx)("button",{onClick:g,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:m,children:m?"復旧中...":"手動で再試行"}),(0,n.jsx)("button",{onClick:()=>window.location.href="/",className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",children:"ホームに戻る"}),a&&(0,n.jsx)("button",{onClick:a,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"閉じる"})]}),r&&(0,n.jsxs)("details",{className:"mt-4",children:[(0,n.jsx)("summary",{className:"text-sm text-gray-600 cursor-pointer",children:"技術詳細を表示"}),(0,n.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,n.jsxs)("div",{className:"bg-gray-100 p-3 rounded text-xs",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"エラーメッセージ:"})," ",t.message]}),u.technicalDetails&&(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"詳細:"})," ",u.technicalDetails]})]}),t.stack&&(0,n.jsxs)("div",{className:"bg-gray-100 p-3 rounded text-xs",children:[(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"スタックトレース:"})}),(0,n.jsx)("pre",{className:"mt-1 overflow-auto max-h-32",children:t.stack})]})]})]}),o>=c&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,n.jsx)("p",{className:"text-sm text-yellow-800",children:"自動復旧に失敗しました。手動で再試行するか、ホームに戻ってください。"})})]})})}):null}class P{initializeMonitoring(){if("PerformanceObserver"in window){let e=new PerformanceObserver(e=>{for(let t of e.getEntries())this.handlePerformanceEntry(t)});try{e.observe({entryTypes:["navigation","paint","measure","resource"]})}catch(e){console.warn("PerformanceObserver not supported:",e)}}this.startMemoryMonitoring(),this.estimateBundleSize()}handlePerformanceEntry(e){switch(e.entryType){case"navigation":this.metrics.loadTime=e.duration;break;case"paint":"first-contentful-paint"===e.name&&(this.renderStartTime=e.startTime);break;case"measure":e.name.includes("render")&&(this.metrics.renderTime=e.duration);break;case"resource":(e.name.includes(".js")||e.name.includes(".css"))&&this.updateBundleSize(e)}}startMemoryMonitoring(){"memory"in performance&&setInterval(()=>{let e=performance.memory;e&&(this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit},e.usedJSHeapSize>0x6400000&&console.warn("High memory usage detected:",{used:Math.round(e.usedJSHeapSize/1024/1024)+"MB",total:Math.round(e.totalJSHeapSize/1024/1024)+"MB",limit:Math.round(e.jsHeapSizeLimit/1024/1024)+"MB"}))},1e4)}estimateBundleSize(){let e=document.querySelectorAll("script[src]"),t=0;e.forEach(e=>{e.src.includes("_next/static/")&&(t+=5e4)}),this.metrics.bundleSize=t}updateBundleSize(e){"transferSize"in e&&(this.metrics.bundleSize+=e.transferSize||0)}startComponentTimer(e){this.componentTimers.set(e,performance.now())}endComponentTimer(e){let t=this.componentTimers.get(e);if(t){let s=performance.now()-t,a=this.componentMetrics.get(e);a?(a.renderTime=(a.renderTime+s)/2,a.updateCount++):(this.componentMetrics.set(e,{name:e,renderTime:s,mountTime:s,updateCount:1,memoryUsage:this.metrics.memoryUsage.used}),this.metrics.componentCount++),this.componentTimers.delete(e)}}updateCacheHitRate(e,t){this.metrics.cacheHitRate=t>0?e/t*100:0}updateErrorRate(e,t){this.metrics.errorRate=t>0?e/t*100:0}getMetrics(){return(0,a._)({},this.metrics)}getComponentMetrics(){return Array.from(this.componentMetrics.values())}getSlowComponents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;return this.getComponentMetrics().filter(t=>t.renderTime>e).sort((e,t)=>t.renderTime-e.renderTime)}getMemoryReport(){let{used:e,total:t,limit:s}=this.metrics.memoryUsage,a=s>0?e/s*100:0,r="メモリ使用量は正常です";return a>80?r="メモリ使用量が高すぎます。ページを再読み込みすることを推奨します。":a>60&&(r="メモリ使用量がやや高いです。不要なタブを閉じることを推奨します。"),{usage:"".concat(Math.round(e/1024/1024),"MB / ").concat(Math.round(s/1024/1024),"MB"),percentage:Math.round(a),recommendation:r}}optimizePerformance(){console.log("\uD83D\uDE80 パフォーマンス最適化を実行中..."),this.cleanupEventListeners(),this.preventMemoryLeaks(),this.optimizeCache(),console.log("✅ パフォーマンス最適化が完了しました")}cleanupEventListeners(){document.querySelectorAll("*").forEach(e=>{console.debug("Event listeners on element:",e.tagName)})}preventMemoryLeaks(){this.metrics.memoryUsage.used>0x3200000&&(console.warn("メモリ使用量が高いため、最適化を実行します"),"gc"in window&&window.gc())}optimizeCache(){"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{(e.includes("old")||e.includes("temp"))&&caches.delete(e)})})}generateReport(){let e=this.getMetrics(),t=this.getComponentMetrics(),s=this.getMemoryReport();return"\n# パフォーマンスレポート\n\n## 基本メトリクス\n- 読み込み時間: ".concat(e.loadTime.toFixed(2),"ms\n- レンダリング時間: ").concat(e.renderTime.toFixed(2),"ms\n- コンポーネント数: ").concat(e.componentCount,"\n- バンドルサイズ: ").concat(Math.round(e.bundleSize/1024),"KB\n- キャッシュヒット率: ").concat(e.cacheHitRate.toFixed(1),"%\n- エラー率: ").concat(e.errorRate.toFixed(1),"%\n\n## メモリ使用量\n- 使用量: ").concat(s.usage,"\n- 使用率: ").concat(s.percentage,"%\n- 推奨事項: ").concat(s.recommendation,"\n\n## コンポーネントパフォーマンス\n").concat(t.map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms (更新回数: ").concat(e.updateCount,")")).join("\n"),"\n\n## 遅いコンポーネント\n").concat(this.getSlowComponents().map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms")).join("\n"),"\n    ").trim()}constructor(){this.startTime=performance.now(),this.renderStartTime=0,this.metrics={loadTime:0,renderTime:0,memoryUsage:{used:0,total:0,limit:0},componentCount:0,bundleSize:0,cacheHitRate:0,errorRate:0},this.componentMetrics=new Map,this.componentTimers=new Map,this.initializeMonitoring()}}let z=new P;setInterval(function(){let e=z.getMetrics();e.memoryUsage.used>0x5000000&&(console.warn("メモリ使用量が高いため、自動最適化を実行します"),z.optimizePerformance()),e.errorRate>10&&console.warn("エラー率が高いです:",e.errorRate+"%"),e.cacheHitRate<50&&console.warn("キャッシュヒット率が低いです:",e.cacheHitRate+"%")},3e4);var G=s(7020);function O(e){let{children:t,fallbackToSample:s=!0}=e,[a,r]=(0,i.useState)(null),[l,c]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async()=>{try{let e=(()=>{let e=new Date,t=Array.from({length:30},(t,s)=>new Date(e.getTime()-(29-s)*864e5).toISOString().split("T")[0]).map((e,t)=>({date:e,code:"7203.T",open:2500+100*Math.random()-50,high:2550+50*Math.random(),low:2450-50*Math.random(),close:2500+100*Math.random()-50,volume:1e6+5e5*Math.random(),sma_5:2500+50*Math.random()-25,sma_10:2500+40*Math.random()-20,sma_25:2500+30*Math.random()-15,sma_50:2500+20*Math.random()-10,rsi_14:30+40*Math.random(),macd:10*Math.random()-5,macd_signal:8*Math.random()-4,macd_hist:2*Math.random()-1})),s=Array.from({length:20},(e,t)=>({index:t+1,actual:2500+200*Math.random()-100,predicted:2500+200*Math.random()-100,error:10*Math.random()-5,error_percentage:5*Math.random()})),a={total_data_points:t.length,prediction_period:"30日",best_model:"XGBoost",mae:"0.0234",r2:"0.8765",last_updated:e.toISOString()};return{stockData:t,modelComparison:[{name:"XGBoost",type:"Gradient Boosting",mae:.0234,mse:8e-4,rmse:.0283,r2:.8765,rank:1},{name:"Random Forest",type:"Ensemble",mae:.0256,mse:9e-4,rmse:.03,r2:.8543,rank:2},{name:"Linear Regression",type:"Linear",mae:.0345,mse:.0012,rmse:.0346,r2:.7891,rank:3}],featureAnalysis:[{feature:"価格変動率",importance:.35,percentage:35},{feature:"ボリューム",importance:.25,percentage:25},{feature:"RSI",importance:.15,percentage:15},{feature:"移動平均",importance:.12,percentage:12},{feature:"ボリンジャーバンド",importance:.08,percentage:8},{feature:"MACD",importance:.05,percentage:5}],predictions:s,summary:a,marketInsights:{volatility:"medium",trend:"bullish",risk_level:"moderate",market_sentiment:"positive"},riskAssessment:{risk_level:"Medium",risk_score:.65,var_95:.032,max_drawdown:.085,sharpe_ratio:1.25}}})();r(e)}catch(e){console.error("サンプルデータの生成に失敗:",e)}finally{c(!1)}})()},[]),l)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"サンプルデータを準備中..."})]})}):(0,n.jsx)("div",{className:"sample-data-provider",children:t})}var B=s(9191);function U(e){let{onAnalysisStart:t,onAnalysisComplete:s,onDataUpdateStart:l,onDataUpdateComplete:c,className:o=""}=e,[d,m]=(0,i.useState)(!1),[h,u]=(0,i.useState)(!1),[y,b]=(0,i.useState)(0),[v,w]=(0,i.useState)([{id:"data_update",name:"データ更新",description:"最新の株価データを取得します",icon:(0,n.jsx)(j.A,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"},{id:"feature_engineering",name:"特徴量エンジニアリング",description:"技術指標を計算します",icon:(0,n.jsx)(p.A,{className:"h-5 w-5"}),estimatedTime:"1分",status:"pending"},{id:"model_training",name:"モデル学習",description:"AIモデルを学習させます",icon:(0,n.jsx)(f.A,{className:"h-5 w-5"}),estimatedTime:"2分",status:"pending"},{id:"prediction",name:"予測実行",description:"株価予測を実行します",icon:(0,n.jsx)(B.A,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"}]),[N,S]=(0,i.useState)(0),[_,A]=(0,i.useState)(null),T=async()=>{if(!d){m(!0),b(0),S(0),null==t||t();try{for(let e=0;e<v.length;e++){b(e),w(t=>t.map((t,s)=>(0,r._)((0,a._)({},t),{status:s===e?"running":s<e?"completed":"pending"})));let t=0===e?2e3:1===e?3e3:2===e?5e3:2e3;await new Promise(e=>setTimeout(e,t)),S(Math.round((e+1)/v.length*100))}w(e=>e.map(e=>(0,r._)((0,a._)({},e),{status:"completed"}))),null==s||s({success:!0,message:"分析が完了しました"})}catch(e){console.error("分析実行エラー:",e),w(e=>e.map(e=>(0,r._)((0,a._)({},e),{status:"error"})))}finally{m(!1)}}},C=async()=>{if(!h){u(!0),null==l||l();try{await new Promise(e=>setTimeout(e,3e3)),null==c||c({success:!0,message:"データ更新が完了しました"})}catch(e){console.error("データ更新エラー:",e)}finally{u(!1)}}};(0,i.useEffect)(()=>{if(!d){A(null);return}A(Math.max(0,v.reduce((e,t)=>e+(({data_update:2,feature_engineering:3,model_training:5,prediction:2})[t.id]||1),0)-2*y))},[d,y,v]);let I=e=>{switch(e.status){case"completed":return(0,n.jsx)(g.A,{className:"h-5 w-5 text-green-500"});case"running":return(0,n.jsx)(M.A,{className:"h-5 w-5 text-blue-500 animate-spin"});case"error":return(0,n.jsx)(x.A,{className:"h-5 w-5 text-red-500"});default:return e.icon}},D=e=>{switch(e.status){case"completed":return"text-green-600 bg-green-50 border-green-200";case"running":return"text-blue-600 bg-blue-50 border-blue-200";case"error":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 ".concat(o),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(p.A,{className:"h-6 w-6 text-purple-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"分析実行"})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("button",{onClick:C,disabled:h||d,className:"flex items-center space-x-2 px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(j.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"データ更新のみ"})]})})]}),(0,n.jsx)("div",{className:"space-y-3 mb-6",children:v.map((e,t)=>(0,n.jsx)("div",{className:"p-4 rounded-lg border-2 transition-all ".concat(D(e)),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[I(e),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:e.name}),(0,n.jsx)("p",{className:"text-sm opacity-75",children:e.description})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:e.estimatedTime}),"running"===e.status&&(0,n.jsx)("div",{className:"text-xs text-blue-600",children:"実行中..."})]})]})},e.id))}),d&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,n.jsx)("span",{children:"全体進捗"}),(0,n.jsxs)("span",{children:[N,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,n.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(N,"%")}})}),_&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mt-2",children:[(0,n.jsx)(k.A,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["推定残り時間: ",_,"分"]})]})]}),(0,n.jsx)("div",{className:"flex space-x-3",children:d?(0,n.jsxs)("button",{disabled:!0,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gray-400 text-white rounded-lg cursor-not-allowed",children:[(0,n.jsx)(M.A,{className:"h-5 w-5 animate-spin"}),(0,n.jsx)("span",{className:"font-medium",children:"実行中..."})]}):(0,n.jsxs)("button",{onClick:T,disabled:h,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(B.A,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"font-medium",children:"分析を実行"})]})}),!d&&100===N&&(0,n.jsxs)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(g.A,{className:"h-5 w-5 text-green-600"}),(0,n.jsx)("span",{className:"text-green-800 font-medium",children:"分析が完了しました"})]}),(0,n.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"予測結果がダッシュボードに表示されます"})]})]})}class H{detectInfiniteLoop(e){let t=Date.now();if(t-(this.lastRenderTimes.get(e)||0)<this.TIME_THRESHOLD){let t=(this.renderCounts.get(e)||0)+1;if(this.renderCounts.set(e,t),t>this.MAX_RENDERS)return console.warn("Infinite loop detected in component: ".concat(e)),this.blockComponent(e),!0}else this.renderCounts.set(e,1);return this.lastRenderTimes.set(e,t),!1}blockComponent(e){this.blockedComponents.add(e),setTimeout(()=>{this.blockedComponents.delete(e),this.renderCounts.delete(e),console.log("Infinite loop protection reset for component: ".concat(e))},this.BLOCK_DURATION)}isBlocked(e){return this.blockedComponents.has(e)}reset(){this.renderCounts.clear(),this.lastRenderTimes.clear(),this.blockedComponents.clear()}constructor(){this.renderCounts=new Map,this.lastRenderTimes=new Map,this.blockedComponents=new Set,this.MAX_RENDERS=10,this.TIME_THRESHOLD=100,this.BLOCK_DURATION=5e3}}let J=new H;{let e=0,t=Date.now(),s=!1,a=console.error;console.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];t.join(" ").includes("Maximum update depth exceeded")&&!s&&(console.warn("Global infinite loop detected, forcing page reload"),s=!0,window.location.reload()),a.apply(console,t)};let r=new MutationObserver(()=>{let a=Date.now();a-t<30?++e>25&&!s&&(console.warn("Global infinite loop detected, forcing page reload"),s=!0,window.location.reload()):e=0,t=a});document.body?r.observe(document.body,{childList:!0,subtree:!0,attributes:!0}):document.addEventListener("DOMContentLoaded",()=>{r.observe(document.body,{childList:!0,subtree:!0,attributes:!0})})}function q(e){let{children:t,fallback:s,componentId:a="default"}=e,[r,l]=(0,i.useState)(!1),c=(0,i.useRef)(0),o=(0,i.useRef)(Date.now()),d=(0,i.useRef)(null);return((0,i.useEffect)(()=>{c.current+=1;let e=Date.now(),t=e-o.current;t<50&&c.current>15&&(console.warn("InfiniteLoopProtection: Infinite loop detected, blocking"),l(!0),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{l(!1),c.current=0,console.log("Infinite loop protection reset")},5e3)),o.current=e,t>1e3&&(c.current=0)}),(0,i.useEffect)(()=>()=>{d.current&&clearTimeout(d.current)},[]),(0,i.useEffect)(()=>{J.isBlocked(a)&&l(!0)},[a]),r)?s?(0,n.jsx)(n.Fragment,{children:s}):(0,n.jsx)("div",{className:"flex flex-col items-center justify-center p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,n.jsxs)("div",{className:"text-red-800 text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"コンポーネントが一時的にブロックされました"}),(0,n.jsx)("p",{className:"text-sm mb-4",children:"無限ループが検出されたため、このコンポーネントを一時的にブロックしています。 数秒後に自動的に復旧します。"}),(0,n.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600 mx-auto"})]})}):(0,n.jsx)(n.Fragment,{children:t})}let K=(0,i.createContext)(null);function W(e){let{children:t}=e;return(0,n.jsx)(K.Provider,{value:{data:[],loading:!1,error:null,setData:()=>{},setLoading:()=>{},setError:()=>{}},children:t})}function X(){return(0,i.useEffect)(()=>{i.useEffect;let e=0,t=Date.now(),s=setInterval(()=>{let s=Date.now();s-t<100?++e>10&&(console.warn("ChartDataProviderKiller: Infinite loop detected, forcing page reload"),window.location.reload()):e=0,t=s},100),a=e=>{e.message.includes("Maximum update depth exceeded")&&(console.warn("ChartDataProviderKiller: Maximum update depth exceeded, reloading page"),e.preventDefault(),window.location.reload())};return window.addEventListener("error",a),()=>{clearInterval(s),window.removeEventListener("error",a)}},[]),null}let Q="force-dynamic";(0,c.default)(()=>Promise.all([s.e(7396),s.e(9909)]).then(s.bind(s,9909)),{loadableGenerated:{webpack:()=>[9909]},ssr:!1});let V=(0,c.default)(()=>Promise.all([s.e(7396),s.e(3343)]).then(s.bind(s,3343)),{loadableGenerated:{webpack:()=>[3343]},ssr:!1});(0,c.default)(()=>Promise.all([s.e(7396),s.e(7456)]).then(s.bind(s,7456)),{loadableGenerated:{webpack:()=>[7456]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(953),s.e(898)]).then(s.bind(s,898)),{loadableGenerated:{webpack:()=>[898]},ssr:!1}),(0,c.default)(()=>s.e(2660).then(s.bind(s,2660)),{loadableGenerated:{webpack:()=>[2660]},ssr:!1}),(0,c.default)(()=>s.e(5206).then(s.bind(s,5206)),{loadableGenerated:{webpack:()=>[5206]},ssr:!1}),(0,c.default)(()=>s.e(7792).then(s.bind(s,7792)),{loadableGenerated:{webpack:()=>[7792]},ssr:!1}),(0,c.default)(()=>s.e(2165).then(s.bind(s,2165)),{loadableGenerated:{webpack:()=>[2165]},ssr:!1}),(0,c.default)(()=>s.e(7024).then(s.bind(s,7024)),{loadableGenerated:{webpack:()=>[7024]},ssr:!1}),(0,c.default)(()=>s.e(667).then(s.bind(s,667)),{loadableGenerated:{webpack:()=>[667]},ssr:!1}),(0,c.default)(()=>s.e(3382).then(s.bind(s,1001)),{loadableGenerated:{webpack:()=>[1001]},ssr:!1}),(0,c.default)(()=>s.e(4553).then(s.bind(s,4553)),{loadableGenerated:{webpack:()=>[4553]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(728),s.e(9191),s.e(9435),s.e(5091)]).then(s.bind(s,5091)),{loadableGenerated:{webpack:()=>[5091]},ssr:!1}),(0,c.default)(()=>s.e(728).then(s.bind(s,728)),{loadableGenerated:{webpack:()=>[728]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(9191),s.e(865)]).then(s.bind(s,1572)),{loadableGenerated:{webpack:()=>[1572]},ssr:!1}),(0,c.default)(()=>s.e(7475).then(s.bind(s,7475)),{loadableGenerated:{webpack:()=>[7475]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(9435),s.e(1594)]).then(s.bind(s,9435)),{loadableGenerated:{webpack:()=>[9435]},ssr:!1}),(0,c.default)(()=>s.e(980).then(s.bind(s,980)),{loadableGenerated:{webpack:()=>[980]},ssr:!1}),(0,c.default)(()=>s.e(6033).then(s.bind(s,6033)),{loadableGenerated:{webpack:()=>[6033]},ssr:!1}),(0,c.default)(()=>s.e(3501).then(s.bind(s,3501)),{loadableGenerated:{webpack:()=>[3501]},ssr:!1}),(0,c.default)(()=>s.e(2015).then(s.bind(s,2015)),{loadableGenerated:{webpack:()=>[2015]},ssr:!1}),(0,c.default)(()=>s.e(1360).then(s.bind(s,1360)).then(e=>({default:e.default})),{loadableGenerated:{webpack:()=>[1360]},ssr:!1}),(0,c.default)(()=>s.e(3394).then(s.bind(s,3394)),{loadableGenerated:{webpack:()=>[3394]},ssr:!1});let Y=(0,c.default)(()=>s.e(5393).then(s.bind(s,5393)).then(e=>({default:e.TourProvider})),{loadableGenerated:{webpack:()=>[5393]},ssr:!1});function Z(){var e,t;let[l,c]=(0,i.useState)("overview"),[o,N]=(0,i.useState)([]),[k,_]=(0,i.useState)([]),[M,A]=(0,i.useState)(null),[I,D]=(0,i.useState)(null),[F,L]=(0,i.useState)(null),[P,O]=(0,i.useState)(null),[B,H]=(0,i.useState)(null),[J,K]=(0,i.useState)(""),[Q,Y]=(0,i.useState)(""),[Z,$]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(!1),[es,ea]=(0,i.useState)(!1),[er,en]=(0,i.useState)(!1),[ei,el]=(0,i.useState)(!1),[ec,eo]=(0,i.useState)(null),[ed,em]=(0,i.useState)(G.DEFAULT_CHECKLIST_ITEMS),[eh,eu]=(0,i.useState)({}),[ex,eg]=(0,i.useState)(!0),[ep,ef]=(0,i.useState)(null),[ey,eb]=(0,i.useState)([]);!function(e){let{useEffect:t}=s(2115);t(()=>(z.startComponentTimer(e),()=>{z.endComponentTimer(e)}),[e])}("dashboard"),(0,d.P)(),(0,m.o)();let ej=function(){let[e,t]=(0,i.useState)({isLoading:!0,error:null,connectionStatus:null,marketSummary:null,lastUpdated:null,analysisResults:[]}),s=(0,i.useCallback)(async()=>{t(e=>(0,r._)((0,a._)({},e),{isLoading:!0,error:null}));try{console.log("ダッシュボード: JQuants接続テスト開始...");let e=await (0,h.rN)();if(t(t=>(0,r._)((0,a._)({},t),{connectionStatus:e})),!e.success)throw Error("API接続失敗: ".concat(e.message));console.log("ダッシュボード: 市場分析実行中...");let s=await (0,u.qB)();if(!s)throw Error("市場サマリーの生成に失敗しました");let n=new Date().toISOString();t(e=>(0,r._)((0,a._)({},e),{isLoading:!1,marketSummary:s,lastUpdated:n,error:null})),console.log("ダッシュボードデータ更新完了:",{analyzedSymbols:s.analyzedSymbols,totalRecommendations:Object.values(s.recommendations).reduce((e,t)=>e+t,0),topGainers:s.topGainers.length,topLosers:s.topLosers.length})}catch(e){console.error("ダッシュボードデータ取得エラー:",e),t(t=>(0,r._)((0,a._)({},t),{isLoading:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}))}},[]);return(0,i.useEffect)(()=>{s()},[s]),(0,r._)((0,a._)({},e),{actions:{refresh:s}})}();!function(){let[e,t]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/data/sample_data.json");if(e.ok){let s=await e.json();t(s)}else t((()=>{let e=new Date;return{stockData:Array.from({length:30},(t,s)=>new Date(e.getTime()-(29-s)*864e5).toISOString().split("T")[0]).map((e,t)=>({date:e,code:"7203.T",open:2500+100*Math.random()-50,high:2550+50*Math.random(),low:2450-50*Math.random(),close:2500+100*Math.random()-50,volume:1e6+5e5*Math.random(),sma_5:2500+50*Math.random()-25,sma_10:2500+40*Math.random()-20,sma_25:2500+30*Math.random()-15,sma_50:2500+20*Math.random()-10,rsi_14:30+40*Math.random(),macd:10*Math.random()-5,macd_signal:8*Math.random()-4,macd_hist:2*Math.random()-1})),modelComparison:[{name:"XGBoost",type:"Gradient Boosting",mae:.0234,mse:8e-4,rmse:.0283,r2:.8765,rank:1}],featureAnalysis:[{feature:"価格変動率",importance:.35,percentage:35},{feature:"ボリューム",importance:.25,percentage:25}],predictions:Array.from({length:20},(e,t)=>({index:t+1,actual:2500+200*Math.random()-100,predicted:2500+200*Math.random()-100,error:10*Math.random()-5,error_percentage:5*Math.random()})),summary:{total_data_points:30,prediction_period:"30日",best_model:"XGBoost",mae:"0.0234",r2:"0.8765",last_updated:e.toISOString()},marketInsights:{volatility:"medium",trend:"bullish",risk_level:"moderate"},riskAssessment:{risk_level:"Medium",risk_score:.65}}})())}catch(e){console.error("サンプルデータの読み込みに失敗:",e)}})()},[])}();let[ev,ew]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{eg(!0);let e={summary:{exists:(0,w.Sj)("dash:summary").exists,timestamp:(0,w.Sj)("dash:summary").timestamp||void 0},stock:{exists:(0,w.Sj)("dash:stock").exists,timestamp:(0,w.Sj)("dash:stock").timestamp||void 0},model:{exists:(0,w.Sj)("dash:model").exists,timestamp:(0,w.Sj)("dash:model").timestamp||void 0},feature:{exists:(0,w.Sj)("dash:feature").exists,timestamp:(0,w.Sj)("dash:feature").timestamp||void 0},pred:{exists:(0,w.Sj)("dash:pred").exists,timestamp:(0,w.Sj)("dash:pred").timestamp||void 0},marketInsights:{exists:(0,w.Sj)("dash:marketInsights").exists,timestamp:(0,w.Sj)("dash:marketInsights").timestamp||void 0},riskAssessment:{exists:(0,w.Sj)("dash:riskAssessment").exists,timestamp:(0,w.Sj)("dash:riskAssessment").timestamp||void 0}};eu(e),await eN();let t=R.J.getInstance();await t.initialize(),eg(!1)}catch(e){console.error("ダッシュボード初期化エラー:",e),ef("ダッシュボードの初期化に失敗しました"),eg(!1)}})()},[]);let eN=async()=>{try{K(new Date().toLocaleString("ja-JP")),eS()}catch(e){console.error("データ読み込みエラー:",e),ef("データの読み込みに失敗しました")}},eS=()=>{var e,t,s,a,r,n,i;let l=[];(null===(e=eh.summary)||void 0===e?void 0:e.exists)&&eh.summary.timestamp&&l.push(S.getFreshnessInfo(eh.summary.timestamp,"cache",60)),(null===(t=eh.stock)||void 0===t?void 0:t.exists)&&eh.stock.timestamp&&l.push(S.getFreshnessInfo(eh.stock.timestamp,"cache",30)),(null===(s=eh.model)||void 0===s?void 0:s.exists)&&eh.model.timestamp&&l.push(S.getFreshnessInfo(eh.model.timestamp,"cache",120)),(null===(a=eh.feature)||void 0===a?void 0:a.exists)&&eh.feature.timestamp&&l.push(S.getFreshnessInfo(eh.feature.timestamp,"cache",60)),(null===(r=eh.pred)||void 0===r?void 0:r.exists)&&eh.pred.timestamp&&l.push(S.getFreshnessInfo(eh.pred.timestamp,"cache",15)),(null===(n=eh.marketInsights)||void 0===n?void 0:n.exists)&&eh.marketInsights.timestamp&&l.push(S.getFreshnessInfo(eh.marketInsights.timestamp,"cache",30)),(null===(i=eh.riskAssessment)||void 0===i?void 0:i.exists)&&eh.riskAssessment.timestamp&&l.push(S.getFreshnessInfo(eh.riskAssessment.timestamp,"cache",60)),eb(l)},ek=async()=>{$(!0),Y("更新中...");try{await eN(),Y("更新完了"),setTimeout(()=>Y(""),2e3)}catch(e){console.error("更新エラー:",e),Y("更新失敗")}finally{$(!1)}},e_=async()=>{$(!0),Y("強制更新中...");try{await eN(),Y("強制更新完了"),setTimeout(()=>Y(""),2e3)}catch(e){console.error("強制更新エラー:",e),Y("強制更新失敗")}finally{$(!1)}},eM=async()=>{$(!0),Y("再計算中...");try{await eN(),Y("再計算完了"),setTimeout(()=>Y(""),2e3)}catch(e){console.error("再計算エラー:",e),Y("再計算失敗")}finally{$(!1)}},eA=e=>{eo(e),el(!0)};return ex?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"ダッシュボードを読み込み中..."})]})}):ep?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(x.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:ep}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"再読み込み"})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X,{}),(0,n.jsx)(W,{children:(0,n.jsx)(q,{componentId:"dashboard-main",children:(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20 lg:pb-0",children:[(0,n.jsx)(V,{activeTab:l,onTabChange:c,onAnalysisClick:()=>et(!0),onSettingsClick:()=>ea(!0),onMonitoringClick:()=>en(!0)}),(0,n.jsx)("header",{className:"hidden lg:block bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,n.jsxs)("div",{"data-guide-target":"welcome",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"J-Quants 株価予測ダッシュボード"}),(0,n.jsx)("p",{className:"text-gray-600",children:"機械学習による株価予測システム"})]}),(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row items-start xl:items-center space-y-2 xl:space-y-0 xl:space-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(g.A,{className:"h-5 w-5 text-green-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"システム: 正常稼働中"})]}),ey.length>0&&(0,n.jsx)(T,{freshnessInfos:ey,onRefreshAll:ek}),ey.length>0&&(0,n.jsx)(C,{freshnessInfos:ey,showDetails:!1,onRefreshAll:ek,className:"hidden xl:block"})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)(E,{onRefresh:ev?ej.actions.refresh:ek,onForceRefresh:ev?ej.actions.refresh:e_,onRecompute:ev?ej.actions.refresh:eM,isLoading:ev?ej.isLoading:Z,lastRefresh:ev?ej.lastUpdated?new Date(ej.lastUpdated):void 0:J?new Date(J):void 0,refreshInterval:5,variant:"default",size:"md",showProgress:!0,showLastRefresh:!0})})]})]})})}),(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsx)("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[{id:"overview",name:"概要",icon:p.A},{id:"analysis",name:"分析",icon:f.A},{id:"models",name:"モデル",icon:y.A},{id:"predictions",name:"予測",icon:b.A}].map(e=>{let t=e.icon;return(0,n.jsxs)("button",{onClick:()=>c(e.id),className:"flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ".concat(l===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,n.jsx)(t,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:e.name})]},e.id)})})}),(0,n.jsx)("div",{className:"mb-6 flex justify-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-2 shadow-sm border flex",children:[(0,n.jsx)("button",{onClick:()=>ew(!0),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(ev?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"実データ (JQuants)"}),(0,n.jsx)("button",{onClick:()=>ew(!1),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(ev?"text-gray-600 hover:text-gray-900":"bg-blue-600 text-white"),children:"サンプルデータ"})]})}),"overview"===l&&(0,n.jsxs)("div",{className:"space-y-6","data-guide-target":"overview",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"システム状況"}),ev&&ej.connectionStatus&&(0,n.jsxs)("div",{className:"flex items-center px-3 py-1 rounded-lg text-sm ".concat(ej.connectionStatus.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:[ej.connectionStatus.success?(0,n.jsx)(g.A,{className:"w-4 h-4 mr-2"}):(0,n.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"JQuants API: ",ej.connectionStatus.success?"接続中":"エラー"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(g.A,{className:"h-8 w-8 text-green-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"システム状態"}),(0,n.jsx)("p",{className:"text-sm text-green-600",children:ev&&(null===(e=ej.connectionStatus)||void 0===e?void 0:e.success)?"JQuants接続中":"正常稼働中"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(j.A,{className:"h-8 w-8 text-blue-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"データ更新"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:ev?ej.lastUpdated?new Date(ej.lastUpdated).toLocaleString("ja-JP"):"未更新":J||"未更新"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(y.A,{className:"h-8 w-8 text-purple-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"分析銘柄数"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:ev&&ej.marketSummary?"".concat(ej.marketSummary.analyzedSymbols,"/").concat(ej.marketSummary.totalSymbols,"件"):"学習済み"})]})]})]}),ev&&ej.marketSummary&&(0,n.jsxs)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ej.marketSummary.recommendations.STRONG_BUY+ej.marketSummary.recommendations.BUY}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"買い推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:ej.marketSummary.recommendations.HOLD}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"ホールド"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ej.marketSummary.recommendations.SELL+ej.marketSummary.recommendations.STRONG_SELL}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"売り推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ej.marketSummary.topGainers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"上昇銘柄"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ej.marketSummary.topLosers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"下落銘柄"})]})]}),!ev&&ey.length>0&&(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(C,{freshnessInfos:ey,showDetails:!0,onRefreshAll:ek})})]}),I&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"パフォーマンス指標"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[I.accuracy||"N/A","%"]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"精度"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:I.mae||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"MAE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:I.rmse||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"RMSE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:I.r2||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"R\xb2"})]})]})]}),F&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"市場インサイト"}),(0,n.jsx)("div",{className:"space-y-3",children:null===(t=F.trends)||void 0===t?void 0:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.description}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat("positive"===e.sentiment?"text-green-600":"negative"===e.sentiment?"text-red-600":"text-gray-600"),children:"positive"===e.sentiment?"上昇":"negative"===e.sentiment?"下降":"中立"})]},t))})]})]}),"analysis"===l&&(0,n.jsx)("div",{className:"space-y-6","data-guide-target":"analysis-features",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"分析機能"}),(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(p.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"分析機能は準備中です"})]})]})}),"models"===l&&(0,n.jsx)("div",{className:"space-y-6","data-guide-target":"model-comparison",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"モデル比較"}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"モデル名"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"タイプ"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MAE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RMSE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R\xb2"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ランク"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>eA(e),children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.mae.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.rmse.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.r2.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,n.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(1===e.rank?"bg-green-100 text-green-800":e.rank<=3?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:["#",e.rank]})})]},t))})]})})]})}),"predictions"===l&&(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"予測結果"}),(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(b.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"予測機能は準備中です"})]})]})})]}),ee&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"分析実行"}),(0,n.jsx)("button",{onClick:()=>et(!1),className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)(v.A,{className:"h-6 w-6"})})]}),(0,n.jsx)(U,{})]})})]})})})]})}function $(){return(0,n.jsx)(l.tH,{fallbackRender:e=>{let{error:t,resetErrorBoundary:s}=e;return(0,n.jsx)(L,{error:t})},children:(0,n.jsx)(o.Z,{children:(0,n.jsx)(O,{children:(0,n.jsx)(Y,{children:(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}),children:(0,n.jsx)(Z,{})})})})})})}(0,c.default)(()=>s.e(6825).then(s.bind(s,6825)).then(e=>({default:e.MetricTooltip})),{loadableGenerated:{webpack:()=>[6825]},ssr:!1}),(0,c.default)(()=>s.e(6825).then(s.bind(s,6825)).then(e=>({default:e.SimpleTooltip})),{loadableGenerated:{webpack:()=>[6825]},ssr:!1}),(0,c.default)(()=>Promise.resolve().then(s.bind(s,7020)),{loadableGenerated:{webpack:()=>[7020]},ssr:!1}),(0,c.default)(()=>Promise.resolve().then(s.bind(s,7020)).then(e=>({default:e.ChecklistBadge})),{loadableGenerated:{webpack:()=>[7020]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(7378),s.e(220),s.e(4339)]).then(s.bind(s,4339)),{loadableGenerated:{webpack:()=>[4339]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(7378),s.e(220),s.e(5393),s.e(8772)]).then(s.bind(s,8772)),{loadableGenerated:{webpack:()=>[8772]},ssr:!1}),(0,c.default)(()=>Promise.all([s.e(7396),s.e(7050)]).then(s.bind(s,7050)),{loadableGenerated:{webpack:()=>[7050]},ssr:!1})},7020:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ChecklistBadge:()=>h,DEFAULT_CHECKLIST_ITEMS:()=>u,default:()=>m});var a=s(9233),r=s(5843),n=s(5155),i=s(2115),l=s(767),c=s(3239),o=s(3565),d=s(817);function m(e){let{items:t,onItemComplete:s,onItemReset:m,onComplete:h,className:u=""}=e,[x,g]=(0,i.useState)(!0),[p,f]=(0,i.useState)(0);(0,i.useEffect)(()=>{let e=t.filter(e=>e.completed).length;f(e),e===t.length&&setTimeout(()=>{g(!1),h()},2e3)},[t,h]);let y=e=>{e.completed?(m(e.id),d.oV.screenReader.announceChecklistItem(e.title,!1)):(s(e.id),d.oV.screenReader.announceChecklistItem(e.title,!0))};return x?(0,n.jsxs)("div",(0,r._)((0,a._)({className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 ".concat(u)},d.oV.generateAriaAttributes("checklist")),{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"初回チェックリスト"}),(0,n.jsxs)("div",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[p," / ",t.length]})]}),(0,n.jsx)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"チェックリストを閉じる",children:(0,n.jsx)(l.A,{size:16})})]}),(0,n.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,n.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded-md cursor-pointer transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(e.completed?"bg-green-50 hover:bg-green-100":"bg-gray-50 hover:bg-gray-100"),onClick:()=>y(e),role:"listitem",tabIndex:0,"aria-checked":e.completed,"aria-label":"".concat(e.title,": ").concat(e.description),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),y(e))},children:[(0,n.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:e.completed?(0,n.jsx)(c.A,{size:16,className:"text-green-600"}):(0,n.jsx)(o.A,{size:16,className:"text-gray-400"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium ".concat(e.completed?"text-green-800 line-through":"text-gray-900"),children:e.title}),(0,n.jsx)("p",{className:"text-xs ".concat(e.completed?"text-green-600":"text-gray-600"),children:e.description})]})]},e.id))}),p===t.length&&(0,n.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,n.jsx)(c.A,{size:16}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"お疲れ様でした！"})]}),(0,n.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"主要機能を理解できました。明日からは自動案内しません。"})]})]})):null}function h(e){let{completedCount:t,totalCount:s,onClick:a}=e,r=s>0?t/s*100:0;return t===s?null:(0,n.jsxs)("button",{onClick:a,className:"relative flex items-center gap-2 px-3 py-1.5 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-xs font-medium transition-colors","aria-label":"チェックリスト: ".concat(t,"/").concat(s," 完了"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(c.A,{size:14}),(0,n.jsxs)("span",{children:[t,"/",s]})]}),(0,n.jsx)("div",{className:"w-12 h-1 bg-blue-200 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:"".concat(r,"%")}})})]})}let u=[{id:"update-check",title:"データ更新（Fresh/Stale）を確認",description:"最終更新と鮮度バッジで状態を判断",completed:!1},{id:"top5-candidates",title:"上位5銘柄を確認",description:"シグナル・予測上位・リスク下位の根拠を確認",completed:!1},{id:"holding-action",title:"保有の継続/利確/損切りを選択",description:"数量候補（25%/50%）から選ぶ",completed:!1},{id:"daily-memo",title:"本日のメモを保存",description:"1行メモをローカルに保存",completed:!1}]},7581:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c,t:()=>o});var a=s(9233),r=s(5155),n=s(2115);let i={prediction:{days:30},model:{type:"all",primary_model:"xgboost",compare_models:!0,auto_retrain:!1,retrain_frequency:"weekly"},data:{refresh_interval:"daily",max_data_points:1e3,include_technical_indicators:!0},features:{selected:["sma_5","sma_10","sma_25","sma_50","rsi","macd"]},ui:{theme:"light",refresh_rate:30,show_tooltips:!0}},l=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,n.useState)(i),[o,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),u=async()=>{try{d(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,a._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{d(!1)}},x=async()=>{try{h(!0),localStorage.setItem("jquants-settings",JSON.stringify(s))}catch(e){throw console.error("設定保存エラー:",e),e}finally{h(!1)}};return(0,n.useEffect)(()=>{(async()=>{try{d(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,a._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{d(!1)}})()},[]),(0,r.jsx)(l.Provider,{value:{settings:s,updateSettings:e=>{c(t=>(0,a._)({},t,e))},loadSettings:u,saveSettings:x,resetSettings:()=>{c(i)},isLoading:o,isSaving:m},children:t})}function o(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e}},4561:(e,t,s)=>{"use strict";s.d(t,{P:()=>n});var a=s(2115),r=s(7581);function n(){let{settings:e}=(0,r.t)(),[t,s]=(0,a.useState)(!1),[n,i]=(0,a.useState)(0),[l,c]=(0,a.useState)("");return{runAnalysisWithSettings:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{s(!0),i(0),c("設定に基づく分析を開始しています...");let a={prediction_days:e.prediction.days,primary_model:e.model.primary_model,compare_models:e.model.compare_models,auto_retrain:e.model.auto_retrain,retrain_frequency:e.model.retrain_frequency,max_data_points:e.data.max_data_points,include_technical_indicators:e.data.include_technical_indicators,selected_features:e.features.selected,symbols:t.symbols||[],analysis_type:t.analysisType||"comprehensive",use_settings:!1!==t.useSettings},r=setInterval(()=>{i(e=>e>=90?(clearInterval(r),e):e+10*Math.random())},500);c("分析パラメータを送信中..."),i(10),await new Promise(e=>setTimeout(e,1e3)),c("分析を実行中..."),i(50);let n={success:!0,analysis_id:"analysis_".concat(Date.now()),predictions:[{symbol:"7203.T",name:"トヨタ自動車",prediction:"BUY",confidence:.85,price:2500,change:2.5},{symbol:"6758.T",name:"ソニーグループ",prediction:"SELL",confidence:.72,price:12e3,change:-1.8}],summary:{total_predictions:2,buy_signals:1,sell_signals:1,avg_confidence:.785}};return c("分析が完了しました。データを更新しています..."),i(100),{success:!0,result:n,settings:a}}catch(e){return console.error("分析実行エラー:",e),c("分析エラー: ".concat(e instanceof Error?e.message:"不明なエラー")),{success:!1,error:e instanceof Error?e.message:"不明なエラー"}}finally{s(!1),setTimeout(()=>{i(0),c("")},2e3)}},isAnalyzing:t,analysisProgress:n,analysisStatus:l,getAnalysisDescription:()=>{let t=e.model.compare_models?"複数モデル比較（メイン: ".concat(e.model.primary_model,"）"):"単一モデル（".concat(e.model.primary_model,"）"),s=e.model.auto_retrain?"自動再訓練（".concat(e.model.retrain_frequency,"）"):"手動再訓練";return{prediction:"".concat(e.prediction.days,"日先予測"),model:t,retrain:s,features:"".concat(e.features.selected.length,"個の特徴量"),data:"".concat(e.data.max_data_points,"データポイント")}}}}},817:(e,t,s)=>{"use strict";s.d(t,{oV:()=>o});var a=s(9233),r=s(5843);let n={focusRing:!0,screenReader:!0,highContrast:!0,keyboardNavigation:!0,ariaLabels:{tour:"ガイドツアー",tooltip:"ツールチップ",checklist:"チェックリスト",help:"ヘルプ",glossary:"用語集"}};class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}saveFocus(){this.currentFocus=document.activeElement,this.currentFocus&&this.focusStack.push(this.currentFocus)}restoreFocus(){if(this.focusStack.length>0){let e=this.focusStack.pop();e&&e.focus&&e.focus()}}focusElement(e){e&&e.focus&&e.focus()}trapFocus(e){let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),s=t[0],a=t[t.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===s&&(a.focus(),e.preventDefault()):document.activeElement===a&&(s.focus(),e.preventDefault()))};return e.addEventListener("keydown",r),()=>{e.removeEventListener("keydown",r)}}clearFocusStack(){this.focusStack=[],this.currentFocus=null}constructor(){this.focusStack=[],this.currentFocus=null}}class l{static getInstance(){return l.instance||(l.instance=new l),l.instance}createAnnouncementElement(){this.announcementElement=document.createElement("div"),this.announcementElement.setAttribute("aria-live","polite"),this.announcementElement.setAttribute("aria-atomic","true"),this.announcementElement.className="sr-only",this.announcementElement.style.cssText="\n      position: absolute;\n      left: -10000px;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    ",document.body.appendChild(this.announcementElement)}announce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite";this.announcementElement&&(this.announcementElement.setAttribute("aria-live",t),this.announcementElement.textContent=e,setTimeout(()=>{this.announcementElement&&(this.announcementElement.textContent="")},1e3))}announceStep(e,t){let s="ガイドステップ: ".concat(e,". ").concat(t);this.announce(s,"assertive")}announceChecklistItem(e,t){let s="チェックリスト項目: ".concat(e," - ").concat(t?"完了":"未完了");this.announce(s)}announceTooltip(e){this.announce("ツールチップ: ".concat(e))}constructor(){this.announcementElement=null,this.createAnnouncementElement()}}class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}registerShortcut(e,t){return this.shortcuts.set(e,t),()=>{this.shortcuts.delete(e)}}start(){document.addEventListener("keydown",this.handleKeyDown)}stop(){document.removeEventListener("keydown",this.handleKeyDown)}clear(){this.shortcuts.clear()}constructor(){this.shortcuts=new Map,this.handleKeyDown=e=>{let t=e.key,s=this.shortcuts.get(t);s&&(e.preventDefault(),e.stopPropagation(),s())}}}let o={focusManager:i.getInstance(),screenReader:l.getInstance(),keyboard:c.getInstance(),isHighContrast:function(){if(window.matchMedia("(-ms-high-contrast: active)").matches)return!0;let e=window.getComputedStyle(document.body);return e.backgroundColor===e.color}(),colorBlindness:function(){let e=document.createElement("canvas").getContext("2d");if(!e)return"normal";e.fillStyle="#ff0000",e.fillRect(0,0,1,1);let t=e.getImageData(0,0,1,1).data;return 255===t[0]&&0===t[1]&&t[2],"normal"}(),generateAriaAttributes:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t={role:"button",tabIndex:0,"aria-label":n.ariaLabels[e]||e};switch(e){case"tour":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"tour-title","aria-describedby":"tour-description"});case"tooltip":return(0,r._)((0,a._)({},t),{role:"tooltip","aria-live":"polite"});case"checklist":return(0,r._)((0,a._)({},t),{role:"list","aria-label":"チェックリスト"});case"help":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"help-title"});case"glossary":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"glossary-title"});default:return t}},config:n};o.focusManager,o.screenReader,o.keyboard},2320:(e,t,s)=>{"use strict";s.d(t,{J:()=>r});var a=s(2818);class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){try{await this.loadConfig(),console.log("✅ 通知サービス初期化完了")}catch(e){throw console.error("通知サービス初期化エラー:",e),e}}async loadConfig(){try{let e=localStorage.getItem("notification-config");if(e)try{return this.config=JSON.parse(e),this.config}catch(e){console.warn("通知設定のJSON解析に失敗しました。デフォルトにフォールバックします。")}let t=void 0!==a&&a.env&&!1,s={email:{enabled:!1,smtp_server:"smtp.gmail.com",smtp_port:587,email_user:"",email_password:"",email_to:""},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:"mailto:example@example.com"},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0}};if(t){try{localStorage.setItem("notification-config",JSON.stringify(s))}catch(e){}return this.config=s,s}throw Error("設定が見つかりません")}catch(e){throw console.error("設定読み込みエラー:",e),e}}async saveConfig(e){try{localStorage.setItem("notification-config",JSON.stringify(e)),this.config=e}catch(e){throw console.error("設定保存エラー:",e),e}}async initializePushNotifications(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("プッシュ通知がサポートされていません"),!1;try{this.registration=await navigator.serviceWorker.register("/sw.js");let e=await Notification.requestPermission();if("granted"!==e)return console.warn("通知の許可が得られませんでした"),!1;return await this.subscribeToPushNotifications(),!0}catch(e){return console.error("プッシュ通知の初期化エラー:",e),!1}}async subscribeToPushNotifications(){var e;if(this.registration&&(null===(e=this.config)||void 0===e?void 0:e.push.enabled))try{let e=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.push.vapid_public_key});localStorage.setItem("push-subscription",JSON.stringify(e))}catch(e){console.error("プッシュ通知の購読エラー:",e)}}async sendLocalNotification(e){if(!this.registration||"granted"!==Notification.permission)return;let t={body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:e.type,data:e.data,requireInteraction:"high"===e.priority};await this.registration.showNotification(e.title,t)}async notifyAnalysisComplete(e){let t={type:"analysis_complete",title:"\uD83D\uDCCA 株価分析完了",message:"分析が完了しました。".concat(e.buy_candidates||0,"件の買い候補、").concat(e.sell_candidates||0,"件の売り候補が見つかりました。"),data:e,timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyError(e){let t={type:"error",title:"❌ 分析エラー",message:"分析中にエラーが発生しました: ".concat(e),timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyRecommendation(e,t,s){let a={type:"recommendation",title:"\uD83D\uDCA1 ".concat(e," ").concat(t,"推奨"),message:s,data:{symbol:e,action:t,reason:s},timestamp:new Date().toISOString(),priority:"medium"};await this.sendLocalNotification(a)}async notifyRiskAlert(e,t){let s={type:"risk_alert",title:"⚠️ ".concat(e," リスク警告"),message:t,data:{symbol:e,message:t},timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(s)}async startAutoUpdate(){try{if(!(await fetch("/api/start-auto-update",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("自動更新の開始に失敗しました");console.log("自動更新を開始しました")}catch(e){throw console.error("自動更新開始エラー:",e),e}}async stopAutoUpdate(){try{localStorage.removeItem("auto-update-enabled"),console.log("自動更新設定を削除しました（静的サイトでは実際の自動更新は実行されません）")}catch(e){throw console.error("自動更新停止エラー:",e),e}}async getNotificationHistory(){try{let e=localStorage.getItem("notification-history");if(e)return JSON.parse(e);return[]}catch(e){return console.error("通知履歴取得エラー:",e),[]}}constructor(){this.config=null,this.registration=null}}}},e=>{var t=t=>e(e.s=t);e.O(0,[436,6669,8441,1517,7358],()=>t(8783)),_N_E=e.O()}]);