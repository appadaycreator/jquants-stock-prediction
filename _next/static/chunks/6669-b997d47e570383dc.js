"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6669],{1289:(t,e,a)=>{a.d(e,{o:()=>m});var n=a(9233),r=a(5843),o=a(2115),s=a(9361);async function c(t){try{let e=await (0,s.Co)(),a=(0,s.FA)(t||null,e),{data:n,fromCache:r}=await (0,s.p4)("today:summary","/data/".concat(a,"/summary.json"),{ttlMs:36e5,timeoutMs:6e3,retries:3,retryDelay:800});if(!r)try{localStorage.setItem("today_summary",JSON.stringify(n)),localStorage.setItem("today_summary_timestamp",new Date().toISOString())}catch(t){}if(!n)throw Error("today_summary_missing");return n}catch(e){console.error("fetchTodaySummary error:",e);let t=localStorage.getItem("today_summary");if(t)try{return JSON.parse(t)}catch(t){console.warn("Failed to parse cached data:",t)}throw e}}function i(){return localStorage.getItem("today_summary_timestamp")}function l(t){if(!t)return"Unknown";try{let e=new Date(t).getTime();return(Date.now()-e)/36e5<=6?"Fresh":"Stale"}catch(t){return"Unknown"}}function u(t,e){var a,n,r;let o=[],s=function(t){switch(t){case"STRONG_BUY":return 1;case"BUY":return .8;case"HOLD":default:return .5;case"SELL":return .2;case"STRONG_SELL":return 0}}(t.recommendation);o.push("推奨度: ".concat(t.recommendation));let c=null!==(n=t.confidence)&&void 0!==n?n:.5;o.push("信頼度: ".concat(Math.round(100*c),"%"));let i=null!==(r=null===(a=e.warnings)||void 0===a?void 0:a.some(e=>e.symbol===t.symbol))&&void 0!==r&&r;i&&o.push("リスク警告あり: スコア減点");let l=.6*s+.4*c-(i?.15:0);return("BUY"===t.recommendation||"STRONG_BUY"===t.recommendation)&&(l+=.05),{score:l,reasons:o}}function h(t){if(!t)return[];let e=[];try{let t=localStorage.getItem("portfolio_symbols");t&&(e=JSON.parse(t))}catch(t){}return e&&0!==e.length||(e=t.candidates.slice(0,3).map(t=>t.symbol)),e.map(e=>{var a,n,r;let o=t.candidates.find(t=>t.symbol===e),s=null!==(a=null==o?void 0:o.name)&&void 0!==a?a:e,c="継続",i="トレンドに大きな変化なし";if(o){if("SELL"===o.recommendation||"STRONG_SELL"===o.recommendation){let e=null!==(r=null===(n=t.warnings)||void 0===n?void 0:n.some(t=>t.symbol===o.symbol))&&void 0!==r&&r;c=e?"損切り":"利確",i=e?"リスク警告により手仕舞い推奨":"シグナル弱化により利益確定推奨"}else"BUY"===o.recommendation||"STRONG_BUY"===o.recommendation?(c="継続",i="上昇シグナル継続"):(c="継続",i="中立シグナル")}return{symbol:e,name:s,proposal:c,qtyOptions:[.25,.5],reason:i}})}function d(){let t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"fiveMinMemo:".concat(e,"-").concat(a,"-").concat(n)}function m(){let[t,e]=(0,o.useState)({isLoading:!0,error:null,summary:null,lastUpdated:null,freshness:"Unknown",topCandidates:[],holdingProposals:[],memo:""}),a=(0,o.useCallback)(()=>{try{let t=d(),a=localStorage.getItem(t)||"";e(t=>(0,r._)((0,n._)({},t),{memo:a}))}catch(t){}},[]),s=(0,o.useCallback)(t=>{try{let a=d();localStorage.setItem(a,t),e(e=>(0,r._)((0,n._)({},e),{memo:t}))}catch(t){}},[]),m=(0,o.useCallback)(async()=>{e(t=>(0,r._)((0,n._)({},t),{isLoading:!0,error:null}));try{let t=await c();!function(t){try{localStorage.setItem("today_summary",JSON.stringify(t)),localStorage.setItem("today_summary_timestamp",new Date().toISOString())}catch(t){console.warn("Failed to save to cache:",t)}}(t);let a=i()||t.generated_at||new Date().toISOString(),o=l(a),s=(t.candidates||[]).map(e=>{let{score:a,reasons:o}=u(e,t);return(0,r._)((0,n._)({},e),{routine_score:a,routine_reasons:o})}).sort((t,e)=>e.routine_score-t.routine_score).slice(0,5),d=h(t);e(e=>(0,r._)((0,n._)({},e),{isLoading:!1,summary:t,lastUpdated:a,freshness:o,topCandidates:s,holdingProposals:d}))}catch(a){let t=function(){try{let t=localStorage.getItem("today_summary");if(t)return JSON.parse(t)}catch(t){console.warn("Failed to get cached data:",t)}return null}();if(t){let a=i()||t.generated_at||null,o=l(a),s=(t.candidates||[]).map(e=>{let{score:a,reasons:o}=u(e,t);return(0,r._)((0,n._)({},e),{routine_score:a,routine_reasons:o})}).sort((t,e)=>e.routine_score-t.routine_score).slice(0,5),c=h(t);e(e=>(0,r._)((0,n._)({},e),{isLoading:!1,summary:t,lastUpdated:a,freshness:o,topCandidates:s,holdingProposals:c,error:"最新データの取得に失敗。キャッシュを表示中。"}))}else e(t=>(0,r._)((0,n._)({},t),{isLoading:!1,error:(null==a?void 0:a.message)||"データ取得に失敗しました"}))}},[]);(0,o.useEffect)(()=>{m(),a()},[m,a]);let g=(0,o.useMemo)(()=>t.freshness,[t.freshness]);return(0,r._)((0,n._)({},t),{freshnessLabel:g,actions:{refresh:m,saveMemo:s,setMemo:t=>e(e=>(0,r._)((0,n._)({},e),{memo:t}))}})}},9361:(t,e,a)=>{a.d(e,{Co:()=>s,FA:()=>c,p4:()=>i});var n=a(7209);function r(t,e){try{localStorage.setItem(t,JSON.stringify({v:e,t:Date.now()}))}catch(t){}}function o(t,e){try{let a=localStorage.getItem(t);if(!a)return null;let{v:n,t:r}=JSON.parse(a);if(e&&Date.now()-r>e)return null;return n}catch(t){return null}}async function s(){let t="latest:index",e=o(t,216e5);if(e)return(0,n.ZQ)("/data/latest/index.json",{cacheKey:t,cacheTtlMs:6e5,timeout:6e3,retries:2,retryDelay:800}).then(e=>{let{data:a,fromCache:n}=e;n||r(t,a)}).catch(()=>{}),e;let{data:a,fromCache:s}=await (0,n.ZQ)("/data/latest/index.json",{cacheKey:t,cacheTtlMs:6e5,timeout:6e3,retries:2,retryDelay:800});return s||r(t,a),a}function c(t,e){return t&&e.dates.includes(t)?t:(t?e.dates.find(e=>e<=t):e.latest)||e.latest}async function i(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttlMs:s=36e5,timeoutMs:c=6e3,retries:i=3,retryDelay:l=800}=a,u=o("swr:".concat(t),s);if(u)return(0,n.ZQ)(e,{cacheKey:"swr:".concat(t),cacheTtlMs:s,timeout:c,retries:i,retryDelay:l}).then(e=>{let{data:a,fromCache:n}=e;n||r("swr:".concat(t),a)}).catch(()=>{}),{data:u,fromCache:!0};let{data:h,fromCache:d}=await (0,n.ZQ)(e,{cacheKey:"swr:".concat(t),cacheTtlMs:s,timeout:c,retries:i,retryDelay:l});return d||r("swr:".concat(t),h),{data:h,fromCache:d}}},7209:(t,e,a)=>{a.d(e,{Sj:()=>c,ZQ:()=>l,x6:()=>o});var n=a(9233);a(2115);class r extends Error{constructor(t,e,a,n){super(t),this.code=e,this.status=a,this.retryHint=n,this.name="AppError"}}async function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t=>{try{if(/^https?:\/\//i.test(t))return t;if(t.startsWith("/"))return"".concat("/jquants-stock-prediction").concat(t);return t}catch(e){return t}},{signal:o,timeout:s=1e4,retries:c=3,retryDelay:i=1e3,method:l,headers:u,json:h,idempotencyKey:d}=e,m=new AbortController,g=setTimeout(()=>m.abort(),s);o&&o.addEventListener("abort",()=>m.abort());let f=null;for(let e=0;e<=c;e++)try{let e={"Cache-Control":"no-cache",Pragma:"no-cache"},o=void 0!==h;o&&(e["Content-Type"]="application/json");let s=l||(o?"POST":"GET"),c=/^(POST|PUT|PATCH|DELETE)$/i.test(s),i=!0===d?function(){try{var t,e;let a=globalThis.crypto&&(null===(t=(e=globalThis.crypto).randomUUID)||void 0===t?void 0:t.call(e))||void 0;if(a)return"idem_".concat(a)}catch(t){}let a=Math.random().toString(36).slice(2);return"idem_".concat(Date.now(),"_").concat(a)}():"string"==typeof d?d:void 0;c&&i&&(e["Idempotency-Key"]=i);let f=await fetch(a(t),{signal:m.signal,cache:"no-cache",method:s,headers:(0,n._)({},e,u||{}),body:o?JSON.stringify(h):void 0});if(clearTimeout(g),!f.ok)try{let t=await f.text(),e=JSON.parse(t);if(e&&"object"==typeof e&&e.error_code&&e.user_message)throw new r(e.user_message,String(e.error_code),f.status,e.retry_hint);throw new r("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}catch(t){if(t instanceof r)throw t;throw new r("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}let S=f.headers.get("content-type");if(!S||!S.includes("application/json"))throw new r("レスポンスがJSON形式ではありません","INVALID_CONTENT_TYPE");return await f.json()}catch(a){if(f=a,a instanceof Error&&"AbortError"===a.name)throw new r("リクエストが中断されました","ABORTED");if(e<c){let n=i*Math.pow(2,e);console.warn("Fetch attempt ".concat(e+1," failed for ").concat(t,":"),a),console.log("Retrying in ".concat(n,"ms...")),await new Promise(t=>setTimeout(t,n))}}if(f instanceof r)throw f;throw new r("すべてのリトライ試行が失敗しました: ".concat((null==f?void 0:f.message)||"Unknown error"),"ALL_RETRIES_FAILED")}let s="app_cache:";function c(t){try{let e=function(t){try{let e=localStorage.getItem(s+t);if(!e)return null;let a=JSON.parse(e);return"number"==typeof a.t?a.t:null}catch(t){return null}}(t);if(!e)return{exists:!1,timestamp:null,ageMs:null};return{exists:!0,timestamp:e,ageMs:Date.now()-e}}catch(t){return{exists:!1,timestamp:null,ageMs:null}}}function i(t,e){try{let a=localStorage.getItem(s+t);if(!a)return null;let n=JSON.parse(a);if(e&&Date.now()-n.t>e)return null;return n.v}catch(t){return null}}async function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{cacheKey:a,cacheTtlMs:n}=e;if(a){let t=i(a,n);if(t)return console.log("Using cached data for ".concat(a)),{data:t,fromCache:!0}}try{let n=await o(t,e);return a&&(function(t,e){try{let a={v:e,t:Date.now()};localStorage.setItem(s+t,JSON.stringify(a))}catch(t){}}(a,n),console.log("Cached fresh data for ".concat(a))),{data:n,fromCache:!1}}catch(n){if(console.warn("Fetch failed for ".concat(t,", attempting cache fallback:"),n),a){let t=i(a);if(t)return console.log("Using stale cache for ".concat(a," due to fetch failure")),{data:t,fromCache:!0}}let e=function(t){try{if(t.includes("/api/today"))return{date:new Date().toISOString().split("T")[0],summary:"データ取得中...",status:"loading"};if(t.includes("/api/predictions"))return{predictions:[],status:"loading",message:"予測データを取得中..."};if(t.includes("/api/risk"))return{risk_level:"medium",status:"loading",message:"リスク分析中..."};if(t.includes("/api/dashboard"))return{summary:{},status:"loading",message:"ダッシュボードデータを読み込み中..."};return{status:"loading",message:"データを読み込み中...",timestamp:Date.now()}}catch(t){return null}}(t);if(e)return console.log("Using default data for ".concat(t)),{data:e,fromCache:!0};throw n}}},795:(t,e,a)=>{a.d(e,{fg:()=>c,V3:()=>i,rN:()=>s});class n{async initDB(){if("undefined"==typeof indexedDB){console.info("IndexedDBはクライアントサイドでのみ利用可能です");return}return new Promise((t,e)=>{let a=indexedDB.open(this.DB_NAME,this.DB_VERSION);a.onerror=()=>{console.error("IndexedDB初期化エラー:",a.error),e(a.error)},a.onsuccess=()=>{this.db=a.result,console.info("IndexedDB初期化完了"),t()},a.onupgradeneeded=t=>{let e=t.target.result;if(!e.objectStoreNames.contains(this.STORE_NAME)){let t=e.createObjectStore(this.STORE_NAME,{keyPath:["symbol","date"]});t.createIndex("symbol","symbol",{unique:!1}),t.createIndex("date","date",{unique:!1})}e.objectStoreNames.contains(this.METADATA_STORE)||e.createObjectStore(this.METADATA_STORE,{keyPath:"symbol"})}})}async authenticate(){try{if(this.accessToken&&(await this.testConnectionInternal()).success)return{success:!0,message:"既存のトークンで認証済み"};if(!this.config.email||!this.config.password)return{success:!1,message:"認証情報が設定されていません。環境変数JQUANTS_EMAIL, JQUANTS_PASSWORDを設定してください。"};console.info("J-Quants認証開始");let t=await fetch("https://api.jquants.com/v1/token/auth_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mailaddress:this.config.email,password:this.config.password}),signal:AbortSignal.timeout(this.config.timeout)});if(!t.ok)throw Error("認証失敗: HTTP ".concat(t.status));let e=await t.json();if(this.refreshToken=e.refreshToken||e.refreshtoken||null,!this.refreshToken)throw Error("リフレッシュトークンが取得できませんでした");let a=await fetch("https://api.jquants.com/v1/token/auth_refresh?refreshtoken=".concat(encodeURIComponent(this.refreshToken)),{method:"POST",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(this.config.timeout)});if(!a.ok)throw Error("トークン取得失敗: HTTP ".concat(a.status));let n=await a.json();return this.accessToken=n.idtoken||n.idToken||null,console.info("J-Quants認証成功"),{success:!0,message:"認証が完了しました"}}catch(t){return console.error("J-Quants認証エラー:",t),{success:!1,message:"認証失敗: ".concat(t instanceof Error?t.message:"不明なエラー")}}}async getAllSymbols(){try{await this.ensureAuthenticated();let t=await fetch("".concat(this.config.baseUrl,"/listed/info"),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),"Content-Type":"application/json"},signal:AbortSignal.timeout(this.config.timeout)});if(!t.ok)return console.error("全銘柄一覧取得失敗",t.status,t.statusText),[];let e=await t.json();return((null==e?void 0:e.info)||[]).map(t=>({code:(null==t?void 0:t.Code)||(null==t?void 0:t.code),name:(null==t?void 0:t.CompanyName)||(null==t?void 0:t.name)||(null==t?void 0:t.CompanyNameEnglish)||"不明",sector:(null==t?void 0:t.Sector33CodeName)||(null==t?void 0:t.sector)})).filter(t=>!!t.code&&!!t.name)}catch(t){return console.error("全銘柄一覧取得エラー:",t),[]}}async ensureAuthenticated(){if(!this.accessToken){let t=await this.authenticate();if(!t.success)throw Error(t.message)}}async testConnectionInternal(){try{var t;let e=await fetch("".concat(this.config.baseUrl,"/listed/info"),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),"Content-Type":"application/json"},signal:AbortSignal.timeout(this.config.timeout)});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let a=await e.json();return{success:!0,message:"接続成功: ".concat((null==a?void 0:null===(t=a.info)||void 0===t?void 0:t.length)||0,"件の銘柄データを取得")}}catch(t){return{success:!1,message:"接続失敗: ".concat(t instanceof Error?t.message:"不明なエラー")}}}async testConnection(){try{console.info("J-Quants接続テスト開始"),await this.ensureAuthenticated();let t=await this.testConnectionInternal();return t.success?console.info("J-Quants接続テスト成功",t.message):console.error("J-Quants接続テスト失敗",t.message),t}catch(t){return console.error("J-Quants接続テストエラー:",t),{success:!1,message:"接続失敗: ".concat(t instanceof Error?t.message:"不明なエラー")}}}async getStockData(t,e,a){let n=!(arguments.length>3)||void 0===arguments[3]||arguments[3];try{if(console.info("株価データ取得開始",{symbol:t,startDate:e,endDate:a,useCache:n}),await this.ensureAuthenticated(),n){let n=await this.getCachedData(t,e,a);if(n.length>0)return console.info("キャッシュからデータ取得",{symbol:t,count:n.length,dateRange:"".concat(e," - ").concat(a)}),n}let r=await this.fetchFromAPI(t,e,a);return n&&r.length>0&&await this.saveToCache(t,r,e,a),console.info("APIからデータ取得完了",{symbol:t,count:r.length}),r}catch(t){throw console.error("株価データ取得エラー:",t),t}}async getIncrementalData(t){try{let e=new Date("2025-07-10"),a=new Date,n=a>e?e:a,r=new Date(n.getTime()-6048e5).toISOString().split("T")[0],o=n.toISOString().split("T")[0];console.info("差分更新開始",{symbol:t,dateRange:"".concat(r," - ").concat(o)});let s=await this.getStockData(t,r,o,!1),c=[...await this.getCachedData(t,"2020-01-01",r),...s].sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime());return await this.saveToCache(t,c,"2020-01-01",o),console.info("差分更新完了",{symbol:t,totalCount:c.length,newCount:s.length}),c}catch(t){throw console.error("差分更新エラー:",t),t}}async fetchFromAPI(t,e,a){let n=new URLSearchParams({code:t,from:e,to:a}),r=await fetch("https://api.jquants.com/v1/prices/daily_quotes?".concat(n),{method:"GET",headers:{Authorization:"Bearer ".concat(this.accessToken),"Content-Type":"application/json"},signal:AbortSignal.timeout(this.config.timeout)});if(!r.ok){let o=await r.text().catch(()=>"エラーレスポンスの読み取りに失敗");if(400===r.status&&o.includes("subscription covers"))return console.warn("サブスクリプション期間外のデータ要求: ".concat(t," (").concat(e," - ").concat(a,")")),this.generateSampleStockData(t,e,a);throw console.error("API取得失敗: HTTP ".concat(r.status),{url:"https://api.jquants.com/v1/prices/daily_quotes?".concat(n),status:r.status,statusText:r.statusText,error:o,params:{symbol:t,startDate:e,endDate:a}}),Error("API取得失敗: HTTP ".concat(r.status," - ").concat(o))}let o=await r.json();return this.transformAPIResponse(o,t)}generateSampleStockData(t,e,a){let n=[],r=new Date(e),o=new Date(a);for(let e=new Date(r);e<=o;e.setDate(e.getDate()+1)){if(0===e.getDay()||6===e.getDay())continue;let a=1e3+5e3*Math.random(),r=(Math.random()-.5)*100;n.push({date:e.toISOString().split("T")[0],code:t,open:a+r,high:a+r+50*Math.random(),low:a+r-50*Math.random(),close:a+r+(Math.random()-.5)*20,volume:Math.floor(1e6*Math.random()),sma_5:a+.8*r,sma_10:a+.6*r,sma_25:a+.4*r,sma_50:a+.2*r})}return console.info("サンプルデータを生成: ".concat(t," (").concat(n.length,"件)")),n}transformAPIResponse(t,e){return(null==t?void 0:t.daily_quotes)?t.daily_quotes.filter(t=>t.Code===e).map(t=>({date:t.Date,code:t.Code,open:parseFloat(t.Open)||0,high:parseFloat(t.High)||0,low:parseFloat(t.Low)||0,close:parseFloat(t.Close)||0,volume:parseInt(t.Volume)||0,sma_5:void 0,sma_10:void 0,sma_25:void 0,sma_50:void 0})).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()):[]}async getCachedData(t,e,a){return this.db?new Promise((n,r)=>{let o=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).index("symbol").getAll(t);o.onsuccess=()=>{n(o.result.filter(t=>t.date>=e&&t.date<=a))},o.onerror=()=>{console.error("キャッシュ取得エラー:",o.error),r(o.error)}}):[]}async saveToCache(t,e,a,n){if(this.db&&0!==e.length)return new Promise((r,o)=>{let s=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readwrite"),c=s.objectStore(this.STORE_NAME),i=s.objectStore(this.METADATA_STORE),l=0,u=e.length+1;e.forEach(t=>{let e=c.put(t);e.onsuccess=()=>{++l===u&&r()},e.onerror=()=>{console.error("キャッシュ保存エラー:",e.error),o(e.error)}});let h={lastUpdated:new Date().toISOString(),dataVersion:"1.0",symbol:t,dateRange:{start:a,end:n}},d=i.put(h);d.onsuccess=()=>{++l===u&&r()},d.onerror=()=>{console.error("メタデータ保存エラー:",d.error),o(d.error)}})}async clearCache(t){if(this.db)return new Promise((e,a)=>{let n=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readwrite");if(t){let a=n.objectStore(this.STORE_NAME),r=a.index("symbol").getAll(t);r.onsuccess=()=>{let t=r.result,n=0;t.forEach(r=>{a.delete([r.symbol,r.date]).onsuccess=()=>{++n===t.length&&e()}})}}else{let t=n.objectStore(this.STORE_NAME),a=n.objectStore(this.METADATA_STORE);t.clear(),a.clear(),e()}})}async getCacheStats(){return this.db?new Promise((t,e)=>{let a=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readonly"),n=a.objectStore(this.STORE_NAME),r=a.objectStore(this.METADATA_STORE),o=n.getAll(),s=r.getAll(),c=[],i=[];o.onsuccess=()=>{c=o.result},s.onsuccess=()=>{i=s.result},a.oncomplete=()=>{let e=[...new Set(c.map(t=>t.symbol))],a=i.length>0?Math.max(...i.map(t=>new Date(t.lastUpdated).getTime())):0;t({totalRecords:c.length,symbols:e,lastUpdated:a>0?new Date(a).toISOString():""})},a.onerror=()=>{e(a.error)}}):{totalRecords:0,symbols:[],lastUpdated:""}}constructor(t){this.db=null,this.accessToken=null,this.refreshToken=null,this.DB_NAME="jquants_cache",this.DB_VERSION=1,this.STORE_NAME="stock_data",this.METADATA_STORE="metadata",this.config=t,this.accessToken=t.token||null,this.initDB().catch(t=>{console.warn("IndexedDB初期化に失敗しました（キャッシュ機能は無効）:",t)})}}var r=a(2818);class o{static async callServer(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let e=new AbortController,a=window.setTimeout(()=>e.abort(),3e4);try{let a;switch(t){case"getAllSymbols":case"getMarketInfo":default:a="/data/listed_index.json";break;case"getStockPrices":return{data:[],message:"価格データは個別銘柄ファイルから取得してください"}}let n=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"},signal:e.signal});if(!n.ok)throw Error("HTTP ".concat(n.status,": ").concat(n.statusText));return await n.json()}finally{window.clearTimeout(a)}}static getInstance(){return this.instance||(this.instance=this.createInstance()),this.instance}static createInstance(){let t=t=>r.env["NEXT_PUBLIC_".concat(t)];return console.log("\uD83D\uDD0D Client-side env debug:",{isClient:!0,NODE_ENV:"production",allEnvKeys:Object.keys(r.env),jquantsVars:{email:r.env.NEXT_PUBLIC_JQUANTS_EMAIL,password:r.env.NEXT_PUBLIC_JQUANTS_PASSWORD?"***":void 0,token:r.env.NEXT_PUBLIC_JQUANTS_ID_TOKEN?"***":void 0,baseUrl:r.env.NEXT_PUBLIC_JQUANTS_BASE_URL,timeout:r.env.NEXT_PUBLIC_JQUANTS_TIMEOUT}}),new n({email:t("JQUANTS_EMAIL"),password:t("JQUANTS_PASSWORD"),token:t("JQUANTS_ID_TOKEN"),baseUrl:t("JQUANTS_BASE_URL")||"https://api.jquants.com/v1",timeout:parseInt(t("JQUANTS_TIMEOUT")||"30000")})}static reset(){this.instance=null}static async testConnection(){try{return await this.callServer("testConnection")}catch(t){return console.error("クライアント側接続テストエラー:",t),{success:!1,message:t instanceof Error?t.message:"接続テストに失敗しました"}}try{let t=this.getInstance();return await t.testConnection()}catch(t){return{success:!1,message:"接続テスト失敗: ".concat(t instanceof Error?t.message:"不明なエラー")}}}static async getAllSymbols(){try{return await this.callServer("getAllSymbols")}catch(t){return console.error("クライアント側全銘柄一覧取得エラー:",t),[]}try{let t=this.getInstance();return await t.getAllSymbols()}catch(t){return console.error("全銘柄一覧取得エラー:",t),[]}}static async getStockData(t,e,a){let n=!(arguments.length>3)||void 0===arguments[3]||arguments[3];try{return await this.callServer("getStockData",{symbol:t,startDate:e,endDate:a,useCache:n})}catch(t){return console.error("クライアント側株価データ取得エラー:",t),[]}try{let r=this.getInstance();return await r.getStockData(t,e,a,n)}catch(t){return console.error("株価データ取得エラー:",t),[]}}static async getIncrementalData(t){try{return await this.callServer("getIncrementalData",{symbol:t})}catch(t){return console.error("クライアント側差分更新エラー:",t),[]}try{let e=this.getInstance();return await e.getIncrementalData(t)}catch(t){return console.error("差分更新エラー:",t),[]}}static async clearCache(t){try{await this.callServer("clearCache",{symbol:t});return}catch(t){console.error("クライアント側キャッシュクリアエラー:",t);return}try{let e=this.getInstance();await e.clearCache(t)}catch(t){console.error("キャッシュクリアエラー:",t)}}static async getCacheStats(){try{return await this.callServer("getCacheStats")}catch(t){return console.error("クライアント側キャッシュ統計取得エラー:",t),{totalRecords:0,symbols:[],lastUpdated:""}}try{let t=this.getInstance();return await t.getCacheStats()}catch(t){return console.error("キャッシュ統計取得エラー:",t),{totalRecords:0,symbols:[],lastUpdated:""}}}}o.instance=null;let s=function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return o.testConnection(...e)},c=function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return o.getAllSymbols(...e)},i=function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return o.getStockData(...e)}},8197:(t,e,a)=>{a.d(e,{hk:()=>i,qB:()=>l,qG:()=>c});var n=a(9233),r=a(795);function o(t,e){if(t.length<e)return t[t.length-1]||0;let a=t.slice(-e);return a.reduce((t,e)=>t+e,0)/a.length}async function s(t,e){try{var a;let s=new Date("2025-07-10"),c=new Date,i=c>s?s:c,l=i.toISOString().split("T")[0],u=new Date(i.getTime()-5184e6).toISOString().split("T")[0],h=await (0,r.V3)(t,u,l);if(0===h.length)return console.warn("株価データが取得できませんでした: ".concat(t)),null;let d=e;if(!d){let e=(await (0,r.fg)()).find(e=>e.code===t);d=(null==e?void 0:e.name)||t}let m=function(t){let e=t.map(t=>t.close);return{sma5:o(e,5),sma10:o(e,10),sma25:o(e,25),sma50:o(e,50),rsi:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(t.length<e+1)return 50;let a=[];for(let e=1;e<t.length;e++)a.push(t[e]-t[e-1]);let n=a.slice(-e).filter(t=>t>0),r=a.slice(-e).filter(t=>t<0).map(Math.abs);if(0===r.length)return 100;if(0===n.length)return 0;let o=n.reduce((t,e)=>t+e,0)/e,s=r.reduce((t,e)=>t+e,0)/e;return 0===s?100:100-100/(1+o/s)}(e),macd:function(t){if(t.length<26)return{macd:0,signal:0,histogram:0};let e=(t,e)=>{let a=[t[0]],n=2/(e+1);for(let e=1;e<t.length;e++)a.push(t[e]*n+a[e-1]*(1-n));return a},a=e(t,12),n=e(t,26),r=a[a.length-1]-n[n.length-1],o=[];for(let e=26;e<t.length;e++)o.push(a[e]-n[e]);let s=e(o.slice(-9),9),c=s.length>0?s[s.length-1]:0;return{macd:r,signal:c,histogram:r-c}}(e),bollinger:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(t.length<e){let e=t[t.length-1]||0;return{upper:e,middle:e,lower:e}}let a=t.slice(-e),n=a.reduce((t,e)=>t+e,0)/a.length,r=Math.sqrt(a.reduce((t,e)=>t+Math.pow(e-n,2),0)/a.length);return{upper:n+2*r,middle:n,lower:n-2*r}}(e)}}(h),g=function(t,e){var a,n;let r,o,s,c;let i=[],l=0,u=0,h=0,d=(null===(a=t[t.length-1])||void 0===a?void 0:a.close)||0,m=(null===(n=t[t.length-2])||void 0===n?void 0:n.close)||d;e.sma5>e.sma10&&e.sma10>e.sma25?(l+=2,i.push("短期上昇トレンド（SMA5 > SMA10 > SMA25）")):e.sma5<e.sma10&&e.sma10<e.sma25&&(u+=2,i.push("短期下降トレンド（SMA5 < SMA10 < SMA25）")),d>e.sma50?(l+=1,i.push("長期上昇トレンド（価格 > SMA50）")):(u+=1,i.push("長期下降トレンド（価格 < SMA50）")),e.rsi<30?(l+=2,i.push("RSI過売り状態（".concat(e.rsi.toFixed(1),"）"))):e.rsi>70?(u+=2,i.push("RSI過買い状態（".concat(e.rsi.toFixed(1),"）")),h+=1):e.rsi>=40&&e.rsi<=60&&i.push("RSI中立圏（".concat(e.rsi.toFixed(1),"）")),e.macd.macd>e.macd.signal&&e.macd.histogram>0?(l+=1,i.push("MACD買いシグナル")):e.macd.macd<e.macd.signal&&e.macd.histogram<0&&(u+=1,i.push("MACD売りシグナル")),d<e.bollinger.lower?(l+=1,i.push("ボリンジャーバンド下限接触（反発期待）")):d>e.bollinger.upper&&(u+=1,i.push("ボリンジャーバンド上限接触（過熱警戒）"),h+=1),Math.abs((d-m)/m)>.05&&(h+=1,i.push("高ボラティリティ（急激な価格変動）"));let g=l-u;return g>=3?(r="STRONG_BUY",o=Math.min(.9,.6+(g-3)*.1)):g>=1?(r="BUY",o=.6+(g-1)*.1):g<=-3?(r="STRONG_SELL",o=Math.min(.9,.6+.1*Math.abs(g+3))):g<=-1?(r="SELL",o=.6+.1*Math.abs(g+1)):(r="HOLD",o=.5),o=Math.max(.3,o-.1*h),s=h>=2?"HIGH":h>=1?"MEDIUM":"LOW","STRONG_BUY"===r||"BUY"===r?c=e.sma5>e.sma50?1.05*d:e.sma25:("STRONG_SELL"===r||"SELL"===r)&&(c=.95*d),{recommendation:r,confidence:o,reasons:i,riskLevel:s,targetPrice:c}}(h,m),f=h[h.length-1].close,S=(null===(a=h[h.length-2])||void 0===a?void 0:a.close)||f,y=f-S;return(0,n._)({symbol:t,name:d,currentPrice:f,priceChange:y,priceChangePercent:y/S*100,indicators:m},g)}catch(e){return console.error("株価分析エラー (".concat(t,"):"),e),null}}async function c(t){let e=[],a=await (0,r.fg)(),n=[];for(let e=0;e<t.length;e+=5)n.push(t.slice(e,e+5));for(let t of n){let n=t.map(async t=>{let e=a.find(e=>e.code===t);return s(t,null==e?void 0:e.name)}),r=await Promise.all(n);e.push(...r.filter(t=>null!==t))}return e}function i(){return["7203","6758","9984","6861","8035","4063","6981","7974","4519","8031","9432","2914","4568","6954","6367"]}async function l(t){let e=t||i(),a=await c(e),n={STRONG_BUY:0,BUY:0,HOLD:0,SELL:0,STRONG_SELL:0};a.forEach(t=>{n[t.recommendation]++});let r=a.filter(t=>t.priceChangePercent>0).sort((t,e)=>e.priceChangePercent-t.priceChangePercent).slice(0,5),o=a.filter(t=>t.priceChangePercent<0).sort((t,e)=>t.priceChangePercent-e.priceChangePercent).slice(0,5);return{totalSymbols:e.length,analyzedSymbols:a.length,recommendations:n,topGainers:r,topLosers:o,lastUpdated:new Date().toISOString()}}}}]);