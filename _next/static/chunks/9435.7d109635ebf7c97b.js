"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9435],{2725:(e,s,t)=>{t.d(s,{A:()=>r});let r=(0,t(7401).A)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},9435:(e,s,t)=>{t.r(s),t.d(s,{default:()=>g});var r=t(9233),a=t(5843),l=t(5155),n=t(2115),c=t(9191),i=t(2725);let d=(0,t(7401).A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var o=t(1773),m=t(6889),u=t(3239),x=t(5340),h=t(1594);function g(e){let{symbols:s,onUpdateComplete:t,onProgressChange:g,maxConcurrent:p=4,timeout:b=3e4,className:f=""}=e,[j,y]=(0,n.useState)([]),[v,w]=(0,n.useState)(!1),[N,_]=(0,n.useState)(0),[k,A]=(0,n.useState)(!1),[S,T]=(0,n.useState)(!1),[M,E]=(0,n.useState)(0),[C,I]=(0,n.useState)(0),[D,P]=(0,n.useState)(null),[R,q]=(0,n.useState)(0),B=(0,n.useRef)(null),O=(0,n.useRef)(null),U=(0,n.useRef)(new Map);(0,n.useEffect)(()=>{y(s.map(e=>({symbol:e,name:z(e),status:"pending",progress:0})))},[s]),(0,n.useEffect)(()=>(v&&D?O.current=setInterval(()=>{q(Math.floor((Date.now()-D.getTime())/1e3))},1e3):O.current&&(clearInterval(O.current),O.current=null),()=>{O.current&&clearInterval(O.current)}),[v,D]),(0,n.useEffect)(()=>()=>{B.current&&B.current.abort(),O.current&&clearInterval(O.current),U.current.forEach(e=>clearTimeout(e))},[]);let z=e=>({"7203.T":"トヨタ自動車","6758.T":"ソニーグループ","6861.T":"キーエンス","9984.T":"ソフトバンクグループ","4063.T":"信越化学工業"})[e]||e,F=async()=>{v||(w(!0),A(!1),T(!1),P(new Date),q(0),E(0),I(0),_(0),B.current=new AbortController,y(e=>e.map(e=>(0,a._)((0,r._)({},e),{status:"pending",progress:0,error:void 0,data:void 0}))),await G())},G=async()=>{let e=j.filter(e=>"pending"===e.status),l=[];for(let t=0;t<e.length&&!S;t+=p){let n=e.slice(t,t+p),c=n.map(e=>H(e.symbol,B.current.signal));try{(await Promise.allSettled(c)).forEach((e,s)=>{let t=n[s].symbol;"fulfilled"===e.status?(y(s=>s.map(s=>s.symbol===t?(0,a._)((0,r._)({},s),{status:"completed",progress:100,data:e.value}):s)),E(e=>e+1),l.push(e.value)):(y(s=>s.map(s=>{var l;return s.symbol===t?(0,a._)((0,r._)({},s),{status:"error",error:(null===(l=e.reason)||void 0===l?void 0:l.message)||"Unknown error"}):s})),I(e=>e+1))});let e=M+n.length,t=Math.round(e/s.length*100);for(_(t),null==g||g(t);k&&!S;)await new Promise(e=>setTimeout(e,100))}catch(e){console.error("Batch update error:",e)}}w(!1),null==t||t(l)},H=async(e,s)=>{y(s=>s.map(s=>s.symbol===e?(0,a._)((0,r._)({},s),{status:"updating",progress:0}):s));let t=setTimeout(()=>{s.aborted||y(s=>s.map(s=>s.symbol===e?(0,a._)((0,r._)({},s),{status:"error",error:"Timeout"}):s))},b);U.current.set(e,t);try{let t=await J(e,s),r=U.current.get(e);return r&&(clearTimeout(r),U.current.delete(e)),t}catch(t){let s=U.current.get(e);throw s&&(clearTimeout(s),U.current.delete(e)),t}},J=async(e,s)=>{let t=1e3+2e3*Math.random();for(let l=1;l<=5;l++){if(s.aborted)throw Error("Aborted");let n=Math.round(l/5*100);y(s=>s.map(s=>s.symbol===e?(0,a._)((0,r._)({},s),{progress:n}):s)),await new Promise(e=>setTimeout(e,t/5))}return{symbol:e,price:1e3+5e3*Math.random(),change:(Math.random()-.5)*10,volume:Math.floor(1e6*Math.random()),timestamp:new Date().toISOString()}},K=()=>{B.current&&B.current.abort(),T(!0),w(!1),A(!1)};return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow border ".concat(f),children:[(0,l.jsx)("div",{className:"p-4 border-b",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"一括更新"}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:[s.length,"銘柄を並列で更新中"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[v?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("button",{onClick:()=>{A(!k)},className:"flex items-center px-3 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:[k?(0,l.jsx)(c.A,{className:"h-4 w-4 mr-2"}):(0,l.jsx)(i.A,{className:"h-4 w-4 mr-2"}),k?"再開":"一時停止"]}),(0,l.jsxs)("button",{onClick:K,className:"flex items-center px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,l.jsx)(d,{className:"h-4 w-4 mr-2"}),"中断"]})]}):(0,l.jsxs)("button",{onClick:F,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,l.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"開始"]}),(0,l.jsxs)("button",{onClick:()=>{K(),y(e=>e.map(e=>(0,a._)((0,r._)({},e),{status:"pending",progress:0,error:void 0,data:void 0}))),_(0),E(0),I(0),q(0),P(null)},className:"flex items-center px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,l.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"リセット"]})]})]})}),(0,l.jsxs)("div",{className:"p-4 border-b",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"全体進捗"}),(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:[N,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(N,"%")}})}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2 text-sm text-gray-600",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("span",{children:["完了: ",M]}),(0,l.jsxs)("span",{children:["エラー: ",C]}),(0,l.jsxs)("span",{children:["残り: ",s.length-M-C]})]}),D&&(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(m.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(R)})]})]})]}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"銘柄別進捗"}),(0,l.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:j.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)("div",{className:"flex-shrink-0",children:["completed"===e.status&&(0,l.jsx)(u.A,{className:"h-5 w-5 text-green-500"}),"error"===e.status&&(0,l.jsx)(x.A,{className:"h-5 w-5 text-red-500"}),"updating"===e.status&&(0,l.jsx)(o.A,{className:"h-5 w-5 text-blue-500 animate-spin"}),"pending"===e.status&&(0,l.jsx)(h.A,{className:"h-5 w-5 text-gray-400"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium text-gray-900",children:e.symbol}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:e.name})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:["updating"===e.status&&(0,l.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-1",children:(0,l.jsx)("div",{className:"bg-blue-600 h-1 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["completed"===e.status&&"完了","error"===e.status&&"エラー","updating"===e.status&&"".concat(e.progress,"%"),"pending"===e.status&&"待機中"]})]})]},e.symbol))})]}),C>0&&(0,l.jsxs)("div",{className:"p-4 border-t bg-red-50",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"エラー詳細"}),(0,l.jsx)("div",{className:"space-y-1",children:j.filter(e=>"error"===e.status).map(e=>(0,l.jsxs)("div",{className:"text-sm text-red-700",children:[e.symbol,": ",e.error]},e.symbol))})]})]})}}}]);