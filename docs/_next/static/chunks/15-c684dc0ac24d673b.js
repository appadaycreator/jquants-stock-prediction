"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{5442:function(e,t,r){r.d(t,{Po:function(){return n},VJ:function(){return s}});class a{categorizeError(e){let t=e.message.toLowerCase();return t.includes("network")||t.includes("fetch")||t.includes("timeout")||t.includes("connection")?{category:"network",severity:"medium",message:e.message,userMessage:"ネットワーク接続に問題があります。しばらく待ってから再試行してください。",autoRetry:!0,retryDelay:3e3,fallbackAction:"refresh",timestamp:new Date().toISOString()}:t.includes("api")||t.includes("http")||t.includes("status")?{category:"api",severity:"high",message:e.message,userMessage:"API接続に問題があります。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:t.includes("data")||t.includes("parse")||t.includes("json")?{category:"data",severity:"medium",message:e.message,userMessage:"データの処理中にエラーが発生しました。",autoRetry:!0,retryDelay:1e3,fallbackAction:"clear-cache",timestamp:new Date().toISOString()}:t.includes("validation")||t.includes("invalid")||t.includes("required")?{category:"validation",severity:"low",message:e.message,userMessage:"入力データに問題があります。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:t.includes("system")||t.includes("internal")?{category:"system",severity:"critical",message:e.message,userMessage:"システムエラーが発生しました。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"redirect",timestamp:new Date().toISOString()}:{category:"unknown",severity:"medium",message:e.message,userMessage:"予期しないエラーが発生しました。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}}async handleError(e,t){let r=this.categorizeError(e);this.errorHistory.push(r);let a=t?"".concat(t.operation,"_").concat(t.component,"_").concat(e.message):e.message,n=Date.now(),s=this.lastErrorTime.get(a)||0,o=this.errorCounts.get(a)||0;if(n-s<6e4&&o>=this.maxErrorsPerMinute)return!1;if(this.errorCounts.set(a,o+1),this.lastErrorTime.set(a,n),console.error("エラーハンドラー:",r),this.isRecovering)return console.log("既に復旧処理中です"),!1;this.isRecovering=!0;try{return r.autoRetry&&await this.retryOperation(r),await this.executeFallbackAction(r),this.isRecovering=!1,!0}catch(e){return console.error("復旧処理エラー:",e),this.isRecovering=!1,!1}}async retryOperation(e){e.retryDelay>0&&await new Promise(t=>setTimeout(t,e.retryDelay))}async executeFallbackAction(e){switch(e.fallbackAction){case"refresh":window.location.reload();break;case"clear-cache":localStorage.clear(),sessionStorage.clear();break;case"redirect":window.location.href="/error"}}getErrorHistory(){return[...this.errorHistory]}getErrorStats(){let e={},t={};return this.errorHistory.forEach(r=>{e[r.category]=(e[r.category]||0)+1,t[r.severity]=(t[r.severity]||0)+1}),{total:this.errorHistory.length,byCategory:e,bySeverity:t}}reset(){this.errorHistory=[],this.errorCounts.clear(),this.lastErrorTime.clear(),this.isRecovering=!1}constructor(){this.errorHistory=[],this.isRecovering=!1,this.errorCounts=new Map,this.lastErrorTime=new Map,this.maxErrorsPerMinute=10}}let n=new a,s={handle:(e,t)=>n.handleError(e,t),categorize:e=>n.categorizeError(e),getHistory:()=>n.getErrorHistory(),getStats:()=>n.getErrorStats(),reset:()=>n.reset()}},4076:function(e,t,r){r.d(t,{Q8:function(){return l},nw:function(){return i}});var a=r(5583);r(2265);class n extends Error{constructor(e,t,r,a){super(e),this.code=t,this.status=r,this.retryHint=a,this.name="AppError"}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e=>{try{if(/^https?:\/\//i.test(e))return e;if(e.startsWith("/"))return"".concat("/jquants-stock-prediction").concat(e);return e}catch(t){return e}},{signal:s,timeout:o=1e4,retries:i=3,retryDelay:c=1e3,method:l,headers:u,json:h,idempotencyKey:g}=t,d=new AbortController,m=setTimeout(()=>d.abort(),o);s&&s.addEventListener("abort",()=>d.abort());let f=null;for(let t=0;t<=i;t++)try{let t={"Cache-Control":"no-cache",Pragma:"no-cache"},s=void 0!==h;s&&(t["Content-Type"]="application/json");let o=l||(s?"POST":"GET"),i=/^(POST|PUT|PATCH|DELETE)$/i.test(o),c=!0===g?function(){try{var e,t;let r=globalThis.crypto&&(null===(e=(t=globalThis.crypto).randomUUID)||void 0===e?void 0:e.call(t))||void 0;if(r)return"idem_".concat(r)}catch(e){}let r=Math.random().toString(36).slice(2);return"idem_".concat(Date.now(),"_").concat(r)}():"string"==typeof g?g:void 0;i&&c&&(t["Idempotency-Key"]=c);let f=await fetch(r(e),{signal:d.signal,cache:"no-cache",method:o,headers:(0,a._)({},t,u||{}),body:s?JSON.stringify(h):void 0});if(clearTimeout(m),!f.ok)try{let e=await f.text(),t=JSON.parse(e);if(t&&"object"==typeof t&&t.error_code&&t.user_message)throw new n(t.user_message,String(t.error_code),f.status,t.retry_hint);throw new n("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}catch(e){if(e instanceof n)throw e;throw new n("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}let y=f.headers.get("content-type");if(!y||!y.includes("application/json"))throw new n("レスポンスがJSON形式ではありません","INVALID_CONTENT_TYPE");return await f.json()}catch(r){if(f=r,r instanceof Error&&"AbortError"===r.name)throw new n("リクエストが中断されました","ABORTED");if(t<i){let a=c*Math.pow(2,t);console.warn("Fetch attempt ".concat(t+1," failed for ").concat(e,":"),r),console.log("Retrying in ".concat(a,"ms...")),await new Promise(e=>setTimeout(e,a))}}if(f instanceof n)throw f;throw new n("すべてのリトライ試行が失敗しました: ".concat((null==f?void 0:f.message)||"Unknown error"),"ALL_RETRIES_FAILED")}let o="app_cache:";function i(e){try{let t=function(e){try{let t=localStorage.getItem(o+e);if(!t)return null;let r=JSON.parse(t);return"number"==typeof r.t?r.t:null}catch(e){return null}}(e);if(!t)return{exists:!1,timestamp:null,ageMs:null};return{exists:!0,timestamp:t,ageMs:Date.now()-t}}catch(e){return{exists:!1,timestamp:null,ageMs:null}}}function c(e,t){try{let r=localStorage.getItem(o+e);if(!r)return null;let a=JSON.parse(r);if(t&&Date.now()-a.t>t)return null;return a.v}catch(e){return null}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{cacheKey:r,cacheTtlMs:a}=t;if(r){let e=c(r,a);if(e)return console.log("Using cached data for ".concat(r)),{data:e,fromCache:!0}}try{let a=await s(e,t);return r&&(function(e,t){try{let r={v:t,t:Date.now()};localStorage.setItem(o+e,JSON.stringify(r))}catch(e){}}(r,a),console.log("Cached fresh data for ".concat(r))),{data:a,fromCache:!1}}catch(a){if(console.warn("Fetch failed for ".concat(e,", attempting cache fallback:"),a),r){let e=c(r);if(e)return console.log("Using stale cache for ".concat(r," due to fetch failure")),{data:e,fromCache:!0}}let t=function(e){try{if(e.includes("/api/today"))return{date:new Date().toISOString().split("T")[0],summary:"データ取得中...",status:"loading"};if(e.includes("/api/predictions"))return{predictions:[],status:"loading",message:"予測データを取得中..."};if(e.includes("/api/risk"))return{risk_level:"medium",status:"loading",message:"リスク分析中..."};if(e.includes("/api/dashboard"))return{summary:{},status:"loading",message:"ダッシュボードデータを読み込み中..."};return{status:"loading",message:"データを読み込み中...",timestamp:Date.now()}}catch(e){return null}}(e);if(t)return console.log("Using default data for ".concat(e)),{data:t,fromCache:!0};throw a}}},9488:function(e,t,r){r.d(t,{JR:function(){return c},dN:function(){return o},ny:function(){return i}});var a=r(5583);function n(e,t){if(e.length<t)return e[e.length-1]||0;let r=e.slice(-t);return r.reduce((e,t)=>e+t,0)/r.length}async function s(e,t){try{var r;if(!e||""===e.trim())return null;let s=new Date("2025-07-10"),o=new Date,i=o>s?s:o,c=i.toISOString().split("T")[0],l=new Date(i.getTime()-5184e6).toISOString().split("T")[0],u=function(e,t,r){let a=[],n=new Date(t),s=new Date(r),o={7203:2500,6758:12e3,9984:6e3,6861:5e4,4063:15e3}[e]||1e3,i={7203:"トヨタ自動車",6758:"ソニーグループ",9984:"ソフトバンクグループ",6861:"キーエンス",4063:"信越化学工業"}[e]||e,c=o;for(let t=new Date(n);t<=s;t.setDate(t.getDate()+1)){if(0===t.getDay()||6===t.getDay())continue;let r=(Math.random()-.5)*.1,n=c*r,s=Math.floor(1e6*Math.random())+1e5,l=(c=Math.max(c+n,.5*o))*s*.1;a.push({symbol:e,name:i,price:c,change:n,changePercent:100*r,volume:s,marketCap:l,lastUpdated:t.toISOString(),close:c,date:t.toISOString().split("T")[0]})}return a}(e,l,c);if(0===u.length)return console.warn("株価データが取得できませんでした: ".concat(e)),null;let h=t;if(!h){let t=[{code:"7203",name:"トヨタ自動車"},{code:"6758",name:"ソニーグループ"},{code:"9984",name:"ソフトバンクグループ"},{code:"6861",name:"キーエンス"},{code:"4063",name:"信越化学工業"}].find(t=>t.code===e);h=(null==t?void 0:t.name)||e}let g=function(e){let t=e.map(e=>e.close);return{sma5:n(t,5),sma10:n(t,10),sma25:n(t,25),sma50:n(t,50),rsi:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(e.length<t+1)return 50;let r=[];for(let t=1;t<e.length;t++)r.push(e[t]-e[t-1]);let a=r.slice(-t).filter(e=>e>0),n=r.slice(-t).filter(e=>e<0).map(Math.abs);if(0===n.length)return 100;if(0===a.length)return 0;let s=a.reduce((e,t)=>e+t,0)/t,o=n.reduce((e,t)=>e+t,0)/t;return 0===o?100:100-100/(1+s/o)}(t),macd:function(e){if(e.length<26)return{macd:0,signal:0,histogram:0};let t=(e,t)=>{let r=[e[0]],a=2/(t+1);for(let t=1;t<e.length;t++)r.push(e[t]*a+r[t-1]*(1-a));return r},r=t(e,12),a=t(e,26),n=r[r.length-1]-a[a.length-1],s=[];for(let t=26;t<e.length;t++)s.push(r[t]-a[t]);let o=t(s.slice(-9),9),i=o.length>0?o[o.length-1]:0;return{macd:n,signal:i,histogram:n-i}}(t),bollinger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(e.length<t){let t=e[e.length-1]||0;return{upper:t,middle:t,lower:t}}let r=e.slice(-t),a=r.reduce((e,t)=>e+t,0)/r.length,n=Math.sqrt(r.reduce((e,t)=>e+Math.pow(t-a,2),0)/r.length);return{upper:a+2*n,middle:a,lower:a-2*n}}(t)}}(u),d=function(e,t){var r,a;let n,s,o,i;let c=[],l=0,u=0,h=0,g=(null===(r=e[e.length-1])||void 0===r?void 0:r.close)||0,d=(null===(a=e[e.length-2])||void 0===a?void 0:a.close)||g;t.sma5>t.sma10&&t.sma10>t.sma25?(l+=2,c.push("短期上昇トレンド（SMA5 > SMA10 > SMA25）")):t.sma5<t.sma10&&t.sma10<t.sma25&&(u+=2,c.push("短期下降トレンド（SMA5 < SMA10 < SMA25）")),g>t.sma50?(l+=1,c.push("長期上昇トレンド（価格 > SMA50）")):(u+=1,c.push("長期下降トレンド（価格 < SMA50）")),t.rsi<30?(l+=2,c.push("RSI過売り状態（".concat(t.rsi.toFixed(1),"）"))):t.rsi>70?(u+=2,c.push("RSI過買い状態（".concat(t.rsi.toFixed(1),"）")),h+=1):t.rsi>=40&&t.rsi<=60&&c.push("RSI中立圏（".concat(t.rsi.toFixed(1),"）")),t.macd.macd>t.macd.signal&&t.macd.histogram>0?(l+=1,c.push("MACD買いシグナル")):t.macd.macd<t.macd.signal&&t.macd.histogram<0&&(u+=1,c.push("MACD売りシグナル")),g<t.bollinger.lower?(l+=1,c.push("ボリンジャーバンド下限接触（反発期待）")):g>t.bollinger.upper&&(u+=1,c.push("ボリンジャーバンド上限接触（過熱警戒）"),h+=1),Math.abs((g-d)/d)>.05&&(h+=1,c.push("高ボラティリティ（急激な価格変動）"));let m=l-u;return m>=3?(n="STRONG_BUY",s=Math.min(.9,.6+(m-3)*.1)):m>=1?(n="BUY",s=.6+(m-1)*.1):m<=-3?(n="STRONG_SELL",s=Math.min(.9,.6+.1*Math.abs(m+3))):m<=-1?(n="SELL",s=.6+.1*Math.abs(m+1)):(n="HOLD",s=.5),s=Math.max(.3,s-.1*h),o=h>=2?"HIGH":h>=1?"MEDIUM":"LOW","STRONG_BUY"===n||"BUY"===n?i=t.sma5>t.sma50?1.05*g:t.sma25:("STRONG_SELL"===n||"SELL"===n)&&(i=.95*g),{recommendation:n,confidence:s,reasons:c,riskLevel:o,targetPrice:i}}(u,g),m=u[u.length-1].close,f=(null===(r=u[u.length-2])||void 0===r?void 0:r.close)||m,y=m-f;return(0,a._)({symbol:e,name:h,currentPrice:m,priceChange:y,priceChangePercent:y/f*100,indicators:g},d)}catch(t){return console.error("株価分析エラー (".concat(e,"):"),t),null}}async function o(e){let t=[],r=[{code:"7203",name:"トヨタ自動車",sector:"自動車"},{code:"6758",name:"ソニーグループ",sector:"エンターテインメント"},{code:"9984",name:"ソフトバンクグループ",sector:"通信"},{code:"6861",name:"キーエンス",sector:"電子部品"},{code:"4063",name:"信越化学工業",sector:"化学"}],a=[];for(let t=0;t<e.length;t+=5)a.push(e.slice(t,t+5));for(let e of a){let a=e.map(async e=>{let t=r.find(t=>t.code===e);return s(e,null==t?void 0:t.name)}),n=await Promise.all(a);t.push(...n.filter(e=>null!==e))}return t}function i(){return["7203","6758","9984","6861","8035","4063","6981","7974","4519","8031","9432","2914","4568","6954","6367"]}async function c(e){let t=e||i(),r=await o(t),a={STRONG_BUY:0,BUY:0,HOLD:0,SELL:0,STRONG_SELL:0};r.forEach(e=>{a[e.recommendation]++});let n=r.filter(e=>e.priceChangePercent>0).sort((e,t)=>t.priceChangePercent-e.priceChangePercent).slice(0,5),s=r.filter(e=>e.priceChangePercent<0).sort((e,t)=>e.priceChangePercent-t.priceChangePercent).slice(0,5);return{totalSymbols:t.length,analyzedSymbols:r.length,recommendations:a,topGainers:n,topLosers:s,lastUpdated:new Date().toISOString()}}},1959:function(e,t,r){r.d(t,{M:function(){return o}});var a=r(5583);class n{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,void 0,t)}async post(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,t,r)}async put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,t,r)}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,void 0,t)}async request(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=(0,a._)({},this.defaultConfig,n),o=this.buildUrl(t),i=null;for(let t=0;t<=s.retries;t++)try{return await this.executeRequest(e,o,r,s)}catch(e){if(i=e,t<s.retries){await this.delay(s.retryDelay*Math.pow(2,t));continue}}throw i||Error("Request failed")}async executeRequest(e,t,r,n){let s=new AbortController,o=setTimeout(()=>s.abort(),n.timeout);try{let i=await fetch(t,{method:e,headers:(0,a._)({"Content-Type":"application/json"},n.headers),body:r?JSON.stringify(r):void 0,signal:s.signal});if(clearTimeout(o),!i.ok)throw Error("HTTP ".concat(i.status,": ").concat(i.statusText));return{data:await i.json(),status:i.status,statusText:i.statusText,headers:this.extractHeaders(i)}}catch(e){throw clearTimeout(o),e}}buildUrl(e){return e.startsWith("http")?e:"".concat(this.baseURL).concat(e.startsWith("/")?e:"/".concat(e))}extractHeaders(e){let t={};return e.headers&&"function"==typeof e.headers.forEach&&e.headers.forEach((e,r)=>{t[r]=e}),t}delay(e){return new Promise(t=>setTimeout(t,e))}async testConnection(){try{return{success:!0,message:"Frontend connection successful"}}catch(e){return{success:!1,message:"Connection failed: ".concat(e instanceof Error?e.message:"Unknown error")}}}async getStockData(e){return(await this.get("/stocks/".concat(e))).data}async getMarketData(){return(await this.get("/market")).data}async getPredictions(){return(await this.get("/predictions")).data}async getPersonalInvestmentData(){return(await this.get("/personal-investment")).data}constructor(e="/api"){this.baseURL=e,this.defaultConfig={timeout:1e4,retries:3,retryDelay:1e3,cache:!0,cacheTTL:3e5}}}let s=new n,o=()=>s.testConnection()}}]);