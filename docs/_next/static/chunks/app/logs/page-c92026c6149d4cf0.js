(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{789:function(e,t,l){Promise.resolve().then(l.bind(l,3071))},3071:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return i}});var s=l(7437),n=l(2265);let a=["ALL","ERROR","WARN","INFO","DEBUG"];function i(){let[e,t]=(0,n.useState)("ALL"),[l,i]=(0,n.useState)(""),[d,r]=(0,n.useState)(""),[c,o]=(0,n.useState)(100),[u,h]=(0,n.useState)(!1),[x,p]=(0,n.useState)([]),[g,j]=(0,n.useState)([]),[f,v]=(0,n.useState)(""),[y,C]=(0,n.useState)(!1),[b,w]=(0,n.useState)(!0),m=(0,n.useRef)(null),R=async()=>{C(!0);let t=new URLSearchParams;"ALL"!==e&&t.set("level",e),l&&t.set("source",l),d&&t.set("request_id",d),t.set("limit",String(c));let s=await fetch("/api/logs?".concat(t.toString()),{cache:"no-store"}),n=await s.json();p(n.items||[]),j(n.files||[]),C(!1)};(0,n.useEffect)(()=>{R()},[R,e,l,d,c]),(0,n.useEffect)(()=>(b&&(m.current=setInterval(R,5e3)),()=>m.current&&clearInterval(m.current)),[b,R,e,l,d,c]);let L=(0,n.useMemo)(()=>{let e=f.trim().toLowerCase(),t=u?x.filter(e=>"ERROR"===e.level||"CRITICAL"===e.level):x;return e?t.filter(t=>t.ts.toLowerCase().includes(e)||t.level.toLowerCase().includes(e)||t.source.toLowerCase().includes(e)||(t.request_id||"").toLowerCase().includes(e)||t.message.toLowerCase().includes(e)):t},[x,f,u]),S=async()=>{let e=L.map(e=>"".concat(e.ts," ").concat(e.level," [").concat(e.source,"] ").concat(e.message)).join("\n");await navigator.clipboard.writeText(e)};return(0,s.jsxs)("div",{style:{padding:16,display:"grid",gap:12},children:[(0,s.jsx)("h2",{children:"ログビューア"}),(0,s.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[(0,s.jsxs)("label",{children:["レベル:",(0,s.jsx)("select",{value:e,onChange:e=>t(e.target.value),children:a.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("label",{children:["処理（source）:",(0,s.jsx)("input",{value:l,onChange:e=>i(e.target.value),placeholder:"system/model/api..."})]}),(0,s.jsxs)("label",{children:["request_id:",(0,s.jsx)("input",{value:d,onChange:e=>r(e.target.value),placeholder:"xxxx-xxxx"})]}),(0,s.jsxs)("label",{children:["件数:",(0,s.jsx)("input",{type:"number",min:1,max:1e3,value:c,onChange:e=>o(parseInt(e.target.value||"100",10))})]}),(0,s.jsxs)("label",{title:"ERROR/CRITICAL のみ",children:[(0,s.jsx)("input",{type:"checkbox",checked:u,onChange:e=>h(e.target.checked)})," 重大のみ"]}),(0,s.jsxs)("label",{children:["検索:",(0,s.jsx)("input",{value:f,onChange:e=>v(e.target.value),placeholder:"キーワード"})]}),(0,s.jsx)("button",{onClick:R,disabled:y,children:"更新"}),(0,s.jsx)("button",{onClick:()=>w(e=>!e),children:b?"自動更新停止":"自動更新"}),(0,s.jsx)("button",{onClick:S,children:"表示内容をコピー"})]}),(0,s.jsx)("div",{style:{fontSize:12,opacity:.8},children:"ログファイル（ダウンロード可）:"}),(0,s.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:g.map(e=>(0,s.jsx)("a",{href:"/api/logs/download?file=".concat(encodeURIComponent(e)),children:e},e))}),(0,s.jsx)("div",{style:{border:"1px solid #ddd",borderRadius:8,overflow:"hidden"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{style:{background:"#fafafa"},children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"時間"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"レベル"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"処理"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"request_id"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"メッセージ"}),(0,s.jsx)("th",{style:{textAlign:"left",padding:8},children:"ファイル"})]})}),(0,s.jsx)("tbody",{children:L.map((e,t)=>(0,s.jsxs)("tr",{style:{borderTop:"1px solid #eee",background:"ERROR"===e.level||"CRITICAL"===e.level?"#fff4f4":"white"},children:[(0,s.jsx)("td",{style:{padding:8,whiteSpace:"nowrap"},children:e.ts}),(0,s.jsx)("td",{style:{padding:8},children:e.level}),(0,s.jsx)("td",{style:{padding:8},children:e.source}),(0,s.jsx)("td",{style:{padding:8},children:e.request_id||""}),(0,s.jsx)("td",{style:{padding:8},children:e.message}),(0,s.jsx)("td",{style:{padding:8},children:e.file})]},t))})]})}),y&&(0,s.jsx)("div",{children:"読み込み中..."})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=789)}),_N_E=e.O()}]);