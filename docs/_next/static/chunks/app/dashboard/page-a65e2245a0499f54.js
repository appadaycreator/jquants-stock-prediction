(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6417:function(e,t,s){Promise.resolve().then(s.bind(s,8874))},8874:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return et},dynamic:function(){return Y}});var a=s(5583),r=s(1780),n=s(7437),i=s(2265),l=s(660),c=s(166),o=s(3959),d=s(1959),m=s(9488),h=s(6865),u=s(1671),x=s(6215),g=s(8896),p=s(4822),f=s(525),y=s(91),b=s(2489),j=s(4076);class v{static getInstance(e){return v.instance||(v.instance=new v(e)),v.instance}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4),c=r||this.config.defaultTtlMinutes;l<=this.config.freshThresholdMinutes?(t="fresh",s=!0):(t=l<=this.config.staleThresholdMinutes?"stale":l<=this.config.expiredThresholdMinutes?"stale":"expired",s=!1),l>c&&(t="expired",s=!1),"api"===a&&(t="fresh",s=!0);let o=new Date(i.getTime()+6e4*c);return{isFresh:s,lastUpdated:i,ageMinutes:l,cacheStatus:t,source:a,ttlMinutes:c,nextRefresh:o}}getFreshnessFromCacheMeta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache";return e.exists&&e.timestamp?this.getFreshnessInfo(e.timestamp,t,e.ttl):null}getCombinedFreshnessInfo(e){if(0===e.length)return{overallStatus:"all_expired",oldestData:null,freshCount:0,staleCount:0,expiredCount:0,totalCount:0};let t=e.filter(e=>e.isFresh).length,s=e.filter(e=>"stale"===e.cacheStatus).length,a=e.filter(e=>"expired"===e.cacheStatus).length,r=e.length;return{overallStatus:t===r?"all_fresh":a===r?"all_expired":s===r?"all_stale":"mixed",oldestData:e.reduce((e,t)=>t.ageMinutes>e.ageMinutes?t:e),freshCount:t,staleCount:s,expiredCount:a,totalCount:r}}getFreshnessBadgeStyle(e){switch(e){case"fresh":return{className:"bg-green-100 text-green-800 border-green-200",icon:"✓",text:"Fresh",color:"green"};case"stale":return{className:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"⚠",text:"Stale",color:"yellow"};case"expired":return{className:"bg-red-100 text-red-800 border-red-200",icon:"✗",text:"Expired",color:"red"};default:return{className:"bg-gray-100 text-gray-800 border-gray-200",icon:"?",text:"Unknown",color:"gray"}}}getRelativeTimeString(e){return e<1?"たった今":e<60?"".concat(e,"分前"):e<1440?"".concat(Math.floor(e/60),"時間前"):"".concat(Math.floor(e/1440),"日前")}getNextRefreshString(e){let t=new Date,s=Math.floor((e.getTime()-t.getTime())/6e4);return s<=0?"更新が必要":s<60?"".concat(s,"分後に更新"):"".concat(Math.floor(s/60),"時間後に更新")}constructor(e){this.config=(0,a._)({freshThresholdMinutes:15,staleThresholdMinutes:60,expiredThresholdMinutes:240,defaultTtlMinutes:60},e)}}let w=v.getInstance();var N=s(1723),S=s(9388),k=s(7168);class _{static getInstance(){return _.instance||(_.instance=new _),_.instance}registerDataSource(e,t,s,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"api",n=arguments.length>5?arguments[5]:void 0;this.dataSources.set(e,{id:e,name:t,lastUpdated:s,ttlMinutes:a,source:r,refreshCallback:n}),n&&this.refreshCallbacks.set(e,n)}registerRefreshCallback(e,t){this.refreshCallbacks.set(e,t)}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"api",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4);return r?l<.5*r?t="fresh":l<r?(t="stale",s=new Date(i.getTime()+6e4*r)):t="expired":t=l<5?"fresh":l<30?"stale":"expired",{dataSourceId:"unknown",dataSourceName:"Unknown",lastUpdated:i,cacheStatus:t,ageMinutes:l,ttlMinutes:r,nextRefresh:s,source:a}}getDataSourceFreshnessInfo(e){let t=this.dataSources.get(e);return t?this.getFreshnessInfo(t.lastUpdated,t.source,t.ttlMinutes):null}getAllFreshnessInfo(){let e=new Map;return this.dataSources.forEach((t,s)=>{let a=this.getDataSourceFreshnessInfo(s);a&&(a.dataSourceId=s,a.dataSourceName=t.name,e.set(s,a))}),e}getSystemHealth(){let e=new Date,t=[],s=0,a=0;return this.dataSources.forEach(e=>{let r=this.getDataSourceFreshnessInfo(e.id);if(r)switch(r.cacheStatus){case"expired":s++,t.push("".concat(e.name,": データが期限切れ"));break;case"stale":a++}}),{status:s>0?"critical":a>0?"warning":"healthy",activeSources:this.dataSources.size,totalSources:this.dataSources.size,issues:t,lastChecked:e}}async refreshDataSource(e){let t=this.refreshCallbacks.get(e);t&&await t();let s=this.dataSources.get(e);s&&(s.lastUpdated=new Date,this.dataSources.set(e,s))}async refreshAllDataSources(){let e=[];this.refreshCallbacks.forEach(t=>{e.push(t())}),await Promise.all(e),this.dataSources.forEach((e,t)=>{e.lastUpdated=new Date,this.dataSources.set(t,e)})}removeDataSource(e){this.dataSources.delete(e),this.refreshCallbacks.delete(e)}clearAllDataSources(){this.dataSources.clear(),this.refreshCallbacks.clear()}getDataSources(){return Array.from(this.dataSources.values())}getDataSourceCount(){return this.dataSources.size}constructor(){this.dataSources=new Map,this.refreshCallbacks=new Map}}var C=e=>{let t,s,a,{className:r="",showRefreshButton:l=!0,onRefresh:c,freshnessInfos:o,onRefreshAll:d}=e,[m,x]=(0,i.useState)(new Map),[g,p]=(0,i.useState)(null),[f,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)(null),w=_.getInstance();(0,i.useEffect)(()=>{let e=()=>{x(w.getAllFreshnessInfo()),p(w.getSystemHealth()),v(new Date)};e();let t=setInterval(e,3e4);return()=>{clearInterval(t)}},[w]);let C=async()=>{if(!f)try{b(!0),d?await d():c?await c():await w.refreshAllDataSources(),v(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{b(!1)}},E=(t=0,s=0,a=0,m.forEach(e=>{switch(e.cacheStatus){case"fresh":t++;break;case"stale":s++;break;case"expired":a++}}),{freshCount:t,staleCount:s,expiredCount:a});return m.size,(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(r),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(y.Z,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"データ鮮度サマリー"})]}),l&&(0,n.jsx)("button",{onClick:C,disabled:f,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(f?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(k.Z,{className:"h-4 w-4 ".concat(f?"animate-spin":"")})})]}),g&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(()=>{if(!g)return(0,n.jsx)(N.Z,{className:"h-4 w-4"});switch(g.status){case"healthy":return(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-600"});case"warning":return(0,n.jsx)(h.Z,{className:"h-4 w-4 text-yellow-600"});case"critical":return(0,n.jsx)(S.Z,{className:"h-4 w-4 text-red-600"});default:return(0,n.jsx)(N.Z,{className:"h-4 w-4"})}})(),(0,n.jsx)("span",{className:"text-sm font-medium ".concat((()=>{if(!g)return"text-gray-600";switch(g.status){case"healthy":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}})()),children:g.status.toUpperCase()}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",g.activeSources,"/",g.totalSources," アクティブ)"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,n.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-green-600",children:E.freshCount})]}),(0,n.jsx)("div",{className:"text-xs text-green-700 dark:text-green-300",children:"フレッシュ"})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(h.Z,{className:"h-4 w-4 text-yellow-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-yellow-600",children:E.staleCount})]}),(0,n.jsx)("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"ステール"})]}),(0,n.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-red-600",children:E.expiredCount})]}),(0,n.jsx)("div",{className:"text-xs text-red-700 dark:text-red-300",children:"期限切れ"})]})]}),j&&(0,n.jsxs)("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400 text-center",children:["最終更新: ",j.toLocaleTimeString()]}),g&&g.issues.length>0&&(0,n.jsxs)("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,n.jsx)(S.Z,{className:"h-3 w-3 text-red-600"}),(0,n.jsxs)("span",{className:"text-xs font-medium text-red-800 dark:text-red-200",children:[g.issues.length,"件の問題"]})]}),(0,n.jsxs)("div",{className:"text-xs text-red-700 dark:text-red-300",children:[g.issues[0],g.issues.length>1&&" 他".concat(g.issues.length-1,"件")]})]})]})},E=e=>{let{className:t="",showDetails:s=!0,showStats:a=!0,freshnessInfos:r,onRefreshAll:l}=e,[c,o]=(0,i.useState)({totalItems:0,totalSize:0,hitRate:0,missRate:0,lastCleanup:new Date}),[d,m]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=()=>{try{let e=Object.keys(localStorage).filter(e=>e.startsWith("stock_")||e.startsWith("cache_")),t=0,s=[];e.forEach(e=>{let a=localStorage.getItem(e);if(a){let r=new Blob([a]).size;t+=r;try{let t=JSON.parse(a),n=t.timestamp?new Date(t.timestamp):new Date,i=t.ttl||36e5,l=Date.now()-n.getTime()>i;s.push({key:e,size:r,lastAccessed:n,ttl:i,isExpired:l})}catch(e){}}}),o({totalItems:e.length,totalSize:t,hitRate:.85,missRate:.15,lastCleanup:new Date}),m(s)}catch(e){console.error("キャッシュ統計取得エラー:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]);let h=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},x=e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4),s=Math.floor(t/60);return t<1?"たった今":t<60?"".concat(t,"分前"):s<24?"".concat(s,"時間前"):"".concat(Math.floor(s/24),"日前")};return(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(y.Z,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"キャッシュ可視化"})]}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200",title:"キャッシュを更新",children:(0,n.jsx)(k.Z,{className:"h-4 w-4"})})]}),a&&(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.totalItems}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総アイテム数"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:h(c.totalSize)}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総サイズ"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-yellow-600",children:[(100*c.hitRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ヒット率"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[(100*c.missRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ミス率"})]})]}),s&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"キャッシュアイテム一覧"}),0===d.length?(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,n.jsx)(y.Z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,n.jsx)("p",{children:"キャッシュアイテムがありません"})]}):(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(e.isExpired?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-700"),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:e.isExpired?(0,n.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}):(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:e.key}),(0,n.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[h(e.size)," • ",x(e.lastAccessed)]})]})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isExpired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.isExpired?"期限切れ":"有効"})})]},t))})]})]})},I=s(1239),T=s(9076),M=e=>{let{onRefresh:t,onForceRefresh:s,onRecalculate:a,onRecompute:r,isLoading:l=!1,lastUpdated:c,lastRefresh:o,showLastUpdated:d=!0,showLastRefresh:m=!0,variant:h="default",size:x="md",showProgress:g=!1,refreshInterval:p,className:f=""}=e,[y,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!1),[w,S]=(0,i.useState)(!1),[_,C]=(0,i.useState)(null),E=async()=>{if(!y&&t)try{b(!0),await t(),C(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{b(!1)}},M=async()=>{if(!j&&s)try{v(!0),await s(),C(new Date)}catch(e){console.error("強制リフレッシュエラー:",e)}finally{v(!1)}},D=async()=>{if(!w&&a)try{S(!0),await a(),C(new Date)}catch(e){console.error("再計算エラー:",e)}finally{S(!1)}},R=e=>{let t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4),r=Math.floor(a/60);return a<1?"たった今":a<60?"".concat(a,"分前"):r<24?"".concat(r,"時間前"):"".concat(Math.floor(r/24),"日前")};return"compact"===h?(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsx)("button",{onClick:E,disabled:y||l,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(k.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")})}),d&&c&&(0,n.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:R(c)})]}):"full"===h?(0,n.jsxs)("div",{className:"space-y-3 ".concat(f),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)("button",{onClick:E,disabled:y||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(k.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),s&&(0,n.jsxs)("button",{onClick:M,disabled:j||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-yellow-600 text-white hover:bg-yellow-700 transition-colors duration-200 ".concat(j||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(I.Z,{className:"h-4 w-4 ".concat(j?"animate-pulse":"")}),(0,n.jsx)("span",{children:j?"強制更新中...":"強制更新"})]}),a&&(0,n.jsxs)("button",{onClick:D,disabled:w||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 ".concat(w||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(T.Z,{className:"h-4 w-4 ".concat(w?"animate-spin":"")}),(0,n.jsx)("span",{children:w?"再計算中...":"再計算"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[d&&c&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(N.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["最終更新: ",R(c)]})]}),o&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-600"}),(0,n.jsxs)("span",{children:["更新完了: ",R(o)]})]})]})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsxs)("button",{onClick:E,disabled:y||l,className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(k.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),d&&c&&(0,n.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:R(c)})]})},D=s(8071);class R{initializeMonitoring(){if("PerformanceObserver"in window){let e=new PerformanceObserver(e=>{for(let t of e.getEntries())this.handlePerformanceEntry(t)});try{e.observe({entryTypes:["navigation","paint","measure","resource"]})}catch(e){console.warn("PerformanceObserver not supported:",e)}}this.startMemoryMonitoring(),this.estimateBundleSize()}handlePerformanceEntry(e){switch(e.entryType){case"navigation":this.metrics.loadTime=e.duration;break;case"paint":"first-contentful-paint"===e.name&&(this.renderStartTime=e.startTime);break;case"measure":e.name.includes("render")&&(this.metrics.renderTime=e.duration);break;case"resource":(e.name.includes(".js")||e.name.includes(".css"))&&this.updateBundleSize(e)}}startMemoryMonitoring(){"memory"in performance&&setInterval(()=>{let e=performance.memory;e&&(this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit},e.usedJSHeapSize>104857600&&console.warn("High memory usage detected:",{used:Math.round(e.usedJSHeapSize/1024/1024)+"MB",total:Math.round(e.totalJSHeapSize/1024/1024)+"MB",limit:Math.round(e.jsHeapSizeLimit/1024/1024)+"MB"}))},1e4)}estimateBundleSize(){let e=document.querySelectorAll("script[src]"),t=0;e.forEach(e=>{e.src.includes("_next/static/")&&(t+=5e4)}),this.metrics.bundleSize=t}updateBundleSize(e){"transferSize"in e&&(this.metrics.bundleSize+=e.transferSize||0)}startComponentTimer(e){this.componentTimers.set(e,performance.now())}endComponentTimer(e){let t=this.componentTimers.get(e);if(t){let s=performance.now()-t,a=this.componentMetrics.get(e);a?(a.renderTime=(a.renderTime+s)/2,a.updateCount++):(this.componentMetrics.set(e,{name:e,renderTime:s,mountTime:s,updateCount:1,memoryUsage:this.metrics.memoryUsage.used}),this.metrics.componentCount++),this.componentTimers.delete(e)}}updateCacheHitRate(e,t){this.metrics.cacheHitRate=t>0?e/t*100:0}updateErrorRate(e,t){this.metrics.errorRate=t>0?e/t*100:0}getMetrics(){return(0,a._)({},this.metrics)}getComponentMetrics(){return Array.from(this.componentMetrics.values())}getSlowComponents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;return this.getComponentMetrics().filter(t=>t.renderTime>e).sort((e,t)=>t.renderTime-e.renderTime)}getMemoryReport(){let{used:e,total:t,limit:s}=this.metrics.memoryUsage,a=s>0?e/s*100:0,r="メモリ使用量は正常です";return a>80?r="メモリ使用量が高すぎます。ページを再読み込みすることを推奨します。":a>60&&(r="メモリ使用量がやや高いです。不要なタブを閉じることを推奨します。"),{usage:"".concat(Math.round(e/1024/1024),"MB / ").concat(Math.round(s/1024/1024),"MB"),percentage:Math.round(a),recommendation:r}}optimizePerformance(){console.log("\uD83D\uDE80 パフォーマンス最適化を実行中..."),this.cleanupEventListeners(),this.preventMemoryLeaks(),this.optimizeCache(),console.log("✅ パフォーマンス最適化が完了しました")}cleanupEventListeners(){document.querySelectorAll("*").forEach(e=>{console.debug("Event listeners on element:",e.tagName)})}preventMemoryLeaks(){this.metrics.memoryUsage.used>52428800&&(console.warn("メモリ使用量が高いため、最適化を実行します"),"gc"in window&&window.gc())}optimizeCache(){"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{(e.includes("old")||e.includes("temp"))&&caches.delete(e)})})}generateReport(){let e=this.getMetrics(),t=this.getComponentMetrics(),s=this.getMemoryReport();return"\n# パフォーマンスレポート\n\n## 基本メトリクス\n- 読み込み時間: ".concat(e.loadTime.toFixed(2),"ms\n- レンダリング時間: ").concat(e.renderTime.toFixed(2),"ms\n- コンポーネント数: ").concat(e.componentCount,"\n- バンドルサイズ: ").concat(Math.round(e.bundleSize/1024),"KB\n- キャッシュヒット率: ").concat(e.cacheHitRate.toFixed(1),"%\n- エラー率: ").concat(e.errorRate.toFixed(1),"%\n\n## メモリ使用量\n- 使用量: ").concat(s.usage,"\n- 使用率: ").concat(s.percentage,"%\n- 推奨事項: ").concat(s.recommendation,"\n\n## コンポーネントパフォーマンス\n").concat(t.map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms (更新回数: ").concat(e.updateCount,")")).join("\n"),"\n\n## 遅いコンポーネント\n").concat(this.getSlowComponents().map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms")).join("\n"),"\n    ").trim()}constructor(){this.startTime=performance.now(),this.renderStartTime=0,this.metrics={loadTime:0,renderTime:0,memoryUsage:{used:0,total:0,limit:0},componentCount:0,bundleSize:0,cacheHitRate:0,errorRate:0},this.componentMetrics=new Map,this.componentTimers=new Map,this.initializeMonitoring()}}let F=new R;setInterval(function(){let e=F.getMetrics();e.memoryUsage.used>83886080&&(console.warn("メモリ使用量が高いため、自動最適化を実行します"),F.optimizePerformance()),e.errorRate>10&&console.warn("エラー率が高いです:",e.errorRate+"%"),e.cacheHitRate<50&&console.warn("キャッシュヒット率が低いです:",e.cacheHitRate+"%")},3e4);let A={focusRing:!0,screenReader:!0,highContrast:!0,keyboardNavigation:!0,ariaLabels:{tour:"ガイドツアー",tooltip:"ツールチップ",checklist:"チェックリスト",help:"ヘルプ",glossary:"用語集"}};class Z{static getInstance(){return Z.instance||(Z.instance=new Z),Z.instance}saveFocus(){this.currentFocus=document.activeElement,this.currentFocus&&this.focusStack.push(this.currentFocus)}restoreFocus(){if(this.focusStack.length>0){let e=this.focusStack.pop();e&&e.focus&&e.focus()}}focusElement(e){e&&e.focus&&e.focus()}trapFocus(e){let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),s=t[0],a=t[t.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===s&&(a.focus(),e.preventDefault()):document.activeElement===a&&(s.focus(),e.preventDefault()))};return e.addEventListener("keydown",r),()=>{e.removeEventListener("keydown",r)}}clearFocusStack(){this.focusStack=[],this.currentFocus=null}constructor(){this.focusStack=[],this.currentFocus=null}}class L{static getInstance(){return L.instance||(L.instance=new L),L.instance}createAnnouncementElement(){this.announcementElement=document.createElement("div"),this.announcementElement.setAttribute("aria-live","polite"),this.announcementElement.setAttribute("aria-atomic","true"),this.announcementElement.className="sr-only",this.announcementElement.style.cssText="\n      position: absolute;\n      left: -10000px;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    ",document.body.appendChild(this.announcementElement)}announce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite";this.announcementElement&&(this.announcementElement.setAttribute("aria-live",t),this.announcementElement.textContent=e,setTimeout(()=>{this.announcementElement&&(this.announcementElement.textContent="")},1e3))}announceStep(e,t){let s="ガイドステップ: ".concat(e,". ").concat(t);this.announce(s,"assertive")}announceChecklistItem(e,t){let s="チェックリスト項目: ".concat(e," - ").concat(t?"完了":"未完了");this.announce(s)}announceTooltip(e){this.announce("ツールチップ: ".concat(e))}constructor(){this.announcementElement=null,this.createAnnouncementElement()}}class P{static getInstance(){return P.instance||(P.instance=new P),P.instance}registerShortcut(e,t){return this.shortcuts.set(e,t),()=>{this.shortcuts.delete(e)}}start(){document.addEventListener("keydown",this.handleKeyDown)}stop(){document.removeEventListener("keydown",this.handleKeyDown)}clear(){this.shortcuts.clear()}constructor(){this.shortcuts=new Map,this.handleKeyDown=e=>{let t=e.key,s=this.shortcuts.get(t);s&&(e.preventDefault(),e.stopPropagation(),s())}}}let O={focusManager:Z.getInstance(),screenReader:L.getInstance(),keyboard:P.getInstance(),isHighContrast:function(){if(window.matchMedia("(-ms-high-contrast: active)").matches)return!0;let e=window.getComputedStyle(document.body);return e.backgroundColor===e.color}(),colorBlindness:function(){let e=document.createElement("canvas").getContext("2d");if(!e)return"normal";e.fillStyle="#ff0000",e.fillRect(0,0,1,1);let t=e.getImageData(0,0,1,1).data;return 255===t[0]&&0===t[1]&&t[2],"normal"}(),generateAriaAttributes:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t={role:"button",tabIndex:0,"aria-label":A.ariaLabels[e]||e};switch(e){case"tour":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"tour-title","aria-describedby":"tour-description"});case"tooltip":return(0,r._)((0,a._)({},t),{role:"tooltip","aria-live":"polite"});case"checklist":return(0,r._)((0,a._)({},t),{role:"list","aria-label":"チェックリスト"});case"help":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"help-title"});case"glossary":return(0,r._)((0,a._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"glossary-title"});default:return t}},config:A};O.focusManager,O.screenReader,O.keyboard;let z=[{id:"update-check",title:"データ更新（Fresh/Stale）を確認",description:"最終更新と鮮度バッジで状態を判断",completed:!1},{id:"top5-candidates",title:"上位5銘柄を確認",description:"シグナル・予測上位・リスク下位の根拠を確認",completed:!1},{id:"holding-action",title:"保有の継続/利確/損切りを選択",description:"数量候補（25%/50%）から選ぶ",completed:!1},{id:"daily-memo",title:"本日のメモを保存",description:"1行メモをローカルに保存",completed:!1}];function U(e){let{children:t,fallbackToSample:s=!0}=e,[a,r]=(0,i.useState)(null),[l,c]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async()=>{try{let e=(()=>{let e=new Date,t=Array.from({length:30},(t,s)=>new Date(e.getTime()-(29-s)*864e5).toISOString().split("T")[0]).map((e,t)=>({date:e,code:"7203.T",open:2500+100*Math.random()-50,high:2550+50*Math.random(),low:2450-50*Math.random(),close:2500+100*Math.random()-50,volume:1e6+5e5*Math.random(),sma_5:2500+50*Math.random()-25,sma_10:2500+40*Math.random()-20,sma_25:2500+30*Math.random()-15,sma_50:2500+20*Math.random()-10,rsi_14:30+40*Math.random(),macd:10*Math.random()-5,macd_signal:8*Math.random()-4,macd_hist:2*Math.random()-1})),s=Array.from({length:20},(e,t)=>({index:t+1,actual:2500+200*Math.random()-100,predicted:2500+200*Math.random()-100,error:10*Math.random()-5,error_percentage:5*Math.random()})),a={total_data_points:t.length,prediction_period:"30日",best_model:"XGBoost",mae:"0.0234",r2:"0.8765",last_updated:e.toISOString()};return{stockData:t,modelComparison:[{name:"XGBoost",type:"Gradient Boosting",mae:.0234,mse:8e-4,rmse:.0283,r2:.8765,rank:1},{name:"Random Forest",type:"Ensemble",mae:.0256,mse:9e-4,rmse:.03,r2:.8543,rank:2},{name:"Linear Regression",type:"Linear",mae:.0345,mse:.0012,rmse:.0346,r2:.7891,rank:3}],featureAnalysis:[{feature:"価格変動率",importance:.35,percentage:35},{feature:"ボリューム",importance:.25,percentage:25},{feature:"RSI",importance:.15,percentage:15},{feature:"移動平均",importance:.12,percentage:12},{feature:"ボリンジャーバンド",importance:.08,percentage:8},{feature:"MACD",importance:.05,percentage:5}],predictions:s,summary:a,marketInsights:{volatility:"medium",trend:"bullish",risk_level:"moderate",market_sentiment:"positive"},riskAssessment:{risk_level:"Medium",risk_score:.65,var_95:.032,max_drawdown:.085,sharpe_ratio:1.25}}})();r(e)}catch(e){console.error("サンプルデータの生成に失敗:",e)}finally{c(!1)}})()},[]),l)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"サンプルデータを準備中..."})]})}):(0,n.jsx)("div",{className:"sample-data-provider",children:t})}var B=s(3276);function J(e){let{onAnalysisStart:t,onAnalysisComplete:s,onDataUpdateStart:l,onDataUpdateComplete:c,className:o=""}=e,[d,m]=(0,i.useState)(!1),[p,f]=(0,i.useState)(!1),[b,j]=(0,i.useState)(0),[v,w]=(0,i.useState)([{id:"data_update",name:"データ更新",description:"最新の株価データを取得します",icon:(0,n.jsx)(y.Z,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"},{id:"feature_engineering",name:"特徴量エンジニアリング",description:"技術指標を計算します",icon:(0,n.jsx)(x.Z,{className:"h-5 w-5"}),estimatedTime:"1分",status:"pending"},{id:"model_training",name:"モデル学習",description:"AIモデルを学習させます",icon:(0,n.jsx)(g.Z,{className:"h-5 w-5"}),estimatedTime:"2分",status:"pending"},{id:"prediction",name:"予測実行",description:"株価予測を実行します",icon:(0,n.jsx)(B.Z,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"}]),[S,_]=(0,i.useState)(0),[C,E]=(0,i.useState)(null),I=async()=>{if(!d){m(!0),j(0),_(0),null==t||t();try{for(let e=0;e<v.length;e++){j(e),w(t=>t.map((t,s)=>(0,r._)((0,a._)({},t),{status:s===e?"running":s<e?"completed":"pending"})));let t=0===e?2e3:1===e?3e3:2===e?5e3:2e3;await new Promise(e=>setTimeout(e,t)),_(Math.round((e+1)/v.length*100))}w(e=>e.map(e=>(0,r._)((0,a._)({},e),{status:"completed"}))),null==s||s()}catch(e){console.error("分析実行エラー:",e),w(e=>e.map(e=>(0,r._)((0,a._)({},e),{status:"error"})))}finally{m(!1)}}},T=async()=>{if(!p){f(!0),null==l||l();try{await new Promise(e=>setTimeout(e,3e3)),null==c||c()}catch(e){console.error("データ更新エラー:",e)}finally{f(!1)}}};(0,i.useEffect)(()=>{if(!d){E(null);return}E(Math.max(0,v.reduce((e,t)=>e+(({data_update:2,feature_engineering:3,model_training:5,prediction:2})[t.id]||1),0)-2*b))},[d,b,v]);let M=e=>{switch(e.status){case"completed":return(0,n.jsx)(u.Z,{className:"h-5 w-5 text-green-500"});case"running":return(0,n.jsx)(k.Z,{className:"h-5 w-5 text-blue-500 animate-spin"});case"error":return(0,n.jsx)(h.Z,{className:"h-5 w-5 text-red-500"});default:return e.icon}},D=e=>{switch(e.status){case"completed":return"text-green-600 bg-green-50 border-green-200";case"running":return"text-blue-600 bg-blue-50 border-blue-200";case"error":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 ".concat(o),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(x.Z,{className:"h-6 w-6 text-purple-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"分析実行"})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("button",{onClick:T,disabled:p||d,className:"flex items-center space-x-2 px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(y.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"データ更新のみ"})]})})]}),(0,n.jsx)("div",{className:"space-y-3 mb-6",children:v.map((e,t)=>(0,n.jsx)("div",{className:"p-4 rounded-lg border-2 transition-all ".concat(D(e)),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[M(e),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:e.name}),(0,n.jsx)("p",{className:"text-sm opacity-75",children:e.description})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:e.estimatedTime}),"running"===e.status&&(0,n.jsx)("div",{className:"text-xs text-blue-600",children:"実行中..."})]})]})},e.id))}),d&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,n.jsx)("span",{children:"全体進捗"}),(0,n.jsxs)("span",{children:[S,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,n.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(S,"%")}})}),C&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mt-2",children:[(0,n.jsx)(N.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["推定残り時間: ",C,"分"]})]})]}),(0,n.jsx)("div",{className:"flex space-x-3",children:d?(0,n.jsxs)("button",{disabled:!0,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gray-400 text-white rounded-lg cursor-not-allowed",children:[(0,n.jsx)(k.Z,{className:"h-5 w-5 animate-spin"}),(0,n.jsx)("span",{className:"font-medium",children:"実行中..."})]}):(0,n.jsxs)("button",{onClick:I,disabled:p,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(B.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"font-medium",children:"分析を実行"})]})}),!d&&100===S&&(0,n.jsxs)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.Z,{className:"h-5 w-5 text-green-600"}),(0,n.jsx)("span",{className:"text-green-800 font-medium",children:"分析が完了しました"})]}),(0,n.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"予測結果がダッシュボードに表示されます"})]})]})}var G=s(1622),H=s(4887);let q=(0,i.createContext)(null),V={FIRST_VISIT:"guide_first_visit",COMPLETED_STEPS:"guide_completed_steps",TOUR_COMPLETED:"guide_tour_completed",GUIDE_DISABLED:"guide_disabled",CURRENT_STEP:"guide_current_step"},K=[{id:"welcome",target:'[data-guide-target="welcome"]',title:"ようこそ！",body:"J-Quants株価予測システムへようこそ。3分で主要機能を案内します。",placement:"auto",page:"/",next:"navigation"},{id:"navigation",target:'[data-guide-target="navigation"]',title:"ナビゲーション",body:"各ページへの移動はここから。予測・モデル・分析・設定を切り替えできます。",placement:"bottom",page:"/",next:"dashboard-overview"},{id:"dashboard-overview",target:'[data-guide-target="dashboard-overview"]',title:"ダッシュボード概要",body:"今日の投資指示と主要KPIが表示されます。まずはここを確認しましょう。",placement:"auto",page:"/",next:"kpi-metrics"},{id:"kpi-metrics",target:'[data-guide-target="kpi-metrics"]',title:"主要指標の見方",body:"MAE（平均絶対誤差）・R\xb2（決定係数）・予測精度を確認。低いMAEと高いR\xb2が理想的。",placement:"auto",page:"/",next:"candidate-cards"},{id:"candidate-cards",target:'[data-guide-target="candidate-cards"]',title:"候補銘柄カード",body:"推奨銘柄とリスク情報を表示。カードをクリックして詳細分析に進めます。",placement:"auto",page:"/",next:"model-comparison"},{id:"model-comparison",target:'[data-guide-target="model-comparison"]',title:"モデル比較",body:"複数モデルの性能を比較。総合評価→詳細指標の順で確認しましょう。",placement:"auto",page:"/",next:"analysis-features"},{id:"analysis-features",target:'[data-guide-target="analysis-features"]',title:"分析機能",body:"特徴量重要度・残差分析・相関分析でモデルの信頼性を確認できます。",placement:"auto",page:"/",next:"settings-config"},{id:"settings-config",target:'[data-guide-target="settings-config"]',title:"設定",body:"実行時刻・通知先・しきい値を設定。定期的な分析実行に必要です。",placement:"auto",page:"/",next:"help-support"},{id:"help-support",target:'[data-guide-target="help-support"]',title:"ヘルプ・サポート",body:"困った時はF1キーまたは「？」ボタンでクイックヘルプを表示できます。",placement:"auto",page:"/",next:"completion"},{id:"completion",target:'[data-guide-target="completion"]',title:"完了！",body:"お疲れ様でした！これで主要機能を理解できました。明日からは自動案内しません。",placement:"auto",page:"/"}];function W(e){let{children:t,steps:s=K}=e,[l,c]=(0,i.useState)({isActive:!1,currentStep:null,completedSteps:[],isFirstVisit:!0,isTourCompleted:!1,isGuideDisabled:!1});(0,i.useEffect)(()=>{let e="false"!==localStorage.getItem(V.FIRST_VISIT),t=JSON.parse(localStorage.getItem(V.COMPLETED_STEPS)||"[]"),s="true"===localStorage.getItem(V.TOUR_COMPLETED),n="true"===localStorage.getItem(V.GUIDE_DISABLED),i=localStorage.getItem(V.CURRENT_STEP);c(l=>(0,r._)((0,a._)({},l),{isFirstVisit:e,completedSteps:t,isTourCompleted:s,isGuideDisabled:n,currentStep:i||null})),!e||n||s||setTimeout(()=>{d()},1e3)},[]);let o=(0,i.useCallback)(e=>{c(t=>{let s=(0,a._)({},t,e);return void 0!==e.isFirstVisit&&localStorage.setItem(V.FIRST_VISIT,e.isFirstVisit.toString()),void 0!==e.completedSteps&&localStorage.setItem(V.COMPLETED_STEPS,JSON.stringify(e.completedSteps)),void 0!==e.isTourCompleted&&localStorage.setItem(V.TOUR_COMPLETED,e.isTourCompleted.toString()),void 0!==e.isGuideDisabled&&localStorage.setItem(V.GUIDE_DISABLED,e.isGuideDisabled.toString()),void 0!==e.currentStep&&(e.currentStep?localStorage.setItem(V.CURRENT_STEP,e.currentStep):localStorage.removeItem(V.CURRENT_STEP)),s})},[]),d=(0,i.useCallback)(()=>{let e=s[0];e&&(O.focusManager.saveFocus(),O.screenReader.announce("ガイドツアーを開始しました"),o({isActive:!0,currentStep:e.id,isFirstVisit:!1}))},[s,o]),m=(0,i.useCallback)(()=>{setTimeout(()=>{c(e=>{if(!e.currentStep)return e;let t=s.find(t=>t.id===e.currentStep);if(!(null==t?void 0:t.next))return(0,r._)((0,a._)({},e),{isActive:!1,currentStep:null,isTourCompleted:!0,completedSteps:[...e.completedSteps,e.currentStep]});let n=s.find(e=>e.id===t.next);if(!n)return e;if(n.action){if("nav"===n.action.type)window.location.href=n.action.to;else if("click"===n.action.type){let e=document.querySelector(n.action.target);e&&e.click()}}return(0,r._)((0,a._)({},e),{currentStep:n.id,completedSteps:[...e.completedSteps,e.currentStep]})})},0)},[s]),h=(0,i.useCallback)(()=>{c(e=>{if(!e.currentStep)return e;let t=s.find(t=>t.id===e.currentStep);if(!(null==t?void 0:t.prev))return e;let n=s.find(e=>e.id===t.prev);return n?(0,r._)((0,a._)({},e),{currentStep:n.id}):e})},[s]),u=(0,i.useCallback)(()=>{o({isActive:!1,currentStep:null,isTourCompleted:!0})},[]),x=(0,i.useCallback)(()=>{O.screenReader.announce("ガイドツアーが完了しました"),O.focusManager.restoreFocus(),o({isActive:!1,currentStep:null,isTourCompleted:!0,completedSteps:[...l.completedSteps,l.currentStep||""]})},[l.completedSteps,l.currentStep]),g=(0,i.useCallback)(()=>{o({isGuideDisabled:!l.isGuideDisabled})},[l.isGuideDisabled]),p=(0,i.useCallback)(()=>{localStorage.removeItem(V.FIRST_VISIT),localStorage.removeItem(V.COMPLETED_STEPS),localStorage.removeItem(V.TOUR_COMPLETED),localStorage.removeItem(V.GUIDE_DISABLED),localStorage.removeItem(V.CURRENT_STEP),c({isActive:!1,currentStep:null,completedSteps:[],isFirstVisit:!0,isTourCompleted:!1,isGuideDisabled:!1})},[]),f=(0,i.useCallback)(()=>l.currentStep&&s.find(e=>e.id===l.currentStep)||null,[l.currentStep,s]),y=(0,i.useCallback)(e=>l.completedSteps.includes(e),[l.completedSteps]);return(0,n.jsxs)(q.Provider,{value:{state:l,startTour:d,nextStep:m,prevStep:h,skipTour:u,completeTour:x,toggleGuide:g,resetGuide:p,getCurrentStepData:f,isStepCompleted:y},children:[t,l.isActive&&(0,n.jsx)(Q,{})]})}function Q(){let{state:e,getCurrentStepData:t,nextStep:s,prevStep:a,skipTour:r,completeTour:l}=function(){let e=(0,i.useContext)(q);if(!e)throw Error("useGuide must be used within a TourProvider");return e}(),[c,o]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{o(!0)},[]),!c)return null;let d=t();return d?(0,H.createPortal)((0,n.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/50"}),(0,n.jsx)(X,{step:d,onNext:s,onPrev:a,onSkip:r,onComplete:l,isFirst:!d.prev,isLast:!d.next})]}),document.body):null}function X(e){let{step:t,onNext:s,onPrev:a,onSkip:r,onComplete:l,isFirst:c,isLast:o}=e,[d,m]=(0,i.useState)(null),[h,u]=(0,i.useState)({top:0,left:0,width:0,height:0});if((0,i.useEffect)(()=>{let e=document.querySelector(t.target);if(e){m(e);let t=e.getBoundingClientRect();u({top:t.top+window.scrollY,left:t.left+window.scrollX,width:t.width,height:t.height})}},[t.target]),(0,i.useEffect)(()=>{if(!d){let e=setTimeout(()=>{s()},0);return()=>clearTimeout(e)}},[d,s]),!d)return null;let x=(()=>{let{top:e,left:s,width:a,height:r}=h;switch(t.placement){case"top":return{top:e-200-16,left:s+a/2-160};case"bottom":return{top:e+r+16,left:s+a/2-160};case"left":return{top:e+r/2-100,left:s-320-16};case"right":return{top:e+r/2-100,left:s+a+16};default:let n=window.innerHeight-(e+r),i=window.innerWidth-(s+a);if(n>=216)return{top:e+r+16,left:s+a/2-160};if(e>=216)return{top:e-200-16,left:s+a/2-160};if(i>=336)return{top:e+r/2-100,left:s+a+16};return{top:e+r/2-100,left:s-320-16}}})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute border-2 border-blue-500 rounded-lg pointer-events-none",style:{top:h.top-4,left:h.left-4,width:h.width+8,height:h.height+8,boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}}),(0,n.jsxs)("div",{className:"absolute bg-white rounded-lg shadow-xl p-6 max-w-sm",style:{top:x.top,left:x.left,zIndex:1e3},children:[t.title&&(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:t.body}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[!c&&(0,n.jsx)("button",{onClick:a,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"戻る"}),(0,n.jsx)("button",{onClick:r,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"スキップ"})]}),(0,n.jsx)("div",{className:"flex gap-2",children:o?(0,n.jsx)("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"完了"}):(0,n.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"次へ"})})]})]})]})}let Y="force-dynamic",$=(0,c.default)(()=>Promise.all([s.e(648),s.e(424)]).then(s.bind(s,9424)),{loadableGenerated:{webpack:()=>[9424]},ssr:!1});function ee(){var e,t;let[l,c]=(0,i.useState)("overview"),[o,v]=(0,i.useState)(""),[N,S]=(0,i.useState)(!1),[k,_]=(0,i.useState)(!1),[I,T]=(0,i.useState)({}),[R,A]=(0,i.useState)(!0),[Z,L]=(0,i.useState)(null),[P,O]=(0,i.useState)([]),[U,B]=(0,i.useState)(""),[G,H]=(0,i.useState)(null),[q,V]=(0,i.useState)(!1),[K,W]=(0,i.useState)(z),[Q,X]=(0,i.useState)(!1),[Y,ee]=(0,i.useState)(!1),et={accuracy:85.5,mae:12.3,rmse:18.7,r2:.78},es={trends:[{description:"テクノロジー株の上昇傾向",sentiment:"positive"},{description:"エネルギー株の調整局面",sentiment:"negative"},{description:"金融株の安定推移",sentiment:"neutral"}]};!function(e){let{useEffect:t}=s(2265);t(()=>(F.startComponentTimer(e),()=>{F.endComponentTimer(e)}),[e])}("dashboard");let ea=function(){let[e,t]=(0,i.useState)({isLoading:!0,error:null,connectionStatus:null,marketSummary:null,lastUpdated:null,analysisResults:[]}),s=(0,i.useCallback)(async()=>{t(e=>(0,r._)((0,a._)({},e),{isLoading:!0,error:null}));try{console.log("ダッシュボード: JQuants接続テスト開始...");let e=await (0,d.M)();if(t(t=>(0,r._)((0,a._)({},t),{connectionStatus:e})),!e.success){t(t=>(0,r._)((0,a._)({},t),{isLoading:!1,error:"API接続失敗: ".concat(e.message)}));return}console.log("ダッシュボード: 市場分析実行中...");let s=await (0,m.JR)();if(!s){t(e=>(0,r._)((0,a._)({},e),{isLoading:!1,error:"市場サマリーの生成に失敗しました"}));return}let n=new Date().toISOString();t(e=>(0,r._)((0,a._)({},e),{isLoading:!1,marketSummary:s,lastUpdated:n,error:null})),console.log("ダッシュボードデータ更新完了:",{analyzedSymbols:s.analyzedSymbols,totalRecommendations:Object.values(s.recommendations).reduce((e,t)=>e+t,0),topGainers:s.topGainers.length,topLosers:s.topLosers.length})}catch(e){console.error("ダッシュボードデータ取得エラー:",e),t(t=>(0,r._)((0,a._)({},t),{isLoading:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}))}},[]);return(0,i.useEffect)(()=>{s()},[s]),(0,r._)((0,a._)({},e),{actions:{refresh:s}})}(),[er,en]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{A(!0);let e={summary:{exists:(0,j.nw)("dash:summary").exists,timestamp:(0,j.nw)("dash:summary").timestamp||void 0},stock:{exists:(0,j.nw)("dash:stock").exists,timestamp:(0,j.nw)("dash:stock").timestamp||void 0},model:{exists:(0,j.nw)("dash:model").exists,timestamp:(0,j.nw)("dash:model").timestamp||void 0},feature:{exists:(0,j.nw)("dash:feature").exists,timestamp:(0,j.nw)("dash:feature").timestamp||void 0},pred:{exists:(0,j.nw)("dash:pred").exists,timestamp:(0,j.nw)("dash:pred").timestamp||void 0},marketInsights:{exists:(0,j.nw)("dash:marketInsights").exists,timestamp:(0,j.nw)("dash:marketInsights").timestamp||void 0},riskAssessment:{exists:(0,j.nw)("dash:riskAssessment").exists,timestamp:(0,j.nw)("dash:riskAssessment").timestamp||void 0}};T(e),await ei();let t=D.g.getInstance();await t.initialize(),A(!1)}catch(e){console.error("ダッシュボード初期化エラー:",e),L("ダッシュボードの初期化に失敗しました"),A(!1)}})()},[]);let ei=async()=>{try{v(new Date().toLocaleString("ja-JP")),el()}catch(e){console.error("データ読み込みエラー:",e),L("データの読み込みに失敗しました")}},el=()=>{var e,t,s,a,r,n,i;let l=[];(null===(e=I.summary)||void 0===e?void 0:e.exists)&&I.summary.timestamp&&l.push(w.getFreshnessInfo(I.summary.timestamp,"cache",60)),(null===(t=I.stock)||void 0===t?void 0:t.exists)&&I.stock.timestamp&&l.push(w.getFreshnessInfo(I.stock.timestamp,"cache",30)),(null===(s=I.model)||void 0===s?void 0:s.exists)&&I.model.timestamp&&l.push(w.getFreshnessInfo(I.model.timestamp,"cache",120)),(null===(a=I.feature)||void 0===a?void 0:a.exists)&&I.feature.timestamp&&l.push(w.getFreshnessInfo(I.feature.timestamp,"cache",60)),(null===(r=I.pred)||void 0===r?void 0:r.exists)&&I.pred.timestamp&&l.push(w.getFreshnessInfo(I.pred.timestamp,"cache",15)),(null===(n=I.marketInsights)||void 0===n?void 0:n.exists)&&I.marketInsights.timestamp&&l.push(w.getFreshnessInfo(I.marketInsights.timestamp,"cache",30)),(null===(i=I.riskAssessment)||void 0===i?void 0:i.exists)&&I.riskAssessment.timestamp&&l.push(w.getFreshnessInfo(I.riskAssessment.timestamp,"cache",60)),O(l)},ec=async()=>{S(!0),B("更新中...");try{await ei(),B("更新完了"),setTimeout(()=>B(""),2e3)}catch(e){console.error("更新エラー:",e),B("更新失敗")}finally{S(!1)}},eo=async()=>{S(!0),B("強制更新中...");try{await ei(),B("強制更新完了"),setTimeout(()=>B(""),2e3)}catch(e){console.error("強制更新エラー:",e),B("強制更新失敗")}finally{S(!1)}},ed=async()=>{S(!0),B("再計算中...");try{await ei(),B("再計算完了"),setTimeout(()=>B(""),2e3)}catch(e){console.error("再計算エラー:",e),B("再計算失敗")}finally{S(!1)}},em=e=>{H(e),V(!0)};return R?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"ダッシュボードを読み込み中..."})]})}):Z?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(h.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:Z}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"再読み込み"})]})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20 lg:pb-0",children:[(0,n.jsx)($,{activeTab:l,onTabChange:c,onAnalysisClick:()=>_(!0),onSettingsClick:()=>X(!0),onMonitoringClick:()=>ee(!0)}),(0,n.jsx)("header",{className:"hidden lg:block bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,n.jsxs)("div",{"data-guide-target":"welcome",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"J-Quants 株価予測ダッシュボード"}),(0,n.jsx)("p",{className:"text-gray-600",children:"機械学習による株価予測システム"})]}),(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row items-start xl:items-center space-y-2 xl:space-y-0 xl:space-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(u.Z,{className:"h-5 w-5 text-green-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"システム: 正常稼働中"})]}),P.length>0&&(0,n.jsx)(C,{freshnessInfos:P,onRefreshAll:ec}),P.length>0&&(0,n.jsx)(E,{freshnessInfos:P,showDetails:!1,onRefreshAll:ec,className:"hidden xl:block"})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)(M,{onRefresh:er?ea.actions.refresh:ec,onForceRefresh:er?ea.actions.refresh:eo,onRecompute:er?ea.actions.refresh:ed,isLoading:er?ea.isLoading:N,lastRefresh:er?ea.lastUpdated?new Date(ea.lastUpdated):void 0:o?new Date(o):void 0,refreshInterval:5,variant:"default",size:"md",showProgress:!0,showLastRefresh:!0})})]})]})})}),(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsx)("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[{id:"overview",name:"概要",icon:x.Z},{id:"analysis",name:"分析",icon:g.Z},{id:"models",name:"モデル",icon:p.Z},{id:"predictions",name:"予測",icon:f.Z}].map(e=>{let t=e.icon;return(0,n.jsxs)("button",{onClick:()=>c(e.id),className:"flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ".concat(l===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,n.jsx)(t,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:e.name})]},e.id)})})}),(0,n.jsx)("div",{className:"mb-6 flex justify-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-2 shadow-sm border flex",children:[(0,n.jsx)("button",{onClick:()=>en(!0),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(er?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"実データ (JQuants)"}),(0,n.jsx)("button",{onClick:()=>en(!1),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(er?"text-gray-600 hover:text-gray-900":"bg-blue-600 text-white"),children:"サンプルデータ"})]})}),"overview"===l&&(0,n.jsxs)("div",{className:"space-y-6","data-guide-target":"overview",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"システム状況"}),er&&ea.connectionStatus&&(0,n.jsxs)("div",{className:"flex items-center px-3 py-1 rounded-lg text-sm ".concat(ea.connectionStatus.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:[ea.connectionStatus.success?(0,n.jsx)(u.Z,{className:"w-4 h-4 mr-2"}):(0,n.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"JQuants API: ",ea.connectionStatus.success?"接続中":"エラー"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(u.Z,{className:"h-8 w-8 text-green-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"システム状態"}),(0,n.jsx)("p",{className:"text-sm text-green-600",children:er&&(null===(e=ea.connectionStatus)||void 0===e?void 0:e.success)?"JQuants接続中":"正常稼働中"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(y.Z,{className:"h-8 w-8 text-blue-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"データ更新"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:er?ea.lastUpdated?new Date(ea.lastUpdated).toLocaleString("ja-JP"):"未更新":o||"未更新"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(p.Z,{className:"h-8 w-8 text-purple-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"分析銘柄数"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:er&&ea.marketSummary?"".concat(ea.marketSummary.analyzedSymbols,"/").concat(ea.marketSummary.totalSymbols,"件"):"学習済み"})]})]})]}),er&&ea.marketSummary&&(0,n.jsxs)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ea.marketSummary.recommendations.STRONG_BUY+ea.marketSummary.recommendations.BUY}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"買い推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:ea.marketSummary.recommendations.HOLD}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"ホールド"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ea.marketSummary.recommendations.SELL+ea.marketSummary.recommendations.STRONG_SELL}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"売り推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ea.marketSummary.topGainers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"上昇銘柄"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ea.marketSummary.topLosers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"下落銘柄"})]})]}),!er&&P.length>0&&(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(E,{freshnessInfos:P,showDetails:!0,onRefreshAll:ec})})]}),et&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"パフォーマンス指標"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[et.accuracy||"N/A","%"]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"精度"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:et.mae||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"MAE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:et.rmse||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"RMSE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:et.r2||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"R\xb2"})]})]})]}),es&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"市場インサイト"}),(0,n.jsx)("div",{className:"space-y-3",children:null===(t=es.trends)||void 0===t?void 0:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.description}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat("positive"===e.sentiment?"text-green-600":"negative"===e.sentiment?"text-red-600":"text-gray-600"),children:"positive"===e.sentiment?"上昇":"negative"===e.sentiment?"下降":"中立"})]},t))})]})]}),"analysis"===l&&(0,n.jsx)("div",{className:"space-y-6","data-guide-target":"analysis-features",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"分析機能"}),(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(x.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"分析機能は準備中です"})]})]})}),"models"===l&&(0,n.jsx)("div",{className:"space-y-6","data-guide-target":"model-comparison",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"モデル比較"}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"モデル名"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"タイプ"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MAE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RMSE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R\xb2"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ランク"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{name:"Random Forest",type:"Ensemble",mae:10.2,mse:156.8,rmse:12.5,r2:.82,rank:1},{name:"XGBoost",type:"Gradient Boosting",mae:11.1,mse:178.3,rmse:13.4,r2:.79,rank:2},{name:"LSTM",type:"Neural Network",mae:12.8,mse:201.5,rmse:14.2,r2:.75,rank:3}].map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>em(e),children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.mae.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.rmse.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.r2.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,n.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(1===e.rank?"bg-green-100 text-green-800":e.rank<=3?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:["#",e.rank]})})]},t))})]})})]})}),"predictions"===l&&(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"予測結果"}),(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(f.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"予測機能は準備中です"})]})]})})]}),k&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"分析実行"}),(0,n.jsx)("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)(b.Z,{className:"h-6 w-6"})})]}),(0,n.jsx)(J,{})]})})]})})}function et(){return(0,n.jsx)(l.SV,{fallbackRender:e=>{let{error:t,resetErrorBoundary:s}=e;return(0,n.jsx)(G.Z,{onError:()=>{}})},children:(0,n.jsx)(o.m,{children:(0,n.jsx)(U,{children:(0,n.jsx)(W,{children:(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}),children:(0,n.jsx)(ee,{})})})})})})}},1622:function(e,t,s){"use strict";var a=s(7437),r=s(2265),n=s(5442),i=s(7168),l=s(4938),c=s(2489),o=s(6865),d=s(2926),m=s(91),h=s(8728);class u extends r.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var s,a;console.error("統一エラーバウンダリ:",e,t),n.Po.handleError(e).then(t=>{if(t)this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1});else{let t=n.Po.categorizeError(e);this.setState({errorInfo:t,isRecovering:!1})}}),null===(s=(a=this.props).onError)||void 0===s||s.call(a,e,t)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;let{errorInfo:e,isRecovering:t,retryCount:s}=this.state,r=s<this.maxRetries;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:this.getErrorIcon()}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,a.jsx)("p",{className:"text-sm mb-4 ".concat(this.getErrorColor()),children:(null==e?void 0:e.userMessage)||"予期しないエラーが発生しました"}),e&&(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:(0,a.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,a.jsxs)("div",{children:["カテゴリ: ",e.category]}),(0,a.jsxs)("div",{children:["重要度: ",e.severity]}),(0,a.jsxs)("div",{children:["時刻: ",new Date(e.timestamp).toLocaleString("ja-JP")]})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[r&&(0,a.jsxs)("button",{onClick:this.handleRetry,disabled:t,className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4 ".concat(t?"animate-spin":"")}),(0,a.jsx)("span",{children:t?"復旧中...":"再試行"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("button",{onClick:this.handleGoHome,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"ホーム"})]}),(0,a.jsxs)("button",{onClick:this.handleRefresh,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"再読み込み"})]})]}),(0,a.jsxs)("button",{onClick:this.handleDismiss,className:"w-full flex items-center justify-center space-x-2 px-3 py-2 text-gray-500 hover:text-gray-700",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"エラーを無視"})]})]}),s>0&&(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["再試行回数: ",s,"/",this.maxRetries]})]})})})}return this.props.children}constructor(e){super(e),this.maxRetries=3,this.handleRetry=async()=>{if(!(this.state.retryCount>=this.maxRetries)){this.setState({isRecovering:!0,retryCount:this.state.retryCount+1});try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}try{Object.keys(localStorage).forEach(e=>{(e.startsWith("app_cache:")||e.startsWith("next:"))&&localStorage.removeItem(e)})}catch(e){console.warn("ローカルストレージのクリアに失敗:",e)}this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1})}catch(e){console.error("リトライエラー:",e),this.setState({isRecovering:!1})}}},this.handleGoHome=()=>{window.location.href="/"},this.handleRefresh=()=>{window.location.reload()},this.handleDismiss=()=>{this.setState({hasError:!1,error:null,errorInfo:null,retryCount:0})},this.getErrorIcon=()=>{if(!this.state.errorInfo)return(0,a.jsx)(o.Z,{className:"h-8 w-8 text-red-500"});switch(this.state.errorInfo.category){case"network":return(0,a.jsx)(d.Z,{className:"h-8 w-8 text-orange-500"});case"api":return(0,a.jsx)(m.Z,{className:"h-8 w-8 text-blue-500"});case"system":return(0,a.jsx)(h.Z,{className:"h-8 w-8 text-purple-500"});default:return(0,a.jsx)(o.Z,{className:"h-8 w-8 text-red-500"})}},this.getErrorColor=()=>{if(!this.state.errorInfo)return"text-red-600";switch(this.state.errorInfo.severity){case"low":return"text-yellow-600";case"medium":return"text-orange-600";default:return"text-red-600"}},this.state={hasError:!1,error:null,errorInfo:null,isRecovering:!1,retryCount:0}}}t.Z=u},3959:function(e,t,s){"use strict";s.d(t,{m:function(){return c},r:function(){return o}});var a=s(5583),r=s(7437),n=s(2265);let i={prediction:{days:30},model:{type:"all",primary_model:"xgboost",compare_models:!0,auto_retrain:!1,retrain_frequency:"weekly"},data:{refresh_interval:"daily",max_data_points:1e3,include_technical_indicators:!0},features:{selected:["sma_5","sma_10","sma_25","sma_50","rsi","macd"]},ui:{theme:"light",refresh_rate:30,show_tooltips:!0}},l=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,n.useState)(i),[o,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),u=async()=>{try{d(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,a._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{d(!1)}},x=async()=>{try{h(!0),localStorage.setItem("jquants-settings",JSON.stringify(s))}catch(e){throw console.error("設定保存エラー:",e),e}finally{h(!1)}};return(0,n.useEffect)(()=>{(async()=>{try{d(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,a._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{d(!1)}})()},[]),(0,r.jsx)(l.Provider,{value:{settings:s,updateSettings:e=>{c(t=>(0,a._)({},t,e))},loadSettings:u,saveSettings:x,resetSettings:()=>{c(i)},isLoading:o,isSaving:m},children:t})}function o(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e}},8071:function(e,t,s){"use strict";s.d(t,{g:function(){return r}});var a=s(257);class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){try{await this.loadConfig(),console.log("✅ 通知サービス初期化完了")}catch(e){throw console.error("通知サービス初期化エラー:",e),e}}async loadConfig(){try{let e=localStorage.getItem("notification-config");if(e)try{return this.config=JSON.parse(e),this.config}catch(e){console.warn("通知設定のJSON解析に失敗しました。デフォルトにフォールバックします。")}let t=void 0!==a&&a.env&&!1,s={email:{enabled:!1,smtp_server:"smtp.gmail.com",smtp_port:587,email_user:"",email_password:"",email_to:""},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:"mailto:example@example.com"},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0}};if(t){try{localStorage.setItem("notification-config",JSON.stringify(s))}catch(e){}return this.config=s,s}throw Error("設定が見つかりません")}catch(e){throw console.error("設定読み込みエラー:",e),e}}async saveConfig(e){try{localStorage.setItem("notification-config",JSON.stringify(e)),this.config=e}catch(e){throw console.error("設定保存エラー:",e),e}}async initializePushNotifications(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("プッシュ通知がサポートされていません"),!1;try{this.registration=await navigator.serviceWorker.register("/sw.js");let e=await Notification.requestPermission();if("granted"!==e)return console.warn("通知の許可が得られませんでした"),!1;return await this.subscribeToPushNotifications(),!0}catch(e){return console.error("プッシュ通知の初期化エラー:",e),!1}}async subscribeToPushNotifications(){var e;if(this.registration&&(null===(e=this.config)||void 0===e?void 0:e.push.enabled))try{let e=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.push.vapid_public_key});localStorage.setItem("push-subscription",JSON.stringify(e))}catch(e){console.error("プッシュ通知の購読エラー:",e)}}async sendLocalNotification(e){if(!this.registration||"granted"!==Notification.permission)return;let t={body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:e.type,data:e.data,requireInteraction:"high"===e.priority};await this.registration.showNotification(e.title,t)}async notifyAnalysisComplete(e){let t={type:"analysis_complete",title:"\uD83D\uDCCA 株価分析完了",message:"分析が完了しました。".concat(e.buy_candidates||0,"件の買い候補、").concat(e.sell_candidates||0,"件の売り候補が見つかりました。"),data:e,timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyError(e){let t={type:"error",title:"❌ 分析エラー",message:"分析中にエラーが発生しました: ".concat(e),timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyRecommendation(e,t,s){let a={type:"recommendation",title:"\uD83D\uDCA1 ".concat(e," ").concat(t,"推奨"),message:s,data:{symbol:e,action:t,reason:s},timestamp:new Date().toISOString(),priority:"medium"};await this.sendLocalNotification(a)}async notifyRiskAlert(e,t){let s={type:"risk_alert",title:"⚠️ ".concat(e," リスク警告"),message:t,data:{symbol:e,message:t},timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(s)}async startAutoUpdate(){try{if(!(await fetch("/api/start-auto-update",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("自動更新の開始に失敗しました");console.log("自動更新を開始しました")}catch(e){throw console.error("自動更新開始エラー:",e),e}}async stopAutoUpdate(){try{localStorage.removeItem("auto-update-enabled"),console.log("自動更新設定を削除しました（静的サイトでは実際の自動更新は実行されません）")}catch(e){throw console.error("自動更新停止エラー:",e),e}}async getNotificationHistory(){try{let e=localStorage.getItem("notification-history");if(e)return JSON.parse(e);return[]}catch(e){return console.error("通知履歴取得エラー:",e),[]}}constructor(){this.config=null,this.registration=null}}}},function(e){e.O(0,[644,15,971,117,744],function(){return e(e.s=6417)}),_N_E=e.O()}]);