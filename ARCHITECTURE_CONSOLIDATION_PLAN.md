# アーキテクチャ統合計画

## 🎯 目標
アーキテクチャの複雑性と重複コード問題を解決し、単一の統合システムを構築する

## 📊 現状分析

### 問題の深刻度
- **影響度**: 🔴 Critical
- **修正難易度**: 🟡 Medium  
- **推定工数**: 2-3日

### 主要な問題
1. **機能重複**: `unified_system.py` (1210行) と `jquants_stock_prediction.py` (272行)
2. **設定ファイル混乱**: 3つの設定ファイルが存在
3. **エラーハンドリング分散**: 96個のファイルで分散

## 🏗️ 統合戦略

### Phase 1: レガシーシステムの廃止
- [ ] `jquants_stock_prediction.py` を廃止予定としてマーク
- [ ] 統合システムへの移行警告を追加
- [ ] 後方互換性を維持

### Phase 2: 設定ファイルの統合
- [ ] `config_final.yaml` を唯一の設定ファイルとして使用
- [ ] `config_unified.yaml` と `trading_config.yaml` を廃止
- [ ] 設定項目の重複を解消

### Phase 3: エラーハンドリングの統合
- [ ] `unified_system.py` 内のエラーハンドリングを統一
- [ ] `unified_error_handler.py` の機能を `unified_system.py` に統合
- [ ] 分散したエラーハンドリングを集約

### Phase 4: コードの最適化
- [ ] 重複コードの削除
- [ ] 不要なクラスとメソッドの削除
- [ ] パフォーマンスの最適化

## 📋 実装計画

### Step 1: レガシーシステムの廃止準備
```python
# jquants_stock_prediction.py に廃止警告を追加
warnings.warn(
    "jquants_stock_prediction.py は廃止予定です。unified_system.py を使用してください。",
    DeprecationWarning,
    stacklevel=2,
)
```

### Step 2: 設定ファイルの統合
- `config_final.yaml` を唯一の設定ファイルとして使用
- 他の設定ファイルを削除または非推奨化

### Step 3: エラーハンドリングの統合
- `unified_system.py` 内のエラーハンドリングを統一
- 分散したエラーハンドリングを集約

### Step 4: コードの最適化
- 重複コードの削除
- 不要なクラスとメソッドの削除

## 🎯 期待される効果

### 保守性の向上
- 単一の統合システムによる保守性向上
- 設定ファイルの統一による管理の簡素化
- エラーハンドリングの統一によるデバッグの容易化

### パフォーマンスの向上
- 重複コードの削除によるメモリ使用量の削減
- 統合システムによる処理の最適化

### 開発効率の向上
- 単一のコードベースによる開発効率の向上
- 統一されたエラーハンドリングによるデバッグの容易化

## 📊 成功指標

- [ ] コード行数の削減: 目標 30% 削減
- [ ] 設定ファイルの統合: 3ファイル → 1ファイル
- [ ] エラーハンドリングの統一: 分散 → 統合
- [ ] パフォーマンスの向上: メモリ使用量 20% 削減

## 🚀 実装スケジュール

### Day 1: レガシーシステムの廃止準備
- 廃止警告の追加
- 移行ガイドの作成

### Day 2: 設定ファイルの統合
- 設定ファイルの統合
- 設定項目の重複解消

### Day 3: エラーハンドリングの統合
- エラーハンドリングの統一
- 分散したエラーハンドリングの集約

## 📝 注意事項

- 後方互換性を維持
- 既存の機能を損なわない
- 段階的な移行を実施
- 十分なテストを実施
