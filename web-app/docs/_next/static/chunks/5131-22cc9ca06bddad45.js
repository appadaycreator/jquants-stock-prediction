"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5131],{55131:function(e,r,t){t.d(r,{default:function(){return y}});var s=t(57437),a=t(2265);class i{categorizeError(e){let r=e.message.toLowerCase();return this._isNetworkError(r)?{category:"network",severity:"medium",message:e.message,userMessage:"ネットワーク接続に問題があります。しばらく待ってから再試行してください。",autoRetry:!0,retryDelay:3e3,fallbackAction:"refresh",timestamp:new Date().toISOString()}:r.includes("api")||r.includes("http")||r.includes("status")?{category:"api",severity:"high",message:e.message,userMessage:"API接続に問題があります。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:r.includes("data")||r.includes("parse")||r.includes("json")?{category:"data",severity:"medium",message:e.message,userMessage:"データの処理中にエラーが発生しました。",autoRetry:!0,retryDelay:1e3,fallbackAction:"clear-cache",timestamp:new Date().toISOString()}:r.includes("validation")||r.includes("invalid")||r.includes("required")?{category:"validation",severity:"low",message:e.message,userMessage:"入力データに問題があります。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:r.includes("system")||r.includes("internal")?{category:"system",severity:"critical",message:e.message,userMessage:"システムエラーが発生しました。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"redirect",timestamp:new Date().toISOString()}:{category:"unknown",severity:"medium",message:e.message,userMessage:"予期しないエラーが発生しました。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}}async handleError(e,r){let t=this.categorizeError(e);this.errorHistory.push(t);let s=r?"".concat(r.operation,"_").concat(r.component,"_").concat(e.message):e.message,a=Date.now(),i=this.lastErrorTime.get(s)||0,o=this.errorCounts.get(s)||0;if(a-i<6e4&&o>=this.maxErrorsPerMinute)return!1;if(this.errorCounts.set(s,o+1),this.lastErrorTime.set(s,a),console.error("エラーハンドラー:",t),this.isRecovering)return console.log("既に復旧処理中です"),!1;this.isRecovering=!0;try{return t.autoRetry&&await this.retryOperation(t),await this.executeFallbackAction(t),this.isRecovering=!1,!0}catch(e){return console.error("復旧処理エラー:",e),this.isRecovering=!1,!1}}async retryOperation(e){e.retryDelay>0&&await new Promise(r=>setTimeout(r,e.retryDelay))}_isNetworkError(e){return["network","fetch","timeout","connection","offline"].some(r=>e.includes(r))}async executeFallbackAction(e){switch(e.fallbackAction){case"refresh":window.location.reload();break;case"clear-cache":localStorage.clear(),sessionStorage.clear();break;case"redirect":window.location.href="/error"}}getErrorHistory(){return[...this.errorHistory]}getErrorStats(){let e={},r={};return this.errorHistory.forEach(t=>{e[t.category]=(e[t.category]||0)+1,r[t.severity]=(r[t.severity]||0)+1}),{total:this.errorHistory.length,byCategory:e,bySeverity:r}}reset(){this.errorHistory=[],this.errorCounts.clear(),this.lastErrorTime.clear(),this.isRecovering=!1}constructor(){this.errorHistory=[],this.isRecovering=!1,this.errorCounts=new Map,this.lastErrorTime=new Map,this.maxErrorsPerMinute=10}}let o=new i;var n=t(82431),c=t(14938),l=t(32489),h=t(76865),u=t(62926),d=t(50091),m=t(98728);class g extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){var t,s;console.error("統一エラーバウンダリ:",e,r),o.handleError(e).then(r=>{if(r)this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1});else{let r=o.categorizeError(e);this.setState({errorInfo:r,isRecovering:!1})}}),null===(t=(s=this.props).onError)||void 0===t||t.call(s,e,r)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;let{errorInfo:e,isRecovering:r,retryCount:t}=this.state,a=t<this.maxRetries;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"flex justify-center mb-4",children:this.getErrorIcon()}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,s.jsx)("p",{className:"text-sm mb-4 ".concat(this.getErrorColor()),children:(null==e?void 0:e.userMessage)||"予期しないエラーが発生しました"}),e&&(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:(0,s.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,s.jsxs)("div",{children:["カテゴリ: ",e.category]}),(0,s.jsxs)("div",{children:["重要度: ",e.severity]}),(0,s.jsxs)("div",{children:["時刻: ",new Date(e.timestamp).toLocaleString("ja-JP")]})]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[a&&(0,s.jsxs)("button",{onClick:this.handleRetry,disabled:r,className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(n.Z,{className:"h-4 w-4 ".concat(r?"animate-spin":"")}),(0,s.jsx)("span",{children:r?"復旧中...":"再試行"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{onClick:this.handleGoHome,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"ホーム"})]}),(0,s.jsxs)("button",{onClick:this.handleRefresh,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,s.jsx)(n.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"再読み込み"})]})]}),(0,s.jsxs)("button",{onClick:this.handleDismiss,className:"w-full flex items-center justify-center space-x-2 px-3 py-2 text-gray-500 hover:text-gray-700",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"エラーを無視"})]})]}),t>0&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["再試行回数: ",t,"/",this.maxRetries]})]})})})}return this.props.children}constructor(e){super(e),this.maxRetries=3,this.handleRetry=async()=>{if(!(this.state.retryCount>=this.maxRetries)){this.setState({isRecovering:!0,retryCount:this.state.retryCount+1});try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}try{Object.keys(localStorage).forEach(e=>{(e.startsWith("app_cache:")||e.startsWith("next:"))&&localStorage.removeItem(e)})}catch(e){console.warn("ローカルストレージのクリアに失敗:",e)}this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1})}catch(e){console.error("リトライエラー:",e),this.setState({isRecovering:!1})}}},this.handleGoHome=()=>{window.location.href="/"},this.handleRefresh=()=>{window.location.reload()},this.handleDismiss=()=>{this.setState({hasError:!1,error:null,errorInfo:null,retryCount:0})},this.getErrorIcon=()=>{if(!this.state.errorInfo)return(0,s.jsx)(h.Z,{className:"h-8 w-8 text-red-500"});switch(this.state.errorInfo.category){case"network":return(0,s.jsx)(u.Z,{className:"h-8 w-8 text-orange-500"});case"api":return(0,s.jsx)(d.Z,{className:"h-8 w-8 text-blue-500"});case"system":return(0,s.jsx)(m.Z,{className:"h-8 w-8 text-purple-500"});default:return(0,s.jsx)(h.Z,{className:"h-8 w-8 text-red-500"})}},this.getErrorColor=()=>{if(!this.state.errorInfo)return"text-red-600";switch(this.state.errorInfo.severity){case"low":return"text-yellow-600";case"medium":return"text-orange-600";default:return"text-red-600"}},this.state={hasError:!1,error:null,errorInfo:null,isRecovering:!1,retryCount:0}}}var y=g}}]);