"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{63910:function(t,e,i){i.d(e,{$:function(){return n}});var a=i(2265),o=i(3959);function n(){let{settings:t}=(0,o.r)(),[e,i]=(0,a.useState)(!1),[n,s]=(0,a.useState)(0),[r,c]=(0,a.useState)("");return{runAnalysisWithSettings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{i(!0),s(0),c("設定に基づく分析を開始しています...");let a={prediction_days:t.prediction.days,primary_model:t.model.primary_model,compare_models:t.model.compare_models,auto_retrain:t.model.auto_retrain,retrain_frequency:t.model.retrain_frequency,max_data_points:t.data.max_data_points,include_technical_indicators:t.data.include_technical_indicators,selected_features:t.features.selected,symbols:e.symbols||[],analysis_type:e.analysisType||"comprehensive",use_settings:!1!==e.useSettings},o=setInterval(()=>{s(t=>t>=90?(clearInterval(o),t):t+10*Math.random())},500);c("分析パラメータを送信中..."),s(10),await new Promise(t=>setTimeout(t,1e3)),c("分析を実行中..."),s(50);let n={success:!0,analysis_id:"analysis_".concat(Date.now()),predictions:[{symbol:"7203.T",name:"トヨタ自動車",prediction:"BUY",confidence:.85,price:2500,change:2.5},{symbol:"6758.T",name:"ソニーグループ",prediction:"SELL",confidence:.72,price:12e3,change:-1.8}],summary:{total_predictions:2,buy_signals:1,sell_signals:1,avg_confidence:.785}};return c("分析が完了しました。データを更新しています..."),s(100),{success:!0,result:n,settings:a}}catch(t){return console.error("分析実行エラー:",t),c("分析エラー: ".concat(t instanceof Error?t.message:"不明なエラー")),{success:!1,error:t instanceof Error?t.message:"不明なエラー"}}finally{i(!1),setTimeout(()=>{s(0),c("")},2e3)}},isAnalyzing:e,analysisProgress:n,analysisStatus:r,getAnalysisDescription:()=>{let e=t.model.compare_models?"複数モデル比較（メイン: ".concat(t.model.primary_model,"）"):"単一モデル（".concat(t.model.primary_model,"）"),i=t.model.auto_retrain?"自動再訓練（".concat(t.model.retrain_frequency,"）"):"手動再訓練";return{prediction:"".concat(t.prediction.days,"日先予測"),model:e,retrain:i,features:"".concat(t.features.selected.length,"個の特徴量"),data:"".concat(t.data.max_data_points,"データポイント")}}}}},28071:function(t,e,i){i.d(e,{g:function(){return o}});var a=i(40257);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}async initialize(){try{await this.loadConfig(),console.log("✅ 通知サービス初期化完了")}catch(t){throw console.error("通知サービス初期化エラー:",t),t}}async loadConfig(){try{if("undefined"==typeof localStorage)throw Error("localStorage is not available");let t=localStorage.getItem("notification-config");if(t)try{return this.config=JSON.parse(t),this.config}catch(t){console.warn("通知設定のJSON解析に失敗しました。デフォルトにフォールバックします。")}let e=void 0!==a&&a.env&&!1,i={email:{enabled:!1,smtp_server:"smtp.gmail.com",smtp_port:587,email_user:"",email_password:"",email_to:""},slack:{enabled:!1,webhook_url:"",channel:"#stock-analysis",username:"株価分析Bot",icon_emoji:":chart_with_upwards_trend:"},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:"mailto:example@example.com"},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0},rate_limiting:{max_notifications_per_hour:5,cooldown_minutes:30}};if(e){try{"undefined"!=typeof localStorage&&localStorage.setItem("notification-config",JSON.stringify(i))}catch(t){}return this.config=i,i}throw Error("設定が見つかりません")}catch(t){throw console.error("設定読み込みエラー:",t),t}}async saveConfig(t){try{if("undefined"==typeof localStorage)throw Error("localStorage is not available");localStorage.setItem("notification-config",JSON.stringify(t)),this.config=t}catch(t){throw console.error("設定保存エラー:",t),t}}async initializePushNotifications(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("プッシュ通知がサポートされていません"),!1;try{this.registration=await navigator.serviceWorker.register("/sw.js");let t=await Notification.requestPermission();if("granted"!==t)return console.warn("通知の許可が得られませんでした"),!1;return await this.subscribeToPushNotifications(),!0}catch(t){return console.error("プッシュ通知の初期化エラー:",t),!1}}async subscribeToPushNotifications(){var t;if(this.registration&&(null===(t=this.config)||void 0===t?void 0:t.push.enabled))try{let t=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.push.vapid_public_key});localStorage.setItem("push-subscription",JSON.stringify(t))}catch(t){console.error("プッシュ通知の購読エラー:",t)}}async sendLocalNotification(t){if(!this.registration||"granted"!==Notification.permission)return;let e={body:t.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:t.type,data:t.data,requireInteraction:"high"===t.priority};await this.registration.showNotification(t.title,e)}async notifyAnalysisComplete(t){let e={type:"analysis_complete",title:"\uD83D\uDCCA 株価分析完了",message:"分析が完了しました。".concat(t.buy_candidates||0,"件の買い候補、").concat(t.sell_candidates||0,"件の売り候補が見つかりました。"),data:t,timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(e)}async notifyError(t){let e={type:"error",title:"❌ 分析エラー",message:"分析中にエラーが発生しました: ".concat(t),timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(e)}async notifyRecommendation(t,e,i){let a={type:"recommendation",title:"\uD83D\uDCA1 ".concat(t," ").concat(e,"推奨"),message:i,data:{symbol:t,action:e,reason:i},timestamp:new Date().toISOString(),priority:"medium"};await this.sendLocalNotification(a)}async notifyRiskAlert(t,e){let i={type:"risk_alert",title:"⚠️ ".concat(t," リスク警告"),message:e,data:{symbol:t,message:e},timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(i)}async startAutoUpdate(){try{if(!(await fetch("/api/start-auto-update",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("自動更新の開始に失敗しました");console.log("自動更新を開始しました")}catch(t){throw console.error("自動更新開始エラー:",t),t}}async stopAutoUpdate(){try{localStorage.removeItem("auto-update-enabled"),console.log("自動更新設定を削除しました（静的サイトでは実際の自動更新は実行されません）")}catch(t){throw console.error("自動更新停止エラー:",t),t}}async getNotificationHistory(){try{if("undefined"==typeof localStorage)return[];let t=localStorage.getItem("notification-history");if(t)return JSON.parse(t);return[]}catch(t){return console.error("通知履歴取得エラー:",t),[]}}async notifyRoutineComplete(t){let e={type:"routine_complete",title:"✅ 5分ルーティン完了",message:"5分ルーティンが正常に完了しました。実行時間: ".concat(t.execution_time||"不明"),data:t,timestamp:new Date().toISOString(),priority:"high",source:"automated"};await this.sendLocalNotification(e),await this.sendEmailNotification(e),await this.sendSlackNotification(e)}async notifyRoutineFailed(t){let e={type:"routine_failed",title:"❌ 5分ルーティン失敗",message:"5分ルーティンでエラーが発生しました: ".concat(t),timestamp:new Date().toISOString(),priority:"critical",source:"automated"};await this.sendLocalNotification(e),await this.sendEmailNotification(e),await this.sendSlackNotification(e)}async notifySchedulerStatus(t){let e={type:"scheduler_status",title:"\uD83D\uDCC5 スケジューラー状態",message:"スケジューラー: ".concat(t.is_running?"実行中":"停止中",", 実行回数: ").concat(t.execution_count,", エラー回数: ").concat(t.error_count),data:t,timestamp:new Date().toISOString(),priority:"medium",source:"automated"};await this.sendLocalNotification(e)}async sendEmailNotification(t){var e;if((null===(e=this.config)||void 0===e?void 0:e.email.enabled)&&this.config.email.email_to)try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:this.config.email.email_to,subject:t.title,message:t.message,config:this.config.email})})).ok)throw Error("メール送信に失敗しました");console.log("メール通知を送信しました")}catch(t){console.error("メール通知送信エラー:",t)}}async sendSlackNotification(t){var e;if((null===(e=this.config)||void 0===e?void 0:e.slack.enabled)&&this.config.slack.webhook_url)try{if(!(await fetch("/api/send-slack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({webhook_url:this.config.slack.webhook_url,channel:this.config.slack.channel,username:this.config.slack.username,icon_emoji:this.config.slack.icon_emoji,title:t.title,message:t.message,priority:t.priority})})).ok)throw Error("Slack通知送信に失敗しました");console.log("Slack通知を送信しました")}catch(t){console.error("Slack通知送信エラー:",t)}}async checkRateLimit(){var t;if(!(null===(t=this.config)||void 0===t?void 0:t.rate_limiting))return!0;try{let t=Date.now()-36e5;if((await this.getNotificationHistory()).filter(e=>new Date(e.timestamp).getTime()>t).length>=this.config.rate_limiting.max_notifications_per_hour)return console.warn("レート制限により通知をスキップします"),!1;return!0}catch(t){return console.error("レート制限チェックエラー:",t),!0}}async saveNotificationToHistory(t){try{if("undefined"==typeof localStorage)return;let e=await this.getNotificationHistory();e.unshift(t);let i=e.slice(0,100);localStorage.setItem("notification-history",JSON.stringify(i))}catch(t){console.error("通知履歴保存エラー:",t)}}async sendNotification(t){await this.checkRateLimit()&&(await this.saveNotificationToHistory(t),await this.sendLocalNotification(t),await this.sendEmailNotification(t),await this.sendSlackNotification(t))}constructor(){this.config=null,this.registration=null}}}}]);