"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2056],{55131:function(e,t,r){r.d(t,{default:function(){return y}});var s=r(57437),a=r(2265);class i{categorizeError(e){let t=e.message.toLowerCase();return this._isNetworkError(t)?{category:"network",severity:"medium",message:e.message,userMessage:"ネットワーク接続に問題があります。しばらく待ってから再試行してください。",autoRetry:!0,retryDelay:3e3,fallbackAction:"refresh",timestamp:new Date().toISOString()}:t.includes("api")||t.includes("http")||t.includes("status")?{category:"api",severity:"high",message:e.message,userMessage:"API接続に問題があります。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:t.includes("data")||t.includes("parse")||t.includes("json")?{category:"data",severity:"medium",message:e.message,userMessage:"データの処理中にエラーが発生しました。",autoRetry:!0,retryDelay:1e3,fallbackAction:"clear-cache",timestamp:new Date().toISOString()}:t.includes("validation")||t.includes("invalid")||t.includes("required")?{category:"validation",severity:"low",message:e.message,userMessage:"入力データに問題があります。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}:t.includes("system")||t.includes("internal")?{category:"system",severity:"critical",message:e.message,userMessage:"システムエラーが発生しました。管理者にお問い合わせください。",autoRetry:!1,retryDelay:0,fallbackAction:"redirect",timestamp:new Date().toISOString()}:{category:"unknown",severity:"medium",message:e.message,userMessage:"予期しないエラーが発生しました。",autoRetry:!1,retryDelay:0,fallbackAction:"none",timestamp:new Date().toISOString()}}async handleError(e,t){let r=this.categorizeError(e);this.errorHistory.push(r);let s=t?"".concat(t.operation,"_").concat(t.component,"_").concat(e.message):e.message,a=Date.now(),i=this.lastErrorTime.get(s)||0,o=this.errorCounts.get(s)||0;if(a-i<6e4&&o>=this.maxErrorsPerMinute)return!1;if(this.errorCounts.set(s,o+1),this.lastErrorTime.set(s,a),console.error("エラーハンドラー:",r),this.isRecovering)return console.log("既に復旧処理中です"),!1;this.isRecovering=!0;try{return r.autoRetry&&await this.retryOperation(r),await this.executeFallbackAction(r),this.isRecovering=!1,!0}catch(e){return console.error("復旧処理エラー:",e),this.isRecovering=!1,!1}}async retryOperation(e){e.retryDelay>0&&await new Promise(t=>setTimeout(t,e.retryDelay))}_isNetworkError(e){return["network","fetch","timeout","connection","offline"].some(t=>e.includes(t))}async executeFallbackAction(e){switch(e.fallbackAction){case"refresh":window.location.reload();break;case"clear-cache":localStorage.clear(),sessionStorage.clear();break;case"redirect":window.location.href="/error"}}getErrorHistory(){return[...this.errorHistory]}getErrorStats(){let e={},t={};return this.errorHistory.forEach(r=>{e[r.category]=(e[r.category]||0)+1,t[r.severity]=(t[r.severity]||0)+1}),{total:this.errorHistory.length,byCategory:e,bySeverity:t}}reset(){this.errorHistory=[],this.errorCounts.clear(),this.lastErrorTime.clear(),this.isRecovering=!1}constructor(){this.errorHistory=[],this.isRecovering=!1,this.errorCounts=new Map,this.lastErrorTime=new Map,this.maxErrorsPerMinute=10}}let o=new i;var n=r(82431),c=r(14938),l=r(32489),h=r(76865),u=r(62926),d=r(50091),m=r(98728);class g extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var r,s;console.error("統一エラーバウンダリ:",e,t),o.handleError(e).then(t=>{if(t)this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1});else{let t=o.categorizeError(e);this.setState({errorInfo:t,isRecovering:!1})}}),null===(r=(s=this.props).onError)||void 0===r||r.call(s,e,t)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;let{errorInfo:e,isRecovering:t,retryCount:r}=this.state,a=r<this.maxRetries;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"flex justify-center mb-4",children:this.getErrorIcon()}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,s.jsx)("p",{className:"text-sm mb-4 ".concat(this.getErrorColor()),children:(null==e?void 0:e.userMessage)||"予期しないエラーが発生しました"}),e&&(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:(0,s.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,s.jsxs)("div",{children:["カテゴリ: ",e.category]}),(0,s.jsxs)("div",{children:["重要度: ",e.severity]}),(0,s.jsxs)("div",{children:["時刻: ",new Date(e.timestamp).toLocaleString("ja-JP")]})]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[a&&(0,s.jsxs)("button",{onClick:this.handleRetry,disabled:t,className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(n.Z,{className:"h-4 w-4 ".concat(t?"animate-spin":"")}),(0,s.jsx)("span",{children:t?"復旧中...":"再試行"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{onClick:this.handleGoHome,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"ホーム"})]}),(0,s.jsxs)("button",{onClick:this.handleRefresh,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:[(0,s.jsx)(n.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"再読み込み"})]})]}),(0,s.jsxs)("button",{onClick:this.handleDismiss,className:"w-full flex items-center justify-center space-x-2 px-3 py-2 text-gray-500 hover:text-gray-700",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"エラーを無視"})]})]}),r>0&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["再試行回数: ",r,"/",this.maxRetries]})]})})})}return this.props.children}constructor(e){super(e),this.maxRetries=3,this.handleRetry=async()=>{if(!(this.state.retryCount>=this.maxRetries)){this.setState({isRecovering:!0,retryCount:this.state.retryCount+1});try{if("caches"in window){let e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}try{Object.keys(localStorage).forEach(e=>{(e.startsWith("app_cache:")||e.startsWith("next:"))&&localStorage.removeItem(e)})}catch(e){console.warn("ローカルストレージのクリアに失敗:",e)}this.setState({hasError:!1,error:null,errorInfo:null,isRecovering:!1})}catch(e){console.error("リトライエラー:",e),this.setState({isRecovering:!1})}}},this.handleGoHome=()=>{window.location.href="/"},this.handleRefresh=()=>{window.location.reload()},this.handleDismiss=()=>{this.setState({hasError:!1,error:null,errorInfo:null,retryCount:0})},this.getErrorIcon=()=>{if(!this.state.errorInfo)return(0,s.jsx)(h.Z,{className:"h-8 w-8 text-red-500"});switch(this.state.errorInfo.category){case"network":return(0,s.jsx)(u.Z,{className:"h-8 w-8 text-orange-500"});case"api":return(0,s.jsx)(d.Z,{className:"h-8 w-8 text-blue-500"});case"system":return(0,s.jsx)(m.Z,{className:"h-8 w-8 text-purple-500"});default:return(0,s.jsx)(h.Z,{className:"h-8 w-8 text-red-500"})}},this.getErrorColor=()=>{if(!this.state.errorInfo)return"text-red-600";switch(this.state.errorInfo.severity){case"low":return"text-yellow-600";case"medium":return"text-orange-600";default:return"text-red-600"}},this.state={hasError:!1,error:null,errorInfo:null,isRecovering:!1,retryCount:0}}}var y=g},3959:function(e,t,r){r.d(t,{SettingsProvider:function(){return c},r:function(){return l}});var s=r(85583),a=r(57437),i=r(2265);let o={prediction:{days:30},model:{type:"all",primary_model:"xgboost",compare_models:!0,auto_retrain:!1,retrain_frequency:"weekly"},data:{refresh_interval:"daily",max_data_points:1e3,include_technical_indicators:!0},features:{selected:["sma_5","sma_10","sma_25","sma_50","rsi","macd"]},ui:{theme:"light",refresh_rate:30,show_tooltips:!0}},n=(0,i.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,i.useState)(o),[l,h]=(0,i.useState)(!1),[u,d]=(0,i.useState)(!1),m=async()=>{try{h(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,s._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{h(!1)}},g=async()=>{try{d(!0),localStorage.setItem("jquants-settings",JSON.stringify(r))}catch(e){throw console.error("設定保存エラー:",e),e}finally{d(!1)}};return(0,i.useEffect)(()=>{(async()=>{try{h(!0);let e=localStorage.getItem("jquants-settings");if(e){let t=JSON.parse(e);c(e=>(0,s._)({},e,t))}}catch(e){console.error("設定の読み込みに失敗:",e)}finally{h(!1)}})()},[]),(0,a.jsx)(n.Provider,{value:{settings:r,updateSettings:e=>{c(t=>(0,s._)({},t,e))},loadSettings:m,saveSettings:g,resetSettings:()=>{c(o)},isLoading:l,isSaving:u},children:t})}function l(){let e=(0,i.useContext)(n);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e}}}]);