"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9735,9488],{4076:function(t,e,n){n.d(e,{Q8:function(){return u},Z_:function(){return s},gz:function(){return r},nw:function(){return c},rd:function(){return o}});var a=n(5583);n(2265);class r extends Error{constructor(t,e,n,a){super(t),this.code=e,this.status=n,this.retryHint=a,this.name="AppError"}}async function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t=>{try{if(/^https?:\/\//i.test(t))return t;if(t.startsWith("/"))return"".concat("/jquants-stock-prediction").concat(t);return t}catch(e){return t}},{signal:o,timeout:s=1e4,retries:i=3,retryDelay:c=1e3,method:l,headers:u,json:h,idempotencyKey:d}=e,m=new AbortController,g=setTimeout(()=>m.abort(),s);o&&o.addEventListener("abort",()=>m.abort());let f=null;for(let e=0;e<=i;e++)try{let e={"Cache-Control":"no-cache",Pragma:"no-cache"},o=void 0!==h;o&&(e["Content-Type"]="application/json");let s=l||(o?"POST":"GET"),i=/^(POST|PUT|PATCH|DELETE)$/i.test(s),c=!0===d?function(){try{var t,e;let n=globalThis.crypto&&(null===(t=(e=globalThis.crypto).randomUUID)||void 0===t?void 0:t.call(e))||void 0;if(n)return"idem_".concat(n)}catch(t){}let n=Math.random().toString(36).slice(2);return"idem_".concat(Date.now(),"_").concat(n)}():"string"==typeof d?d:void 0;i&&c&&(e["Idempotency-Key"]=c);let f=await fetch(n(t),{signal:m.signal,cache:"no-cache",method:s,headers:(0,a._)({},e,u||{}),body:o?JSON.stringify(h):void 0});if(clearTimeout(g),!f.ok)try{let t=await f.text(),e=JSON.parse(t);if(e&&"object"==typeof e&&e.error_code&&e.user_message)throw new r(e.user_message,String(e.error_code),f.status,e.retry_hint);throw new r("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}catch(t){if(t instanceof r)throw t;throw new r("HTTP ".concat(f.status,": ").concat(f.statusText),"HTTP_".concat(f.status),f.status)}let p=f.headers.get("content-type");if(!p||!p.includes("application/json"))throw new r("レスポンスがJSON形式ではありません","INVALID_CONTENT_TYPE");return await f.json()}catch(n){if(f=n,n instanceof Error&&"AbortError"===n.name)throw new r("リクエストが中断されました","ABORTED");if(e<i){let a=c*Math.pow(2,e);console.warn("Fetch attempt ".concat(e+1," failed for ").concat(t,":"),n),console.log("Retrying in ".concat(a,"ms...")),await new Promise(t=>setTimeout(t,a))}}if(f instanceof r)throw f;throw new r("すべてのリトライ試行が失敗しました: ".concat((null==f?void 0:f.message)||"Unknown error"),"ALL_RETRIES_FAILED")}async function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},a=[],r=Object.entries(t).map(async t=>{let[n,r]=t;try{let t=await o(r,e);return{key:n,data:t}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return a.push("".concat(n,": ").concat(t)),{key:n,data:null}}});return(await Promise.all(r)).forEach(t=>{let{key:e,data:a}=t;null!==a&&(n[e]=a)}),a.length>0&&console.warn("一部のデータ取得に失敗しました:",a),n}let i="app_cache:";function c(t){try{let e=function(t){try{let e=localStorage.getItem(i+t);if(!e)return null;let n=JSON.parse(e);return"number"==typeof n.t?n.t:null}catch(t){return null}}(t);if(!e)return{exists:!1,timestamp:null,ageMs:null};return{exists:!0,timestamp:e,ageMs:Date.now()-e}}catch(t){return{exists:!1,timestamp:null,ageMs:null}}}function l(t,e){try{let n=localStorage.getItem(i+t);if(!n)return null;let a=JSON.parse(n);if(e&&Date.now()-a.t>e)return null;return a.v}catch(t){return null}}async function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{cacheKey:n,cacheTtlMs:a}=e;if(n){let t=l(n,a);if(t)return console.log("Using cached data for ".concat(n)),{data:t,fromCache:!0}}try{let a=await o(t,e);return n&&(function(t,e){try{let n={v:e,t:Date.now()};localStorage.setItem(i+t,JSON.stringify(n))}catch(t){}}(n,a),console.log("Cached fresh data for ".concat(n))),{data:a,fromCache:!1}}catch(a){if(console.warn("Fetch failed for ".concat(t,", attempting cache fallback:"),a),n){let t=l(n);if(t)return console.log("Using stale cache for ".concat(n," due to fetch failure")),{data:t,fromCache:!0}}let e=function(t){try{if(t.includes("/api/today"))return{date:new Date().toISOString().split("T")[0],summary:"データ取得中...",status:"loading"};if(t.includes("/api/predictions"))return{predictions:[],status:"loading",message:"予測データを取得中..."};if(t.includes("/api/risk"))return{risk_level:"medium",status:"loading",message:"リスク分析中..."};if(t.includes("/api/dashboard"))return{summary:{},status:"loading",message:"ダッシュボードデータを読み込み中..."};return{status:"loading",message:"データを読み込み中...",timestamp:Date.now()}}catch(t){return null}}(t);if(e)return console.log("Using default data for ".concat(t)),{data:e,fromCache:!0};throw a}}},9488:function(t,e,n){n.d(e,{JR:function(){return c},analyzeMultipleStocks:function(){return s},ny:function(){return i}});var a=n(5583);function r(t,e){if(t.length<e)return t[t.length-1]||0;let n=t.slice(-e);return n.reduce((t,e)=>t+e,0)/n.length}async function o(t,e){try{var n,o;if(!t||""===t.trim())return null;let s=new Date("2025-07-10"),i=new Date,c=i>s?s:i,l=c.toISOString().split("T")[0],u=new Date(c.getTime()-5184e6).toISOString().split("T")[0],h=function(t,e,n){let a=[],r=new Date(e),o=new Date(n),s={7203:2500,6758:12e3,9984:6e3,6861:5e4,4063:15e3}[t]||1e3,i={7203:"トヨタ自動車",6758:"ソニーグループ",9984:"ソフトバンクグループ",6861:"キーエンス",4063:"信越化学工業"}[t]||t,c=s;for(let e=new Date(r);e<=o;e.setDate(e.getDate()+1)){if(0===e.getDay()||6===e.getDay())continue;let n=(Math.random()-.5)*.1,r=c*n,o=Math.floor(1e6*Math.random())+1e5,l=(c=Math.max(c+r,.5*s))*o*.1;a.push({symbol:t,name:i,price:c,change:r,changePercent:100*n,volume:o,marketCap:l,lastUpdated:e.toISOString(),close:c,date:e.toISOString().split("T")[0]})}return a}(t,u,l);if(0===h.length)return console.warn("株価データが取得できませんでした: ".concat(t)),null;let d=e||t;if(!d)try{let e=await fetch("/data/listed_index.json");if(e.ok){let n=await e.json(),a=null===(o=n.stocks)||void 0===o?void 0:o.find(e=>e.code===t);d=(null==a?void 0:a.name)||t}else{let e=[{code:"7203",name:"トヨタ自動車"},{code:"6758",name:"ソニーグループ"},{code:"9984",name:"ソフトバンクグループ"},{code:"6861",name:"キーエンス"},{code:"4063",name:"信越化学工業"}].find(e=>e.code===t);d=(null==e?void 0:e.name)||t}}catch(e){console.warn("銘柄名の取得に失敗しました:",e),d=t}let m=function(t){let e=t.map(t=>t.close);return{sma5:r(e,5),sma10:r(e,10),sma25:r(e,25),sma50:r(e,50),rsi:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(t.length<e+1)return 50;let n=[];for(let e=1;e<t.length;e++)n.push(t[e]-t[e-1]);let a=n.slice(-e).filter(t=>t>0),r=n.slice(-e).filter(t=>t<0).map(Math.abs);if(0===r.length)return 100;if(0===a.length)return 0;let o=a.reduce((t,e)=>t+e,0)/e,s=r.reduce((t,e)=>t+e,0)/e;return 0===s?100:100-100/(1+o/s)}(e),macd:function(t){if(t.length<26)return{macd:0,signal:0,histogram:0};let e=(t,e)=>{let n=[t[0]],a=2/(e+1);for(let e=1;e<t.length;e++)n.push(t[e]*a+n[e-1]*(1-a));return n},n=e(t,12),a=e(t,26),r=n[n.length-1]-a[a.length-1],o=[];for(let e=26;e<t.length;e++)o.push(n[e]-a[e]);let s=e(o.slice(-9),9),i=s.length>0?s[s.length-1]:0;return{macd:r,signal:i,histogram:r-i}}(e),bollinger:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(t.length<e){let e=t[t.length-1]||0;return{upper:e,middle:e,lower:e}}let n=t.slice(-e),a=n.reduce((t,e)=>t+e,0)/n.length,r=Math.sqrt(n.reduce((t,e)=>t+Math.pow(e-a,2),0)/n.length);return{upper:a+2*r,middle:a,lower:a-2*r}}(e)}}(h),g=function(t,e){var n,a;let r,o,s,i;let c=[],l=0,u=0,h=0,d=(null===(n=t[t.length-1])||void 0===n?void 0:n.close)||0,m=(null===(a=t[t.length-2])||void 0===a?void 0:a.close)||d;e.sma5>e.sma10&&e.sma10>e.sma25?(l+=2,c.push("短期上昇トレンド（SMA5 > SMA10 > SMA25）")):e.sma5<e.sma10&&e.sma10<e.sma25&&(u+=2,c.push("短期下降トレンド（SMA5 < SMA10 < SMA25）")),d>e.sma50?(l+=1,c.push("長期上昇トレンド（価格 > SMA50）")):(u+=1,c.push("長期下降トレンド（価格 < SMA50）")),e.rsi<30?(l+=2,c.push("RSI過売り状態（".concat(e.rsi.toFixed(1),"）"))):e.rsi>70?(u+=2,c.push("RSI過買い状態（".concat(e.rsi.toFixed(1),"）")),h+=1):e.rsi>=40&&e.rsi<=60&&c.push("RSI中立圏（".concat(e.rsi.toFixed(1),"）")),e.macd.macd>e.macd.signal&&e.macd.histogram>0?(l+=1,c.push("MACD買いシグナル")):e.macd.macd<e.macd.signal&&e.macd.histogram<0&&(u+=1,c.push("MACD売りシグナル")),d<e.bollinger.lower?(l+=1,c.push("ボリンジャーバンド下限接触（反発期待）")):d>e.bollinger.upper&&(u+=1,c.push("ボリンジャーバンド上限接触（過熱警戒）"),h+=1),Math.abs((d-m)/m)>.05&&(h+=1,c.push("高ボラティリティ（急激な価格変動）"));let g=l-u;return g>=3?(r="STRONG_BUY",o=Math.min(.9,.6+(g-3)*.1)):g>=1?(r="BUY",o=.6+(g-1)*.1):g<=-3?(r="STRONG_SELL",o=Math.min(.9,.6+.1*Math.abs(g+3))):g<=-1?(r="SELL",o=.6+.1*Math.abs(g+1)):(r="HOLD",o=.5),o=Math.max(.3,o-.1*h),s=h>=2?"HIGH":h>=1?"MEDIUM":"LOW","STRONG_BUY"===r||"BUY"===r?i=e.sma5>e.sma50?1.05*d:e.sma25:("STRONG_SELL"===r||"SELL"===r)&&(i=.95*d),{recommendation:r,confidence:o,reasons:c,riskLevel:s,targetPrice:i}}(h,m),f=h[h.length-1].close,p=(null===(n=h[h.length-2])||void 0===n?void 0:n.close)||f,S=f-p;return(0,a._)({symbol:t,name:d,currentPrice:f,priceChange:S,priceChangePercent:S/p*100,indicators:m},g)}catch(e){return console.error("株価分析エラー (".concat(t,"):"),e),null}}async function s(t){let e=[],n=[{code:"7203",name:"トヨタ自動車",sector:"自動車"},{code:"6758",name:"ソニーグループ",sector:"エンターテインメント"},{code:"9984",name:"ソフトバンクグループ",sector:"通信"},{code:"6861",name:"キーエンス",sector:"電子部品"},{code:"4063",name:"信越化学工業",sector:"化学"}],a=[];for(let e=0;e<t.length;e+=5)a.push(t.slice(e,e+5));for(let t of a){let a=t.map(async t=>{let e=n.find(e=>e.code===t);return o(t,null==e?void 0:e.name)}),r=await Promise.all(a);e.push(...r.filter(t=>null!==t))}return e}function i(){return["7203","6758","9984","6861","8035","4063","6981","7974","4519","8031","9432","2914","4568","6954","6367"]}async function c(t){try{let e=t||i();console.log("市場サマリー生成開始: ".concat(e.length,"銘柄を分析"));let n=await s(e);if(0===n.length)return console.warn("分析結果が0件です。サンプルデータを使用します。"),l();let a={STRONG_BUY:0,BUY:0,HOLD:0,SELL:0,STRONG_SELL:0};n.forEach(t=>{a[t.recommendation]++});let r=n.filter(t=>t.priceChangePercent>0).sort((t,e)=>e.priceChangePercent-t.priceChangePercent).slice(0,5),o=n.filter(t=>t.priceChangePercent<0).sort((t,e)=>t.priceChangePercent-e.priceChangePercent).slice(0,5);return console.log("市場サマリー生成完了: ".concat(n.length,"銘柄分析済み")),{totalSymbols:e.length,analyzedSymbols:n.length,recommendations:a,topGainers:r,topLosers:o,lastUpdated:new Date().toISOString()}}catch(t){return console.error("市場サマリー生成エラー:",t),console.log("サンプルデータにフォールバックします"),l()}}function l(){return{totalSymbols:5,analyzedSymbols:5,recommendations:{STRONG_BUY:1,BUY:2,HOLD:1,SELL:1,STRONG_SELL:0},topGainers:[{symbol:"7203",name:"トヨタ自動車",currentPrice:2500,priceChange:50,priceChangePercent:2.04,indicators:{sma5:2480,sma10:2460,sma25:2400,sma50:2350,rsi:65,macd:{macd:2.5,signal:1.8,histogram:.7},bollinger:{upper:2600,middle:2450,lower:2300}},recommendation:"BUY",confidence:.75,reasons:["短期上昇トレンド","RSI中立圏"],riskLevel:"LOW",targetPrice:2600}],topLosers:[{symbol:"6758",name:"ソニーグループ",currentPrice:12e3,priceChange:-100,priceChangePercent:-.83,indicators:{sma5:12100,sma10:12200,sma25:12300,sma50:12500,rsi:45,macd:{macd:-1.2,signal:-.8,histogram:-.4},bollinger:{upper:13e3,middle:12200,lower:11400}},recommendation:"HOLD",confidence:.6,reasons:["短期調整局面","RSI中立圏"],riskLevel:"MEDIUM"}],lastUpdated:new Date().toISOString()}}},1959:function(t,e,n){n.d(e,{M7:function(){return s},_d:function(){return r}});var a=n(5583);class r{async get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",t,void 0,e)}async post(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",t,e,n)}async put(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",t,e,n)}async delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",t,void 0,e)}async request(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=(0,a._)({},this.defaultConfig,r),s=this.buildUrl(e),i=null;for(let e=0;e<=o.retries;e++)try{return await this.executeRequest(t,s,n,o)}catch(t){if(i=t,e<o.retries){await this.delay(o.retryDelay*Math.pow(2,e));continue}}throw i||Error("Request failed")}async executeRequest(t,e,n,r){let o=new AbortController,s=setTimeout(()=>o.abort(),r.timeout);try{let i=await fetch(e,{method:t,headers:(0,a._)({"Content-Type":"application/json"},r.headers),body:n?JSON.stringify(n):void 0,signal:o.signal});if(clearTimeout(s),!i.ok)throw Error("HTTP ".concat(i.status,": ").concat(i.statusText));return{data:await i.json(),status:i.status,statusText:i.statusText,headers:this.extractHeaders(i)}}catch(t){throw clearTimeout(s),t}}buildUrl(t){return t.startsWith("http")?t:"".concat(this.baseURL).concat(t.startsWith("/")?t:"/".concat(t))}extractHeaders(t){let e={};return t.headers&&"function"==typeof t.headers.forEach&&t.headers.forEach((t,n)=>{e[n]=t}),e}delay(t){return new Promise(e=>setTimeout(e,t))}async testConnection(){if(this.isStaticSite())return{success:!0,message:"静的サイトモード: モックデータを使用中"};try{let t=await fetch("/api/health",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));let e=await t.json();return{success:!0,message:"API接続成功: ".concat(e.status)}}catch(t){return console.error("API接続テストエラー:",t),{success:!1,message:"API接続失敗: ".concat(t instanceof Error?t.message:"Unknown error")}}}isStaticSite(){let t=window.location.hostname;return t.includes("github.io")||t.includes("netlify.app")||t.includes("vercel.app")||t.includes("appadaycreator.github.io")}async getStockData(t){return this.isStaticSite()?{symbol:t,price:2500,change:2.5,volume:1e6,lastUpdated:new Date().toISOString()}:(await this.get("/stocks/".concat(t))).data}async getMarketData(){return this.isStaticSite()?{marketStatus:"open",topGainers:[],topLosers:[],lastUpdated:new Date().toISOString()}:(await this.get("/market")).data}async getPredictions(){return this.isStaticSite()?{predictions:[],lastUpdated:new Date().toISOString()}:(await this.get("/predictions")).data}async getPersonalInvestmentData(){return this.isStaticSite()?{portfolio:{totalValue:1e6,totalReturn:5.2},positions:[],lastUpdated:new Date().toISOString()}:(await this.get("/personal-investment")).data}constructor(t="/api"){this.baseURL=t,this.defaultConfig={timeout:1e4,retries:3,retryDelay:1e3,cache:!0,cacheTTL:3e5}}}let o=new r,s=()=>o.testConnection()}}]);