(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7659],{9041:function(e,s,t){Promise.resolve().then(t.bind(t,6440))},6440:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var l=t(7437),a=t(2265),i=t(5583),r=t(1780),c=t(5465);function n(e){var s,t,n,d,o,m,h,x,u,j,g,p,v;let{symbol:b,autoRefresh:N=!1,showCacheStats:y=!1}=e,{data:f,loading:w,error:k,lastUpdated:_,source:C,refresh:S,clearCache:z,startAutoRefresh:I,stopAutoRefresh:D,isRetrying:E,canRetry:A}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{symbol:s,autoRefresh:t=!1,refreshInterval:l=3e4,enableFallback:n=!0,onError:d,onDataUpdate:o}=e,[m,h]=(0,a.useState)({data:null,loading:!1,error:null,lastUpdated:null,source:null,retryCount:0}),x=(0,a.useRef)(null),u=(0,a.useRef)(null),j=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h(e=>(0,r._)((0,i._)({},e),{loading:!0,error:null}));try{let t=await c.X.get("stock_".concat(s));if(t){let s=e?"api":"cache";h(e=>{var l,a;return(0,r._)((0,i._)({},e),{data:t,loading:!1,error:null,lastUpdated:null!==(a=null===(l=t.metadata)||void 0===l?void 0:l.last_updated)&&void 0!==a?a:null,source:s,retryCount:0})}),null==o||o(t)}else throw Error("データを取得できませんでした")}catch(s){let e=s instanceof Error?s.message:"不明なエラー";h(s=>(0,r._)((0,i._)({},s),{loading:!1,error:e,retryCount:s.retryCount+1})),null==d||d(e),n&&m.retryCount<3&&setTimeout(()=>{j(!1)},5e3*(m.retryCount+1))}},[s,n,d,o,m.retryCount]),g=(0,a.useCallback)(()=>{j(!0)},[j]),p=(0,a.useCallback)(async()=>{await c.X.delete("stock_".concat(s)),h(e=>(0,r._)((0,i._)({},e),{data:null,source:null}))},[s]),v=(0,a.useCallback)(()=>{x.current&&clearInterval(x.current),x.current=setInterval(()=>{j(!1)},l)},[j,l]),b=(0,a.useCallback)(()=>{x.current&&(clearInterval(x.current),x.current=null)},[]);return(0,a.useEffect)(()=>(j(!1),t&&v(),()=>{b(),u.current&&clearTimeout(u.current)}),[s,t,j,v,b]),(0,a.useEffect)(()=>(t?v():b(),()=>b()),[t,v,b]),(0,a.useEffect)(()=>{let e=()=>{};e();let s=setInterval(e,3e5);return()=>clearInterval(s)},[]),(0,r._)((0,i._)({},m),{refresh:g,clearCache:p,startAutoRefresh:v,stopAutoRefresh:b,isRetrying:m.retryCount>0,canRetry:m.retryCount<3})}({symbol:b,autoRefresh:N,refreshInterval:3e4,enableFallback:!0,onError:e=>console.error("データ取得エラー:",e),onDataUpdate:e=>console.log("データ更新:",e)}),[L,R]=(0,a.useState)(null);return((0,a.useEffect)(()=>{y&&R({totalItems:5,validItems:4,expiredItems:1,totalSize:1048576})},[y]),w)?(0,l.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,l.jsx)("span",{className:"ml-2",children:"データ読み込み中..."})]}):k?(0,l.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"text-red-600",children:"⚠️"}),(0,l.jsxs)("div",{className:"ml-2",children:[(0,l.jsx)("h3",{className:"text-red-800 font-medium",children:"データ取得エラー"}),(0,l.jsx)("p",{className:"text-red-600 text-sm",children:k}),A&&(0,l.jsx)("button",{onClick:S,className:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"再試行"})]})]})}):f?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:b?"銘柄 ".concat(b):"全銘柄データ"}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["最終更新: ",_?new Date(_).toLocaleString():"不明"]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["データソース: ","cache"===C?"キャッシュ":"api"===C?"API":"フォールバック"]})]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:S,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"更新"}),(0,l.jsx)("button",{onClick:z,className:"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"キャッシュクリア"}),N?(0,l.jsx)("button",{onClick:D,className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"自動更新停止"}):(0,l.jsx)("button",{onClick:I,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"自動更新開始"})]})]})}),y&&L&&(0,l.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-blue-800 font-medium mb-2",children:"キャッシュ統計"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-blue-600",children:"総アイテム数:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:L.totalItems})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-blue-600",children:"有効アイテム:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:L.validItems})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-blue-600",children:"期限切れ:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:L.expiredItems})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-blue-600",children:"総サイズ:"}),(0,l.jsxs)("span",{className:"ml-2 font-medium",children:[(L.totalSize/1024).toFixed(1)," KB"]})]})]})]}),(0,l.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"株価データ"}),b?(0,l.jsx)("div",{className:"space-y-2",children:f.stocks&&f.stocks[b]?(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"銘柄名:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:f.stocks[b].name})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"現在価格:"}),(0,l.jsxs)("span",{className:"ml-2 font-medium",children:["\xa5",(null===(n=f.stocks[b])||void 0===n?void 0:null===(t=n.current_price)||void 0===t?void 0:null===(s=t.last_price)||void 0===s?void 0:s.toLocaleString())||"N/A"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"変動:"}),(0,l.jsxs)("span",{className:"ml-2 font-medium ".concat(((null===(o=f.stocks[b])||void 0===o?void 0:null===(d=o.current_price)||void 0===d?void 0:d.change_percent)||0)>=0?"text-red-600":"text-blue-600"),children:[((null===(h=f.stocks[b])||void 0===h?void 0:null===(m=h.current_price)||void 0===m?void 0:m.change_percent)||0).toFixed(2),"%"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"出来高:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:((null===(u=f.stocks[b])||void 0===u?void 0:null===(x=u.volume)||void 0===x?void 0:x.current_volume)||0).toLocaleString()})]})]}):(0,l.jsx)("p",{className:"text-gray-600",children:"銘柄データが見つかりません"})}):(0,l.jsx)("div",{className:"space-y-2",children:f.stocks&&Object.keys(f.stocks).length>0?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(f.stocks).map(e=>{var s,t,a,i,r;let[c,n]=e;return(0,l.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium",children:n.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:c})]}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:n.sector||"N/A"})]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"価格:"}),(0,l.jsxs)("span",{className:"font-medium",children:["\xa5",(null===(t=n.current_price)||void 0===t?void 0:null===(s=t.last_price)||void 0===s?void 0:s.toLocaleString())||"N/A"]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"変動:"}),(0,l.jsxs)("span",{className:"font-medium ".concat(((null===(a=n.current_price)||void 0===a?void 0:a.change_percent)||0)>=0?"text-red-600":"text-blue-600"),children:[((null===(i=n.current_price)||void 0===i?void 0:i.change_percent)||0).toFixed(2),"%"]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"出来高:"}),(0,l.jsx)("span",{className:"font-medium",children:((null===(r=n.volume)||void 0===r?void 0:r.current_volume)||0).toLocaleString()})]})]})]},c)})}):(0,l.jsx)("p",{className:"text-gray-600",children:"株価データがありません"})})]}),(0,l.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"メタデータ"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"総銘柄数:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:(null===(j=f.metadata)||void 0===j?void 0:j.total_stocks)||0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"データソース:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:(null===(g=f.metadata)||void 0===g?void 0:g.data_source)||"N/A"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"バージョン:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:(null===(p=f.metadata)||void 0===p?void 0:p.version)||"N/A"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"更新タイプ:"}),(0,l.jsx)("span",{className:"ml-2 font-medium",children:(null===(v=f.metadata)||void 0===v?void 0:v.update_type)||"N/A"})]})]})]})]}):(0,l.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,l.jsx)("p",{className:"text-gray-600",children:"データがありません"}),(0,l.jsx)("button",{onClick:S,className:"mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"データを取得"})]})}function d(){let[e,s]=(0,a.useState)(""),[t,i]=(0,a.useState)(!1),[r,c]=(0,a.useState)(!0);return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"データ取得・キャッシュ機能テスト"}),(0,l.jsx)("p",{className:"text-gray-600",children:"jQuantsデータのJSON形式保持と差分更新機能のテストページです。"})]}),(0,l.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-8",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"テスト設定"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"表示銘柄"}),(0,l.jsx)("select",{value:e,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{code:"",name:"全銘柄"},{code:"7203",name:"トヨタ自動車"},{code:"6758",name:"ソニーグループ"},{code:"9984",name:"ソフトバンクグループ"}].map(e=>(0,l.jsx)("option",{value:e.code,children:e.name},e.code))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"自動更新"}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"autoRefresh",checked:t,onChange:e=>i(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"autoRefresh",className:"ml-2 text-sm text-gray-700",children:"30秒間隔で自動更新"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"キャッシュ統計"}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"showCacheStats",checked:r,onChange:e=>c(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{htmlFor:"showCacheStats",className:"ml-2 text-sm text-gray-700",children:"キャッシュ統計を表示"})]})]})]})]}),(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(n,{symbol:e||void 0,autoRefresh:t,showCacheStats:r})}),(0,l.jsxs)("div",{className:"mt-12 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-blue-900 mb-4",children:"実装された機能"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"\uD83D\uDCCA データ取得機能"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,l.jsx)("li",{children:"• キャッシュ優先のデータ取得"}),(0,l.jsx)("li",{children:"• サーバーからの最新データ取得"}),(0,l.jsx)("li",{children:"• フォールバック機能"}),(0,l.jsx)("li",{children:"• エラーハンドリング"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"\uD83D\uDCBE キャッシュ機能"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,l.jsx)("li",{children:"• TTL設定（30分）"}),(0,l.jsx)("li",{children:"• 自動クリーンアップ"}),(0,l.jsx)("li",{children:"• キャッシュ統計表示"}),(0,l.jsx)("li",{children:"• 手動キャッシュクリア"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"\uD83D\uDD04 差分更新機能"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,l.jsx)("li",{children:"• 既存データとの比較"}),(0,l.jsx)("li",{children:"• 変更検出とログ記録"}),(0,l.jsx)("li",{children:"• 効率的な更新処理"}),(0,l.jsx)("li",{children:"• メタデータ管理"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"\uD83D\uDE80 GitHub Actions"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,l.jsx)("li",{children:"• 定期実行（平日9時・15時）"}),(0,l.jsx)("li",{children:"• 自動データ更新"}),(0,l.jsx)("li",{children:"• 変更検出とコミット"}),(0,l.jsx)("li",{children:"• エラーハンドリング"})]})]})]})]}),(0,l.jsxs)("div",{className:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"技術仕様"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium text-gray-800 mb-2",children:"データ構造"}),(0,l.jsxs)("ul",{className:"text-gray-600 space-y-1",children:[(0,l.jsx)("li",{children:"• メタデータ: 更新時刻、バージョン、総銘柄数"}),(0,l.jsx)("li",{children:"• 株価データ: 価格、変動、出来高、技術指標"}),(0,l.jsx)("li",{children:"• 予測データ: 予測価格、信頼度、モデル情報"}),(0,l.jsx)("li",{children:"• リスク指標: ボラティリティ、ベータ、シャープレシオ"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium text-gray-800 mb-2",children:"ファイル構成"}),(0,l.jsxs)("ul",{className:"text-gray-600 space-y-1",children:[(0,l.jsx)("li",{children:"• /docs/data/stock_data.json (メインデータ)"}),(0,l.jsx)("li",{children:"• /docs/data/stocks/銘柄コード.json (個別銘柄)"}),(0,l.jsx)("li",{children:"• /docs/data/index.json (インデックス)"}),(0,l.jsx)("li",{children:"• /docs/data/metadata/ (メタデータ)"})]})]})]})]})]})})}},5465:function(e,s,t){"use strict";t.d(s,{X:function(){return r}});var l=t(5583),a=t(1780);class i{async get(e){let s=this.cache.get(e);return s?this.isExpired(s)?(this.delete(e),this.stats.misses++,null):(s.timestamp=Date.now(),this.stats.hits++,s.data):(this.stats.misses++,null)}async set(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttl:l=3e5,tags:a=[],priority:i=.5,maxSize:r=1048576,compression:c=!1}=t,n=s,d=JSON.stringify(s),o=new Blob([d]).size;if(c&&o>1024&&(o=new Blob([d=JSON.stringify(n=await this.compress(s))]).size,this.stats.compressions++),o>r){console.warn("Cache entry ".concat(e," exceeds maximum size limit"));return}this.currentSize+o>this.maxSize&&await this.evictLeastPriority();let m={data:n,timestamp:Date.now(),ttl:l,tags:a,priority:i,size:o};this.cache.set(e,m),this.currentSize+=o,this.stats.sets++}async delete(e){let s=this.cache.get(e);return!!s&&(this.currentSize-=s.size,this.stats.deletes++,this.cache.delete(e))}async clearByTags(e){let s=0;for(let[t,l]of this.cache.entries())e.some(e=>l.tags.includes(e))&&(this.currentSize-=l.size,this.cache.delete(t),s++);return s}async clear(){this.cache.clear(),this.currentSize=0}getStats(){let e=this.stats.hits+this.stats.misses,s=e>0?this.stats.hits/e:0;return{size:this.currentSize,count:this.cache.size,maxSize:this.maxSize,hitRate:Math.round(100*s)/100,hits:this.stats.hits,misses:this.stats.misses,sets:this.stats.sets,deletes:this.stats.deletes,compressions:this.stats.compressions}}isExpired(e){return Date.now()-e.timestamp>e.ttl}async evictLeastPriority(){let e=Array.from(this.cache.entries());e.sort((e,s)=>e[1].priority-s[1].priority);let[s,t]=e[0];this.currentSize-=t.size,this.cache.delete(s)}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4)}cleanup(){let e=Date.now();for(let[s,t]of this.cache.entries())e-t.timestamp>t.ttl&&(this.currentSize-=t.size,this.cache.delete(s))}async cachePrediction(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.set(e,s,(0,a._)((0,l._)({},t),{tags:[...t.tags||[],"prediction"],ttl:t.ttl||864e5}))}async getCachedPrediction(e){return await this.get(e)}async cacheModelComparison(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.set(e,s,(0,a._)((0,l._)({},t),{tags:[...t.tags||[],"modelComparison"],ttl:t.ttl||864e5}))}async getCachedModelComparison(e){return await this.get(e)}async compress(e){return e}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.cache.clear(),this.currentSize=0}constructor(){this.cache=new Map,this.maxSize=52428800,this.currentSize=0,this.cleanupInterval=null,this.stats={hits:0,misses:0,sets:0,deletes:0,compressions:0},this.startCleanup()}}let r=new i}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=9041)}),_N_E=e.O()}]);