(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[455],{48513:function(e,t,i){Promise.resolve().then(i.bind(i,42576))},42576:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return x}});var a=i(85583),s=i(1780),n=i(57437),o=i(2265),r=i(99376),c=i(33276),l=i(89227),d=i(98728),m=i(33388),u=i(62926),h=i(85673),g=i(41671),p=i(91723);function y(e){var t;let{onRoutineStart:i,onRoutineComplete:r,onRoutineError:y,className:f=""}=e,[x,b]=(0,o.useState)(!1),[_,w]=(0,o.useState)(!1),[N,v]=(0,o.useState)(0),[j,S]=(0,o.useState)(0),[k,O]=(0,o.useState)({touchOptimized:!0,gestureEnabled:!0,hapticFeedback:!0,voiceGuidance:!1,autoScroll:!0,quickActions:!0}),[C,I]=(0,o.useState)([{id:"symbol_selection",title:"銘柄選択",description:"分析したい銘柄を選択します",estimatedTime:30,completed:!1,required:!0,category:"setup"},{id:"data_validation",title:"データ確認",description:"選択した銘柄のデータが最新か確認します",estimatedTime:15,completed:!1,required:!0,category:"setup"},{id:"analysis_execution",title:"分析実行",description:"AI予測分析を実行します",estimatedTime:120,completed:!1,required:!0,category:"analysis"},{id:"prediction_review",title:"予測結果確認",description:"分析結果と予測値を確認します",estimatedTime:30,completed:!1,required:!0,category:"review"},{id:"risk_assessment",title:"リスク評価",description:"投資リスクと推奨アクションを確認します",estimatedTime:15,completed:!1,required:!0,category:"review"},{id:"investment_decision",title:"投資判断",description:"個人投資ダッシュボードで最終判断を行います",estimatedTime:30,completed:!1,required:!1,category:"action"}]);(0,o.useEffect)(()=>{let e=()=>{let e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),i=window.innerWidth<=768;b(t||i)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let D=(0,o.useCallback)(()=>{k.hapticFeedback&&"vibrate"in navigator&&navigator.vibrate(50)},[k.hapticFeedback]),E=(0,o.useCallback)(e=>{if(k.voiceGuidance&&"speechSynthesis"in window){let t=new SpeechSynthesisUtterance(e);t.lang="ja-JP",t.rate=.9,speechSynthesis.speak(t)}},[k.voiceGuidance]),T=(0,o.useCallback)(async()=>{if(!_){w(!0),v(0),S(0),D(),E("5分ルーティンを開始します"),null==i||i();try{for(let e=0;e<C.length;e++){v(e);let t=C[e];E("".concat(t.title,"を開始します")),await P(t),I(t=>t.map((t,i)=>i===e?(0,s._)((0,a._)({},t),{completed:!0}):t));let i=Math.round((e+1)/C.length*100);S(i),D(),E("".concat(t.title,"が完了しました")),k.autoScroll&&setTimeout(()=>{let t=document.getElementById("step-".concat(e));null==t||t.scrollIntoView({behavior:"smooth",block:"center"})},100)}w(!1),S(100),D(),E("5分ルーティンが完了しました");let e={completed_at:new Date().toISOString(),total_steps:C.length,completed_steps:C.length,execution_time:"約5分"};null==r||r(e)}catch(t){w(!1);let e=t instanceof Error?t.message:"不明なエラーが発生しました";D(),E("エラーが発生しました: ".concat(e)),null==y||y(e)}}},[_,C,k,i,r,y,D,E]),P=async e=>{await new Promise(t=>setTimeout(t,10*e.estimatedTime))},A=[{id:"start_routine",title:"ルーティン開始",icon:(0,n.jsx)(c.Z,{className:"h-5 w-5"}),action:T,color:"bg-green-600 hover:bg-green-700"},{id:"pause_routine",title:"一時停止",icon:(0,n.jsx)(l.Z,{className:"h-5 w-5"}),action:()=>w(!1),color:"bg-yellow-600 hover:bg-yellow-700"},{id:"settings",title:"設定",icon:(0,n.jsx)(d.Z,{className:"h-5 w-5"}),action:()=>console.log("設定を開く"),color:"bg-gray-600 hover:bg-gray-700"}];return x?(0,n.jsxs)("div",{className:"mobile-routine-optimizer ".concat(f),children:[(0,n.jsx)("div",{className:"mobile-header sticky top-0 z-40 bg-white border-b border-gray-200 px-4 py-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(m.Z,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"5分ルーティン"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 text-green-500"}),(0,n.jsx)(h.Z,{className:"h-4 w-4 text-green-500"})]})]})}),(0,n.jsxs)("div",{className:"px-4 py-4 bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"進捗"}),(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:[j,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(j,"%")}})}),_&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["実行中... ",null===(t=C[N])||void 0===t?void 0:t.title]})]}),k.quickActions&&(0,n.jsx)("div",{className:"px-4 py-3 bg-white border-b border-gray-200",children:(0,n.jsx)("div",{className:"flex gap-2",children:A.map(e=>(0,n.jsxs)("button",{onClick:e.action,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-white text-sm font-medium transition-colors ".concat(e.color),children:[e.icon,(0,n.jsx)("span",{className:"hidden sm:inline",children:e.title})]},e.id))})}),(0,n.jsx)("div",{className:"px-4 py-4 space-y-3",children:C.map((e,t)=>(0,n.jsx)("div",{id:"step-".concat(t),className:"p-4 rounded-lg border-2 transition-all duration-200 ".concat(e.completed?"border-green-200 bg-green-50":t===N&&_?"border-blue-200 bg-blue-50":"border-gray-200 bg-white"),children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(e.completed?"bg-green-100 text-green-600":t===N&&_?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:e.completed?(0,n.jsx)(g.Z,{className:"h-4 w-4"}):(0,n.jsx)("span",{children:t+1})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:e.title}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,n.jsx)(p.Z,{className:"h-3 w-3"}),(0,n.jsxs)("span",{children:["約",e.estimatedTime,"秒"]}),e.required&&(0,n.jsx)("span",{className:"px-2 py-0.5 bg-red-100 text-red-600 rounded",children:"必須"})]})]})]})},e.id))}),(0,n.jsxs)("div",{className:"px-4 py-4 bg-gray-50 border-t border-gray-200",children:[(0,n.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"モバイル最適化設定"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("label",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:k.touchOptimized,onChange:e=>O(t=>(0,s._)((0,a._)({},t),{touchOptimized:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"タッチ操作最適化"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:k.gestureEnabled,onChange:e=>O(t=>(0,s._)((0,a._)({},t),{gestureEnabled:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"ジェスチャー操作"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:k.hapticFeedback,onChange:e=>O(t=>(0,s._)((0,a._)({},t),{hapticFeedback:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"振動フィードバック"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:k.voiceGuidance,onChange:e=>O(t=>(0,s._)((0,a._)({},t),{voiceGuidance:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"音声ガイダンス"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:k.autoScroll,onChange:e=>O(t=>(0,s._)((0,a._)({},t),{autoScroll:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:"自動スクロール"})]})]})]})]}):(0,n.jsx)("div",{className:"desktop-layout ".concat(f),children:(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(m.Z,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"モバイル最適化表示"}),(0,n.jsx)("p",{className:"text-gray-500",children:"このコンポーネントはモバイルデバイスで最適化されています"})]})})}var f=i(28071);function x(){(0,r.useRouter)();let[e,t]=(0,o.useState)(null),[i,c]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{let e=f.g.getInstance();await e.initialize(),t(e),c(!0)}catch(e){console.error("通知サービス初期化エラー:",e),c(!0)}})()},[]);let l=async()=>{if(console.log("5分ルーティンを開始します"),e)try{await e.sendNotification({type:"routine_complete",title:"\uD83D\uDE80 5分ルーティン開始",message:"5分ルーティンが開始されました。完了までお待ちください。",timestamp:new Date().toISOString(),priority:"medium",source:"manual"})}catch(e){console.error("開始通知送信エラー:",e)}},d=async t=>{if(console.log("5分ルーティンが完了しました:",t),e)try{await e.notifyRoutineComplete(t)}catch(e){console.error("完了通知送信エラー:",e)}try{let e=JSON.parse(localStorage.getItem("routine-history")||"[]");e.unshift((0,s._)((0,a._)({},t),{id:"routine_".concat(Date.now()),created_at:new Date().toISOString()}));let i=e.slice(0,50);localStorage.setItem("routine-history",JSON.stringify(i))}catch(e){console.error("ルーティン履歴保存エラー:",e)}},m=async t=>{if(console.error("5分ルーティンでエラーが発生しました:",t),e)try{await e.notifyRoutineFailed(t)}catch(e){console.error("エラー通知送信エラー:",e)}};return i?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsx)(y,{onRoutineStart:l,onRoutineComplete:d,onRoutineError:m,className:"min-h-screen"})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"初期化中..."})]})})}},28071:function(e,t,i){"use strict";i.d(t,{g:function(){return s}});var a=i(40257);class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}async initialize(){try{await this.loadConfig(),console.log("✅ 通知サービス初期化完了")}catch(e){throw console.error("通知サービス初期化エラー:",e),e}}async loadConfig(){try{if("undefined"==typeof localStorage)throw Error("localStorage is not available");let e=localStorage.getItem("notification-config");if(e)try{return this.config=JSON.parse(e),this.config}catch(e){console.warn("通知設定のJSON解析に失敗しました。デフォルトにフォールバックします。")}let t=void 0!==a&&a.env&&!1,i={email:{enabled:!1,smtp_server:"smtp.gmail.com",smtp_port:587,email_user:"",email_password:"",email_to:""},slack:{enabled:!1,webhook_url:"",channel:"#stock-analysis",username:"株価分析Bot",icon_emoji:":chart_with_upwards_trend:"},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:"mailto:example@example.com"},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0},rate_limiting:{max_notifications_per_hour:5,cooldown_minutes:30}};if(t){try{"undefined"!=typeof localStorage&&localStorage.setItem("notification-config",JSON.stringify(i))}catch(e){}return this.config=i,i}let s={email:{enabled:!1,smtp_server:"",smtp_port:587,email_user:"",email_password:"",email_to:""},slack:{enabled:!1,webhook_url:"",channel:"",username:"",icon_emoji:":bell:"},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:""},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0},rate_limiting:{max_notifications_per_hour:5,cooldown_minutes:30}};return console.warn("通知設定が未設定のため、安全なデフォルト（全チャンネル無効）で継続します。"),this.config=s,s}catch(e){throw console.error("設定読み込みエラー:",e),e}}async saveConfig(e){try{if("undefined"==typeof localStorage)throw Error("localStorage is not available");localStorage.setItem("notification-config",JSON.stringify(e)),this.config=e}catch(e){throw console.error("設定保存エラー:",e),e}}async initializePushNotifications(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("プッシュ通知がサポートされていません"),!1;try{this.registration=await navigator.serviceWorker.register("/sw.js");let e=await Notification.requestPermission();if("granted"!==e)return console.warn("通知の許可が得られませんでした"),!1;return await this.subscribeToPushNotifications(),!0}catch(e){return console.error("プッシュ通知の初期化エラー:",e),!1}}async subscribeToPushNotifications(){var e;if(this.registration&&(null===(e=this.config)||void 0===e?void 0:e.push.enabled))try{let e=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.push.vapid_public_key});localStorage.setItem("push-subscription",JSON.stringify(e))}catch(e){console.error("プッシュ通知の購読エラー:",e)}}async sendLocalNotification(e){if(!this.registration||"granted"!==Notification.permission)return;let t={body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:e.type,data:e.data,requireInteraction:"high"===e.priority};await this.registration.showNotification(e.title,t)}async notifyAnalysisComplete(e){let t={type:"analysis_complete",title:"\uD83D\uDCCA 株価分析完了",message:"分析が完了しました。".concat(e.buy_candidates||0,"件の買い候補、").concat(e.sell_candidates||0,"件の売り候補が見つかりました。"),data:e,timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyError(e){let t={type:"error",title:"❌ 分析エラー",message:"分析中にエラーが発生しました: ".concat(e),timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyRecommendation(e,t,i){let a={type:"recommendation",title:"\uD83D\uDCA1 ".concat(e," ").concat(t,"推奨"),message:i,data:{symbol:e,action:t,reason:i},timestamp:new Date().toISOString(),priority:"medium"};await this.sendLocalNotification(a)}async notifyRiskAlert(e,t){let i={type:"risk_alert",title:"⚠️ ".concat(e," リスク警告"),message:t,data:{symbol:e,message:t},timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(i)}async startAutoUpdate(){try{if(!(await fetch("/api/start-auto-update",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("自動更新の開始に失敗しました");console.log("自動更新を開始しました")}catch(e){throw console.error("自動更新開始エラー:",e),e}}async stopAutoUpdate(){try{localStorage.removeItem("auto-update-enabled"),console.log("自動更新設定を削除しました（静的サイトでは実際の自動更新は実行されません）")}catch(e){throw console.error("自動更新停止エラー:",e),e}}async getNotificationHistory(){try{if("undefined"==typeof localStorage)return[];let e=localStorage.getItem("notification-history");if(e)return JSON.parse(e);return[]}catch(e){return console.error("通知履歴取得エラー:",e),[]}}async notifyRoutineComplete(e){let t={type:"routine_complete",title:"✅ 5分ルーティン完了",message:"5分ルーティンが正常に完了しました。実行時間: ".concat(e.execution_time||"不明"),data:e,timestamp:new Date().toISOString(),priority:"high",source:"automated"};await this.sendLocalNotification(t),await this.sendEmailNotification(t),await this.sendSlackNotification(t)}async notifyRoutineFailed(e){let t={type:"routine_failed",title:"❌ 5分ルーティン失敗",message:"5分ルーティンでエラーが発生しました: ".concat(e),timestamp:new Date().toISOString(),priority:"critical",source:"automated"};await this.sendLocalNotification(t),await this.sendEmailNotification(t),await this.sendSlackNotification(t)}async notifySchedulerStatus(e){let t={type:"scheduler_status",title:"\uD83D\uDCC5 スケジューラー状態",message:"スケジューラー: ".concat(e.is_running?"実行中":"停止中",", 実行回数: ").concat(e.execution_count,", エラー回数: ").concat(e.error_count),data:e,timestamp:new Date().toISOString(),priority:"medium",source:"automated"};await this.sendLocalNotification(t)}async sendEmailNotification(e){var t;if((null===(t=this.config)||void 0===t?void 0:t.email.enabled)&&this.config.email.email_to)try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:this.config.email.email_to,subject:e.title,message:e.message,config:this.config.email})})).ok)throw Error("メール送信に失敗しました");console.log("メール通知を送信しました")}catch(e){console.error("メール通知送信エラー:",e)}}async sendSlackNotification(e){var t;if((null===(t=this.config)||void 0===t?void 0:t.slack.enabled)&&this.config.slack.webhook_url)try{if(!(await fetch("/api/send-slack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({webhook_url:this.config.slack.webhook_url,channel:this.config.slack.channel,username:this.config.slack.username,icon_emoji:this.config.slack.icon_emoji,title:e.title,message:e.message,priority:e.priority})})).ok)throw Error("Slack通知送信に失敗しました");console.log("Slack通知を送信しました")}catch(e){console.error("Slack通知送信エラー:",e)}}async checkRateLimit(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.rate_limiting))return!0;try{let e=Date.now()-36e5;if((await this.getNotificationHistory()).filter(t=>new Date(t.timestamp).getTime()>e).length>=this.config.rate_limiting.max_notifications_per_hour)return console.warn("レート制限により通知をスキップします"),!1;return!0}catch(e){return console.error("レート制限チェックエラー:",e),!0}}async saveNotificationToHistory(e){try{if("undefined"==typeof localStorage)return;let t=await this.getNotificationHistory();t.unshift(e);let i=t.slice(0,100);localStorage.setItem("notification-history",JSON.stringify(i))}catch(e){console.error("通知履歴保存エラー:",e)}}async sendNotification(e){await this.checkRateLimit()&&(await this.saveNotificationToHistory(e),await this.sendLocalNotification(e),await this.sendEmailNotification(e),await this.sendSlackNotification(e))}constructor(){this.config=null,this.registration=null}}}},function(e){e.O(0,[1216,1744],function(){return e(e.s=48513)}),_N_E=e.O()}]);