(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9295],{3007:function(e,t,s){Promise.resolve().then(s.bind(s,7263))},9205:function(e,t,s){"use strict";s.d(t,{Z:function(){return x}});var a=s(5583),r=s(6796),n=s(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),i=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},c=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()},d=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var u=s(1780),m={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let h=(0,n.forwardRef)((e,t)=>{var{color:s="currentColor",size:l=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:h="",children:x,iconNode:g}=e,p=(0,r._)(e,["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"]);return(0,n.createElement)("svg",(0,a._)((0,u._)((0,a._)({ref:t},m),{width:l,height:l,stroke:s,strokeWidth:i?24*Number(o)/Number(l):o,className:c("lucide",h)}),!x&&!d(p)&&{"aria-hidden":"true"},p),[...g.map(e=>{let[t,s]=e;return(0,n.createElement)(t,s)}),...Array.isArray(x)?x:[x]])}),x=(e,t)=>{let s=(0,n.forwardRef)((s,o)=>{var{className:d}=s,u=(0,r._)(s,["className"]);return(0,n.createElement)(h,(0,a._)({ref:o,iconNode:t,className:c("lucide-".concat(l(i(e))),"lucide-".concat(e),d)},u))});return s.displayName=i(e),s}},6215:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},5252:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},3085:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]])},525:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},2489:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7263:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b},dynamic:function(){return y}});var a=s(5583),r=s(1780),n=s(7437),l=s(2265);class o{async execute(e){return new Promise((t,s)=>{this.requestQueue.push(async()=>{try{let s=await e();t(s)}catch(e){s(e)}}),this.processQueue()})}async processQueue(){if(!this.isProcessing&&0!==this.requestQueue.length){for(this.isProcessing=!0;this.requestQueue.length>0;){let e=Date.now()-this.lastRequestTime;e<this.delayMs&&await new Promise(t=>setTimeout(t,this.delayMs-e));let t=this.requestQueue.shift();t&&(await t(),this.lastRequestTime=Date.now())}this.isProcessing=!1}}constructor(e){this.delayMs=e,this.lastRequestTime=0,this.requestQueue=[],this.isProcessing=!1}}class i{static validateStockData(e){let t=[],s=[];return e.forEach((e,a)=>{let r=[];e.date&&e.code||r.push("Record ".concat(a,": Missing required fields (date, code)")),e.date&&!this.VALIDATION_RULES.date.format.test(e.date)&&r.push("Record ".concat(a,": Invalid date format: ").concat(e.date)),e.code&&!this.VALIDATION_RULES.code.format.test(e.code)&&r.push("Record ".concat(a,": Invalid code format: ").concat(e.code)),["open","high","low","close"].forEach(t=>{let s=parseFloat(e[t]);(isNaN(s)||s<this.VALIDATION_RULES.price.min||s>this.VALIDATION_RULES.price.max)&&r.push("Record ".concat(a,": Invalid ").concat(t," value: ").concat(e[t]))});let n=parseInt(e.volume);(isNaN(n)||n<this.VALIDATION_RULES.volume.min||n>this.VALIDATION_RULES.volume.max)&&r.push("Record ".concat(a,": Invalid volume value: ").concat(e.volume));let l=parseFloat(e.high),o=parseFloat(e.low),i=parseFloat(e.open),c=parseFloat(e.close);isNaN(l)||isNaN(o)||!(l<o)||r.push("Record ".concat(a,": High price (").concat(l,") is less than low price (").concat(o,")")),isNaN(l)||isNaN(i)||!(l<i)||r.push("Record ".concat(a,": High price (").concat(l,") is less than open price (").concat(i,")")),isNaN(l)||isNaN(c)||!(l<c)||r.push("Record ".concat(a,": High price (").concat(l,") is less than close price (").concat(c,")")),isNaN(o)||isNaN(i)||!(o>i)||r.push("Record ".concat(a,": Low price (").concat(o,") is greater than open price (").concat(i,")")),isNaN(o)||isNaN(c)||!(o>c)||r.push("Record ".concat(a,": Low price (").concat(o,") is greater than close price (").concat(c,")")),0===r.length?t.push({date:e.date,code:e.code,open:parseFloat(e.open)||0,high:parseFloat(e.high)||0,low:parseFloat(e.low)||0,close:parseFloat(e.close)||0,volume:parseInt(e.volume)||0}):s.push(...r)}),{validData:t,errors:s}}static calculateQualityScore(e,t){return 0===t?0:Math.round(e/t*100)}}i.VALIDATION_RULES={price:{min:0,max:1e6,required:!0},volume:{min:0,max:1e9,required:!0},date:{format:/^\d{4}-\d{2}-\d{2}$/,required:!0},code:{format:/^\d{4}$/,required:!0}};class c{recordRequest(e,t,s){if(this.metrics.totalRequests++,this.metrics.lastRequestTime=new Date().toISOString(),e)this.metrics.successfulRequests++,this.metrics.consecutiveFailures=0;else switch(this.metrics.failedRequests++,this.metrics.consecutiveFailures++,s){case"timeout":this.metrics.timeoutErrors++;break;case"rate_limit":this.metrics.rateLimitErrors++;break;case"validation":this.metrics.validationErrors++}let a=this.metrics.averageResponseTime*(this.metrics.totalRequests-1)+t;this.metrics.averageResponseTime=a/this.metrics.totalRequests}recordDataQuality(e,t){this.qualityReports.set(e,t)}getMetrics(){return(0,a._)({},this.metrics)}getQualityReport(e){return this.qualityReports.get(e)}getAllQualityReports(){return Array.from(this.qualityReports.values())}getHealthStatus(){let e=[],t=this.metrics.totalRequests>0?this.metrics.successfulRequests/this.metrics.totalRequests*100:100;t<95&&e.push("低い成功率: ".concat(t.toFixed(1),"%")),this.metrics.consecutiveFailures>5&&e.push("連続失敗: ".concat(this.metrics.consecutiveFailures,"回")),this.metrics.timeoutErrors>.1*this.metrics.totalRequests&&e.push("タイムアウトエラーが多い: ".concat(this.metrics.timeoutErrors,"回")),this.metrics.rateLimitErrors>0&&e.push("レート制限エラー: ".concat(this.metrics.rateLimitErrors,"回")),this.metrics.validationErrors>.05*this.metrics.totalRequests&&e.push("データ検証エラーが多い: ".concat(this.metrics.validationErrors,"回"));let s="healthy";return e.length>2||t<80?s="unhealthy":(e.length>0||t<95)&&(s="degraded"),{status:s,issues:e}}constructor(){this.qualityReports=new Map,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,timeoutErrors:0,rateLimitErrors:0,validationErrors:0,averageResponseTime:0,lastRequestTime:"",consecutiveFailures:0,tokenRefreshCount:0,lastTokenRefresh:"",tokenExpiryTime:""}}}class d{async initDB(){return"undefined"==typeof indexedDB?Promise.resolve():new Promise((e,t)=>{let s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>{console.error("IndexedDB初期化エラー:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.info("強化版IndexedDB初期化完了"),e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(this.STORE_NAME)){let e=t.createObjectStore(this.STORE_NAME,{keyPath:["symbol","date"]});e.createIndex("symbol","symbol",{unique:!1}),e.createIndex("date","date",{unique:!1}),e.createIndex("quality_score","qualityScore",{unique:!1})}if(!t.objectStoreNames.contains(this.METADATA_STORE)){let e=t.createObjectStore(this.METADATA_STORE,{keyPath:"symbol"});e.createIndex("last_updated","lastUpdated",{unique:!1}),e.createIndex("quality_score","qualityScore",{unique:!1})}t.objectStoreNames.contains(this.METRICS_STORE)||t.createObjectStore(this.METRICS_STORE,{keyPath:"id"})}})}async fetchWithRetry(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"API call",s=Date.now();try{let a;if(e.includes("/markets/stock/list"))a="/data/listed_index.json";else{if(e.includes("/prices/daily_quotes"))return{data:[],message:"価格データは個別銘柄ファイルから取得してください"};a="/data/listed_index.json"}let r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));let n=await r.json(),l=Date.now()-s;return this.qualityMonitor.recordRequest(!0,l),console.info("".concat(t,"成功 (静的データ)"),{responseTime:l}),n}catch(a){let e=Date.now()-s;throw this.qualityMonitor.recordRequest(!1,e),console.warn("".concat(t,"失敗 (静的データ):"),a),Error("".concat(t,"が失敗: ").concat(a instanceof Error?a.message:"不明なエラー"))}}async makeApiCall(e){return this.rateLimiter.execute(e)}async getAllSymbols(){try{console.info("全銘柄一覧取得開始 (静的データ)");let e=await this.makeApiCall(()=>this.fetchWithRetry("".concat(this.config.baseUrl,"/markets/stock/list"),{method:"GET"},"全銘柄一覧取得")),t=((null==e?void 0:e.stocks)||(null==e?void 0:e.data)||[]).map(e=>({code:(null==e?void 0:e.code)||(null==e?void 0:e.Code),name:(null==e?void 0:e.name)||(null==e?void 0:e.CompanyName)||(null==e?void 0:e.CompanyNameJa)||(null==e?void 0:e.CompanyNameJp)||(null==e?void 0:e.CompanyNameJPN),sector:(null==e?void 0:e.sector)||(null==e?void 0:e.Sector33)||(null==e?void 0:e.SectorName)})).filter(e=>!!e.code&&!!e.name);return console.info("全銘柄一覧取得完了 (静的データ)",{count:t.length}),t}catch(e){return console.error("全銘柄一覧取得エラー (静的データ):",e),[]}}async testConnection(){try{var e,t;console.info("J-Quants接続テスト開始");let s=await this.makeApiCall(()=>this.fetchWithRetry("".concat(this.config.baseUrl,"/markets/stock/list"),{method:"GET"},"接続テスト")),a=this.qualityMonitor.getMetrics(),r=this.qualityMonitor.getHealthStatus();return console.info("J-Quants接続テスト成功",{dataCount:(null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.length)||0,healthStatus:r.status}),{success:!0,message:"接続成功: ".concat((null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.length)||0,"件の銘柄データを取得 (健康状態: ").concat(r.status,")"),metrics:a}}catch(t){console.error("J-Quants接続テスト失敗:",t);let e=this.qualityMonitor.getMetrics();return{success:!1,message:"接続失敗: ".concat(t instanceof Error?t.message:"不明なエラー"),metrics:e}}}async getStockData(e,t,s){let a=!(arguments.length>3)||void 0===arguments[3]||arguments[3];try{if(console.info("株価データ取得開始",{symbol:e,startDate:t,endDate:s,useCache:a}),a){let a=await this.getCachedData(e,t,s);if(a.length>0)return console.info("キャッシュからデータ取得",{symbol:e,count:a.length,dateRange:"".concat(t," - ").concat(s)}),a}let r=await this.makeApiCall(()=>this.fetchFromAPI(e,t,s)),n=r,l=[];if(this.config.enableDataValidation){let e=i.validateStockData(r);n=e.validData,(l=e.errors).length>0&&(console.warn("データ検証エラー:",l),this.qualityMonitor.recordRequest(!1,0,"validation"))}if(this.config.enableQualityMonitoring&&n.length>0){let t=i.calculateQualityScore(n.length,r.length),s={symbol:e,totalRecords:r.length,validRecords:n.length,invalidRecords:r.length-n.length,qualityScore:t,validationErrors:l.map(e=>({type:"validation",count:1,description:e})),recommendations:this.generateQualityRecommendations(t,l)};this.qualityMonitor.recordDataQuality(e,s)}return a&&n.length>0&&await this.saveToCache(e,n,t,s,l),console.info("APIからデータ取得完了",{symbol:e,count:n.length,qualityScore:this.config.enableQualityMonitoring?i.calculateQualityScore(n.length,r.length):void 0}),n}catch(e){throw console.error("株価データ取得エラー:",e),e}}async fetchFromAPI(e,t,s){let a=await this.fetchWithRetry("".concat(this.config.baseUrl,"/markets/daily_quotes"),{method:"GET"},"株価データ取得 (".concat(e,")"));return this.transformAPIResponse(a,e)}transformAPIResponse(e,t){return(null==e?void 0:e.data)?e.data.filter(e=>e.code===t).map(e=>({date:e.date,code:e.code,open:parseFloat(e.open)||0,high:parseFloat(e.high)||0,low:parseFloat(e.low)||0,close:parseFloat(e.close)||0,volume:parseInt(e.volume)||0})):[]}async getCachedData(e,t,s){return this.db?new Promise((a,r)=>{let n=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).index("symbol").getAll(e);n.onsuccess=()=>{a(n.result.filter(e=>e.date>=t&&e.date<=s))},n.onerror=()=>{console.error("キャッシュ取得エラー:",n.error),r(n.error)}}):[]}async saveToCache(e,t,s,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(this.db&&0!==t.length)return new Promise((n,l)=>{let o=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readwrite"),c=o.objectStore(this.STORE_NAME),d=o.objectStore(this.METADATA_STORE),u=0,m=t.length+1;t.forEach(e=>{let t=c.put(e);t.onsuccess=()=>{++u===m&&n()},t.onerror=()=>{console.error("キャッシュ保存エラー:",t.error),l(t.error)}});let h=i.calculateQualityScore(t.length,t.length+r.length),x={lastUpdated:new Date().toISOString(),dataVersion:"2.0",symbol:e,dateRange:{start:s,end:a},qualityScore:h,validationErrors:r},g=d.put(x);g.onsuccess=()=>{++u===m&&n()},g.onerror=()=>{console.error("メタデータ保存エラー:",g.error),l(g.error)}})}generateQualityRecommendations(e,t){let s=[];return e<90&&s.push("データ品質が低下しています。APIの安定性を確認してください。"),t.some(e=>e.includes("Invalid date format"))&&s.push("日付フォーマットの検証を強化してください。"),t.some(e=>e.includes("price"))&&s.push("価格データの異常値をチェックしてください。"),t.some(e=>e.includes("volume"))&&s.push("出来高データの検証を強化してください。"),s}getSystemHealth(){let e=this.qualityMonitor.getHealthStatus(),t=this.qualityMonitor.getMetrics(),s=this.qualityMonitor.getAllQualityReports();return{status:e.status,issues:e.issues,metrics:t,qualityReports:s}}async getCacheStats(){return this.db?new Promise((e,t)=>{let s=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readonly"),a=s.objectStore(this.STORE_NAME),r=s.objectStore(this.METADATA_STORE),n=a.getAll(),l=r.getAll(),o=[],i=[];n.onsuccess=()=>{o=n.result},l.onsuccess=()=>{i=l.result},s.oncomplete=()=>{let t=[...new Set(o.map(e=>e.symbol))],s=i.length>0?Math.max(...i.map(e=>new Date(e.lastUpdated).getTime())):0,a=i.length>0?i.reduce((e,t)=>e+(t.qualityScore||0),0)/i.length:0,r=i.reduce((e,t)=>{var s;return e+((null===(s=t.validationErrors)||void 0===s?void 0:s.length)||0)},0);e({totalRecords:o.length,symbols:t,lastUpdated:s>0?new Date(s).toISOString():"",averageQualityScore:Math.round(a),totalValidationErrors:r})},s.onerror=()=>{t(s.error)}}):{totalRecords:0,symbols:[],lastUpdated:"",averageQualityScore:0,totalValidationErrors:0}}async clearCache(e){if(this.db)return new Promise((t,s)=>{let a=this.db.transaction([this.STORE_NAME,this.METADATA_STORE],"readwrite");if(e){let s=a.objectStore(this.STORE_NAME),r=a.objectStore(this.METADATA_STORE),n=s.index("symbol").getAll(e);n.onsuccess=()=>{let a=n.result,l=0;a.forEach(n=>{s.delete([n.symbol,n.date]).onsuccess=()=>{++l===a.length&&(r.delete(e),t())}})}}else{let e=a.objectStore(this.STORE_NAME),s=a.objectStore(this.METADATA_STORE);e.clear(),s.clear(),t()}})}constructor(e={}){this.db=null,this.DB_NAME="jquants_enhanced_cache",this.DB_VERSION=2,this.STORE_NAME="stock_data",this.METADATA_STORE="metadata",this.METRICS_STORE="metrics",this.config={token:e.token||"",baseUrl:e.baseUrl||"https://api.jquants.com/v1",timeout:e.timeout||3e4,maxRetries:e.maxRetries||3,retryDelay:e.retryDelay||1e3,rateLimitDelay:e.rateLimitDelay||100,enableDataValidation:!1!==e.enableDataValidation,enableQualityMonitoring:!1!==e.enableQualityMonitoring,autoTokenRefresh:!1!==e.autoTokenRefresh,tokenRefreshThreshold:e.tokenRefreshThreshold||2},this.rateLimiter=new o(this.config.rateLimitDelay),this.qualityMonitor=new c,this.initDB()}}var u=s(2489),m=s(5252),h=s(525),x=s(3085),g=s(6215);function p(e){let{symbol:t,isOpen:s,onClose:a}=e,[r,o]=(0,l.useState)(null),[i,c]=(0,l.useState)(null),[d,p]=(0,l.useState)(!0),[f,y]=(0,l.useState)(null),[b,v]=(0,l.useState)(!1),[j,N]=(0,l.useState)(!1),[w,S]=(0,l.useState)(!1),[k,E]=(0,l.useState)(null);(0,l.useEffect)(()=>{s&&t&&(async()=>{try{var e;p(!0),y(null);let s=await fetch("/data/listed_index.json");if(!s.ok)throw Error("銘柄データの取得に失敗しました");let a=await s.json(),r=null===(e=a.stocks)||void 0===e?void 0:e.find(e=>e.code===t);if(!r)throw Error("銘柄コード ".concat(t," が見つかりません"));o(r);let n={symbol:r.code,name:r.name,currentPrice:r.currentPrice||Math.floor(5e3*Math.random())+1e3,priceChange:Math.floor(200*Math.random())-100,priceChangePercent:(Math.random()-.5)*10,recommendation:Math.random()>.5?"BUY":Math.random()>.3?"HOLD":"SELL",confidence:.4*Math.random()+.6,reasons:["テクニカル分析で上昇トレンドを確認","RSIが適正範囲内","ボリンジャーバンド内での価格推移"],riskLevel:Math.random()>.5?"MEDIUM":Math.random()>.3?"LOW":"HIGH",targetPrice:Math.floor(1e3*Math.random())+(r.currentPrice||2e3),technicalIndicators:{sma5:Math.floor(1e3*Math.random())+1e3,sma10:Math.floor(1e3*Math.random())+1e3,sma25:Math.floor(1e3*Math.random())+1e3,sma50:Math.floor(1e3*Math.random())+1e3,rsi:100*Math.random(),macd:{macd:100*Math.random()-50,signal:100*Math.random()-50,histogram:100*Math.random()-50},bollingerBands:{upper:Math.floor(1e3*Math.random())+2e3,middle:Math.floor(1e3*Math.random())+1500,lower:Math.floor(1e3*Math.random())+1e3}}};c(n)}catch(e){console.error("銘柄データの取得エラー:",e),y(e instanceof Error?e.message:"不明なエラーが発生しました")}finally{p(!1)}})()},[s,t]);let M=async()=>{if(r&&i){v(!0),E(null);try{let e=JSON.parse(localStorage.getItem("user_portfolio")||"[]");if(e.findIndex(e=>e.symbol===t)>=0){E("この銘柄は既にポートフォリオに追加されています");return}let s={symbol:t,name:r.name,sector:r.sector,market:r.market,currentPrice:i.currentPrice,addedAt:new Date().toISOString(),targetPrice:i.targetPrice,riskLevel:i.riskLevel,recommendation:i.recommendation,confidence:i.confidence};e.push(s),localStorage.setItem("user_portfolio",JSON.stringify(e)),E("".concat(r.name," (").concat(t,") をポートフォリオに追加しました"))}catch(e){console.error("ポートフォリオ追加エラー:",e),E("ポートフォリオへの追加に失敗しました")}finally{v(!1)}}},R=async()=>{if(r&&i){N(!0),E(null);try{let e=JSON.parse(localStorage.getItem("user_watchlist")||"[]");if(e.findIndex(e=>e.symbol===t)>=0){E("この銘柄は既にウォッチリストに追加されています");return}let s={symbol:t,name:r.name,sector:r.sector,market:r.market,currentPrice:i.currentPrice,addedAt:new Date().toISOString(),targetPrice:i.targetPrice,riskLevel:i.riskLevel,recommendation:i.recommendation,confidence:i.confidence};e.push(s),localStorage.setItem("user_watchlist",JSON.stringify(e)),E("".concat(r.name," (").concat(t,") をウォッチリストに追加しました"))}catch(e){console.error("ウォッチリスト追加エラー:",e),E("ウォッチリストへの追加に失敗しました")}finally{N(!1)}}},A=async()=>{if(r&&i){S(!0),E(null);try{await new Promise(e=>setTimeout(e,2e3));let e=JSON.parse(localStorage.getItem("analysis_history")||"[]"),s={symbol:t,name:r.name,analyzedAt:new Date().toISOString(),currentPrice:i.currentPrice,recommendation:i.recommendation,confidence:i.confidence,riskLevel:i.riskLevel,targetPrice:i.targetPrice,technicalIndicators:i.technicalIndicators,reasons:i.reasons};e.unshift(s),e.length>100&&e.splice(100),localStorage.setItem("analysis_history",JSON.stringify(e)),E("".concat(r.name," (").concat(t,") の詳細分析が完了しました。")+' <a href="/analysis-history" target="_blank" rel="noopener noreferrer" class="underline text-blue-700">分析履歴を見る</a>')}catch(e){console.error("詳細分析エラー:",e),E("詳細分析の実行に失敗しました")}finally{S(!1)}}};return s?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:(null==r?void 0:r.name)||"銘柄詳細"}),(0,n.jsxs)("p",{className:"text-gray-600",children:["銘柄コード: ",t]})]}),(0,n.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,n.jsx)(u.Z,{className:"w-6 h-6"})})]}),(0,n.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)]",children:d?(0,n.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"銘柄データを読み込み中..."})]})}):!f&&r&&i?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"lg:col-span-2",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,n.jsx)(m.Z,{className:"w-5 h-5 mr-2"}),"価格情報"]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"現在価格"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\xa5",i.currentPrice.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"前日比"}),(0,n.jsxs)("div",{className:"flex items-center ".concat(i.priceChange>=0?"text-red-600":"text-green-600"),children:[i.priceChange>=0?(0,n.jsx)(h.Z,{className:"w-4 h-4 mr-1"}):(0,n.jsx)(x.Z,{className:"w-4 h-4 mr-1"}),(0,n.jsxs)("span",{className:"text-lg font-semibold",children:[i.priceChange>=0?"+":"",i.priceChange.toLocaleString()]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"前日比率"}),(0,n.jsxs)("p",{className:"text-lg font-semibold ".concat(i.priceChangePercent>=0?"text-red-600":"text-green-600"),children:[i.priceChangePercent>=0?"+":"",i.priceChangePercent.toFixed(2),"%"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"出来高"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:r.volume?r.volume.toLocaleString():"N/A"})]})]})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,n.jsx)(g.Z,{className:"w-5 h-5 mr-2"}),"投資推奨"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"推奨アクション"}),(0,n.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("BUY"===i.recommendation?"bg-green-100 text-green-800":"SELL"===i.recommendation?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"BUY"===i.recommendation?"買い":"SELL"===i.recommendation?"売り":"ホールド"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"信頼度"}),(0,n.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[(100*i.confidence).toFixed(1),"%"]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"リスクレベル"}),(0,n.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("LOW"===i.riskLevel?"bg-green-100 text-green-800":"MEDIUM"===i.riskLevel?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"LOW"===i.riskLevel?"低":"MEDIUM"===i.riskLevel?"中":"高"})]}),i.targetPrice&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"目標価格"}),(0,n.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:["\xa5",i.targetPrice.toLocaleString()]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"推奨理由"}),(0,n.jsx)("ul",{className:"space-y-1",children:i.reasons.map((e,t)=>(0,n.jsxs)("li",{className:"text-sm text-gray-700 flex items-start",children:[(0,n.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 mr-2 flex-shrink-0"}),e]},t))})]})]})]}),i.technicalIndicators&&(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"テクニカル指標"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"SMA5"}),(0,n.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\xa5",i.technicalIndicators.sma5.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"SMA10"}),(0,n.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\xa5",i.technicalIndicators.sma10.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"SMA25"}),(0,n.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\xa5",i.technicalIndicators.sma25.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"RSI"}),(0,n.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:i.technicalIndicators.rsi.toFixed(1)})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"基本情報"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"銘柄コード"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:r.code})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"会社名"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:r.name})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"セクター"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:r.sector})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"市場"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:r.market})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"最終更新"}),(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:new Date(r.updated_at).toLocaleString("ja-JP")})]})]})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"クイックアクション"}),k&&(0,n.jsx)("div",{className:"mb-4 p-3 rounded-lg text-sm ".concat(k.includes("失敗")||k.includes("既に")?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-green-100 text-green-800 border border-green-200"),children:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:k}})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("button",{onClick:()=>M(),className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:b,children:b?"追加中...":"ポートフォリオに追加"}),(0,n.jsx)("button",{onClick:()=>R(),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:j,children:j?"追加中...":"ウォッチリストに追加"}),(0,n.jsx)("button",{onClick:()=>A(),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:w,children:w?"分析中...":"詳細分析を実行"})]})]})]})]})}):(0,n.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:f||"銘柄データが見つかりません"}),(0,n.jsx)("button",{onClick:a,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"閉じる"})]})})})]})}):null}function f(e){let{value:t,onChange:s,onSearch:a,placeholder:r="銘柄名またはコードを入力...",className:o="",disabled:i=!1}=e,[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(t||""),[h,x]=(0,l.useState)(!1),[g,p]=(0,l.useState)(-1),f=(0,l.useRef)(null),y=(0,l.useRef)(null),b=(0,l.useRef)(null),{suggestions:v,isLoading:j,error:N,showSuggestions:w,handleQueryChange:S,clearSuggestions:k,hideSuggestions:E}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{debounceMs:t=300,minQueryLength:s=1,maxSuggestions:a=10}=e,[r,n]=(0,l.useState)([]),[o,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)(!1),h=(0,l.useRef)(null),x=(0,l.useRef)(null),g=(0,l.useCallback)(async e=>{if(e.length<s){n([]),m(!1);return}x.current&&x.current.abort(),x.current=new AbortController,i(!0),d(null);try{let t=await fetch("/data/listed_index.json",{signal:x.current.signal});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json(),r=function(e,t,s){if(!t||t.length<1)return[];let a=e=>e.toLowerCase().trim().replace(/[０-９]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/[Ａ-Ｚａ-ｚ]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/[（）]/g,e=>"（"===e?"(":")").replace(/[　]/g," "),r=a(t),n=e.filter(e=>{let t=a(e.code),s=a(e.name),n=t.startsWith(r),l=s.startsWith(r);return n||l}).map(e=>({code:e.code,name:e.name,sector:e.sector,market:e.market,displayText:"".concat(e.name," (").concat(e.code,")")})).slice(0,s),l=e.filter(e=>{let t=a(e.code),s=a(e.name),n=t.includes(r),l=s.includes(r),o=t.startsWith(r),i=s.startsWith(r);return(n||l)&&!(o||i)}).map(e=>({code:e.code,name:e.name,sector:e.sector,market:e.market,displayText:"".concat(e.name," (").concat(e.code,")")})),o=n.length>0?n:[...l];return o.sort((e,t)=>{let s=a(e.code).startsWith(r),n=a(t.code).startsWith(r),l=a(e.name).startsWith(r),o=a(t.name).startsWith(r);return s&&!n?-1:!s&&n?1:!l||o||s||n?l||!o||s||n?e.name.localeCompare(t.name,"ja"):1:-1}),o.slice(0,s)}(s.stocks||[],e,a);n(r),m(!0)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;console.error("Suggestions fetch error:",e),d("サジェッションの取得に失敗しました"),n([]),m(!1)}finally{i(!1)}},[s,a]),p=(0,l.useCallback)(e=>{h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{g(e)},t)},[g,t]),f=(0,l.useCallback)(()=>{n([]),m(!1),d(null),x.current&&x.current.abort()},[]),y=(0,l.useCallback)(()=>{m(!1)},[]);return(0,l.useEffect)(()=>()=>{h.current&&clearTimeout(h.current),x.current&&x.current.abort()},[]),{suggestions:r,isLoading:o,error:c,showSuggestions:u,handleQueryChange:p,clearSuggestions:f,hideSuggestions:y,fetchSuggestions:g}}({debounceMs:300,minQueryLength:1,maxSuggestions:10}),M=e=>{var t;s(e.displayText),k(),p(-1),null===(t=f.current)||void 0===t||t.focus(),a&&a(e.displayText)},R=e=>{M(e)};return(0,l.useEffect)(()=>{if(g>=0&&b.current){let e=b.current.children[g];e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[g]),(0,l.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&f.current&&!f.current.contains(e.target)&&(E(),x(!1),p(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[E]),(0,l.useEffect)(()=>{m(t||"")},[t]),(0,n.jsxs)("div",{className:o?"".concat(o," relative"):"relative",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{ref:f,type:"text",value:u,onChange:e=>{let t=e.target.value;m(t),s(t),S(t),p(-1),x(!0)},onFocus:()=>{d(!0),x(!0)},onBlur:()=>{setTimeout(()=>{d(!1),E(),x(!1)},150)},onKeyDown:e=>{if(!w||0===v.length){"Enter"===e.key&&a&&(e.preventDefault(),a(t));return}switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>e<v.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),p(e=>e>0?e-1:v.length-1);break;case"Enter":e.preventDefault(),g>=0&&g<v.length?M(v[g]):a&&a(t);break;case"Escape":var s;e.preventDefault(),E(),x(!1),p(-1),null===(s=f.current)||void 0===s||s.blur()}},placeholder:r,disabled:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",autoComplete:"off",autoFocus:!0}),t&&!i&&(0,n.jsx)("button",{type:"button",onClick:()=>{var e;s(""),k(),p(-1),null===(e=f.current)||void 0===e||e.focus()},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none","aria-label":"検索をクリア",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&w&&v.length>0&&(0,n.jsx)("div",{ref:y,className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:(0,n.jsx)("ul",{ref:b,className:"py-1",children:v.map((e,t)=>(0,n.jsx)("li",{className:"px-3 py-2 cursor-pointer ".concat(t===g?"bg-blue-100 text-blue-900":"hover:bg-gray-100 text-gray-900"),onClick:()=>R(e),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"font-medium ".concat(t===g?"bg-blue-100":""),children:e.displayText}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[e.sector," • ",e.market]})]})},"".concat(e.code,"-").concat(t)))})}),j&&(0,n.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg",children:(0,n.jsxs)("div",{className:"px-3 py-2 text-center text-gray-500",children:[(0,n.jsx)("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"}),"検索中..."]})}),N&&(0,n.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-red-50 border border-red-300 rounded-md shadow-lg",children:(0,n.jsx)("div",{className:"px-3 py-2 text-red-600 text-sm",children:"string"==typeof N?N:"エラーが発生しました"})})]})}let y="force-dynamic";var b=()=>{let[e,t]=(0,l.useState)(null),[s,o]=(0,l.useState)(!0),[i,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(""),[h,x]=(0,l.useState)(""),[g,y]=(0,l.useState)(""),[b,v]=(0,l.useState)("code"),[j,N]=(0,l.useState)("asc"),[w,S]=(0,l.useState)(1),[k]=(0,l.useState)(200),[E,M]=(0,l.useState)(!1),[R,A]=(0,l.useState)({min:"",max:""}),[C,T]=(0,l.useState)({min:"",max:""}),[_,D]=(0,l.useState)(null),[I,L]=(0,l.useState)(!1),[q,P]=(0,l.useState)(null),O=(0,l.useCallback)(async()=>{try{o(!0),c(null);let e=await fetch("/data/listed_index.json");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json();try{if(!q)throw Error("adapter_not_ready");let e=await q.getAllSymbols();if(e.length>0){let n=s.stocks.map(t=>{let s=e.find(e=>e.code===t.code);return(0,r._)((0,a._)({},t),{name:(null==s?void 0:s.name)||t.name,sector:(null==s?void 0:s.sector)||t.sector})});t((0,r._)((0,a._)({},s),{stocks:n,metadata:(0,r._)((0,a._)({},s.metadata),{last_updated:new Date().toISOString()})}))}else t(s)}catch(e){console.warn("J-Quants API取得に失敗、キャッシュデータを使用:",e),t(s)}}catch(e){console.error("Error fetching listed data:",e),c("データの取得に失敗しました")}finally{o(!1)}},[q]);(0,l.useEffect)(()=>{P(new d)},[]),(0,l.useEffect)(()=>{O()},[O]);let F=(0,l.useMemo)(()=>e?Array.from(new Set(e.stocks.map(e=>e.sector))).sort():[],[e]),Q=(0,l.useMemo)(()=>e?Array.from(new Set(e.stocks.map(e=>e.market))).sort():[],[e]),U=(0,l.useCallback)(e=>{b===e?N("asc"===j?"desc":"asc"):(v(e),N("asc")),S(1)},[b,j]),W=(0,l.useMemo)(()=>{if(!e)return[];u.toLowerCase();let t=R.min?parseFloat(R.min):null,s=R.max?parseFloat(R.max):null,a=C.min?parseFloat(C.min):null,r=C.max?parseFloat(C.max):null,n=e=>e.toLowerCase().trim().replace(/[０-９]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/[Ａ-Ｚａ-ｚ]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/[（）]/g,e=>"（"===e?"(":")").replace(/[　]/g," "),l=n(u),o=e.stocks.filter(e=>{let o=n(e.name),i=n(e.code),c=o.includes(l)||i.includes(l),d=!h||e.sector===h,u=!g||e.market===g,m=!t||!s||e.currentPrice&&e.currentPrice>=t&&e.currentPrice<=s,x=!a||!r||e.volume&&e.volume>=a&&e.volume<=r;return c&&d&&u&&m&&x});return o.sort((e,t)=>{let s=e[b],a=t[b];return(("currentPrice"===b||"change"===b||"volume"===b)&&(s=s||0,a=a||0),"string"==typeof s&&(s=s.toLowerCase(),a=a.toLowerCase()),s<a)?"asc"===j?-1:1:s>a?"asc"===j?1:-1:0}),o},[e,u,h,g,b,j,R,C]);(0,l.useEffect)(()=>{S(1)},[u,h,g,R,C]);let Z=(0,l.useMemo)(()=>{let e=(w-1)*k;return W.slice(e,e+k)},[W,w,k]),B=Math.ceil(W.length/k),V=(0,l.useCallback)(e=>{S(Math.max(1,Math.min(e,B)))},[B]),H=(0,l.useCallback)(()=>V(1),[V]),J=(0,l.useCallback)(()=>V(B),[V,B]),z=(0,l.useCallback)(()=>V(w-1),[V,w]),G=(0,l.useCallback)(()=>V(w+1),[V,w]);return s?(0,n.jsx)("div",{className:"container mx-auto p-4",children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-lg",children:"上場銘柄データを読み込み中..."})]})})}):i?(0,n.jsx)("div",{className:"container mx-auto p-4",children:(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{children:i}),(0,n.jsx)("button",{onClick:O,className:"mt-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"再試行"})]})}):e?(0,n.jsxs)("div",{className:"container mx-auto p-4",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"jQuants 上場銘柄データ"}),(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"データ情報"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"総銘柄数:"})," ",e.metadata.total_stocks]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"最終更新:"})," ",new Date(e.metadata.last_updated).toLocaleString("ja-JP")]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"データタイプ:"})," ",e.metadata.data_type]})]})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"検索・フィルター"}),(0,n.jsx)("button",{onClick:()=>M(!E),className:"text-blue-600 hover:text-blue-800 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded","aria-expanded":E,"aria-controls":"advanced-filters",children:E?"詳細フィルターを閉じる":"詳細フィルターを開く"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"検索 (銘柄名・コード)"}),(0,n.jsx)(f,{value:u,onChange:m,placeholder:"銘柄名またはコードを入力...",className:"w-full"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"セクター"}),(0,n.jsxs)("select",{value:h,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"すべてのセクター"}),F.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"市場"}),(0,n.jsxs)("select",{value:g,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"すべての市場"}),Q.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]})]}),E&&(0,n.jsx)("div",{id:"advanced-filters",className:"mt-4 pt-4 border-t border-gray-200",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格範囲 (円)"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{type:"number",value:R.min,onChange:e=>A(t=>(0,r._)((0,a._)({},t),{min:e.target.value})),placeholder:"最小価格",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,n.jsx)("input",{type:"number",value:R.max,onChange:e=>A(t=>(0,r._)((0,a._)({},t),{max:e.target.value})),placeholder:"最大価格",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"出来高範囲"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{type:"number",value:C.min,onChange:e=>T(t=>(0,r._)((0,a._)({},t),{min:e.target.value})),placeholder:"最小出来高",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,n.jsx)("input",{type:"number",value:C.max,onChange:e=>T(t=>(0,r._)((0,a._)({},t),{max:e.target.value})),placeholder:"最大出来高",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,n.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold",children:["銘柄一覧 (",W.length,"件)"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:[w," / ",B," ページ"]}),(0,n.jsx)("button",{onClick:O,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600",children:"更新"})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>U("code"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),U("code"))},children:["銘柄コード","code"===b&&(0,n.jsx)("span",{className:"ml-1","aria-hidden":"true",children:"asc"===j?"↑":"↓"})]}),(0,n.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>U("name"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),U("name"))},children:["会社名","name"===b&&(0,n.jsx)("span",{className:"ml-1","aria-hidden":"true",children:"asc"===j?"↑":"↓"})]}),(0,n.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>U("sector"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),U("sector"))},children:["セクター","sector"===b&&(0,n.jsx)("span",{className:"ml-1","aria-hidden":"true",children:"asc"===j?"↑":"↓"})]}),(0,n.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>U("market"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),U("market"))},children:["市場","market"===b&&(0,n.jsx)("span",{className:"ml-1","aria-hidden":"true",children:"asc"===j?"↑":"↓"})]}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"現在価格"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"出来高"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"更新日時"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.code}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,n.jsx)("div",{className:"max-w-xs truncate",title:e.name,children:e.name})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,n.jsx)("div",{className:"max-w-xs truncate",title:e.sector,children:e.sector})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("プライム"===e.market?"bg-green-100 text-green-800":"スタンダード"===e.market?"bg-blue-100 text-blue-800":"グロース"===e.market?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.market})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.currentPrice?"\xa5".concat(e.currentPrice.toLocaleString()):(0,n.jsx)("span",{className:"text-gray-400 italic",children:"データ取得中..."}),e.change&&e.changePercent&&(0,n.jsxs)("div",{className:"text-xs ".concat(e.change>=0?"text-red-600":"text-green-600"),children:[e.change>=0?"+":"",e.change.toLocaleString()," (",e.changePercent>=0?"+":"",e.changePercent.toFixed(2),"%)"]})]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.volume?e.volume.toLocaleString():(0,n.jsx)("span",{className:"text-gray-400 italic",children:"データ取得中..."})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.updated_at).toLocaleString("ja-JP")}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,n.jsx)("button",{onClick:()=>{D(e.code),L(!0)},className:"text-blue-600 hover:text-blue-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded px-2 py-1","aria-label":"".concat(e.name," (").concat(e.code,") の詳細を表示"),children:"詳細"})})]},e.code))})]})}),B>1&&(0,n.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsxs)("span",{className:"text-sm text-gray-700",children:[(w-1)*k+1," - ",Math.min(w*k,W.length)," / ",W.length," 件"]})}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:H,disabled:1===w,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"最初のページへ",children:"最初"}),(0,n.jsx)("button",{onClick:z,disabled:1===w,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"前のページへ",children:"前へ"}),(0,n.jsx)("span",{className:"px-3 py-1 text-sm bg-blue-500 text-white rounded","aria-label":"現在のページ: ".concat(w),children:w}),(0,n.jsx)("button",{onClick:G,disabled:w===B,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"次のページへ",children:"次へ"}),(0,n.jsx)("button",{onClick:J,disabled:w===B,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"最後のページへ",children:"最後"})]})]})]}),_&&(0,n.jsx)(p,{symbol:_,isOpen:I,onClose:()=>{L(!1),D(null)}})]}):(0,n.jsx)("div",{className:"container mx-auto p-4",children:(0,n.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:"データが見つかりません"}),(0,n.jsx)("p",{children:"上場銘柄データが利用できません。"})]})})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=3007)}),_N_E=e.O()}]);