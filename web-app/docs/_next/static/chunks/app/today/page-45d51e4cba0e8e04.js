(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8891,3268],{22725:function(e,t,s){Promise.resolve().then(s.bind(s,63030))},63030:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W},dynamic:function(){return J}});var a=s(57437),n=s(2265),r=s(85583),l=s(1780),c=s(25493);async function i(e){try{let t=await (0,c.ER)(),s=(0,c.rK)(e||null,t),{data:a,fromCache:n}=await (0,c.Bt)("today:summary","/data/".concat(s,"/summary.json"),{ttlMs:36e5,timeoutMs:6e3,retries:3,retryDelay:800});if(!n)try{localStorage.setItem("today_summary",JSON.stringify(a)),localStorage.setItem("today_summary_timestamp",new Date().toISOString())}catch(e){}if(!a)throw Error("today_summary_missing");return a}catch(t){console.error("fetchTodaySummary error:",t);let e=localStorage.getItem("today_summary");if(e)try{return JSON.parse(e)}catch(e){console.warn("Failed to parse cached data:",e)}throw t}}function o(){return localStorage.getItem("today_summary_timestamp")}function d(e){if(!e)return"Unknown";try{let t=new Date(e).getTime();return(Date.now()-t)/36e5<=6?"Fresh":"Stale"}catch(e){return"Unknown"}}function m(e,t){var s,a,n;let r=[],l=function(e){switch(e){case"STRONG_BUY":return 1;case"BUY":return .8;case"HOLD":default:return .5;case"SELL":return .2;case"STRONG_SELL":return 0}}(e.recommendation);r.push("推奨度: ".concat(e.recommendation));let c=null!==(a=e.confidence)&&void 0!==a?a:.5;r.push("信頼度: ".concat(Math.round(100*c),"%"));let i=null!==(n=null===(s=t.warnings)||void 0===s?void 0:s.some(t=>t.symbol===e.symbol))&&void 0!==n&&n;i&&r.push("リスク警告あり: スコア減点");let o=.6*l+.4*c-(i?.15:0);return("BUY"===e.recommendation||"STRONG_BUY"===e.recommendation)&&(o+=.05),{score:o,reasons:r}}function h(e){if(!e)return[];let t=[];try{let e=localStorage.getItem("portfolio_symbols");e&&(t=JSON.parse(e))}catch(e){}return t&&0!==t.length||(t=e.candidates.slice(0,3).map(e=>e.symbol)),t.map(t=>{var s,a,n;let r=e.candidates.find(e=>e.symbol===t),l=null!==(s=null==r?void 0:r.name)&&void 0!==s?s:t,c="継続",i="トレンドに大きな変化なし";if(r){if("SELL"===r.recommendation||"STRONG_SELL"===r.recommendation){let t=null!==(n=null===(a=e.warnings)||void 0===a?void 0:a.some(e=>e.symbol===r.symbol))&&void 0!==n&&n;c=t?"損切り":"利確",i=t?"リスク警告により手仕舞い推奨":"シグナル弱化により利益確定推奨"}else"BUY"===r.recommendation||"STRONG_BUY"===r.recommendation?(c="継続",i="上昇シグナル継続"):(c="継続",i="中立シグナル")}return{symbol:t,name:l,proposal:c,qtyOptions:[.25,.5],reason:i}})}function u(){let e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"fiveMinMemo:".concat(t,"-").concat(s,"-").concat(a)}var x=s(60444),g=s(39488);function p(){return[{symbol:"7203",name:"トヨタ自動車"},{symbol:"6758",name:"ソニーグループ"},{symbol:"9984",name:"ソフトバンクグループ"},{symbol:"6861",name:"キーエンス"},{symbol:"4063",name:"信越化学工業"}].map((e,t)=>({symbol:e.symbol,name:e.name,currentPrice:1e3+5e3*Math.random(),priceChange:(Math.random()-.5)*200,priceChangePercent:(Math.random()-.5)*10,recommendation:t%3==0?"BUY":t%3==1?"HOLD":"SELL",confidence:.6+.3*Math.random(),riskLevel:t%2==0?"LOW":"MEDIUM",technicalIndicators:{sma_5:1e3+5e3*Math.random(),sma_10:1e3+5e3*Math.random(),sma_25:1e3+5e3*Math.random(),sma_50:1e3+5e3*Math.random(),rsi:30+40*Math.random(),macd:(Math.random()-.5)*10},volume:Math.floor(1e6*Math.random()),marketCap:Math.floor(1e12*Math.random()),indicators:{sma5:1e3+5e3*Math.random(),sma10:1e3+5e3*Math.random(),sma25:1e3+5e3*Math.random(),sma50:1e3+5e3*Math.random(),rsi:30+40*Math.random(),macd:{macd:(Math.random()-.5)*10,signal:(Math.random()-.5)*5,histogram:(Math.random()-.5)*3},bollinger:{upper:1e3+5e3*Math.random(),middle:1e3+5e3*Math.random(),lower:1e3+5e3*Math.random()},trend:t%2==0?"UP":"DOWN",momentum:t%3==0?"STRONG":"WEAK",volatility:t%2==0?"LOW":"HIGH"},reasons:["サンプルデータ: ".concat(e.name),t%2==0?"テクニカル分析良好":"注意が必要",t%3==0?"強気トレンド":"調整局面"]}))}function f(e){if(!e)return"Unknown";try{let t=new Date(e).getTime();return(Date.now()-t)/36e5<=1?"Fresh":"Stale"}catch(e){return"Unknown"}}function y(){let e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"realTodayMemo:".concat(t,"-").concat(s,"-").concat(a)}function b(){try{let e=localStorage.getItem("portfolio_symbols");return e?JSON.parse(e):[]}catch(e){return[]}}function w(e){return e.map(e=>{let t=0,s=[];switch(e.recommendation){case"STRONG_BUY":t+=.9,s.push("強い買い推奨");break;case"BUY":t+=.7,s.push("買い推奨");break;case"HOLD":t+=.5,s.push("中立");break;case"SELL":t+=.3,s.push("売り推奨");break;case"STRONG_SELL":t+=.1,s.push("強い売り推奨")}return t*=e.confidence,s.push("信頼度: ".concat(Math.round(100*e.confidence),"%")),e.priceChangePercent>0?s.push("前日比 +".concat(e.priceChangePercent.toFixed(2),"%")):e.priceChangePercent<0&&s.push("前日比 ".concat(e.priceChangePercent.toFixed(2),"%")),"HIGH"===e.riskLevel?(t*=.8,s.push("高リスク銘柄")):"LOW"===e.riskLevel&&(t*=1.1,s.push("低リスク銘柄")),s.push(...e.reasons.slice(0,3)),{symbol:e.symbol,name:e.name,recommendation:e.recommendation,confidence:e.confidence,currentPrice:e.currentPrice,priceChange:e.priceChange,priceChangePercent:e.priceChangePercent,routine_score:Math.max(0,Math.min(1,t)),routine_reasons:s,riskLevel:e.riskLevel,targetPrice:e.targetPrice}})}function v(e,t){return e.map(e=>{let s=t.find(t=>t.symbol===e);if(!s)return{symbol:e,name:e,proposal:"継続",qtyOptions:[.25,.5],reason:"分析データなし",currentPrice:0,priceChange:0};let a="継続",n="現状維持";return"STRONG_SELL"===s.recommendation||"SELL"===s.recommendation?"HIGH"===s.riskLevel||s.priceChangePercent<-3?(a="損切り",n="下落リスクが高いため手仕舞い推奨"):(a="利確",n="利益確定のタイミング"):"STRONG_BUY"===s.recommendation||"BUY"===s.recommendation?(a="継続",n="上昇継続が期待されるため保有継続"):(a="継続",n="トレンドに大きな変化なし"),{symbol:s.symbol,name:s.name,proposal:a,qtyOptions:"継続"===a?[.25,.5,1]:[.25,.5],reason:n,currentPrice:s.currentPrice,priceChange:s.priceChange}})}let j="signal_fallback_data";var N=s(75465);let S={handleError:async(e,t)=>Promise.resolve(!0)};var _=s(70525),L=s(3085),C=s(21047),k=s(91723),I=s(88906),M=s(58896),O=s(96362),E=s(76865),R=s(33245);function P(e){let{content:t,children:s,position:r="top",maxWidth:l=300}=e,[c,i]=(0,n.useState)(!1),[o,d]=(0,n.useState)({x:0,y:0}),m=(0,n.useRef)(null),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(c&&m.current&&h.current){let e=m.current.getBoundingClientRect(),t=h.current.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,n=0,l=0;switch(r){case"top":n=e.left+e.width/2-t.width/2+s,l=e.top-t.height-8+a;break;case"bottom":n=e.left+e.width/2-t.width/2+s,l=e.bottom+8+a;break;case"left":n=e.left-t.width-8+s,l=e.top+e.height/2-t.height/2+a;break;case"right":n=e.right+8+s,l=e.top+e.height/2-t.height/2+a}let c=window.innerWidth,i=window.innerHeight;n<0&&(n=8),n+t.width>c&&(n=c-t.width-8),l<0&&(l=8),l+t.height>i&&(l=i-t.height-8),d({x:n,y:l})}},[c,r]);let u=()=>i(!0),x=()=>i(!1);return(0,a.jsxs)("div",{className:"relative inline-block",children:[(0,a.jsx)("div",{ref:m,onMouseEnter:u,onMouseLeave:x,onFocus:u,onBlur:x,className:"inline-block",children:s}),c&&(0,a.jsx)("div",{ref:h,className:"absolute z-50 bg-gray-900 text-white text-sm rounded-lg shadow-lg p-3 pointer-events-none",style:{left:o.x,top:o.y,maxWidth:l},children:(0,a.jsxs)("div",{className:"relative",children:[t,(0,a.jsx)("div",{className:"absolute w-2 h-2 bg-gray-900 transform rotate-45 ".concat("top"===r?"bottom-[-4px] left-1/2 -translate-x-1/2":"bottom"===r?"top-[-4px] left-1/2 -translate-x-1/2":"left"===r?"right-[-4px] top-1/2 -translate-y-1/2":"left-[-4px] top-1/2 -translate-y-1/2")})]})})]})}function D(e){let{category:t,children:s}=e,n={上昇トレンド発生:{title:"上昇トレンド発生",description:"移動平均線の上昇トレンド形成により、価格の継続的な上昇が期待されるシグナルです。",icon:(0,a.jsx)(_.Z,{className:"h-4 w-4"}),color:"text-green-600"},下落トレンド注意:{title:"下落トレンド注意",description:"下落トレンドの兆候を検出したシグナルです。リスク管理を強化する必要があります。",icon:(0,a.jsx)(E.Z,{className:"h-4 w-4"}),color:"text-red-600"},出来高急増:{title:"出来高急増",description:"出来高が平均の2倍以上に急増したシグナルです。市場の関心が高まっている可能性があります。",icon:(0,a.jsx)(_.Z,{className:"h-4 w-4"}),color:"text-blue-600"},リスクリターン改善:{title:"リスクリターン改善",description:"シャープレシオの改善により、リスクに対するリターンが向上したシグナルです。",icon:(0,a.jsx)(_.Z,{className:"h-4 w-4"}),color:"text-purple-600"},テクニカルブレイクアウト:{title:"テクニカルブレイクアウト",description:"ボリンジャーバンドの上限を突破したテクニカルブレイクアウトシグナルです。",icon:(0,a.jsx)(_.Z,{className:"h-4 w-4"}),color:"text-orange-600"}}[t]||{title:t,description:"シグナルの詳細情報",icon:(0,a.jsx)(R.Z,{className:"h-4 w-4"}),color:"text-gray-600"};return(0,a.jsx)(P,{content:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:n.color,children:n.icon}),(0,a.jsx)("span",{className:"font-semibold",children:n.title})]}),(0,a.jsx)("p",{className:"text-gray-300 text-xs leading-relaxed",children:n.description})]}),children:s})}function U(e){let{confidence:t,children:s}=e,{level:n,color:r,description:l}=t>=.8?{level:"高",color:"text-green-400",description:"非常に信頼性の高いシグナル"}:t>=.6?{level:"中",color:"text-yellow-400",description:"信頼性の高いシグナル"}:{level:"低",color:"text-red-400",description:"信頼性の低いシグナル"};return(0,a.jsx)(P,{content:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)("span",{className:r,children:["信頼度: ",n]})}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:l}),(0,a.jsxs)("p",{className:"text-gray-400 text-xs",children:["数値: ",(100*t).toFixed(0),"%"]})]}),children:s})}var T=s(53834);function Z(e){let{symbol:t,name:s,recommendation:r,confidence:l,price:c,reason:i,expectedHoldingPeriod:o=30,riskLevel:d,category:m,historicalAccuracy:h=0,evidence:u,onActionClick:x}=e,[g,p]=(0,n.useState)(!1),[f,y]=(0,n.useState)(.25),b=e=>{try{window.open("/charts/".concat(e),"_blank","width=1200,height=800,scrollbars=yes,resizable=yes")}catch(t){console.error("チャート表示エラー:",t),window.open("https://finance.yahoo.com/quote/".concat(e),"_blank")}};return(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(()=>{switch(r){case"STRONG_BUY":case"BUY":return(0,a.jsx)(_.Z,{className:"h-5 w-5 text-green-600"});case"STRONG_SELL":case"SELL":return(0,a.jsx)(L.Z,{className:"h-5 w-5 text-red-600"});default:return(0,a.jsx)(C.Z,{className:"h-5 w-5 text-gray-500"})}})(),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:(0,T.LH)(t)}),s&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:s})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium border ".concat((()=>{switch(r){case"STRONG_BUY":return"bg-green-100 text-green-800 border-green-200";case"BUY":return"bg-green-50 text-green-700 border-green-100";case"STRONG_SELL":return"bg-red-100 text-red-800 border-red-200";case"SELL":return"bg-red-50 text-red-700 border-red-100";default:return"bg-gray-50 text-gray-700 border-gray-100"}})()),children:r}),(0,a.jsx)("button",{onClick:()=>p(!g),className:"text-blue-600 hover:text-blue-800 text-sm",children:g?"詳細を閉じる":"詳細を表示"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"現在価格"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["\xa5",c.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"信頼度"}),(0,a.jsx)(U,{confidence:l,children:(0,a.jsxs)("p",{className:"text-lg font-semibold ".concat(l>=.8?"text-green-600":l>=.6?"text-yellow-600":"text-red-600"," cursor-help"),children:[(100*l).toFixed(0),"%"]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"想定保有期間"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),o,"日"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"リスクレベル"}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs ".concat((()=>{switch(d){case"LOW":return"text-green-600 bg-green-50";case"MEDIUM":return"text-yellow-600 bg-yellow-50";case"HIGH":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}})()),children:[(0,a.jsx)(I.Z,{className:"h-3 w-3 mr-1"}),d]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4 inline mr-1"}),i]}),m&&(0,a.jsx)(D,{category:m,children:(0,a.jsxs)("p",{className:"text-xs text-blue-600 mt-1 cursor-help",children:["カテゴリ: ",m]})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(()=>{if("HOLD"===r)return(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)("button",{onClick:()=>null==x?void 0:x(t,"HOLD",0),className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"継続"})});let e="BUY"===r||"STRONG_BUY"===r,s=e?"買い":"売り";return(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>null==x?void 0:x(t,s,f),className:"px-3 py-1 text-sm text-white rounded-md ".concat(e?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:s}),(0,a.jsxs)("select",{value:f,onChange:e=>y(parseFloat(e.target.value)),className:"px-2 py-1 text-sm border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:.25,children:"25%"}),(0,a.jsx)("option",{value:.5,children:"50%"}),(0,a.jsx)("option",{value:.75,children:"75%"}),(0,a.jsx)("option",{value:1,children:"100%"})]})]})})(),(0,a.jsxs)("button",{className:"text-blue-600 hover:text-blue-800 text-sm flex items-center transition-colors duration-200",onClick:()=>b(t),children:[(0,a.jsx)(O.Z,{className:"h-4 w-4 mr-1"}),"チャート表示"]})]}),g&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(null==u?void 0:u.technical)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"テクニカル指標"}),(0,a.jsx)("div",{className:"space-y-1",children:u.technical.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-600",children:e.name}),(0,a.jsx)("span",{className:"買い"===e.signal?"text-green-600":"売り"===e.signal?"text-red-600":"text-gray-600",children:e.signal})]},t))})]}),(null==u?void 0:u.fundamental)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"ファンダメンタル"}),(0,a.jsx)("div",{className:"space-y-1",children:u.fundamental.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-600",children:e.name}),(0,a.jsx)("span",{className:"買い"===e.signal?"text-green-600":"売り"===e.signal?"text-red-600":"text-gray-600",children:e.signal})]},t))})]}),(null==u?void 0:u.sentiment)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"センチメント"}),(0,a.jsx)("div",{className:"space-y-1",children:u.sentiment.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-600",children:e.name}),(0,a.jsx)("span",{className:"買い"===e.signal?"text-green-600":"売り"===e.signal?"text-red-600":"text-gray-600",children:e.signal})]},t))})]})]}),h>0&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"過去の的中率"}),(0,a.jsxs)("span",{className:"text-lg font-semibold text-blue-600",children:[(100*h).toFixed(1),"%"]})]})})]})]})})}var B=s(41671),z=s(51817),A=s(82431);function Y(e){let{state:t,onRetry:s,onCancel:r,showProgress:l=!0,showRetryButton:c=!0,size:i="md",variant:o="default"}=e,[d,m]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(t.isLoading){let e=setInterval(()=>{m(e=>(e+1)%4)},500);return()=>clearInterval(e)}},[t.isLoading]);let h={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"},u=()=>t.error?t.error:t.retryCount>0?"".concat(t.message," (再試行 ").concat(t.retryCount,"/").concat(t.maxRetries,")"):t.message,x=()=>[".","..","...","...."][d],g=()=>t.error&&!t.isLoading?(0,a.jsx)("div",{className:"flex items-center justify-center text-red-500",children:(0,a.jsx)(E.Z,{className:"".concat(h[i]," mr-2")})}):t.isLoading||100!==t.progress?(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(z.Z,{className:"".concat(h[i]," animate-spin")})}):(0,a.jsx)("div",{className:"flex items-center justify-center text-green-500",children:(0,a.jsx)(B.Z,{className:"".concat(h[i]," mr-2")})});return"minimal"===o?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[g(),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[u(),t.isLoading&&x()]})]}):"overlay"===o?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full mx-4",children:(0,a.jsxs)("div",{className:"text-center",children:[g(),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:t.isLoading?"処理中...":t.error?"エラー":"完了"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[u(),t.isLoading&&x()]}),l&&t.isLoading&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(t.progress,"%")}})}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-gray-500",children:[t.progress,"% 完了"]})]}),(0,a.jsxs)("div",{className:"mt-6 flex space-x-3",children:[t.error&&c&&t.canRetry&&s&&(0,a.jsxs)("button",{onClick:s,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4 inline mr-2"}),"再試行"]}),r&&(0,a.jsx)("button",{onClick:r,className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition-colors",children:"キャンセル"})]})]})})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6",children:[g(),(0,a.jsxs)("div",{className:"mt-4 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.isLoading?"処理中...":t.error?"エラーが発生しました":"完了"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[u(),t.isLoading&&x()]})]}),l&&t.isLoading&&(0,a.jsxs)("div",{className:"mt-4 w-full max-w-xs",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(t.progress,"%")}})}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-gray-500 text-center",children:[t.progress,"% 完了"]})]}),t.error&&c&&t.canRetry&&s&&(0,a.jsxs)("button",{onClick:s,className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4 mr-2"}),"再試行 (",t.retryCount,"/",t.maxRetries,")"]})]})}var F=s(75395),G=s(62926);function H(e){let{error:t,errorCode:s,onRetry:r,onClearError:l,isUsingFallback:c=!1,analysisRequired:i=!1}=e,[o,d]=(0,n.useState)("unknown"),[m,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>{d(navigator.onLine?"online":"offline")};return e(),window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}},[]);let u=async()=>{if(r){h(!0);try{await r()}finally{h(!1)}}};return(0,a.jsx)("div",{className:"border rounded-lg p-4 ".concat(i?"bg-blue-50 border-blue-200 text-blue-800":c?"bg-yellow-50 border-yellow-200 text-yellow-800":"bg-red-50 border-red-200 text-red-800"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[i?(0,a.jsx)(E.Z,{className:"h-5 w-5"}):"offline"===o?(0,a.jsx)(F.Z,{className:"h-5 w-5"}):c?(0,a.jsx)(B.Z,{className:"h-5 w-5"}):(0,a.jsx)(E.Z,{className:"h-5 w-5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:i?"分析が必要です":c?"フォールバック表示中":"エラーが発生しました"}),(0,a.jsx)("div",{className:"text-sm mb-2",children:t}),(0,a.jsx)("div",{className:"text-xs opacity-75",children:i?"最新の投資判断を行うために、まず分析を実行してください。":"offline"===o?"インターネット接続を確認してください。":"API_ERROR"===s?"サーバーに一時的な問題が発生している可能性があります。":"NETWORK_ERROR"===s?"ネットワーク接続を確認してください。":"しばらく時間をおいてから再度お試しください。"}),"offline"===o&&(0,a.jsxs)("div",{className:"mt-2 text-xs flex items-center gap-1",children:[(0,a.jsx)(F.Z,{className:"h-3 w-3"}),"オフライン状態です"]}),i?(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsxs)("button",{onClick:()=>window.location.href="/",className:"bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 flex items-center gap-1",children:[(0,a.jsx)(O.Z,{className:"h-4 w-4"}),"分析実行へ"]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/reports",className:"bg-gray-600 text-white px-3 py-2 rounded text-sm hover:bg-gray-700 flex items-center gap-1",children:"過去の結果を確認"})]}):c?(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsxs)("button",{onClick:u,disabled:m,className:"bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-1",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 ".concat(m?"animate-spin":"")}),m?"再試行中...":"最新データを取得"]}),l&&(0,a.jsx)("button",{onClick:l,className:"bg-gray-600 text-white px-3 py-2 rounded text-sm hover:bg-gray-700",children:"前回の結果を表示"})]}):(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsxs)("button",{onClick:u,disabled:m,className:"bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 disabled:opacity-50 flex items-center gap-1",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 ".concat(m?"animate-spin":"")}),m?"再試行中...":"再試行"]}),"offline"===o&&(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"bg-gray-600 text-white px-3 py-2 rounded text-sm hover:bg-gray-700 flex items-center gap-1",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4"}),"ページを再読み込み"]})]})]})]})})}let J="force-dynamic";function W(){var e,t,c,L,C,I;!function(){let[e,t]=(0,n.useState)({isLoading:!0,error:null,summary:null,lastUpdated:null,freshness:"Unknown",topCandidates:[],holdingProposals:[],memo:""}),s=(0,n.useCallback)(()=>{try{let e=u(),s=localStorage.getItem(e)||"";t(e=>(0,l._)((0,r._)({},e),{memo:s}))}catch(e){}},[]),a=(0,n.useCallback)(e=>{try{let s=u();localStorage.setItem(s,e),t(t=>(0,l._)((0,r._)({},t),{memo:e}))}catch(e){}},[]),c=(0,n.useCallback)(async()=>{t(e=>(0,l._)((0,r._)({},e),{isLoading:!0,error:null}));try{let e=await i();!function(e){try{localStorage.setItem("today_summary",JSON.stringify(e)),localStorage.setItem("today_summary_timestamp",new Date().toISOString())}catch(e){console.warn("Failed to save to cache:",e)}}(e);let s=o()||e.generated_at||new Date().toISOString(),a=d(s),n=(e.candidates||[]).map(t=>{let{score:s,reasons:a}=m(t,e);return(0,l._)((0,r._)({},t),{routine_score:s,routine_reasons:a})}).sort((e,t)=>t.routine_score-e.routine_score).slice(0,5),c=h(e);t(t=>(0,l._)((0,r._)({},t),{isLoading:!1,summary:e,lastUpdated:s,freshness:a,topCandidates:n,holdingProposals:c}))}catch(s){let e=function(){try{let e=localStorage.getItem("today_summary");if(e)return JSON.parse(e)}catch(e){console.warn("Failed to get cached data:",e)}return null}();if(e){let s=o()||e.generated_at||null,a=d(s),n=(e.candidates||[]).map(t=>{let{score:s,reasons:a}=m(t,e);return(0,l._)((0,r._)({},t),{routine_score:s,routine_reasons:a})}).sort((e,t)=>t.routine_score-e.routine_score).slice(0,5),c=h(e);t(t=>(0,l._)((0,r._)({},t),{isLoading:!1,summary:e,lastUpdated:s,freshness:a,topCandidates:n,holdingProposals:c,error:"最新データの取得に失敗。キャッシュを表示中。"}))}else t(e=>(0,l._)((0,r._)({},e),{isLoading:!1,error:(null==s?void 0:s.message)||"データ取得に失敗しました"}))}},[]);(0,n.useEffect)(()=>{c(),s()},[c,s]);let x=(0,n.useMemo)(()=>e.freshness,[e.freshness]);(0,l._)((0,r._)({},e),{freshnessLabel:x,actions:{refresh:c,saveMemo:a,setMemo:e=>t(t=>(0,l._)((0,r._)({},t),{memo:e}))}})}();let O=function(){let[e,t]=(0,n.useState)({isLoading:!0,error:null,connectionStatus:null,lastUpdated:null,freshness:"Unknown",topCandidates:[],holdingProposals:[],memo:"",availableSymbols:[]}),a=(0,n.useCallback)(()=>{try{let e=y(),s=localStorage.getItem(e)||"";t(e=>(0,l._)((0,r._)({},e),{memo:s}))}catch(e){}},[]),c=(0,n.useCallback)(e=>{try{let s=y();localStorage.setItem(s,e),t(t=>(0,l._)((0,r._)({},t),{memo:e}))}catch(e){}},[]),i=(0,n.useCallback)(async()=>{t(e=>(0,l._)((0,r._)({},e),{isLoading:!0,error:null}));try{let e,a,n;console.log("JQuants接続テスト開始...");try{if(e=await (0,x.M7)(),t(t=>(0,l._)((0,r._)({},t),{connectionStatus:e})),!e.success){if(console.warn("API接続失敗、サンプルデータを使用します:",e.message),e.message.includes("静的サイトモード"))console.log("静的サイトモード: サンプルデータを使用します");else throw Error("API接続失敗: ".concat(e.message))}}catch(e){if(console.warn("接続テストエラー、サンプルデータを使用します:",e),e instanceof Error&&e.message.includes("静的サイトモード"))console.log("静的サイトモード: サンプルデータを使用します");else throw e}console.log("銘柄一覧取得中...");try{let{getAllSymbols:e}=await s.e(8381).then(s.bind(s,48381));a=await e(),console.log("全銘柄取得完了: ".concat(a.length,"件")),t(e=>(0,l._)((0,r._)({},e),{availableSymbols:a}))}catch(e){console.warn("銘柄一覧取得エラー、サンプルデータを使用します:",e),a=[{code:"7203",name:"トヨタ自動車"},{code:"6758",name:"ソニーグループ"},{code:"9984",name:"ソフトバンクグループ"},{code:"6861",name:"キーエンス"},{code:"4063",name:"信越化学工業"}],t(e=>(0,l._)((0,r._)({},e),{availableSymbols:a}))}console.log("株価分析実行中...");let c=await (0,g.getPopularSymbols)();try{n=await (0,g.analyzeMultipleStocks)(c),console.log("株価分析完了: ".concat(n.length,"件の結果"))}catch(e){console.warn("株価分析エラー、サンプルデータを使用します:",e),n=[]}if(0===n.length){console.warn("分析可能な株価データがありませんでした。サンプルデータを使用します。");let e=p(),s=w(e).sort((e,t)=>t.routine_score-e.routine_score).slice(0,5),a=b(),n=v(a,e),c=new Date().toISOString(),i=f(c);t(e=>(0,l._)((0,r._)({},e),{isLoading:!1,topCandidates:s,holdingProposals:n,lastUpdated:c,freshness:i,error:null})),console.log("サンプルデータで更新完了:",{candidates:s.length,holdings:n.length});return}let i=w(n).sort((e,t)=>t.routine_score-e.routine_score).slice(0,5),o=b(),d=v(o,n),m=new Date().toISOString(),h=f(m);t(e=>(0,l._)((0,r._)({},e),{isLoading:!1,topCandidates:i,holdingProposals:d,lastUpdated:m,freshness:h,error:null})),console.log("データ更新完了:",{candidates:i.length,holdings:d.length,symbols:a.length})}catch(e){console.error("データ取得エラー:",e);try{console.warn("エラーが発生しました。サンプルデータを使用します。");let s=p(),a=w(s).sort((e,t)=>t.routine_score-e.routine_score).slice(0,5),n=b(),c=v(n,s),i=new Date().toISOString(),o=f(i);t(t=>(0,l._)((0,r._)({},t),{isLoading:!1,topCandidates:a,holdingProposals:c,lastUpdated:i,freshness:o,error:"データ取得エラー: ".concat(e instanceof Error?e.message:"不明なエラー"," (サンプルデータを表示)")})),console.log("サンプルデータでエラー回復完了:",{candidates:a.length,holdings:c.length})}catch(s){console.error("サンプルデータ生成も失敗:",s),t(t=>(0,l._)((0,r._)({},t),{isLoading:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}))}}},[]);return(0,n.useEffect)(()=>{i(),a()},[i,a]),(0,l._)((0,r._)({},e),{actions:{refresh:i,saveMemo:c,setMemo:e=>t(t=>(0,l._)((0,r._)({},t),{memo:e}))}})}(),[R]=(0,n.useState)(Date.now()),[P,D]=(0,n.useState)([]),U=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],[t,a]=(0,n.useState)(null),[r,l]=(0,n.useState)(!1),[c,i]=(0,n.useState)(null),[o,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),u=(0,n.useRef)(!1),x=(0,n.useRef)(0),g=(0,n.useCallback)(async function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!u.current){u.current=!0,l(!0),i(null);try{if(t){let e=await N.X.get("today_summary");if(e){a(e),d(!0),h(e.lastUpdated);return}}if(e){console.log("実データモード: JQuantsデータを取得中...");try{let{analyzeMultipleStocks:e,getPopularSymbols:t}=await Promise.resolve().then(s.bind(s,39488)),n=await t(),r=await e(n.slice(0,5)),l={date:new Date().toISOString().split("T")[0],marketStatus:"open",topSignals:r.map(e=>{var t;return{symbol:e.symbol,action:"BUY"===e.recommendation?"buy":"SELL"===e.recommendation?"sell":"hold",confidence:e.confidence,price:e.currentPrice,change:e.priceChangePercent,reason:"テクニカル分析: ".concat("number"==typeof(null===(t=e.technicalIndicators)||void 0===t?void 0:t.rsi)?"RSI ".concat(e.technicalIndicators.rsi.toFixed(1)):"分析完了")}}),marketInsights:{trend:r.filter(e=>"BUY"===e.recommendation).length>r.filter(e=>"SELL"===e.recommendation).length?"bullish":"bearish",volatility:"medium",sentiment:r.reduce((e,t)=>e+t.confidence,0)/r.length},riskAssessment:{level:"medium",factors:["市場の不安定性","金利変動リスク"],recommendations:["分散投資の実施","リスク管理の徹底"]},lastUpdated:new Date().toISOString()};a(l),d(!1),h(l.lastUpdated),await N.X.set("today_summary",l,{ttl:3e5,tags:["today","summary","real_data"],priority:.9}),console.log("実データ取得完了:",l.topSignals.length,"件のシグナル");return}catch(e){console.warn("実データ取得失敗、モックデータを使用:",e)}}console.log("モックデータを使用（API呼び出し無効化）");let n={date:new Date().toISOString().split("T")[0],marketStatus:"open",topSignals:[{symbol:"7203",action:"buy",confidence:.85,price:2500,change:2.5,reason:"テクニカル分析で上昇トレンドを確認"},{symbol:"6758",action:"sell",confidence:.72,price:1800,change:-1.2,reason:"利益確定のタイミング"}],marketInsights:{trend:"bullish",volatility:"medium",sentiment:.7},riskAssessment:{level:"medium",factors:["市場の不安定性","金利変動リスク"],recommendations:["分散投資の実施","リスク管理の徹底"]},lastUpdated:new Date().toISOString()};a(n),d(!1),h(n.lastUpdated),await N.X.set("today_summary",n,{ttl:3e5,tags:["today","summary"],priority:.9})}catch(t){let e={operation:"fetchTodayData",component:"TodayPage",timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href};await S.handleError(t,e),console.warn("データ取得エラー、モックデータを使用:",t),x.current+=1}finally{l(!1),u.current=!1}}},[]),p=(0,n.useCallback)(()=>{x.current<3&&g(!1)},[g]),f=(0,n.useCallback)(()=>{x.current=0,g(!1)},[g]);return(0,n.useEffect)(()=>{g(!0)},[]),{data:t,loading:r,error:c,fromCache:o,retry:p,refresh:f,lastUpdated:m}}(!0),{fallbackData:z,fallbackTimestamp:F,saveFallbackData:G}=function(){let[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)(null),r=(0,n.useCallback)(e=>{t(e),a(Date.now());try{localStorage.setItem("today_fallback_data",JSON.stringify(e)),localStorage.setItem("today_fallback_timestamp",Date.now().toString())}catch(e){console.warn("Failed to save fallback data to localStorage:",e)}},[]),l=(0,n.useCallback)(()=>{try{let e=localStorage.getItem("today_fallback_data"),s=localStorage.getItem("today_fallback_timestamp");if(e&&s){let n=JSON.parse(e),r=parseInt(s);t(n),a(r)}}catch(e){console.warn("Failed to load fallback data from localStorage:",e)}},[]);return(0,n.useEffect)(()=>{l()},[l]),{fallbackData:e,fallbackTimestamp:s,saveFallbackData:r,loadFallbackData:l}}(),J=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,s]=(0,n.useState)([]),[a,r]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null),h=(0,n.useCallback)(()=>{try{let e=localStorage.getItem(j);if(e){let t=JSON.parse(e),s=new Date(t.timestamp);if((new Date().getTime()-s.getTime())/36e5<6)return t.signals}}catch(e){console.warn("キャッシュデータの読み込みに失敗:",e)}return null},[]),u=(0,n.useCallback)(e=>{try{let t={signals:e,timestamp:new Date().toISOString()};localStorage.setItem(j,JSON.stringify(t))}catch(e){console.warn("キャッシュデータの保存に失敗:",e)}},[]),x=(0,n.useCallback)(()=>{let t=["上昇トレンド発生","下落トレンド注意","出来高急増","リスクリターン改善","テクニカルブレイクアウト"],s=["BUY","SELL","HOLD"];return(e.length>0?e:["7203.T","6758.T","9984.T"]).map(e=>({symbol:e,signal_type:s[Math.floor(Math.random()*s.length)],confidence:.4*Math.random()+.6,price:1e3+2e3*Math.random(),timestamp:new Date().toISOString(),reason:"".concat(t[Math.floor(Math.random()*t.length)],"によるシグナル"),category:t[Math.floor(Math.random()*t.length)],expected_holding_period:30}))},[e]),g=(0,n.useCallback)(async()=>{r(!0),c(null),o(!1);try{let e=h();if(e)s(e),o(!1),c(null),m(new Date);else{let e=x();s(e),o(!1),c(null),m(new Date),u(e)}}catch(t){console.error("シグナル取得エラー:",t);let e=h();if(e)s(e),o(!1),c(null),m(new Date);else{let e=x();s(e),o(!1),c(null),m(new Date),u(e)}}finally{r(!1)}},[]),p=(0,n.useCallback)(()=>{c(null),o(!1)},[]);return(0,n.useEffect)(()=>{g()},[]),{signals:t,loading:a,error:l,isUsingFallback:i,lastUpdate:d,refresh:g,clearError:p}}((0,n.useMemo)(()=>O.topCandidates.map(e=>e.symbol),[O.topCandidates]));(0,n.useEffect)(()=>{"notification"===new URLSearchParams(window.location.search).get("from")&&setTimeout(()=>{let e=document.querySelector('[data-highlight="true"]');e&&e.scrollIntoView({behavior:"smooth",block:"center"})},800)},[]);let W=(0,n.useCallback)(e=>{D(t=>t.includes(e)?t:[...t,e])},[D]);if((0,n.useEffect)(()=>{U.data&&G(U.data)},[U.data,G]),O.isLoading)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,a.jsx)(Y,{state:{isLoading:!0,progress:50,message:"JQuantsデータを分析中...",canRetry:!1,retryCount:0,maxRetries:3},variant:"default",showProgress:!0}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-4 animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-3"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-2/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},t))})]})});let K=Math.max(0,300-Math.floor((Date.now()-R)/1e3));return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-md mx-auto px-4 py-4 md:max-w-3xl",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg",children:(0,a.jsx)(M.Z,{className:"h-6 w-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"今日のタスク"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"5分で完了する投資判断"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.floor(K/60),":",(K%60).toString().padStart(2,"0")]})]})]})})}),(0,a.jsxs)("div",{className:"w-full max-w-md mx-auto px-4 py-4 md:max-w-3xl",children:[O.connectionStatus&&(0,a.jsx)("div",{className:"mb-4 p-3 rounded-lg border ".concat(O.connectionStatus.success?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),role:"status","aria-live":"polite",children:(0,a.jsxs)("div",{className:"flex items-center",children:[O.connectionStatus.success?(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["JQuants API: ",O.connectionStatus.message]})]})}),(null===(t=O.connectionStatus)||void 0===t?void 0:null===(e=t.message)||void 0===e?void 0:e.includes("静的サイトモード"))&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md text-blue-800 text-sm",children:["実データに切り替えるには、URL に ",(0,a.jsx)("code",{children:"?forceReal=1"})," を付与するか、",(0,a.jsx)("code",{children:"NEXT_PUBLIC_FORCE_REAL_API=true"})," を ",(0,a.jsx)("code",{children:".env.local"})," に設定してください。"]}),(O.error||J.error)&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(H,{error:O.error||J.error||"",errorCode:(null===(c=J.error)||void 0===c?void 0:c.includes("分析を実行してから"))?"ANALYSIS_REQUIRED":(null===(L=J.error)||void 0===L?void 0:L.includes("ネットワーク"))?"NETWORK_ERROR":"API_ERROR",onRetry:()=>{var e;(null===(e=O.actions)||void 0===e?void 0:e.refresh)&&O.actions.refresh(),J.refresh&&J.refresh()},onClearError:J.clearError,isUsingFallback:J.isUsingFallback,analysisRequired:(null===(C=J.error)||void 0===C?void 0:C.includes("分析を実行してから"))||(null===(I=O.error)||void 0===I?void 0:I.includes("分析を実行してから"))})}),(0,a.jsx)("section",{className:"mb-6","aria-label":"データ更新状況",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"最終更新"}),(0,a.jsx)("p",{className:"text-base font-semibold text-gray-900",children:O.lastUpdated?new Date(O.lastUpdated).toLocaleString("ja-JP"):"—"}),O.availableSymbols.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["利用可能銘柄: ",O.availableSymbols.length,"件"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat("Fresh"===O.freshness?"bg-green-100 text-green-800":"Stale"===O.freshness?"bg-red-100 text-red-800":"bg-gray-100 text-gray-700"),children:["Fresh"===O.freshness?(0,a.jsx)(B.Z,{className:"h-4 w-4 mr-1"}):"Stale"===O.freshness?(0,a.jsx)(E.Z,{className:"h-4 w-4 mr-1"}):null,O.freshness]}),(0,a.jsxs)("button",{className:"bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700 flex items-center space-x-1",onClick:O.actions.refresh,disabled:O.isLoading,children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 ".concat(O.isLoading?"animate-spin":"")}),(0,a.jsx)("span",{children:O.isLoading?"更新中":"更新"})]})]})]})}),(0,a.jsxs)("section",{className:"mb-6","aria-label":"上位候補",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"今日の投資指示"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.Z,{className:"h-5 w-5 text-green-600"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[O.topCandidates.length,"件の候補"]}),(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded",children:"実データ"})]})]}),0===O.topCandidates.length?(0,a.jsx)("div",{className:"bg-white rounded-xl border p-4 text-gray-600 text-sm",children:O.isLoading?"分析中...":"該当候補がありません"}):(0,a.jsx)("div",{className:"space-y-4",children:O.topCandidates.map(e=>{var t;return(0,a.jsx)(Z,{symbol:e.symbol,name:e.name,recommendation:e.recommendation,confidence:null!==(t=e.confidence)&&void 0!==t?t:.5,price:"currentPrice"in e?e.currentPrice:1e3,reason:e.routine_reasons.join(", ")||"スコア上位",expectedHoldingPeriod:30,riskLevel:"riskLevel"in e?e.riskLevel:"MEDIUM",category:"テクニカル分析",historicalAccuracy:0,evidence:{technical:[{name:"推奨",value:"STRONG_BUY"===e.recommendation?100:"BUY"===e.recommendation?80:50,signal:"買い"},{name:"信頼度",value:Math.round(100*e.confidence),signal:"中立"},..."priceChangePercent"in e?[{name:"前日比",value:e.priceChangePercent,signal:e.priceChangePercent>0?"買い":"売り"}]:[]],fundamental:[],sentiment:[]},onActionClick:(e,t,s)=>{console.log("".concat(e,": ").concat(t," ").concat(100*s,"%")),W(e)}},e.symbol)})})]}),(0,a.jsxs)("section",{className:"mb-6","aria-label":"保有銘柄アクション",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"保有中の提案"}),0===O.holdingProposals.length?(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-4 text-sm text-gray-600",children:["保有銘柄が見つかりません",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"※ localStorage の portfolio_symbols に銘柄コードを設定してください"})]}):(0,a.jsx)("div",{className:"space-y-3",children:O.holdingProposals.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-xl border p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-semibold text-gray-900",children:[(0,T.LH)(e.symbol),e.name&&e.name!==e.symbol&&(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:["(",e.name,")"]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.reason}),"currentPrice"in e&&e.currentPrice>0&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["現在価格: \xa5",e.currentPrice.toLocaleString(),0!==e.priceChange&&(0,a.jsxs)("span",{className:"ml-2 ".concat(e.priceChange>0?"text-green-600":"text-red-600"),children:["(",e.priceChange>0?"+":"",e.priceChange.toFixed(0),")"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"inline-block text-xs px-2 py-1 rounded mr-2 ".concat("継続"===e.proposal?"bg-blue-100 text-blue-800":"利確"===e.proposal?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.proposal}),e.qtyOptions.map(e=>(0,a.jsxs)("button",{className:"ml-1 bg-gray-100 px-2 py-1 rounded text-xs hover:bg-gray-200",children:[Math.round(100*e),"%"]},e))]})]})},e.symbol))})]}),(0,a.jsxs)("section",{className:"mb-8","aria-label":"本日のメモ",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"今日のメモ"}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-3 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:O.memo,onChange:e=>O.actions.setMemo(e.target.value),placeholder:"本日の決定を1行で記録（ローカル保存）",className:"flex-1 outline-none text-sm"}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700",onClick:()=>O.actions.saveMemo(O.memo),children:"保存"})]})]}),(0,a.jsxs)("section",{className:"mb-8","aria-label":"シグナル履歴",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"シグナル履歴"}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsx)("p",{className:"text-gray-600",children:"シグナル履歴機能は一時的に無効化されています。"})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"進捗状況"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[P.length,"/5 完了"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(P.length/5*100,"%")}})})]}),(0,a.jsx)("div",{className:"text-center text-xs text-gray-500 pb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"5分で完了・上下スクロールのみで完結"})]})})]})]})}},25493:function(e,t,s){"use strict";s.d(t,{Bt:function(){return d},ER:function(){return c},rK:function(){return o}}),s(85583),s(1780);var a=s(94076),n=s(73268);function r(e,t){try{localStorage.setItem(e,JSON.stringify({v:t,t:Date.now()}))}catch(e){}}function l(e,t){try{let s=localStorage.getItem(e);if(!s)return null;let{v:a,t:n}=JSON.parse(s);if(t&&Date.now()-n>t)return null;return a}catch(e){return null}}async function c(){let e="latest:index",t=l(e,216e5);if(t)return i().then(t=>{t&&r(e,t)}).catch(()=>{}),t;let s=await i();return s&&r(e,s),s}async function i(){let e=[...new Set(["/data/latest/index.json",(0,n.resolveStaticPath)("/data/latest/index.json")])];for(let t=0;t<e.length;t++){let s=e[t];console.log("Trying URL ".concat(t+1,"/").concat(e.length,": ").concat(s));try{let{data:e,fromCache:n}=await (0,a.Q8)(s,{cacheKey:"latest:index:attempt_".concat(t),cacheTtlMs:6e5,timeout:6e3,retries:1,retryDelay:500});return console.log("Success with URL: ".concat(s)),e}catch(a){if(console.warn("URL ".concat(t+1," failed: ").concat(s),a),t===e.length-1)return console.error("All URLs failed, returning fallback data"),{latest:"20250930",dates:["20250930"]}}}throw Error("Unexpected error in fetchLatestIndexWithFallback")}function o(e,t){if(!t||!t.latest||!Array.isArray(t.dates))return console.warn("Invalid index data, using fallback date"),"20250930";if(e&&"string"==typeof e&&"undefined"!==e&&t.dates.includes(e))return e;let s=(e&&"undefined"!==e?t.dates.find(t=>t<=e):t.latest)||t.latest;return console.log("resolveBusinessDate: target=".concat(e,", result=").concat(s)),s}async function d(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttlMs:n=36e5,timeoutMs:c=6e3,retries:i=3,retryDelay:o=800}=s,d=l("swr:".concat(e),n);if(d)return(0,a.Q8)(t,{cacheKey:"swr:".concat(e),cacheTtlMs:n,timeout:c,retries:i,retryDelay:o}).then(t=>{let{data:s,fromCache:a}=t;a||r("swr:".concat(e),s)}).catch(()=>{}),{data:d,fromCache:!0};let{data:m,fromCache:h}=await (0,a.Q8)(t,{cacheKey:"swr:".concat(e),cacheTtlMs:n,timeout:c,retries:i,retryDelay:o});return h||r("swr:".concat(e),m),{data:m,fromCache:h}}function m(){try{let e=Object.keys(localStorage),t=[/^latest:index/,/^swr:latest:index/,/^today:summary/,/^personal:dashboard/];["latest:index","latest:index:primary","latest:index:fallback","latest:index:attempt_0","latest:index:attempt_1","today:summary","personal:dashboard"].forEach(e=>{localStorage.removeItem(e),localStorage.removeItem("swr:".concat(e))}),e.forEach(e=>{t.some(t=>t.test(e))&&localStorage.removeItem(e)}),localStorage.setItem("cache_cleared_at",new Date().toISOString()),console.log("Data cache cleared successfully")}catch(e){console.warn("Failed to clear data cache:",e)}}{let e="2.24.1",t=localStorage.getItem("app_version");t!==e&&(console.log("App version changed from ".concat(t," to ").concat(e,", clearing cache")),m(),localStorage.setItem("app_version",e)),window.clearDataCache=m,window.getLatestIndex=c,window.resolveStaticPath=s(73268).resolveStaticPath,window.APP_VERSION=e}},73268:function(e,t,s){"use strict";function a(e){return/^(?:https?:)?\/\//i.test(e)||e.startsWith("data:")?(console.debug("resolveStaticPath: Absolute URL, returning as-is: ".concat(e)),e):(console.debug("resolveStaticPath: No base path, returning: ".concat(e)),e)}s.d(t,{resolveStaticPath:function(){return a}})},53834:function(e,t,s){"use strict";function a(e){if(!e)return"";let t=e.trim();return/^[A-Za-z]\d{4}$/.test(t)?t.toUpperCase():/^\d+$/.test(t)&&5===t.length&&t.startsWith("0")?t.substring(1):t}function n(e){if(!e)return"";let t=e.trim();return/^[A-Za-z]\d{4}$/.test(t)?t.toUpperCase():/^\d{5}$/.test(t)&&t.startsWith("0")?t.substring(1):(/^\d{4}$/.test(t),t)}function r(e){if(!e)return null;let t=a(e);return/^\d{4}$/.test(t)?t:null}s.d(t,{G$:function(){return a},LH:function(){return n},To:function(){return r}})},75465:function(e,t,s){"use strict";s.d(t,{X:function(){return l}});var a=s(85583),n=s(1780);class r{async get(e){let t=this.cache.get(e);return t?this.isExpired(t)?(this.delete(e),this.stats.misses++,null):(t.timestamp=Date.now(),this.stats.hits++,t.data):(this.stats.misses++,null)}async set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttl:a=3e5,tags:n=[],priority:r=.5,maxSize:l=1048576,compression:c=!1}=s,i=t,o=JSON.stringify(t),d=new Blob([o]).size;if(c&&d>1024&&(d=new Blob([o=JSON.stringify(i=await this.compress(t))]).size,this.stats.compressions++),d>l){console.warn("Cache entry ".concat(e," exceeds maximum size limit"));return}this.currentSize+d>this.maxSize&&await this.evictLeastPriority();let m={data:i,timestamp:Date.now(),ttl:a,tags:n,priority:r,size:d};this.cache.set(e,m),this.currentSize+=d,this.stats.sets++}async delete(e){let t=this.cache.get(e);return!!t&&(this.currentSize-=t.size,this.stats.deletes++,this.cache.delete(e))}async clearByTags(e){let t=0;for(let[s,a]of this.cache.entries())e.some(e=>a.tags.includes(e))&&(this.currentSize-=a.size,this.cache.delete(s),t++);return t}async clear(){this.cache.clear(),this.currentSize=0}getStats(){let e=this.stats.hits+this.stats.misses,t=e>0?this.stats.hits/e:0;return{size:this.currentSize,count:this.cache.size,maxSize:this.maxSize,hitRate:Math.round(100*t)/100,hits:this.stats.hits,misses:this.stats.misses,sets:this.stats.sets,deletes:this.stats.deletes,compressions:this.stats.compressions}}isExpired(e){return Date.now()-e.timestamp>e.ttl}async evictLeastPriority(){let e=Array.from(this.cache.entries());e.sort((e,t)=>e[1].priority-t[1].priority);let[t,s]=e[0];this.currentSize-=s.size,this.cache.delete(t)}startCleanup(){this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4)}cleanup(){let e=Date.now();for(let[t,s]of this.cache.entries())e-s.timestamp>s.ttl&&(this.currentSize-=s.size,this.cache.delete(t))}async cachePrediction(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.set(e,t,(0,n._)((0,a._)({},s),{tags:[...s.tags||[],"prediction"],ttl:s.ttl||864e5}))}async getCachedPrediction(e){return await this.get(e)}async cacheModelComparison(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.set(e,t,(0,n._)((0,a._)({},s),{tags:[...s.tags||[],"modelComparison"],ttl:s.ttl||864e5}))}async getCachedModelComparison(e){return await this.get(e)}async compress(e){return e}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.cache.clear(),this.currentSize=0}constructor(){this.cache=new Map,this.maxSize=52428800,this.currentSize=0,this.cleanupInterval=null,this.stats={hits:0,misses:0,sets:0,deletes:0,compressions:0},this.startCleanup()}}let l=new r}},function(e){e.O(0,[1216,9488,963,1744],function(){return e(e.s=22725)}),_N_E=e.O()}]);