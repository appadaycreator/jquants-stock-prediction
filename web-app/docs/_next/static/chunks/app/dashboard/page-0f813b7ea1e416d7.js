(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6417:function(e,t,s){Promise.resolve().then(s.bind(s,5332))},5332:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eD},dynamic:function(){return eR}});var a,r,n=s(7437),i=s(2265),l=s(660),c=s(166),o=s(3959),d=s(5583),m=s(1780),x=s(1959),h=s(9488),u=s(6865),g=s(1671),p=s(6215),f=s(8896),y=s(4822),j=s(525),b=s(91),v=s(2489),N=s(4076);class w{static getInstance(e){return w.instance||(w.instance=new w(e)),w.instance}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4),c=r||this.config.defaultTtlMinutes;l<=this.config.freshThresholdMinutes?(t="fresh",s=!0):(t=l<=this.config.staleThresholdMinutes?"stale":l<=this.config.expiredThresholdMinutes?"stale":"expired",s=!1),l>c&&(t="expired",s=!1),"api"===a&&(t="fresh",s=!0);let o=new Date(i.getTime()+6e4*c);return{isFresh:s,lastUpdated:i,ageMinutes:l,cacheStatus:t,source:a,ttlMinutes:c,nextRefresh:o}}getFreshnessFromCacheMeta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache";return e.exists&&e.timestamp?this.getFreshnessInfo(e.timestamp,t,e.ttl):null}getCombinedFreshnessInfo(e){if(0===e.length)return{overallStatus:"all_expired",oldestData:null,freshCount:0,staleCount:0,expiredCount:0,totalCount:0};let t=e.filter(e=>e.isFresh).length,s=e.filter(e=>"stale"===e.cacheStatus).length,a=e.filter(e=>"expired"===e.cacheStatus).length,r=e.length;return{overallStatus:t===r?"all_fresh":a===r?"all_expired":s===r?"all_stale":"mixed",oldestData:e.reduce((e,t)=>t.ageMinutes>e.ageMinutes?t:e),freshCount:t,staleCount:s,expiredCount:a,totalCount:r}}getFreshnessBadgeStyle(e){switch(e){case"fresh":return{className:"bg-green-100 text-green-800 border-green-200",icon:"✓",text:"Fresh",color:"green"};case"stale":return{className:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"⚠",text:"Stale",color:"yellow"};case"expired":return{className:"bg-red-100 text-red-800 border-red-200",icon:"✗",text:"Expired",color:"red"};default:return{className:"bg-gray-100 text-gray-800 border-gray-200",icon:"?",text:"Unknown",color:"gray"}}}getRelativeTimeString(e){return e<1?"たった今":e<60?"".concat(e,"分前"):e<1440?"".concat(Math.floor(e/60),"時間前"):"".concat(Math.floor(e/1440),"日前")}getNextRefreshString(e){let t=new Date,s=Math.floor((e.getTime()-t.getTime())/6e4);return s<=0?"更新が必要":s<60?"".concat(s,"分後に更新"):"".concat(Math.floor(s/60),"時間後に更新")}constructor(e){this.config=(0,d._)({freshThresholdMinutes:15,staleThresholdMinutes:60,expiredThresholdMinutes:240,defaultTtlMinutes:60},e)}}let S=w.getInstance();var k=s(1723),_=s(9388),T=s(6744);class E{static getInstance(){return E.instance||(E.instance=new E),E.instance}registerDataSource(e,t,s,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"api",n=arguments.length>5?arguments[5]:void 0;this.dataSources.set(e,{id:e,name:t,lastUpdated:s,ttlMinutes:a,source:r,refreshCallback:n}),n&&this.refreshCallbacks.set(e,n)}registerRefreshCallback(e,t){this.refreshCallbacks.set(e,t)}getFreshnessInfo(e){let t,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"api",r=arguments.length>2?arguments[2]:void 0,n=new Date,i=new Date(e),l=Math.floor((n.getTime()-i.getTime())/6e4);return r?l<.5*r?t="fresh":l<r?(t="stale",s=new Date(i.getTime()+6e4*r)):t="expired":t=l<5?"fresh":l<30?"stale":"expired",{dataSourceId:"unknown",dataSourceName:"Unknown",lastUpdated:i,cacheStatus:t,ageMinutes:l,ttlMinutes:r,nextRefresh:s,source:a}}getDataSourceFreshnessInfo(e){let t=this.dataSources.get(e);return t?this.getFreshnessInfo(t.lastUpdated,t.source,t.ttlMinutes):null}getAllFreshnessInfo(){let e=new Map;return this.dataSources.forEach((t,s)=>{let a=this.getDataSourceFreshnessInfo(s);a&&(a.dataSourceId=s,a.dataSourceName=t.name,e.set(s,a))}),e}getSystemHealth(){let e=new Date,t=[],s=0,a=0;return this.dataSources.forEach(e=>{let r=this.getDataSourceFreshnessInfo(e.id);if(r)switch(r.cacheStatus){case"expired":s++,t.push("".concat(e.name,": データが期限切れ"));break;case"stale":a++}}),{status:s>0?"critical":a>0?"warning":"healthy",activeSources:this.dataSources.size,totalSources:this.dataSources.size,issues:t,lastChecked:e}}async refreshDataSource(e){let t=this.refreshCallbacks.get(e);t&&await t();let s=this.dataSources.get(e);s&&(s.lastUpdated=new Date,this.dataSources.set(e,s))}async refreshAllDataSources(){let e=[];this.refreshCallbacks.forEach(t=>{e.push(t())}),await Promise.all(e),this.dataSources.forEach((e,t)=>{e.lastUpdated=new Date,this.dataSources.set(t,e)})}removeDataSource(e){this.dataSources.delete(e),this.refreshCallbacks.delete(e)}clearAllDataSources(){this.dataSources.clear(),this.refreshCallbacks.clear()}getDataSources(){return Array.from(this.dataSources.values())}getDataSourceCount(){return this.dataSources.size}constructor(){this.dataSources=new Map,this.refreshCallbacks=new Map}}var C=e=>{let t,s,a,{className:r="",showRefreshButton:l=!0,onRefresh:c,freshnessInfos:o,onRefreshAll:d}=e,[m,x]=(0,i.useState)(new Map),[h,p]=(0,i.useState)(null),[f,y]=(0,i.useState)(!1),[j,v]=(0,i.useState)(null),N=E.getInstance();(0,i.useEffect)(()=>{let e=()=>{x(N.getAllFreshnessInfo()),p(N.getSystemHealth()),v(new Date)};e();let t=setInterval(e,3e4);return()=>{clearInterval(t)}},[N]);let w=async()=>{if(!f)try{y(!0),d?await d():c?await c():await N.refreshAllDataSources(),v(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{y(!1)}},S=(t=0,s=0,a=0,m.forEach(e=>{switch(e.cacheStatus){case"fresh":t++;break;case"stale":s++;break;case"expired":a++}}),{freshCount:t,staleCount:s,expiredCount:a});return m.size,(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(r),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(b.Z,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"データ鮮度サマリー"})]}),l&&(0,n.jsx)("button",{onClick:w,disabled:f,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(f?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(T.Z,{className:"h-4 w-4 ".concat(f?"animate-spin":"")})})]}),h&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(()=>{if(!h)return(0,n.jsx)(k.Z,{className:"h-4 w-4"});switch(h.status){case"healthy":return(0,n.jsx)(g.Z,{className:"h-4 w-4 text-green-600"});case"warning":return(0,n.jsx)(u.Z,{className:"h-4 w-4 text-yellow-600"});case"critical":return(0,n.jsx)(_.Z,{className:"h-4 w-4 text-red-600"});default:return(0,n.jsx)(k.Z,{className:"h-4 w-4"})}})(),(0,n.jsx)("span",{className:"text-sm font-medium ".concat((()=>{if(!h)return"text-gray-600";switch(h.status){case"healthy":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}})()),children:h.status.toUpperCase()}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",h.activeSources,"/",h.totalSources," アクティブ)"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,n.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(g.Z,{className:"h-4 w-4 text-green-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-green-600",children:S.freshCount})]}),(0,n.jsx)("div",{className:"text-xs text-green-700 dark:text-green-300",children:"フレッシュ"})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(u.Z,{className:"h-4 w-4 text-yellow-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-yellow-600",children:S.staleCount})]}),(0,n.jsx)("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"ステール"})]}),(0,n.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[(0,n.jsx)(_.Z,{className:"h-4 w-4 text-red-600"}),(0,n.jsx)("span",{className:"text-lg font-bold text-red-600",children:S.expiredCount})]}),(0,n.jsx)("div",{className:"text-xs text-red-700 dark:text-red-300",children:"期限切れ"})]})]}),j&&(0,n.jsxs)("div",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400 text-center",children:["最終更新: ",j.toLocaleTimeString()]}),h&&h.issues.length>0&&(0,n.jsxs)("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,n.jsx)(_.Z,{className:"h-3 w-3 text-red-600"}),(0,n.jsxs)("span",{className:"text-xs font-medium text-red-800 dark:text-red-200",children:[h.issues.length,"件の問題"]})]}),(0,n.jsxs)("div",{className:"text-xs text-red-700 dark:text-red-300",children:[h.issues[0],h.issues.length>1&&" 他".concat(h.issues.length-1,"件")]})]})]})},R=e=>{let{className:t="",showDetails:s=!0,showStats:a=!0,freshnessInfos:r,onRefreshAll:l}=e,[c,o]=(0,i.useState)({totalItems:0,totalSize:0,hitRate:0,missRate:0,lastCleanup:new Date}),[d,m]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=()=>{try{let e=Object.keys(localStorage).filter(e=>e.startsWith("stock_")||e.startsWith("cache_")),t=0,s=[];e.forEach(e=>{let a=localStorage.getItem(e);if(a){let r=new Blob([a]).size;t+=r;try{let t=JSON.parse(a),n=t.timestamp?new Date(t.timestamp):new Date,i=t.ttl||36e5,l=Date.now()-n.getTime()>i;s.push({key:e,size:r,lastAccessed:n,ttl:i,isExpired:l})}catch(e){}}}),o({totalItems:e.length,totalSize:t,hitRate:.85,missRate:.15,lastCleanup:new Date}),m(s)}catch(e){console.error("キャッシュ統計取得エラー:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]);let x=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},h=e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4),s=Math.floor(t/60);return t<1?"たった今":t<60?"".concat(t,"分前"):s<24?"".concat(s,"時間前"):"".concat(Math.floor(s/24),"日前")};return(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(b.Z,{className:"h-5 w-5 text-blue-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"キャッシュ可視化"})]}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200",title:"キャッシュを更新",children:(0,n.jsx)(T.Z,{className:"h-4 w-4"})})]}),a&&(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.totalItems}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総アイテム数"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:x(c.totalSize)}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"総サイズ"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-yellow-600",children:[(100*c.hitRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ヒット率"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-red-600",children:[(100*c.missRate).toFixed(1),"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"ミス率"})]})]}),s&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("h4",{className:"text-md font-medium text-gray-900 dark:text-white",children:"キャッシュアイテム一覧"}),0===d.length?(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,n.jsx)(b.Z,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,n.jsx)("p",{children:"キャッシュアイテムがありません"})]}):(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(e.isExpired?"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-700"),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:e.isExpired?(0,n.jsx)(_.Z,{className:"h-4 w-4 text-red-600"}):(0,n.jsx)(g.Z,{className:"h-4 w-4 text-green-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:e.key}),(0,n.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[x(e.size)," • ",h(e.lastAccessed)]})]})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.isExpired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.isExpired?"期限切れ":"有効"})})]},t))})]})]})},M=s(1239),I=s(9076),D=e=>{let{onRefresh:t,onForceRefresh:s,onRecalculate:a,onRecompute:r,isLoading:l=!1,lastUpdated:c,lastRefresh:o,showLastUpdated:d=!0,showLastRefresh:m=!0,variant:x="default",size:h="md",showProgress:u=!1,refreshInterval:p,className:f=""}=e,[y,j]=(0,i.useState)(!1),[b,v]=(0,i.useState)(!1),[N,w]=(0,i.useState)(!1),[S,_]=(0,i.useState)(null),E=async()=>{if(!y&&t)try{j(!0),await t(),_(new Date)}catch(e){console.error("リフレッシュエラー:",e)}finally{j(!1)}},C=async()=>{if(!b&&s)try{v(!0),await s(),_(new Date)}catch(e){console.error("強制リフレッシュエラー:",e)}finally{v(!1)}},R=async()=>{if(!N&&a)try{w(!0),await a(),_(new Date)}catch(e){console.error("再計算エラー:",e)}finally{w(!1)}},D=e=>{let t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4),r=Math.floor(a/60);return a<1?"たった今":a<60?"".concat(a,"分前"):r<24?"".concat(r,"時間前"):"".concat(Math.floor(r/24),"日前")};return"compact"===x?(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsx)("button",{onClick:E,disabled:y||l,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),title:"データを更新",children:(0,n.jsx)(T.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")})}),d&&c&&(0,n.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:D(c)})]}):"full"===x?(0,n.jsxs)("div",{className:"space-y-3 ".concat(f),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)("button",{onClick:E,disabled:y||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(T.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),s&&(0,n.jsxs)("button",{onClick:C,disabled:b||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-yellow-600 text-white hover:bg-yellow-700 transition-colors duration-200 ".concat(b||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(M.Z,{className:"h-4 w-4 ".concat(b?"animate-pulse":"")}),(0,n.jsx)("span",{children:b?"強制更新中...":"強制更新"})]}),a&&(0,n.jsxs)("button",{onClick:R,disabled:N||l,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 ".concat(N||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(I.Z,{className:"h-4 w-4 ".concat(N?"animate-spin":"")}),(0,n.jsx)("span",{children:N?"再計算中...":"再計算"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[d&&c&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(k.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["最終更新: ",D(c)]})]}),o&&(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)(g.Z,{className:"h-4 w-4 text-green-600"}),(0,n.jsxs)("span",{children:["更新完了: ",D(o)]})]})]})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2 ".concat(f),children:[(0,n.jsxs)("button",{onClick:E,disabled:y||l,className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 ".concat(y||l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)(T.Z,{className:"h-4 w-4 ".concat(y?"animate-spin":"")}),(0,n.jsx)("span",{children:y?"更新中...":"更新"})]}),d&&c&&(0,n.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:D(c)})]})},L=s(8071);class A{initializeMonitoring(){if("PerformanceObserver"in window){let e=new PerformanceObserver(e=>{for(let t of e.getEntries())this.handlePerformanceEntry(t)});try{e.observe({entryTypes:["navigation","paint","measure","resource"]})}catch(e){console.warn("PerformanceObserver not supported:",e)}}this.startMemoryMonitoring(),this.estimateBundleSize()}handlePerformanceEntry(e){switch(e.entryType){case"navigation":this.metrics.loadTime=e.duration;break;case"paint":"first-contentful-paint"===e.name&&(this.renderStartTime=e.startTime);break;case"measure":e.name.includes("render")&&(this.metrics.renderTime=e.duration);break;case"resource":(e.name.includes(".js")||e.name.includes(".css"))&&this.updateBundleSize(e)}}startMemoryMonitoring(){"memory"in performance&&setInterval(()=>{let e=performance.memory;e&&(this.metrics.memoryUsage={used:e.usedJSHeapSize,total:e.totalJSHeapSize,limit:e.jsHeapSizeLimit},e.usedJSHeapSize>104857600&&console.warn("High memory usage detected:",{used:Math.round(e.usedJSHeapSize/1024/1024)+"MB",total:Math.round(e.totalJSHeapSize/1024/1024)+"MB",limit:Math.round(e.jsHeapSizeLimit/1024/1024)+"MB"}))},1e4)}estimateBundleSize(){let e=document.querySelectorAll("script[src]"),t=0;e.forEach(e=>{e.src.includes("_next/static/")&&(t+=5e4)}),this.metrics.bundleSize=t}updateBundleSize(e){"transferSize"in e&&(this.metrics.bundleSize+=e.transferSize||0)}startComponentTimer(e){this.componentTimers.set(e,performance.now())}endComponentTimer(e){let t=this.componentTimers.get(e);if(t){let s=performance.now()-t,a=this.componentMetrics.get(e);a?(a.renderTime=(a.renderTime+s)/2,a.updateCount++):(this.componentMetrics.set(e,{name:e,renderTime:s,mountTime:s,updateCount:1,memoryUsage:this.metrics.memoryUsage.used}),this.metrics.componentCount++),this.componentTimers.delete(e)}}updateCacheHitRate(e,t){this.metrics.cacheHitRate=t>0?e/t*100:0}updateErrorRate(e,t){this.metrics.errorRate=t>0?e/t*100:0}getMetrics(){return(0,d._)({},this.metrics)}getComponentMetrics(){return Array.from(this.componentMetrics.values())}getSlowComponents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;return this.getComponentMetrics().filter(t=>t.renderTime>e).sort((e,t)=>t.renderTime-e.renderTime)}getMemoryReport(){let{used:e,total:t,limit:s}=this.metrics.memoryUsage,a=s>0?e/s*100:0,r="メモリ使用量は正常です";return a>80?r="メモリ使用量が高すぎます。ページを再読み込みすることを推奨します。":a>60&&(r="メモリ使用量がやや高いです。不要なタブを閉じることを推奨します。"),{usage:"".concat(Math.round(e/1024/1024),"MB / ").concat(Math.round(s/1024/1024),"MB"),percentage:Math.round(a),recommendation:r}}optimizePerformance(){console.log("\uD83D\uDE80 パフォーマンス最適化を実行中..."),this.cleanupEventListeners(),this.preventMemoryLeaks(),this.optimizeCache(),console.log("✅ パフォーマンス最適化が完了しました")}cleanupEventListeners(){document.querySelectorAll("*").forEach(e=>{console.debug("Event listeners on element:",e.tagName)})}preventMemoryLeaks(){this.metrics.memoryUsage.used>52428800&&(console.warn("メモリ使用量が高いため、最適化を実行します"),"gc"in window&&window.gc())}optimizeCache(){"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{(e.includes("old")||e.includes("temp"))&&caches.delete(e)})})}generateReport(){let e=this.getMetrics(),t=this.getComponentMetrics(),s=this.getMemoryReport();return"\n# パフォーマンスレポート\n\n## 基本メトリクス\n- 読み込み時間: ".concat(e.loadTime.toFixed(2),"ms\n- レンダリング時間: ").concat(e.renderTime.toFixed(2),"ms\n- コンポーネント数: ").concat(e.componentCount,"\n- バンドルサイズ: ").concat(Math.round(e.bundleSize/1024),"KB\n- キャッシュヒット率: ").concat(e.cacheHitRate.toFixed(1),"%\n- エラー率: ").concat(e.errorRate.toFixed(1),"%\n\n## メモリ使用量\n- 使用量: ").concat(s.usage,"\n- 使用率: ").concat(s.percentage,"%\n- 推奨事項: ").concat(s.recommendation,"\n\n## コンポーネントパフォーマンス\n").concat(t.map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms (更新回数: ").concat(e.updateCount,")")).join("\n"),"\n\n## 遅いコンポーネント\n").concat(this.getSlowComponents().map(e=>"- ".concat(e.name,": ").concat(e.renderTime.toFixed(2),"ms")).join("\n"),"\n    ").trim()}constructor(){this.startTime=performance.now(),this.renderStartTime=0,this.metrics={loadTime:0,renderTime:0,memoryUsage:{used:0,total:0,limit:0},componentCount:0,bundleSize:0,cacheHitRate:0,errorRate:0},this.componentMetrics=new Map,this.componentTimers=new Map,this.initializeMonitoring()}}let Z=new A;function F(e){let{children:t,fallbackToSample:s=!0}=e,[a,r]=(0,i.useState)(null),[l,c]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async()=>{try{let e=(()=>{let e=new Date,t=Array.from({length:30},(t,s)=>new Date(e.getTime()-(29-s)*864e5).toISOString().split("T")[0]).map((e,t)=>({date:e,code:"7203.T",open:2500+100*Math.random()-50,high:2550+50*Math.random(),low:2450-50*Math.random(),close:2500+100*Math.random()-50,volume:1e6+5e5*Math.random(),sma_5:2500+50*Math.random()-25,sma_10:2500+40*Math.random()-20,sma_25:2500+30*Math.random()-15,sma_50:2500+20*Math.random()-10,rsi_14:30+40*Math.random(),macd:10*Math.random()-5,macd_signal:8*Math.random()-4,macd_hist:2*Math.random()-1})),s=Array.from({length:20},(e,t)=>({index:t+1,actual:2500+200*Math.random()-100,predicted:2500+200*Math.random()-100,error:10*Math.random()-5,error_percentage:5*Math.random()})),a={total_data_points:t.length,prediction_period:"30日",best_model:"XGBoost",mae:"0.0234",r2:"0.8765",last_updated:e.toISOString()};return{stockData:t,modelComparison:[{name:"XGBoost",type:"Gradient Boosting",mae:.0234,mse:8e-4,rmse:.0283,r2:.8765,rank:1},{name:"Random Forest",type:"Ensemble",mae:.0256,mse:9e-4,rmse:.03,r2:.8543,rank:2},{name:"Linear Regression",type:"Linear",mae:.0345,mse:.0012,rmse:.0346,r2:.7891,rank:3}],featureAnalysis:[{feature:"価格変動率",importance:.35,percentage:35},{feature:"ボリューム",importance:.25,percentage:25},{feature:"RSI",importance:.15,percentage:15},{feature:"移動平均",importance:.12,percentage:12},{feature:"ボリンジャーバンド",importance:.08,percentage:8},{feature:"MACD",importance:.05,percentage:5}],predictions:s,summary:a,marketInsights:{volatility:"medium",trend:"bullish",risk_level:"moderate",market_sentiment:"positive"},riskAssessment:{risk_level:"Medium",risk_score:.65,var_95:.032,max_drawdown:.085,sharpe_ratio:1.25}}})();r(e)}catch(e){console.error("サンプルデータの生成に失敗:",e)}finally{c(!1)}})()},[]),l)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"サンプルデータを準備中..."})]})}):(0,n.jsx)("div",{className:"sample-data-provider",children:t})}setInterval(function(){let e=Z.getMetrics();e.memoryUsage.used>83886080&&(console.warn("メモリ使用量が高いため、自動最適化を実行します"),Z.optimizePerformance()),e.errorRate>10&&console.warn("エラー率が高いです:",e.errorRate+"%"),e.cacheHitRate<50&&console.warn("キャッシュヒット率が低いです:",e.cacheHitRate+"%")},3e4);var O=s(3276);function P(e){let{onAnalysisStart:t,onAnalysisComplete:s,onDataUpdateStart:a,onDataUpdateComplete:r,className:l=""}=e,[c,o]=(0,i.useState)(!1),[x,h]=(0,i.useState)(!1),[y,j]=(0,i.useState)(0),[v,N]=(0,i.useState)([{id:"data_update",name:"データ更新",description:"最新の株価データを取得します",icon:(0,n.jsx)(b.Z,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"},{id:"feature_engineering",name:"特徴量エンジニアリング",description:"技術指標を計算します",icon:(0,n.jsx)(p.Z,{className:"h-5 w-5"}),estimatedTime:"1分",status:"pending"},{id:"model_training",name:"モデル学習",description:"AIモデルを学習させます",icon:(0,n.jsx)(f.Z,{className:"h-5 w-5"}),estimatedTime:"2分",status:"pending"},{id:"prediction",name:"予測実行",description:"株価予測を実行します",icon:(0,n.jsx)(O.Z,{className:"h-5 w-5"}),estimatedTime:"30秒",status:"pending"}]),[w,S]=(0,i.useState)(0),[_,E]=(0,i.useState)(null),C=async()=>{if(!c){o(!0),j(0),S(0),null==t||t();try{for(let e=0;e<v.length;e++){j(e),N(t=>t.map((t,s)=>(0,m._)((0,d._)({},t),{status:s===e?"running":s<e?"completed":"pending"})));let t=0===e?2e3:1===e?3e3:2===e?5e3:2e3;await new Promise(e=>setTimeout(e,t)),S(Math.round((e+1)/v.length*100))}N(e=>e.map(e=>(0,m._)((0,d._)({},e),{status:"completed"}))),null==s||s()}catch(e){console.error("分析実行エラー:",e),N(e=>e.map(e=>(0,m._)((0,d._)({},e),{status:"error"})))}finally{o(!1)}}},R=async()=>{if(!x){h(!0),null==a||a();try{await new Promise(e=>setTimeout(e,3e3)),null==r||r()}catch(e){console.error("データ更新エラー:",e)}finally{h(!1)}}};(0,i.useEffect)(()=>{if(!c){E(null);return}E(Math.max(0,v.reduce((e,t)=>e+(({data_update:2,feature_engineering:3,model_training:5,prediction:2})[t.id]||1),0)-2*y))},[c,y,v]);let M=e=>{switch(e.status){case"completed":return(0,n.jsx)(g.Z,{className:"h-5 w-5 text-green-500"});case"running":return(0,n.jsx)(T.Z,{className:"h-5 w-5 text-blue-500 animate-spin"});case"error":return(0,n.jsx)(u.Z,{className:"h-5 w-5 text-red-500"});default:return e.icon}},I=e=>{switch(e.status){case"completed":return"text-green-600 bg-green-50 border-green-200";case"running":return"text-blue-600 bg-blue-50 border-blue-200";case"error":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 ".concat(l),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(p.Z,{className:"h-6 w-6 text-purple-600"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"分析実行"})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsxs)("button",{onClick:R,disabled:x||c,className:"flex items-center space-x-2 px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(b.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"データ更新のみ"})]})})]}),(0,n.jsx)("div",{className:"space-y-3 mb-6",children:v.map((e,t)=>(0,n.jsx)("div",{className:"p-4 rounded-lg border-2 transition-all ".concat(I(e)),children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[M(e),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium",children:e.name}),(0,n.jsx)("p",{className:"text-sm opacity-75",children:e.description})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:e.estimatedTime}),"running"===e.status&&(0,n.jsx)("div",{className:"text-xs text-blue-600",children:"実行中..."})]})]})},e.id))}),c&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,n.jsx)("span",{children:"全体進捗"}),(0,n.jsxs)("span",{children:[w,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,n.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(w,"%")}})}),_&&(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mt-2",children:[(0,n.jsx)(k.Z,{className:"h-4 w-4"}),(0,n.jsxs)("span",{children:["推定残り時間: ",_,"分"]})]})]}),(0,n.jsx)("div",{className:"flex space-x-3",children:c?(0,n.jsxs)("button",{disabled:!0,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gray-400 text-white rounded-lg cursor-not-allowed",children:[(0,n.jsx)(T.Z,{className:"h-5 w-5 animate-spin"}),(0,n.jsx)("span",{className:"font-medium",children:"実行中..."})]}):(0,n.jsxs)("button",{onClick:C,disabled:x,className:"flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(O.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{className:"font-medium",children:"分析を実行"})]})}),!c&&100===w&&(0,n.jsxs)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(g.Z,{className:"h-5 w-5 text-green-600"}),(0,n.jsx)("span",{className:"text-green-800 font-medium",children:"分析が完了しました"})]}),(0,n.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"予測結果がダッシュボードに表示されます"})]})]})}var U=s(5131),z=s(4887);let B={focusRing:!0,screenReader:!0,highContrast:!0,keyboardNavigation:!0,ariaLabels:{tour:"ガイドツアー",tooltip:"ツールチップ",checklist:"チェックリスト",help:"ヘルプ",glossary:"用語集"}};class G{static getInstance(){return G.instance||(G.instance=new G),G.instance}saveFocus(){this.currentFocus=document.activeElement,this.currentFocus&&this.focusStack.push(this.currentFocus)}restoreFocus(){if(this.focusStack.length>0){let e=this.focusStack.pop();e&&e.focus&&e.focus()}}focusElement(e){e&&e.focus&&e.focus()}trapFocus(e){let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),s=t[0],a=t[t.length-1],r=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===s&&(a.focus(),e.preventDefault()):document.activeElement===a&&(s.focus(),e.preventDefault()))};return e.addEventListener("keydown",r),()=>{e.removeEventListener("keydown",r)}}clearFocusStack(){this.focusStack=[],this.currentFocus=null}constructor(){this.focusStack=[],this.currentFocus=null}}class H{static getInstance(){return H.instance||(H.instance=new H),H.instance}createAnnouncementElement(){this.announcementElement=document.createElement("div"),this.announcementElement.setAttribute("aria-live","polite"),this.announcementElement.setAttribute("aria-atomic","true"),this.announcementElement.className="sr-only",this.announcementElement.style.cssText="\n      position: absolute;\n      left: -10000px;\n      width: 1px;\n      height: 1px;\n      overflow: hidden;\n    ",document.body.appendChild(this.announcementElement)}announce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite";this.announcementElement&&(this.announcementElement.setAttribute("aria-live",t),this.announcementElement.textContent=e,setTimeout(()=>{this.announcementElement&&(this.announcementElement.textContent="")},1e3))}announceStep(e,t){let s="ガイドステップ: ".concat(e,". ").concat(t);this.announce(s,"assertive")}announceChecklistItem(e,t){let s="チェックリスト項目: ".concat(e," - ").concat(t?"完了":"未完了");this.announce(s)}announceTooltip(e){this.announce("ツールチップ: ".concat(e))}constructor(){this.announcementElement=null,this.createAnnouncementElement()}}class J{static getInstance(){return J.instance||(J.instance=new J),J.instance}registerShortcut(e,t){return this.shortcuts.set(e,t),()=>{this.shortcuts.delete(e)}}start(){document.addEventListener("keydown",this.handleKeyDown)}stop(){document.removeEventListener("keydown",this.handleKeyDown)}clear(){this.shortcuts.clear()}constructor(){this.shortcuts=new Map,this.handleKeyDown=e=>{let t=e.key,s=this.shortcuts.get(t);s&&(e.preventDefault(),e.stopPropagation(),s())}}}let V={focusManager:G.getInstance(),screenReader:H.getInstance(),keyboard:J.getInstance(),isHighContrast:function(){if(window.matchMedia("(-ms-high-contrast: active)").matches)return!0;let e=window.getComputedStyle(document.body);return e.backgroundColor===e.color}(),colorBlindness:function(){let e=document.createElement("canvas").getContext("2d");if(!e)return"normal";e.fillStyle="#ff0000",e.fillRect(0,0,1,1);let t=e.getImageData(0,0,1,1).data;return 255===t[0]&&0===t[1]&&t[2],"normal"}(),generateAriaAttributes:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t={role:"button",tabIndex:0,"aria-label":B.ariaLabels[e]||e};switch(e){case"tour":return(0,m._)((0,d._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"tour-title","aria-describedby":"tour-description"});case"tooltip":return(0,m._)((0,d._)({},t),{role:"tooltip","aria-live":"polite"});case"checklist":return(0,m._)((0,d._)({},t),{role:"list","aria-label":"チェックリスト"});case"help":return(0,m._)((0,d._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"help-title"});case"glossary":return(0,m._)((0,d._)({},t),{role:"dialog","aria-modal":!0,"aria-labelledby":"glossary-title"});default:return t}},config:B};V.focusManager,V.screenReader,V.keyboard;let W=(0,i.createContext)(null),Y={FIRST_VISIT:"guide_first_visit",COMPLETED_STEPS:"guide_completed_steps",TOUR_COMPLETED:"guide_tour_completed",GUIDE_DISABLED:"guide_disabled",CURRENT_STEP:"guide_current_step"},K=[{id:"welcome",target:'[data-guide-target="welcome"]',title:"ようこそ！",body:"J-Quants株価予測システムへようこそ。3分で主要機能を案内します。",placement:"auto",page:"/",next:"navigation"},{id:"navigation",target:'[data-guide-target="navigation"]',title:"ナビゲーション",body:"各ページへの移動はここから。予測・モデル・分析・設定を切り替えできます。",placement:"bottom",page:"/",next:"dashboard-overview"},{id:"dashboard-overview",target:'[data-guide-target="dashboard-overview"]',title:"ダッシュボード概要",body:"今日の投資指示と主要KPIが表示されます。まずはここを確認しましょう。",placement:"auto",page:"/",next:"kpi-metrics"},{id:"kpi-metrics",target:'[data-guide-target="kpi-metrics"]',title:"主要指標の見方",body:"MAE（平均絶対誤差）・R\xb2（決定係数）・予測精度を確認。低いMAEと高いR\xb2が理想的。",placement:"auto",page:"/",next:"candidate-cards"},{id:"candidate-cards",target:'[data-guide-target="candidate-cards"]',title:"候補銘柄カード",body:"推奨銘柄とリスク情報を表示。カードをクリックして詳細分析に進めます。",placement:"auto",page:"/",next:"model-comparison"},{id:"model-comparison",target:'[data-guide-target="model-comparison"]',title:"モデル比較",body:"複数モデルの性能を比較。総合評価→詳細指標の順で確認しましょう。",placement:"auto",page:"/",next:"analysis-features"},{id:"analysis-features",target:'[data-guide-target="analysis-features"]',title:"分析機能",body:"特徴量重要度・残差分析・相関分析でモデルの信頼性を確認できます。",placement:"auto",page:"/",next:"settings-config"},{id:"settings-config",target:'[data-guide-target="settings-config"]',title:"設定",body:"実行時刻・通知先・しきい値を設定。定期的な分析実行に必要です。",placement:"auto",page:"/",next:"help-support"},{id:"help-support",target:'[data-guide-target="help-support"]',title:"ヘルプ・サポート",body:"困った時はF1キーまたは「？」ボタンでクイックヘルプを表示できます。",placement:"auto",page:"/",next:"completion"},{id:"completion",target:'[data-guide-target="completion"]',title:"完了！",body:"お疲れ様でした！これで主要機能を理解できました。明日からは自動案内しません。",placement:"auto",page:"/"}];function q(e){let{children:t,steps:s=K}=e,[a,r]=(0,i.useState)({isActive:!1,currentStep:null,completedSteps:[],isFirstVisit:!0,isTourCompleted:!1,isGuideDisabled:!1});(0,i.useEffect)(()=>{let e="false"!==localStorage.getItem(Y.FIRST_VISIT),t=JSON.parse(localStorage.getItem(Y.COMPLETED_STEPS)||"[]"),s="true"===localStorage.getItem(Y.TOUR_COMPLETED),a="true"===localStorage.getItem(Y.GUIDE_DISABLED),n=localStorage.getItem(Y.CURRENT_STEP);r(r=>(0,m._)((0,d._)({},r),{isFirstVisit:e,completedSteps:t,isTourCompleted:s,isGuideDisabled:a,currentStep:n||null})),!e||a||s||setTimeout(()=>{c()},1e3)},[]);let l=(0,i.useCallback)(e=>{r(t=>{let s=(0,d._)({},t,e);return void 0!==e.isFirstVisit&&localStorage.setItem(Y.FIRST_VISIT,e.isFirstVisit.toString()),void 0!==e.completedSteps&&localStorage.setItem(Y.COMPLETED_STEPS,JSON.stringify(e.completedSteps)),void 0!==e.isTourCompleted&&localStorage.setItem(Y.TOUR_COMPLETED,e.isTourCompleted.toString()),void 0!==e.isGuideDisabled&&localStorage.setItem(Y.GUIDE_DISABLED,e.isGuideDisabled.toString()),void 0!==e.currentStep&&(e.currentStep?localStorage.setItem(Y.CURRENT_STEP,e.currentStep):localStorage.removeItem(Y.CURRENT_STEP)),s})},[]),c=(0,i.useCallback)(()=>{let e=s[0];e&&(V.focusManager.saveFocus(),V.screenReader.announce("ガイドツアーを開始しました"),l({isActive:!0,currentStep:e.id,isFirstVisit:!1}))},[s,l]),o=(0,i.useCallback)(()=>{setTimeout(()=>{r(e=>{if(!e.currentStep)return e;let t=s.find(t=>t.id===e.currentStep);if(!(null==t?void 0:t.next))return(0,m._)((0,d._)({},e),{isActive:!1,currentStep:null,isTourCompleted:!0,completedSteps:[...e.completedSteps,e.currentStep]});let a=s.find(e=>e.id===t.next);if(!a)return e;if(a.action){if("nav"===a.action.type)window.location.href=a.action.to;else if("click"===a.action.type){let e=document.querySelector(a.action.target);e&&e.click()}}return(0,m._)((0,d._)({},e),{currentStep:a.id,completedSteps:[...e.completedSteps,e.currentStep]})})},0)},[s]),x=(0,i.useCallback)(()=>{r(e=>{if(!e.currentStep)return e;let t=s.find(t=>t.id===e.currentStep);if(!(null==t?void 0:t.prev))return e;let a=s.find(e=>e.id===t.prev);return a?(0,m._)((0,d._)({},e),{currentStep:a.id}):e})},[s]),h=(0,i.useCallback)(()=>{l({isActive:!1,currentStep:null,isTourCompleted:!0})},[]),u=(0,i.useCallback)(()=>{V.screenReader.announce("ガイドツアーが完了しました"),V.focusManager.restoreFocus(),l({isActive:!1,currentStep:null,isTourCompleted:!0,completedSteps:[...a.completedSteps,a.currentStep||""]})},[a.completedSteps,a.currentStep]),g=(0,i.useCallback)(()=>{l({isGuideDisabled:!a.isGuideDisabled})},[a.isGuideDisabled]),p=(0,i.useCallback)(()=>{localStorage.removeItem(Y.FIRST_VISIT),localStorage.removeItem(Y.COMPLETED_STEPS),localStorage.removeItem(Y.TOUR_COMPLETED),localStorage.removeItem(Y.GUIDE_DISABLED),localStorage.removeItem(Y.CURRENT_STEP),r({isActive:!1,currentStep:null,completedSteps:[],isFirstVisit:!0,isTourCompleted:!1,isGuideDisabled:!1})},[]),f=(0,i.useCallback)(()=>a.currentStep&&s.find(e=>e.id===a.currentStep)||null,[a.currentStep,s]),y=(0,i.useCallback)(e=>a.completedSteps.includes(e),[a.completedSteps]);return(0,n.jsxs)(W.Provider,{value:{state:a,startTour:c,nextStep:o,prevStep:x,skipTour:h,completeTour:u,toggleGuide:g,resetGuide:p,getCurrentStepData:f,isStepCompleted:y},children:[t,a.isActive&&(0,n.jsx)(X,{})]})}function X(){let{state:e,getCurrentStepData:t,nextStep:s,prevStep:a,skipTour:r,completeTour:l}=function(){let e=(0,i.useContext)(W);if(!e)throw Error("useGuide must be used within a TourProvider");return e}(),[c,o]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{o(!0)},[]),!c)return null;let d=t();return d?(0,z.createPortal)((0,n.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/50"}),(0,n.jsx)(Q,{step:d,onNext:s,onPrev:a,onSkip:r,onComplete:l,isFirst:!d.prev,isLast:!d.next})]}),document.body):null}function Q(e){let{step:t,onNext:s,onPrev:a,onSkip:r,onComplete:l,isFirst:c,isLast:o}=e,[d,m]=(0,i.useState)(null),[x,h]=(0,i.useState)({top:0,left:0,width:0,height:0});if((0,i.useEffect)(()=>{let e=document.querySelector(t.target);if(e){m(e);let t=e.getBoundingClientRect();h({top:t.top+window.scrollY,left:t.left+window.scrollX,width:t.width,height:t.height})}},[t.target]),(0,i.useEffect)(()=>{if(!d){let e=setTimeout(()=>{s()},0);return()=>clearTimeout(e)}},[d,s]),!d)return null;let u=(()=>{let{top:e,left:s,width:a,height:r}=x;switch(t.placement){case"top":return{top:e-200-16,left:s+a/2-160};case"bottom":return{top:e+r+16,left:s+a/2-160};case"left":return{top:e+r/2-100,left:s-320-16};case"right":return{top:e+r/2-100,left:s+a+16};default:let n=window.innerHeight-(e+r),i=window.innerWidth-(s+a);if(n>=216)return{top:e+r+16,left:s+a/2-160};if(e>=216)return{top:e-200-16,left:s+a/2-160};if(i>=336)return{top:e+r/2-100,left:s+a+16};return{top:e+r/2-100,left:s-320-16}}})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute border-2 border-blue-500 rounded-lg pointer-events-none",style:{top:x.top-4,left:x.left-4,width:x.width+8,height:x.height+8,boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}}),(0,n.jsxs)("div",{className:"absolute bg-white rounded-lg shadow-xl p-6 max-w-sm",style:{top:u.top,left:u.left,zIndex:1e3},children:[t.title&&(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t.title}),(0,n.jsx)("p",{className:"text-gray-700 mb-4",children:t.body}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[!c&&(0,n.jsx)("button",{onClick:a,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"戻る"}),(0,n.jsx)("button",{onClick:r,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"スキップ"})]}),(0,n.jsx)("div",{className:"flex gap-2",children:o?(0,n.jsx)("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"完了"}):(0,n.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"次へ"})})]})]})]})}var $=s(4372);let ee=$.Ryn({date:$.Z_8(),symbol:$.Z_8().min(4),y_true:$.Rxh().finite(),y_pred:$.Rxh().finite()}),et=$.Ryn({meta:$.Ryn({model:$.Z_8(),generatedAt:$.Z_8()}).optional(),data:$.IXX(ee).min(1)}),es=$.Ryn({date:$.Z_8(),close:$.Rxh().finite(),sma_5:$.Rxh().finite().optional(),sma_10:$.Rxh().finite().optional(),sma_25:$.Rxh().finite().optional(),sma_50:$.Rxh().finite().optional(),volume:$.Rxh().finite(),predicted:$.Rxh().finite().optional()}),ea=$.Ryn({model_name:$.Z_8(),model_type:$.Z_8(),mae:$.Rxh().finite(),rmse:$.Rxh().finite(),r2:$.Rxh().finite(),rank:$.Rxh().int().min(1)});$.Ryn({total_stocks:$.Rxh().int().min(0),total_predictions:$.Rxh().int().min(0),last_updated:$.Z_8(),model_performance:$.Ryn({best_model:$.Z_8(),accuracy:$.Rxh().min(0).max(1),mae:$.Rxh().finite(),rmse:$.Rxh().finite()})}),$.Ryn({feature:$.Z_8(),importance:$.Rxh().min(0).max(1),percentage:$.Rxh().min(0).max(100)}),$.Ryn({market_trend:$.Z_8(),volatility:$.Rxh().finite(),recommendations:$.IXX($.Z_8()),risk_level:$.KmV(["低","中","高"])}),$.Ryn({overall_risk:$.KmV(["低","中","高"]),portfolio_value:$.Rxh().finite(),var_95:$.Rxh().finite(),max_drawdown:$.Rxh().finite(),sharpe_ratio:$.Rxh().finite()});var er=s(7932);function en(e){let t;return("number"==typeof e?t=e>1e12?er.ou.fromMillis(e).toUTC():er.ou.fromSeconds(e).toUTC():((t=er.ou.fromISO(e,{setZone:!0})).isValid||(t=er.ou.fromFormat(e,"yyyy-MM-dd",{zone:"utc"})),t.isValid||(t=er.ou.fromFormat(e,"yyyy-MM-dd HH:mm:ss",{zone:"utc"})),t.isValid||(t=er.ou.fromFormat(e,"yyyyMMdd",{zone:"utc"})),t.isValid||(t=er.ou.fromFormat(e,"yyyy/MM/dd",{zone:"utc"}))),t.isValid)?t.setZone("Asia/Tokyo"):(console.error("Invalid date format:",e),er.ou.fromISO("2024-01-01",{zone:"Asia/Tokyo"}))}function ei(e){return e.toFormat("yyyy-LL-dd")}function el(e,t){if(e.length!==t.length)throw Error("配列の長さが一致しません");let s=e.map((e,s)=>Math.abs(e-t[s]));return s.reduce((e,t)=>e+t,0)/s.length}function ec(e,t){if(e.length!==t.length)throw Error("配列の長さが一致しません");let s=e.map((e,s)=>Math.pow(e-t[s],2));return Math.sqrt(s.reduce((e,t)=>e+t,0)/s.length)}function eo(e,t){if(e.length!==t.length)throw Error("配列の長さが一致しません");let s=e.reduce((e,t)=>e+t,0)/e.length,a=e.reduce((e,s,a)=>e+Math.pow(s-t[a],2),0),r=e.reduce((e,t)=>e+Math.pow(t-s,2),0);return 0===r?0===a?1:0:1-a/r}(a=r||(r={}))[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.WARN=2]="WARN",a[a.ERROR=3]="ERROR";class ed{shouldLog(e){return e>=this.level}formatMessage(e,t){for(var s=arguments.length,a=Array(s>2?s-2:0),r=2;r<s;r++)a[r-2]=arguments[r];let n=new Date().toISOString(),i=this.context?"[".concat(this.context,"]"):"";return"".concat(n," ").concat(e," ").concat(i," ").concat(t)}debug(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];this.shouldLog(0)&&console.debug(e,...s)}info(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];this.shouldLog(1)&&console.info(e,...s)}warn(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];this.shouldLog(2)&&console.warn(e,...s)}error(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];this.shouldLog(3)&&console.error(e,...s)}createChild(e){return new ed("".concat(this.context,":").concat(e),this.level)}constructor(e="App",t=0){this.context=e,this.level=t}}ed.prototype.log=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";console[t](e)},ed.prototype.group=function(e){console.log(e)},ed.prototype.groupEnd=function(){},ed.prototype.time=function(e){console.log("".concat(e,":"))},ed.prototype.timeEnd=function(e){},ed.prototype.table=function(e){console.log(e)};let em=new ed,ex=em.createChild("Fetcher");em.createChild("DateTime");let eh=em.createChild("Metrics");em.createChild("Chart");class eu{record(e,t){this.metrics.set(e,t),em.debug("Metric recorded: ".concat(e," = ").concat(t))}get(e){return this.metrics.get(e)}getAll(){return Object.fromEntries(this.metrics)}clear(){this.metrics.clear()}constructor(){this.metrics=new Map}}function eg(e){let{error:t,onRetry:s,onDismiss:a}=e;return(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(e=>{if(e instanceof N.gz)switch(e.code){case"HTTP_404":case"HTTP_500":case"HTTP_429":break;case"TIMEOUT":case"ABORTED":return(0,n.jsx)("svg",{className:"h-6 w-6 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});case"INVALID_CONTENT_TYPE":case"INVALID_DATA_STRUCTURE":return(0,n.jsx)("svg",{className:"h-6 w-6 text-orange-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}return(0,n.jsx)("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})})(t)}),(0,n.jsxs)("div",{className:"ml-3 flex-1",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"データの読み込みに失敗しました"}),(0,n.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,n.jsx)("p",{children:(e=>{if(e instanceof N.gz)switch(e.code){case"HTTP_404":return"データファイルが見つかりません。管理者にお問い合わせください。";case"HTTP_500":return"サーバーエラーが発生しました。しばらく待ってから再試行してください。";case"HTTP_429":return"リクエストが多すぎます。しばらく待ってから再試行してください。";case"TIMEOUT":return"通信がタイムアウトしました。ネットワーク接続を確認してください。";case"ABORTED":return"リクエストが中断されました。";case"INVALID_CONTENT_TYPE":return"データ形式が不正です。JSONファイルが期待されています。";case"INVALID_DATA_STRUCTURE":return"データ構造が不正です。フィールド名や型を確認してください。";case"ALL_RETRIES_FAILED":return"すべてのリトライ試行が失敗しました。ネットワーク接続を確認してください。";default:return"エラー: ".concat(e.message)}return e.message.includes("Failed to fetch")?"ネットワーク接続に問題があります。インターネット接続を確認してください。":e.message.includes("RSC payload")?"サーバーとの通信に問題があります。しばらく待ってから再試行してください。":"エラー: ".concat(e.message)})(t)})}),(0,n.jsxs)("div",{className:"mt-4 flex space-x-3",children:[s&&(0,n.jsx)("button",{onClick:s,className:"bg-red-600 text-white px-3 py-1 rounded text-sm font-medium hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"再試行"}),a&&(0,n.jsx)("button",{onClick:a,className:"bg-gray-600 text-white px-3 py-1 rounded text-sm font-medium hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"閉じる"})]})]})]})})}function ep(e){let{className:t=""}=e;return(0,n.jsx)("div",{className:"animate-pulse bg-gray-200 rounded ".concat(t)})}function ef(){return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"}),(0,n.jsx)(ep,{className:"h-4"})]},t))]})}function ey(){return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(ep,{className:"h-6 w-32"}),(0,n.jsx)(ep,{className:"h-4 w-24"})]}),(0,n.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(ep,{className:"h-8 w-8 mx-auto mb-2"}),(0,n.jsx)(ep,{className:"h-4 w-24"})]})})]})}function ej(){return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)(ep,{className:"h-5 w-20"}),(0,n.jsx)(ep,{className:"h-4 w-4 rounded-full"})]}),(0,n.jsx)(ep,{className:"h-8 w-16 mb-2"}),(0,n.jsx)(ep,{className:"h-4 w-24"})]})}function eb(){return(0,n.jsxs)("div",{className:"space-y-6","data-testid":"predictions-skeleton",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(ep,{className:"h-8 w-48"}),(0,n.jsx)(ep,{className:"h-10 w-24"})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)(ej,{},t))}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)(ep,{className:"h-6 w-32 mb-4"}),(0,n.jsx)(ef,{})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsx)(ey,{})}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,n.jsx)(ey,{})})]})]})}new eu;let ev=(0,i.memo)(function(e){let{onError:t}=e,[s,a]=(0,i.useState)(!0),[r,l]=(0,i.useState)(null),[c,o]=(0,i.useState)([]),[d,m]=(0,i.useState)(null),[x,h]=(0,i.useState)(null),[u,g]=(0,i.useState)(0),[p,f]=(0,i.useState)(null),y=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var s,r,n;let t,i,c,d,x;e&&g(e=>e+1),a(!0),l(null),p&&p.abort();let u=new AbortController;f(u),ex.info("予測結果データの読み込みを開始");let y=await (0,N.Z_)({predictions:"./data/prediction_results.json",stockData:"./data/stock_data.json",modelComparison:"./data/unified_model_comparison.json"},{signal:u.signal,timeout:1e4,retries:3});try{t=et.parse(y.predictions)}catch(e){throw new N.gz("予測データのスキーマ検証に失敗: ".concat(e instanceof Error?e.message:"Unknown error"),"INVALID_PREDICTION_SCHEMA")}try{i=(null===(r=y.stockData)||void 0===r?void 0:r.map(e=>es.parse(e)))||[]}catch(e){ex.warn("株価データのスキーマ検証に失敗、空配列で継続",e),i=[]}try{c=(null===(n=y.modelComparison)||void 0===n?void 0:n.map(e=>ea.parse(e)))||[]}catch(e){ex.warn("モデル比較データのスキーマ検証に失敗、空配列で継続",e),c=[]}ex.info("データの読み込みが完了",{predictionsCount:t.data.length,stockDataCount:i.length,modelCount:c.length});try{d=t.data.map(e=>({date:e.date,symbol:e.symbol,y_true:e.y_true,y_pred:e.y_pred,error:Math.abs(e.y_true-e.y_pred)}))}catch(e){throw new N.gz("予測データの変換に失敗: ".concat(e instanceof Error?e.message:"Unknown error"),"PREDICTION_TRANSFORM_ERROR")}o(d);try{t.meta&&h({name:t.meta.model,generatedAt:t.meta.generatedAt})}catch(e){ex.warn("モデル情報の設定に失敗",e),h(null)}try{let e=d.map(e=>e.y_true),t=d.map(e=>e.y_pred),s=el(e,t),a=ec(e,t),r=eo(e,t),n=function(e){let t=e.length<2?e.slice():[e[0],...e.slice(0,-1)],s=e.slice(1),a=t.slice(1);return{mae:el(s,a),rmse:ec(s,a),r2:eo(s,a),mape:function(e,t){if(e.length!==t.length)throw Error("配列の長さが一致しません");let s=e.map((e,s)=>0===e?0:Math.abs((e-t[s])/e));return s.reduce((e,t)=>e+t,0)/s.length*100}(s,a)}}(e),i=function(e,t){let s=(t.mae-e.mae)/t.mae*100,a=(t.rmse-e.rmse)/t.rmse*100,r=e.r2-t.r2;return{maeImprovement:s,rmseImprovement:a,r2Improvement:r,isBetter:e.mae<t.mae&&e.rmse<t.rmse&&e.r2>t.r2}}({mae:s,rmse:a,r2:r},n);d.map(e=>e.date),d.map(e=>[e.y_true]),d.map(e=>e.y_true),x={mae:s,rmse:a,r2:r,baselineComparison:i,overfittingRisk:{isOverfitting:!1,riskLevel:"低",message:"過学習のリスクは低いです"}}}catch(e){ex.error("KPI計算に失敗、デフォルト値を設定",e),x={mae:0,rmse:0,r2:0,baselineComparison:{maeImprovement:0,rmseImprovement:0,r2Improvement:0,isBetter:!1},overfittingRisk:{isOverfitting:!1,riskLevel:"低",message:"計算エラー"}}}m(x),eh.info("KPI計算完了",{mae:x.mae,rmse:x.rmse,r2:x.r2,isBetterThanBaseline:(null===(s=x.baselineComparison)||void 0===s?void 0:s.isBetter)||!1}),g(0)}catch(s){let e=s instanceof N.gz?s:new N.gz(s instanceof Error?s.message:"Unknown error","UNKNOWN_ERROR");ex.error("予測結果データの読み込みに失敗",e),l(e),t&&t(e),u<3&&(ex.info("自動リトライを実行 (".concat(u+1,"/3)")),setTimeout(()=>{y(!0)},2e3*(u+1)))}finally{a(!1)}},[u,p,t]);(0,i.useEffect)(()=>(y(),()=>{p&&p.abort()}),[]);let j=(0,i.useCallback)(()=>{g(0),y()},[y]),b=(0,i.useCallback)(()=>{l(null)},[]);return s?(0,n.jsx)(eb,{}):r?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)(eg,{error:r,onRetry:j,onDismiss:b})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"予測結果"}),x&&(0,n.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["モデル: ",x.name," | 生成日時: ",ei(en(x.generatedAt))]})]}),(0,n.jsx)("button",{onClick:j,className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"更新"})]}),d&&(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"MAE"}),(0,n.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:d.mae.toFixed(2)})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"平均絶対誤差"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"RMSE"}),(0,n.jsx)("span",{className:"text-2xl font-bold text-green-600",children:d.rmse.toFixed(2)})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"二乗平均平方根誤差"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"R\xb2"}),(0,n.jsx)("span",{className:"text-2xl font-bold ".concat("高"===d.overfittingRisk.riskLevel?"text-red-600":"中"===d.overfittingRisk.riskLevel?"text-yellow-600":"text-green-600"),children:d.r2.toFixed(3)})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"決定係数"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"ベースライン"}),(0,n.jsx)("span",{className:"text-2xl font-bold ".concat(d.baselineComparison.isBetter?"text-green-600":"text-red-600"),children:d.baselineComparison.isBetter?"改善":"劣化"})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["MAE改善: ",d.baselineComparison.maeImprovement.toFixed(1),"%"]})]})]}),d&&d.overfittingRisk.isOverfitting&&(0,n.jsx)("div",{className:"border rounded-lg p-4 ".concat("高"===d.overfittingRisk.riskLevel?"bg-red-50 border-red-200":"中"===d.overfittingRisk.riskLevel?"bg-yellow-50 border-yellow-200":"bg-orange-50 border-orange-200"),children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("svg",{className:"h-5 w-5 mr-2 mt-0.5 ".concat("高"===d.overfittingRisk.riskLevel?"text-red-500":"中"===d.overfittingRisk.riskLevel?"text-yellow-500":"text-orange-500"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"text-sm font-medium ".concat("高"===d.overfittingRisk.riskLevel?"text-red-800":"中"===d.overfittingRisk.riskLevel?"text-yellow-800":"text-orange-800"),children:"過学習のリスクが検出されました"}),(0,n.jsx)("p",{className:"text-sm mt-1 ".concat("高"===d.overfittingRisk.riskLevel?"text-red-700":"中"===d.overfittingRisk.riskLevel?"text-yellow-700":"text-orange-700"),children:d.overfittingRisk.message}),(0,n.jsx)("p",{className:"text-xs mt-2 text-gray-600",children:"TimeSeriesSplit評価により検出されました。モデルの再学習を検討してください。"})]})]})}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"予測結果一覧"})}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"日付"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"銘柄"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"実際値"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"予測値"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"誤差"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.slice(0,20).map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ei(en(e.date))}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.symbol}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.y_true.toFixed(2)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.y_pred.toFixed(2)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.error.toFixed(2)})]},t))})]})})]})]})});var eN=s(4972),ew=s(5621),eS=s(8728),ek=s(9322),e_=s(3910);let eT=[{type:"ultra_fast",name:"超高速分析",description:"1日5分で完結する最適化された分析",icon:(0,n.jsx)(M.Z,{className:"w-5 h-5"}),estimatedTime:"1-2分"},{type:"comprehensive",name:"包括的分析",description:"データ取得から予測まで全工程を自動実行",icon:(0,n.jsx)(p.Z,{className:"w-5 h-5"}),estimatedTime:"3-5分"},{type:"symbols",name:"銘柄分析",description:"指定銘柄の詳細分析を実行",icon:(0,n.jsx)(j.Z,{className:"w-5 h-5"}),estimatedTime:"2-3分"},{type:"trading",name:"トレーディング分析",description:"統合トレーディングシステムによる分析",icon:(0,n.jsx)(M.Z,{className:"w-5 h-5"}),estimatedTime:"4-6分"},{type:"sentiment",name:"感情分析",description:"ニュース感情分析による予測",icon:(0,n.jsx)(eN.Z,{className:"w-5 h-5"}),estimatedTime:"3-4分"}];function eE(e){var t,s,a;let{onAnalysisComplete:r,onAnalysisStart:l}=e,[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)("ultra_fast"),[x,h]=(0,i.useState)(0),[u,p]=(0,i.useState)(""),[f,y]=(0,i.useState)(!1),[b,v]=(0,i.useState)(null),[w,S]=(0,i.useState)(null),[_,E]=(0,i.useState)(null),[C,R]=(0,i.useState)("00:00"),[M,I]=(0,i.useState)([]),[D,L]=(0,i.useState)(!1),[A,Z]=(0,i.useState)(null),{runAnalysisWithSettings:F,getAnalysisDescription:P}=(0,e_.$)(),U=eT.find(e=>e.type===d),z=e=>{let t=[e,...M.slice(0,9)];I(t),localStorage.setItem("analysisHistory",JSON.stringify(t))},B=()=>{let e=localStorage.getItem("analysisHistory");if(e)try{let t=JSON.parse(e);I(t),t.length>0&&Z(t[0].result)}catch(e){console.error("履歴読み込みエラー:",e)}};i.useEffect(()=>{B()},[]);let G=async()=>{try{let s;o(!0),h(0),p("ジョブを作成しています..."),S(null),v(null),R("00:00"),null==l||l();let a="analysis:client_token",n=localStorage.getItem(a);if(!n){var e,t;n="client_".concat((null===(e=(t=crypto).randomUUID)||void 0===e?void 0:e.call(t))||Math.random().toString(36).slice(2)),localStorage.setItem(a,n)}p("ローカル分析を実行中...");try{let e=await F({analysisType:d,useSettings:!0});if(!e.success)throw Error(e.error||"分析実行に失敗しました");p("分析が完了しました！"),h(100),v(e.result),null==r||r(e.result);let t="local_".concat(Date.now());E(t),z({id:t,type:d,timestamp:new Date().toISOString(),duration:C,status:"success",result:e.result}),o(!1);return}catch(e){throw p("分析エラー: ".concat(e instanceof Error?e.message:"不明なエラー")),S("分析の実行に失敗しました。詳細: ".concat(e instanceof Error?e.message:"不明なエラー")),o(!1),e}try{if(!(s=(await (0,N.rd)("/api/analyze",{timeout:1e4,json:{client_token:n}})).job_id))return;E(s),p("キューに投入しました。進捗を監視します...")}catch(s){p("APIが利用できないためローカル分析に切り替えます...");let e=await F({analysisType:d,useSettings:!0});if(!e.success)throw Error(e.error||"分析実行に失敗しました");p("分析が完了しました！（ローカル）"),h(100),v(e.result),null==r||r(e.result);let t="local_".concat(Date.now());E(t),z({id:t,type:d,timestamp:new Date().toISOString(),duration:C,status:"success",result:e.result}),o(!1);return}let i=Date.now(),c=async()=>{var e,t;try{let t=await (0,N.rd)("/api/jobs/".concat(s),{timeout:8e3}),a=Math.min(99,Math.max(0,Math.floor(null!==(e=t.progress)&&void 0!==e?e:0)));if(h(a),p("running"===t.status?"分析を実行中...":"queued"===t.status?"待機中...":u),"succeeded"===t.status){h(100),p("分析が完了しました！");let e={message:"分析が完了しました",resultUrl:t.result_url,webDataGenerated:!0};v(e),null==r||r(e),z({id:s,type:d,timestamp:new Date().toISOString(),duration:C,status:"success",result:e}),o(!1);return}if("failed"===t.status){let e=t.error||"サーバー側でエラーが発生しました";throw Error(e)}if(Date.now()-i>18e4)throw Error("タイムアウトしました（3分）");setTimeout(c,1500)}catch(a){let e=null===(t=M[0])||void 0===t?void 0:t.result;S(a instanceof Error?a.message:"不明なエラー"),p("失敗しました。前回結果にフォールバックできます"),e&&v(e),z({id:s,type:d,timestamp:new Date().toISOString(),duration:C,status:"error",error:a instanceof Error?a.message:"Unknown"}),o(!1)}};setTimeout(c,1500)}catch(e){S(e instanceof Error?e.message:"不明なエラーが発生しました"),p("分析に失敗しました"),o(!1)}},H=()=>{o(!1),h(0),p(""),S(null),v(null)};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[(0,n.jsx)(O.Z,{className:"w-6 h-6 text-blue-600"}),"ワンクリック分析実行"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>L(!D),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"分析履歴",children:(0,n.jsx)(ew.Z,{className:"w-5 h-5"})}),(0,n.jsx)("button",{onClick:()=>y(!f),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",title:"設定",children:(0,n.jsx)(eS.Z,{className:"w-5 h-5"})})]})]}),f&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"分析タイプを選択"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:eT.map(e=>(0,n.jsxs)("button",{onClick:()=>m(e.type),className:"p-3 rounded-lg border-2 transition-all ".concat(d===e.type?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e.icon,(0,n.jsx)("span",{className:"font-medium",children:e.name})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["予想時間: ",e.estimatedTime]})]},e.type))})]}),D&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[(0,n.jsx)(ew.Z,{className:"w-5 h-5"}),"分析履歴"]}),0===M.length?(0,n.jsx)("p",{className:"text-gray-500 text-sm",children:"分析履歴がありません"}):(0,n.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:M.map((e,t)=>{var s;return(0,n.jsxs)("div",{className:"p-3 rounded-lg border ".concat("success"===e.status?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:["success"===e.status?(0,n.jsx)(g.Z,{className:"w-4 h-4 text-green-600"}):(0,n.jsx)(ek.Z,{className:"w-4 h-4 text-red-600"}),(0,n.jsx)("span",{className:"font-medium text-sm",children:(null===(s=eT.find(t=>t.type===e.type))||void 0===s?void 0:s.name)||e.type})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,n.jsx)(k.Z,{className:"w-3 h-3"}),new Date(e.timestamp).toLocaleString("ja-JP")]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,n.jsxs)("span",{className:"text-xs text-gray-600",children:["実行時間: ",e.duration]}),0===t&&"success"===e.status&&(0,n.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"最新結果"})]})]},e.id)})})]}),A&&b&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,n.jsxs)("h3",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[(0,n.jsx)(j.Z,{className:"w-5 h-5"}),"前回結果との比較"]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-blue-700 mb-2",children:"前回の結果"}),(0,n.jsxs)("div",{className:"text-sm text-blue-600",children:[(0,n.jsxs)("p",{children:["実行日時: ",new Date(null===(t=M[0])||void 0===t?void 0:t.timestamp).toLocaleString("ja-JP")]}),(0,n.jsxs)("p",{children:["実行時間: ",null===(s=M[0])||void 0===s?void 0:s.duration]}),(0,n.jsxs)("p",{children:["分析タイプ: ",null===(a=eT.find(e=>{var t;return e.type===(null===(t=M[0])||void 0===t?void 0:t.type)}))||void 0===a?void 0:a.name]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-green-700 mb-2",children:"今回の結果"}),(0,n.jsxs)("div",{className:"text-sm text-green-600",children:[(0,n.jsxs)("p",{children:["実行日時: ",new Date().toLocaleString("ja-JP")]}),(0,n.jsxs)("p",{children:["実行時間: ",C]}),(0,n.jsxs)("p",{children:["分析タイプ: ",null==U?void 0:U.name]})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(eS.Z,{className:"w-4 h-4 text-gray-600 mr-2"}),(0,n.jsx)("h4",{className:"font-medium text-gray-800",children:"実行設定"})]}),(()=>{let e=P();return(0,n.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,n.jsxs)("div",{children:["• ",e.prediction]}),(0,n.jsxs)("div",{children:["• ",e.model]}),(0,n.jsxs)("div",{children:["• ",e.retrain]}),(0,n.jsxs)("div",{children:["• ",e.features]}),(0,n.jsxs)("div",{children:["• ",e.data]})]})})()]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-800",children:[null==U?void 0:U.name,"を実行"]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:null==U?void 0:U.description}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["予想時間: ",null==U?void 0:U.estimatedTime]})]}),(0,n.jsx)("button",{onClick:G,disabled:c,className:"px-6 py-3 rounded-lg font-medium transition-all ".concat(c?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:c?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(T.Z,{className:"w-4 h-4 animate-spin"}),"実行中..."]}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(O.Z,{className:"w-4 h-4"}),"分析実行"]})})]}),c&&(0,n.jsxs)("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"分析実行中"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-sm text-blue-600",children:["経過時間: ",C]}),(0,n.jsxs)("span",{className:"text-sm font-medium text-blue-800",children:[x,"%"]})]})]}),(0,n.jsx)("div",{className:"w-full bg-blue-100 rounded-full h-3",children:(0,n.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:"".concat(x,"%")}})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(T.Z,{className:"w-4 h-4 animate-spin text-blue-600"}),(0,n.jsx)("p",{className:"text-sm text-blue-700",children:u})]}),_&&(0,n.jsxs)("p",{className:"text-xs text-blue-500",children:["分析ID: ",_]})]}),w&&(0,n.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,n.jsx)(ek.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"font-medium",children:"エラーが発生しました"})]}),(0,n.jsx)("p",{className:"text-red-700 text-sm mt-1",children:w}),(0,n.jsx)("button",{onClick:H,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"再試行"})]}),b&&(0,n.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-green-800",children:[(0,n.jsx)(g.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"font-medium",children:"分析完了"})]}),(0,n.jsx)("p",{className:"text-green-700 text-sm mt-1",children:b.message}),b.webDataGenerated&&(0,n.jsx)("p",{className:"text-green-600 text-xs mt-1",children:"✅ Webデータも更新されました"}),(0,n.jsx)("button",{onClick:H,className:"mt-2 text-green-600 hover:text-green-800 text-sm underline",children:"新しい分析を実行"})]})]})]})}var eC=s(5938);let eR="force-dynamic",eM=(0,c.default)(()=>Promise.all([s.e(648),s.e(424)]).then(s.bind(s,9424)),{loadableGenerated:{webpack:()=>[9424]},ssr:!1});function eI(){var e,t;let[a,r]=(0,i.useState)("overview"),[l,c]=(0,i.useState)(""),[o,w]=(0,i.useState)(!1),[k,_]=(0,i.useState)(!1),[T,E]=(0,i.useState)(!1),[M,I]=(0,i.useState)(!1),[A,F]=(0,i.useState)({}),[O,U]=(0,i.useState)(!0),[z,B]=(0,i.useState)(null),[G,H]=(0,i.useState)([]),[J,V]=(0,i.useState)(""),W={accuracy:85.5,mae:12.3,rmse:18.7,r2:.78},Y={trends:[{description:"テクノロジー株の上昇傾向",sentiment:"positive"},{description:"エネルギー株の調整局面",sentiment:"negative"},{description:"金融株の安定推移",sentiment:"neutral"}]};!function(e){let{useEffect:t}=s(2265);t(()=>(Z.startComponentTimer(e),()=>{Z.endComponentTimer(e)}),[e])}("dashboard");let K=function(){let[e,t]=(0,i.useState)({isLoading:!0,error:null,connectionStatus:null,marketSummary:null,lastUpdated:null,analysisResults:[]}),s=(0,i.useCallback)(async()=>{t(e=>(0,m._)((0,d._)({},e),{isLoading:!0,error:null}));try{console.log("ダッシュボード: JQuants接続テスト開始...");let e=await (0,x.M)();if(t(t=>(0,m._)((0,d._)({},t),{connectionStatus:e})),!e.success){t(t=>(0,m._)((0,d._)({},t),{isLoading:!1,error:"API接続失敗: ".concat(e.message)}));return}console.log("ダッシュボード: 市場分析実行中...");let s=await (0,h.JR)();if(!s){t(e=>(0,m._)((0,d._)({},e),{isLoading:!1,error:"市場サマリーの生成に失敗しました"}));return}let a=new Date().toISOString();t(e=>(0,m._)((0,d._)({},e),{isLoading:!1,marketSummary:s,lastUpdated:a,error:null})),console.log("ダッシュボードデータ更新完了:",{analyzedSymbols:s.analyzedSymbols,totalRecommendations:Object.values(s.recommendations).reduce((e,t)=>e+t,0),topGainers:s.topGainers.length,topLosers:s.topLosers.length})}catch(e){console.error("ダッシュボードデータ取得エラー:",e),t(t=>(0,m._)((0,d._)({},t),{isLoading:!1,error:e instanceof Error?e.message:"不明なエラーが発生しました"}))}},[]);return(0,i.useEffect)(()=>{s()},[s]),(0,m._)((0,d._)({},e),{actions:{refresh:s}})}(),[q,X]=(0,i.useState)(!0),[Q,$]=(0,i.useState)(null),[ee,et]=(0,i.useState)(null),[es,ea]=(0,i.useState)([]),er=(0,i.useCallback)(async()=>{try{let e=await fetch("/data/listed_index.json");if(e.ok){let t=await e.json();$(t);let s=await en(t);et(s);try{let e=((null==s?void 0:s.topGainers)||[]).slice(0,10).map(e=>e.symbol);e.length>0&&ea(e)}catch(e){}}c(new Date().toLocaleString("ja-JP"))}catch(e){console.error("データ読み込みエラー:",e),B("データの読み込みに失敗しました")}},[]);(0,i.useEffect)(()=>{(async()=>{try{U(!0);let e={summary:{exists:(0,N.nw)("dash:summary").exists,timestamp:(0,N.nw)("dash:summary").timestamp||void 0},stock:{exists:(0,N.nw)("dash:stock").exists,timestamp:(0,N.nw)("dash:stock").timestamp||void 0},model:{exists:(0,N.nw)("dash:model").exists,timestamp:(0,N.nw)("dash:model").timestamp||void 0},feature:{exists:(0,N.nw)("dash:feature").exists,timestamp:(0,N.nw)("dash:feature").timestamp||void 0},pred:{exists:(0,N.nw)("dash:pred").exists,timestamp:(0,N.nw)("dash:pred").timestamp||void 0},marketInsights:{exists:(0,N.nw)("dash:marketInsights").exists,timestamp:(0,N.nw)("dash:marketInsights").timestamp||void 0},riskAssessment:{exists:(0,N.nw)("dash:riskAssessment").exists,timestamp:(0,N.nw)("dash:riskAssessment").timestamp||void 0}};F(e),await er();let t=L.g.getInstance();await t.initialize(),U(!1)}catch(e){console.error("ダッシュボード初期化エラー:",e),B("ダッシュボードの初期化に失敗しました"),U(!1)}})()},[er]),(0,i.useEffect)(()=>{ec()},[A]);let en=async e=>{let t=e.stocks||[],s=t.length,a=t.filter(e=>e.currentPrice&&void 0!==e.changePercent),r={},n={};a.forEach(e=>{e.sector&&void 0!==e.changePercent&&(n[e.sector]||(n[e.sector]={total:0,count:0}),n[e.sector].total+=e.changePercent,n[e.sector].count+=1)}),Object.entries(n).forEach(e=>{let[t,s]=e;r[t]=s.count>0?s.total/s.count:0});let i={STRONG_BUY:0,BUY:0,HOLD:0,SELL:0,STRONG_SELL:0};a.forEach(e=>{let t=el(ei(e,r),e.changePercent||0);i[t.recommendation]++});let l=a.sort((e,t)=>(t.changePercent||0)-(e.changePercent||0)).slice(0,10).map(e=>({symbol:e.code,name:e.name,changePercent:e.changePercent||0})),c=a.sort((e,t)=>(e.changePercent||0)-(t.changePercent||0)).slice(0,10).map(e=>({symbol:e.code,name:e.name,changePercent:e.changePercent||0}));return{totalStocks:s,analyzedStocks:a.length,recommendations:i,topGainers:l,topLosers:c,sectorPerformance:r}},ei=(e,t)=>{var s;let a=0;return void 0!==e.changePercent&&(a+=.4*Math.max(0,Math.min(100,50+2*e.changePercent))),e.sector&&void 0!==t[e.sector]&&(a+=.3*Math.max(0,Math.min(100,50+2*t[e.sector]))),a+=.2*(null!==(s=({プライム:80,スタンダード:60,グロース:40})[String(e.market)])&&void 0!==s?s:50),void 0!==e.volume&&(a+=.1*Math.min(100,10*Math.log10(e.volume+1))),Math.max(0,Math.min(100,a))},el=(e,t)=>e>=80?{recommendation:"STRONG_BUY"}:e>=65?{recommendation:"BUY"}:e>=45?{recommendation:"HOLD"}:e>=25?{recommendation:"SELL"}:{recommendation:"STRONG_SELL"},ec=()=>{var e,t,s,a,r,n,i;let l=[];(null===(e=A.summary)||void 0===e?void 0:e.exists)&&A.summary.timestamp&&l.push(S.getFreshnessInfo(A.summary.timestamp,"cache",60)),(null===(t=A.stock)||void 0===t?void 0:t.exists)&&A.stock.timestamp&&l.push(S.getFreshnessInfo(A.stock.timestamp,"cache",30)),(null===(s=A.model)||void 0===s?void 0:s.exists)&&A.model.timestamp&&l.push(S.getFreshnessInfo(A.model.timestamp,"cache",120)),(null===(a=A.feature)||void 0===a?void 0:a.exists)&&A.feature.timestamp&&l.push(S.getFreshnessInfo(A.feature.timestamp,"cache",60)),(null===(r=A.pred)||void 0===r?void 0:r.exists)&&A.pred.timestamp&&l.push(S.getFreshnessInfo(A.pred.timestamp,"cache",15)),(null===(n=A.marketInsights)||void 0===n?void 0:n.exists)&&A.marketInsights.timestamp&&l.push(S.getFreshnessInfo(A.marketInsights.timestamp,"cache",30)),(null===(i=A.riskAssessment)||void 0===i?void 0:i.exists)&&A.riskAssessment.timestamp&&l.push(S.getFreshnessInfo(A.riskAssessment.timestamp,"cache",60)),H(l)},eo=async()=>{w(!0),V("更新中...");try{await er(),V("更新完了"),setTimeout(()=>V(""),2e3)}catch(e){console.error("更新エラー:",e),V("更新失敗")}finally{w(!1)}},ed=async()=>{w(!0),V("強制更新中...");try{await er(),V("強制更新完了"),setTimeout(()=>V(""),2e3)}catch(e){console.error("強制更新エラー:",e),V("強制更新失敗")}finally{w(!1)}},em=async()=>{w(!0),V("再計算中...");try{await er(),V("再計算完了"),setTimeout(()=>V(""),2e3)}catch(e){console.error("再計算エラー:",e),V("再計算失敗")}finally{w(!1)}};return O?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"ダッシュボードを読み込み中..."})]})}):z?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(u.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:z}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"再読み込み"})]})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-20 lg:pb-0",children:[(0,n.jsx)(eM,{activeTab:a,onTabChange:r,onAnalysisClick:()=>_(!0),onSettingsClick:()=>E(!0),onMonitoringClick:()=>I(!0)}),(0,n.jsx)("header",{className:"hidden lg:block bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,n.jsxs)("div",{"data-guide-target":"welcome",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"J-Quants 株価予測ダッシュボード"}),(0,n.jsx)("p",{className:"text-gray-600",children:"機械学習による株価予測システム"})]}),(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row items-start xl:items-center space-y-2 xl:space-y-0 xl:space-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(g.Z,{className:"h-5 w-5 text-green-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"システム: 正常稼働中"})]}),G.length>0&&(0,n.jsx)(C,{freshnessInfos:G,onRefreshAll:eo}),G.length>0&&(0,n.jsx)(R,{freshnessInfos:G,showDetails:!1,onRefreshAll:eo,className:"hidden xl:block"})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)(D,{onRefresh:q?K.actions.refresh:eo,onForceRefresh:q?K.actions.refresh:ed,onRecompute:q?K.actions.refresh:em,isLoading:q?K.isLoading:o,lastRefresh:q?K.lastUpdated?new Date(K.lastUpdated):void 0:l?new Date(l):void 0,refreshInterval:5,variant:"default",size:"md",showProgress:!0,showLastRefresh:!0})})]})]})})}),(0,n.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsx)("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[{id:"overview",name:"概要",icon:p.Z},{id:"analysis",name:"分析",icon:f.Z},{id:"models",name:"モデル",icon:y.Z},{id:"predictions",name:"予測",icon:j.Z}].map(e=>{let t=e.icon;return(0,n.jsxs)("button",{onClick:()=>r(e.id),className:"flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ".concat(a===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,n.jsx)(t,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:e.name})]},e.id)})})}),(0,n.jsx)("div",{className:"mb-6 flex justify-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-2 shadow-sm border flex",children:[(0,n.jsx)("button",{onClick:()=>X(!0),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(q?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"実データ (JQuants)"}),(0,n.jsx)("button",{onClick:()=>X(!1),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(q?"text-gray-600 hover:text-gray-900":"bg-blue-600 text-white"),children:"サンプルデータ"})]})}),"overview"===a&&(0,n.jsxs)("div",{className:"space-y-6","data-guide-target":"overview",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"システム状況"}),q&&K.connectionStatus&&(0,n.jsxs)("div",{className:"flex items-center px-3 py-1 rounded-lg text-sm ".concat(K.connectionStatus.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:[K.connectionStatus.success?(0,n.jsx)(g.Z,{className:"w-4 h-4 mr-2"}):(0,n.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"JQuants API: ",K.connectionStatus.success?"接続中":"エラー"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(g.Z,{className:"h-8 w-8 text-green-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"システム状態"}),(0,n.jsx)("p",{className:"text-sm text-green-600",children:q&&(null===(e=K.connectionStatus)||void 0===e?void 0:e.success)?"JQuants接続中":"正常稼働中"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(b.Z,{className:"h-8 w-8 text-blue-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"データ更新"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:q?K.lastUpdated?new Date(K.lastUpdated).toLocaleString("ja-JP"):"未更新":l||"未更新"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(y.Z,{className:"h-8 w-8 text-purple-500"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"分析銘柄数"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:ee?"".concat(ee.analyzedStocks,"/").concat(ee.totalStocks,"件"):q&&K.marketSummary?"".concat(K.marketSummary.analyzedSymbols,"/").concat(K.marketSummary.totalSymbols,"件"):"学習済み"})]})]})]}),ee&&(0,n.jsxs)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ee.recommendations.STRONG_BUY+ee.recommendations.BUY}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"買い推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:ee.recommendations.HOLD}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"ホールド"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ee.recommendations.SELL+ee.recommendations.STRONG_SELL}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"売り推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:ee.topGainers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"上昇銘柄"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:ee.topLosers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"下落銘柄"})]})]}),!ee&&q&&K.marketSummary&&(0,n.jsxs)("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:K.marketSummary.recommendations.STRONG_BUY+K.marketSummary.recommendations.BUY}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"買い推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:K.marketSummary.recommendations.HOLD}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"ホールド"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:K.marketSummary.recommendations.SELL+K.marketSummary.recommendations.STRONG_SELL}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"売り推奨"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:K.marketSummary.topGainers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"上昇銘柄"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:K.marketSummary.topLosers.length}),(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"下落銘柄"})]})]}),!q&&G.length>0&&(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)(R,{freshnessInfos:G,showDetails:!0,onRefreshAll:eo})})]}),W&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"パフォーマンス指標"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[W.accuracy||"N/A","%"]}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"精度"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:W.mae||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"MAE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:W.rmse||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"RMSE"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:W.r2||"N/A"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"R\xb2"})]})]})]}),ee&&ee.sectorPerformance&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"セクター別パフォーマンス"}),(0,n.jsx)("div",{className:"space-y-3",children:Object.entries(ee.sectorPerformance).sort((e,t)=>{let[,s]=e,[,a]=t;return a-s}).slice(0,10).map((e,t)=>{let[s,a]=e;return(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsx)("span",{className:"text-sm text-gray-700",children:s}),(0,n.jsxs)("span",{className:"text-sm font-medium ".concat(a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"),children:[a>0?"+":"",a.toFixed(2),"%"]})]},t)})})]}),!ee&&Y&&(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"市場インサイト"}),(0,n.jsx)("div",{className:"space-y-3",children:null===(t=Y.trends)||void 0===t?void 0:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsx)("span",{className:"text-sm text-gray-700",children:e.description}),(0,n.jsx)("span",{className:"text-sm font-medium ".concat("positive"===e.sentiment?"text-green-600":"negative"===e.sentiment?"text-red-600":"text-gray-600"),children:"positive"===e.sentiment?"上昇":"negative"===e.sentiment?"下降":"中立"})]},t))})]})]}),"analysis"===a&&(0,n.jsxs)("div",{className:"space-y-6","data-guide-target":"analysis-features",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ワンクリック分析"}),(0,n.jsx)(eE,{})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"銘柄別分析結果"}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:es.length>0?"".concat(es.length,"銘柄を表示中"):"対象銘柄を選択してください"})]}),(0,n.jsx)(eC.Z,{selectedSymbols:es})]})]}),"models"===a&&(0,n.jsx)("div",{className:"space-y-6","data-guide-target":"model-comparison",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"モデル比較"}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"モデル名"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"タイプ"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MAE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RMSE"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R\xb2"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ランク"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:[{name:"Random Forest",type:"Ensemble",mae:10.2,mse:156.8,rmse:12.5,r2:.82,rank:1},{name:"XGBoost",type:"Gradient Boosting",mae:11.1,mse:178.3,rmse:13.4,r2:.79,rank:2},{name:"LSTM",type:"Neural Network",mae:12.8,mse:201.5,rmse:14.2,r2:.75,rank:3}].map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{},children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.name}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.type}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.mae.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.rmse.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.r2.toFixed(4)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,n.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(1===e.rank?"bg-green-100 text-green-800":e.rank<=3?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:["#",e.rank]})})]},t))})]})})]})}),"predictions"===a&&(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"予測結果"}),(0,n.jsx)(ev,{})]})})]}),k&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"分析実行"}),(0,n.jsx)("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-600",children:(0,n.jsx)(v.Z,{className:"h-6 w-6"})})]}),(0,n.jsx)(P,{})]})})]})})}function eD(){return(0,n.jsx)(l.SV,{fallbackRender:()=>(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)(U.default,{onError:()=>{},children:(0,n.jsx)("div",{})})}),children:(0,n.jsx)(o.SettingsProvider,{children:(0,n.jsx)(F,{children:(0,n.jsx)(q,{children:(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})}),children:(0,n.jsx)(eI,{})})})})})})}},5938:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(7437),r=s(2265),n=s(525),i=s(3085),l=s(1047),c=s(9322);function o(e){let{selectedSymbols:t}=e,[s,o]=(0,r.useState)([]),[d,m]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{t.length>0&&u()},[t]);let u=async()=>{try{m(!0),h(null);let e=await fetch("/data/symbol_analysis_results.json");if(!e.ok)throw Error("分析結果が見つかりません");let t=await e.json(),s=Object.values(t.analysis_results||{});o(s)}catch(e){console.error("分析結果読み込みエラー:",e),h("分析結果の読み込みに失敗しました")}finally{m(!1)}},g=e=>{switch(e){case"BUY":return(0,a.jsx)(n.Z,{className:"h-4 w-4 text-green-600"});case"SELL":return(0,a.jsx)(i.Z,{className:"h-4 w-4 text-red-600"});default:return(0,a.jsx)(l.Z,{className:"h-4 w-4 text-gray-600"})}},p=e=>{switch(e){case"BUY":return"text-green-600 bg-green-50";case"SELL":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},f=e=>e>=.8?"text-green-600":e>=.6?"text-yellow-600":"text-red-600";return d?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"分析結果を読み込み中..."})]}):x?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8 text-red-600",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 mr-2"}),(0,a.jsx)("span",{children:x})]}):0===s.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"分析結果がありません。銘柄を選択して分析を実行してください。"}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"選択された銘柄の分析結果"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.symbol}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 px-2 py-1 rounded-full text-xs ".concat(p(e.signals.overall_signal)),children:[g(e.signals.overall_signal),(0,a.jsx)("span",{children:e.signals.overall_signal})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"現在価格:"}),(0,a.jsxs)("span",{className:"font-medium",children:["\xa5",e.stats.current_price.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"変化率:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(e.stats.change_percent>=0?"text-green-600":"text-red-600"),children:[e.stats.change_percent>=0?"+":"",e.stats.change_percent.toFixed(2),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"信頼度:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(f(e.signals.confidence)),children:[(100*e.signals.confidence).toFixed(0),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"ボラティリティ:"}),(0,a.jsxs)("span",{className:"font-medium",children:[(100*e.stats.volatility).toFixed(1),"%"]})]})]}),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"RSI:"}),(0,a.jsx)("span",{className:p(e.signals.rsi_signal),children:e.signals.rsi_signal})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"MACD:"}),(0,a.jsx)("span",{className:p(e.signals.macd_signal),children:e.signals.macd_signal})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"BB:"}),(0,a.jsx)("span",{className:p(e.signals.bb_signal),children:e.signals.bb_signal})]})]})})]},e.symbol))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"技術指標詳細"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"銘柄"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RSI"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"MACD"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"BB%"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SMA5"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SMA25"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.symbol}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.technical.rsi?e.technical.rsi.toFixed(2):"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.technical.macd?e.technical.macd.toFixed(4):"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.technical.bb_percent?(100*e.technical.bb_percent).toFixed(1)+"%":"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.technical.sma_5?"\xa5"+e.technical.sma_5.toLocaleString():"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.technical.sma_25?"\xa5"+e.technical.sma_25.toLocaleString():"N/A"})]},e.symbol))})]})})]})]})}},3910:function(e,t,s){"use strict";s.d(t,{$:function(){return n}});var a=s(2265),r=s(3959);function n(){let{settings:e}=(0,r.r)(),[t,s]=(0,a.useState)(!1),[n,i]=(0,a.useState)(0),[l,c]=(0,a.useState)("");return{runAnalysisWithSettings:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{s(!0),i(0),c("設定に基づく分析を開始しています...");let a={prediction_days:e.prediction.days,primary_model:e.model.primary_model,compare_models:e.model.compare_models,auto_retrain:e.model.auto_retrain,retrain_frequency:e.model.retrain_frequency,max_data_points:e.data.max_data_points,include_technical_indicators:e.data.include_technical_indicators,selected_features:e.features.selected,symbols:t.symbols||[],analysis_type:t.analysisType||"comprehensive",use_settings:!1!==t.useSettings},r=setInterval(()=>{i(e=>e>=90?(clearInterval(r),e):e+10*Math.random())},500);c("分析パラメータを送信中..."),i(10),await new Promise(e=>setTimeout(e,1e3)),c("分析を実行中..."),i(50);let n={success:!0,analysis_id:"analysis_".concat(Date.now()),predictions:[{symbol:"7203.T",name:"トヨタ自動車",prediction:"BUY",confidence:.85,price:2500,change:2.5},{symbol:"6758.T",name:"ソニーグループ",prediction:"SELL",confidence:.72,price:12e3,change:-1.8}],summary:{total_predictions:2,buy_signals:1,sell_signals:1,avg_confidence:.785}};return c("分析が完了しました。データを更新しています..."),i(100),{success:!0,result:n,settings:a}}catch(e){return console.error("分析実行エラー:",e),c("分析エラー: ".concat(e instanceof Error?e.message:"不明なエラー")),{success:!1,error:e instanceof Error?e.message:"不明なエラー"}}finally{s(!1),setTimeout(()=>{i(0),c("")},2e3)}},isAnalyzing:t,analysisProgress:n,analysisStatus:l,getAnalysisDescription:()=>{let t=e.model.compare_models?"複数モデル比較（メイン: ".concat(e.model.primary_model,"）"):"単一モデル（".concat(e.model.primary_model,"）"),s=e.model.auto_retrain?"自動再訓練（".concat(e.model.retrain_frequency,"）"):"手動再訓練";return{prediction:"".concat(e.prediction.days,"日先予測"),model:t,retrain:s,features:"".concat(e.features.selected.length,"個の特徴量"),data:"".concat(e.data.max_data_points,"データポイント")}}}}},8071:function(e,t,s){"use strict";s.d(t,{g:function(){return r}});var a=s(257);class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){try{await this.loadConfig(),console.log("✅ 通知サービス初期化完了")}catch(e){throw console.error("通知サービス初期化エラー:",e),e}}async loadConfig(){try{let e=localStorage.getItem("notification-config");if(e)try{return this.config=JSON.parse(e),this.config}catch(e){console.warn("通知設定のJSON解析に失敗しました。デフォルトにフォールバックします。")}let t=void 0!==a&&a.env&&!1,s={email:{enabled:!1,smtp_server:"smtp.gmail.com",smtp_port:587,email_user:"",email_password:"",email_to:""},push:{enabled:!1,vapid_public_key:"",vapid_private_key:"",vapid_subject:"mailto:example@example.com"},schedule:{morning_analysis:"09:00",evening_analysis:"15:00",timezone:"Asia/Tokyo"},content:{include_analysis_summary:!0,include_performance_metrics:!0,include_recommendations:!0,include_risk_alerts:!0},filters:{min_confidence_threshold:.7,include_errors:!0,include_success:!0}};if(t){try{localStorage.setItem("notification-config",JSON.stringify(s))}catch(e){}return this.config=s,s}throw Error("設定が見つかりません")}catch(e){throw console.error("設定読み込みエラー:",e),e}}async saveConfig(e){try{localStorage.setItem("notification-config",JSON.stringify(e)),this.config=e}catch(e){throw console.error("設定保存エラー:",e),e}}async initializePushNotifications(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("プッシュ通知がサポートされていません"),!1;try{this.registration=await navigator.serviceWorker.register("/sw.js");let e=await Notification.requestPermission();if("granted"!==e)return console.warn("通知の許可が得られませんでした"),!1;return await this.subscribeToPushNotifications(),!0}catch(e){return console.error("プッシュ通知の初期化エラー:",e),!1}}async subscribeToPushNotifications(){var e;if(this.registration&&(null===(e=this.config)||void 0===e?void 0:e.push.enabled))try{let e=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.config.push.vapid_public_key});localStorage.setItem("push-subscription",JSON.stringify(e))}catch(e){console.error("プッシュ通知の購読エラー:",e)}}async sendLocalNotification(e){if(!this.registration||"granted"!==Notification.permission)return;let t={body:e.message,icon:"/favicon.ico",badge:"/favicon.ico",tag:e.type,data:e.data,requireInteraction:"high"===e.priority};await this.registration.showNotification(e.title,t)}async notifyAnalysisComplete(e){let t={type:"analysis_complete",title:"\uD83D\uDCCA 株価分析完了",message:"分析が完了しました。".concat(e.buy_candidates||0,"件の買い候補、").concat(e.sell_candidates||0,"件の売り候補が見つかりました。"),data:e,timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyError(e){let t={type:"error",title:"❌ 分析エラー",message:"分析中にエラーが発生しました: ".concat(e),timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(t)}async notifyRecommendation(e,t,s){let a={type:"recommendation",title:"\uD83D\uDCA1 ".concat(e," ").concat(t,"推奨"),message:s,data:{symbol:e,action:t,reason:s},timestamp:new Date().toISOString(),priority:"medium"};await this.sendLocalNotification(a)}async notifyRiskAlert(e,t){let s={type:"risk_alert",title:"⚠️ ".concat(e," リスク警告"),message:t,data:{symbol:e,message:t},timestamp:new Date().toISOString(),priority:"high"};await this.sendLocalNotification(s)}async startAutoUpdate(){try{if(!(await fetch("/api/start-auto-update",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("自動更新の開始に失敗しました");console.log("自動更新を開始しました")}catch(e){throw console.error("自動更新開始エラー:",e),e}}async stopAutoUpdate(){try{localStorage.removeItem("auto-update-enabled"),console.log("自動更新設定を削除しました（静的サイトでは実際の自動更新は実行されません）")}catch(e){throw console.error("自動更新停止エラー:",e),e}}async getNotificationHistory(){try{let e=localStorage.getItem("notification-history");if(e)return JSON.parse(e);return[]}catch(e){return console.error("通知履歴取得エラー:",e),[]}}constructor(){this.config=null,this.registration=null}}}},function(e){e.O(0,[732,466,735,56,971,117,744],function(){return e(e.s=6417)}),_N_E=e.O()}]);