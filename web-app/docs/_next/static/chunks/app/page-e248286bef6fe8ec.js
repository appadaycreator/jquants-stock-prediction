(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{70581:function(e,t,s){Promise.resolve().then(s.bind(s,47673))},47673:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L},dynamic:function(){return M}});var a=s(57437),r=s(2265),i=s(85583);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}async initDB(){return"undefined"==typeof indexedDB?Promise.resolve():new Promise((e,t)=>{let s=indexedDB.open("StockCacheDB",1);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("cache")){let e=t.createObjectStore("cache",{keyPath:"key"});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("ttl","ttl",{unique:!1})}}})}async getOrFetch(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{ttl:a=this.config.defaultTTL,version:r="1.0",forceRefresh:i=!1}=s;try{if(!i){let t=await this.get(e);if(t)return this.recordHit(),t}this.recordMiss();let s=await t();return await this.set(e,s,a,r),s}catch(s){console.error("キャッシュ取得エラー (".concat(e,"):"),s);let t=await this.get(e,!0);if(t)return console.warn("期限切れデータを使用: ".concat(e)),t;throw s}}async get(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"undefined"==typeof indexedDB?Promise.resolve(null):(this.db||await this.initDB(),new Promise((s,a)=>{let r=this.db.transaction(["cache"],"readonly").objectStore("cache").get(e);r.onsuccess=()=>{let a=r.result;if(!a){s(null);return}if(Date.now()>a.timestamp+a.ttl&&!t){this.delete(e),s(null);return}s(a.data)},r.onerror=()=>a(r.error)}))}async set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.config.defaultTTL,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"1.0";if("undefined"==typeof indexedDB)return Promise.resolve();this.db||await this.initDB();let r={data:t,timestamp:Date.now(),ttl:s,version:a};return new Promise((t,s)=>{let a=this.db.transaction(["cache"],"readwrite").objectStore("cache").put((0,i._)({key:e},r));a.onsuccess=()=>t(),a.onerror=()=>s(a.error)})}async delete(e){return this.db||await this.initDB(),new Promise((t,s)=>{let a=this.db.transaction(["cache"],"readwrite").objectStore("cache").delete(e);a.onsuccess=()=>t(),a.onerror=()=>s(a.error)})}async cleanup(){return this.db||await this.initDB(),new Promise((e,t)=>{let s=this.db.transaction(["cache"],"readwrite").objectStore("cache").index("timestamp"),a=Date.now(),r=0,i=s.openCursor();i.onsuccess=t=>{let s=t.target.result;if(s){let e=s.value;a>e.timestamp+e.ttl&&(s.delete(),r++),s.continue()}else e(r)},i.onerror=()=>t(i.error)})}async getSize(){return this.db||await this.initDB(),new Promise((e,t)=>{let s=this.db.transaction(["cache"],"readonly").objectStore("cache").count();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}recordHit(){this.metrics.hits++,this.metrics.total++,this.updateHitRate()}recordMiss(){this.metrics.misses++,this.metrics.total++,this.updateHitRate()}updateHitRate(){this.metrics.hitRate=this.metrics.total>0?this.metrics.hits/this.metrics.total*100:0}getMetrics(){return(0,i._)({},this.metrics)}resetMetrics(){this.metrics={hits:0,misses:0,total:0,hitRate:0}}logMetrics(){let e=this.getMetrics();console.log("\uD83D\uDCCA キャッシュメトリクス:"),console.log("  - ヒット率: ".concat(e.hitRate.toFixed(2),"%")),console.log("  - ヒット数: ".concat(e.hits)),console.log("  - ミス数: ".concat(e.misses)),console.log("  - 総リクエスト数: ".concat(e.total))}async clear(){return this.db||await this.initDB(),new Promise((e,t)=>{let s=this.db.transaction(["cache"],"readwrite").objectStore("cache").clear();s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}constructor(){this.db=null,this.metrics={hits:0,misses:0,total:0,hitRate:0},this.config={defaultTTL:864e5,maxSize:104857600,enableMetrics:!0},this.initDB()}}let l=n.getInstance();class c{async getDailyQuotes(){try{let e=await this.fetchWithTimeout("/data/sample_daily_quotes.json");if(e.ok){let t=await e.json();return this.validateDailyQuotesData(t)}throw Error("HTTP ".concat(e.status,": ").concat(e.statusText))}catch(e){return console.warn("サンプル日足データ取得エラー:",e),this.generateFallbackDailyQuotes()}}async getListedData(){try{let e=await this.fetchWithTimeout("/data/sample_listed_data.json");if(e.ok){let t=await e.json();return this.validateListedData(t)}throw Error("HTTP ".concat(e.status,": ").concat(e.statusText))}catch(e){return console.warn("サンプル上場銘柄データ取得エラー:",e),this.generateFallbackListedData()}}async isAvailable(){try{return(await this.fetchWithTimeout("/data/sample_daily_quotes.json",2e3)).ok}catch(e){return!1}}async fetchWithTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.config.timeout,s=new AbortController,a=setTimeout(()=>s.abort(),t);try{let t=await fetch(e,{signal:s.signal,headers:{"Content-Type":"application/json"}});return clearTimeout(a),t}catch(e){throw clearTimeout(a),e}}validateDailyQuotesData(e){if(!e.daily_quotes||!Array.isArray(e.daily_quotes))throw Error("Invalid daily quotes data structure");return e}validateListedData(e){if(!e.listed_data||!Array.isArray(e.listed_data))throw Error("Invalid listed data structure");return e}generateFallbackDailyQuotes(){let e=new Date,t=e.toISOString().split("T")[0];return{daily_quotes:[{code:"7203",name:"トヨタ自動車",sector:"自動車",date:t,open:26787,high:26886,low:26676,close:26755,volume:1213257,turnover_value:32460691035,adjustment_factor:1,adjustment_open:26710,adjustment_high:26805,adjustment_low:26603,adjustment_close:26755,adjustment_volume:1213257,adjustment_turnover_value:32460691035,change_percent:.08,timestamp:e.toISOString()},{code:"6758",name:"ソニーグループ",sector:"電気機器",date:t,open:48407,high:48509,low:48301,close:48478,volume:1224905,turnover_value:59380944590,adjustment_factor:1,adjustment_open:48432,adjustment_high:48571,adjustment_low:48333,adjustment_close:48478,adjustment_volume:1224905,adjustment_turnover_value:59380944590,change_percent:-.32,timestamp:e.toISOString()}],metadata:{generated_at:e.toISOString(),type:"daily_quotes",ttl:"24h",version:"1.0"}}}generateFallbackListedData(){return{listed_data:[{code:"7203",name:"トヨタ自動車",market:"東証プライム",sector17_code:"15",sector17_name:"自動車",sector33_code:"1510",sector33_name:"自動車",scale_code:"10",scale_name:"大型",listing_date:"1949-05-16",close_date:null},{code:"6758",name:"ソニーグループ",market:"東証プライム",sector17_code:"9",sector17_name:"電気機器",sector33_code:"9050",sector33_name:"電気機器",scale_code:"10",scale_name:"大型",listing_date:"1958-12-23",close_date:null}],metadata:{generated_at:new Date().toISOString(),type:"listed_data",ttl:"7d",version:"1.0"}}}constructor(e={}){this.config=(0,i._)({enabled:!0,timeout:5e3,retryCount:3,retryDelay:1e3},e)}}let o=new c;class d{static validateDailyQuotes(e){let t=[];if(!e)return t.push("データがnullまたはundefinedです"),{isValid:!1,errors:t};if(e.daily_quotes?Array.isArray(e.daily_quotes)?e.daily_quotes.forEach((e,s)=>{let a=this.validateDailyQuote(e);a.length>0&&t.push("日足データ[".concat(s,"]: ").concat(a.join(", ")))}):t.push("daily_quotesは配列である必要があります"):t.push("daily_quotesフィールドが存在しません"),e.metadata){let s=this.validateMetadata(e.metadata);s.length>0&&t.push("メタデータ: ".concat(s.join(", ")))}else t.push("metadataフィールドが存在しません");return{isValid:0===t.length,errors:t}}static validateListedData(e){let t=[];if(!e)return t.push("データがnullまたはundefinedです"),{isValid:!1,errors:t};if(e.listed_data?Array.isArray(e.listed_data)?e.listed_data.forEach((e,s)=>{let a=this.validateListedStock(e);a.length>0&&t.push("上場銘柄データ[".concat(s,"]: ").concat(a.join(", ")))}):t.push("listed_dataは配列である必要があります"):t.push("listed_dataフィールドが存在しません"),e.metadata){let s=this.validateMetadata(e.metadata);s.length>0&&t.push("メタデータ: ".concat(s.join(", ")))}else t.push("metadataフィールドが存在しません");return{isValid:0===t.length,errors:t}}static validateDailyQuote(e){let t=[];return["code","name","sector","date","open","high","low","close","volume","turnover_value","change_percent","timestamp"].forEach(s=>{(void 0===e[s]||null===e[s])&&t.push("".concat(s,"フィールドが必須です"))}),["open","high","low","close","volume","turnover_value","change_percent"].forEach(s=>{void 0!==e[s]&&"number"!=typeof e[s]&&t.push("".concat(s,"は数値である必要があります"))}),["code","name","sector","date","timestamp"].forEach(s=>{void 0!==e[s]&&"string"!=typeof e[s]&&t.push("".concat(s,"は文字列である必要があります"))}),e.date&&!this.isValidDate(e.date)&&t.push("dateは有効な日付形式である必要があります"),e.timestamp&&!this.isValidTimestamp(e.timestamp)&&t.push("timestampは有効なISO形式である必要があります"),t}static validateListedStock(e){let t=[];return["code","name","market","sector17_code","sector17_name","sector33_code","sector33_name","scale_code","scale_name","listing_date"].forEach(s=>{(void 0===e[s]||null===e[s])&&t.push("".concat(s,"フィールドが必須です"))}),["code","name","market","sector17_code","sector17_name","sector33_code","sector33_name","scale_code","scale_name","listing_date"].forEach(s=>{void 0!==e[s]&&"string"!=typeof e[s]&&t.push("".concat(s,"は文字列である必要があります"))}),e.listing_date&&!this.isValidDate(e.listing_date)&&t.push("listing_dateは有効な日付形式である必要があります"),e.close_date&&null!==e.close_date&&!this.isValidDate(e.close_date)&&t.push("close_dateは有効な日付形式またはnullである必要があります"),t}static validateMetadata(e){let t=[];return["generated_at","type","ttl","version"].forEach(s=>{(void 0===e[s]||null===e[s])&&t.push("メタデータの".concat(s,"フィールドが必須です"))}),e.generated_at&&!this.isValidTimestamp(e.generated_at)&&t.push("generated_atは有効なISO形式である必要があります"),t}static isValidDate(e){return!isNaN(new Date(e).getTime())&&/^\d{4}-\d{2}-\d{2}$/.test(e)}static isValidTimestamp(e){return!isNaN(new Date(e).getTime())&&e.includes("T")}static generateErrorReport(e){return{type:"parse",message:"データバリデーションエラー: ".concat(e.join("; ")),timestamp:new Date().toISOString(),fallbackUsed:!0}}}class m{static async fetchWithRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.MAX_RETRIES;for(let a=1;a<=s;a++)try{let r=await fetch(e,t);if(r.ok)return r;if(401===r.status)throw console.error("認証エラー (401): ".concat(e)),Error("認証エラー: ".concat(r.status));if(a<s)console.warn("API呼び出し失敗 (".concat(r.status,"): ").concat(e,", リトライ ").concat(a,"/").concat(s)),await this.delay(this.RETRY_DELAY*a);else throw Error("API呼び出し失敗: ".concat(r.status))}catch(t){if(a===s)throw t instanceof Error?t:Error(String(t));console.warn("API呼び出しエラー: ".concat(e,", リトライ ").concat(a,"/").concat(s),t instanceof Error?t.message:String(t)),await this.delay(this.RETRY_DELAY*a)}throw Error("最大リトライ回数に達しました")}static delay(e){return new Promise(t=>setTimeout(t,e))}static async getDailyQuotes(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.getOrFetch("daily_quotes_".concat(e||"latest"),async()=>{try{let e=await this.fetchWithRetry("/api/jquants-proxy/prices/daily_quotes",{method:"GET",headers:{"Content-Type":"application/json"}});return(await e.json()).daily_quotes||[]}catch(e){return console.error("日足データ取得エラー:",e),this.getSampleDailyQuotes()}},{ttl:this.CACHE_CONFIG.dailyQuotes.ttl,version:this.CACHE_CONFIG.dailyQuotes.version,forceRefresh:t})}static async getListedData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return l.getOrFetch("listed_data",async()=>{try{let e=await this.fetchWithRetry("/api/jquants-proxy/prices/listed_info",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error("API Error ".concat(e.status,": ").concat(t.message||e.statusText))}let t=await e.json();if(!t||"object"!=typeof t)throw Error("Invalid response format: expected object");return t.listed_info||[]}catch(e){return console.error("上場銘柄データ取得エラー:",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,timestamp:new Date().toISOString()}),this.getSampleListedData()}},{ttl:this.CACHE_CONFIG.listedData.ttl,version:this.CACHE_CONFIG.listedData.version,forceRefresh:e})}static async getSampleDailyQuotes(){try{let e=await o.getDailyQuotes(),t=d.validateDailyQuotes(e);return t.isValid||console.warn("サンプル日足データのバリデーションエラー:",t.errors),e.daily_quotes.map(e=>({code:e.code,name:e.name,price:e.close,change:e.close-e.open,changePercent:e.change_percent,volume:e.volume,timestamp:e.timestamp}))}catch(e){return console.error("サンプル日足データ取得エラー:",e instanceof Error?e.message:String(e)),[{code:"7203",name:"トヨタ自動車",price:2500,change:50,changePercent:2.04,volume:1e6,timestamp:new Date().toISOString()},{code:"6758",name:"ソニーグループ",price:12e3,change:-100,changePercent:-.83,volume:5e5,timestamp:new Date().toISOString()}]}}static async getSampleListedData(){try{let e=await o.getListedData(),t=d.validateListedData(e);return t.isValid||console.warn("サンプル上場銘柄データのバリデーションエラー:",t.errors),e.listed_data.map(e=>({code:e.code,name:e.name,market:e.market,sector:e.sector17_name,listingDate:e.listing_date}))}catch(e){return console.error("サンプル上場銘柄データ取得エラー:",e instanceof Error?e.message:String(e)),[{code:"7203",name:"トヨタ自動車",market:"東証プライム",sector:"自動車",listingDate:"1949-05-16"},{code:"6758",name:"ソニーグループ",market:"東証プライム",sector:"電気機器",listingDate:"1958-12-23"}]}}static async initialize(){try{console.log("\uD83D\uDE80 データキャッシュ初期化開始");let e=await l.cleanup();console.log("\uD83E\uDDF9 期限切れデータ削除: ".concat(e,"件"));let t=await l.getSize();console.log("\uD83D\uDCE6 キャッシュサイズ: ".concat(t,"件")),l.logMetrics(),console.log("✅ データキャッシュ初期化完了")}catch(e){console.error("❌ データキャッシュ初期化エラー:",e instanceof Error?e.message:String(e))}}static isOffline(){return!navigator.onLine}static onNetworkChange(e){let t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}static async forceRefresh(){try{console.log("\uD83D\uDD04 全キャッシュの強制リフレッシュ"),await l.clear(),console.log("✅ 全キャッシュクリア完了")}catch(e){console.error("❌ 強制リフレッシュエラー:",e)}}}m.CACHE_CONFIG={dailyQuotes:{ttl:864e5,version:"1.0"},listedData:{ttl:6048e5,version:"1.0"},sampleData:{ttl:2592e6,version:"1.0"}},m.MAX_RETRIES=3,m.RETRY_DELAY=1e3;class h{static getInstance(){return h.instance||(h.instance=new h),h.instance}async initialize(){return this.isInitialized?void 0:(this.initPromise||(this.initPromise=this._performInitialization()),this.initPromise)}async _performInitialization(){try{console.log("\uD83D\uDE80 キャッシュシステム初期化開始"),await m.initialize();let e=m.isOffline();console.log("\uD83C\uDF10 ネットワーク状態: ".concat(e?"オフライン":"オンライン")),e?console.log("\uD83D\uDCF1 オフライン状態: キャッシュデータを使用"):await this._refreshExpiredData(),this._startNetworkMonitoring(),this.isInitialized=!0,console.log("✅ キャッシュシステム初期化完了")}catch(e){throw console.error("❌ キャッシュシステム初期化エラー:",e),e}}async _refreshExpiredData(){try{console.log("\uD83D\uDD04 期限切れデータの差分取得開始");try{await m.getDailyQuotes(void 0,!1),console.log("✅ 日足データ更新完了")}catch(e){console.warn("⚠️ 日足データ更新失敗（キャッシュデータを使用）:",e)}try{await m.getListedData(!1),console.log("✅ 上場銘柄データ更新完了")}catch(e){console.warn("⚠️ 上場銘柄データ更新失敗（キャッシュデータを使用）:",e)}console.log("✅ 期限切れデータの差分取得完了")}catch(e){console.error("❌ 期限切れデータ取得エラー:",e)}}_startNetworkMonitoring(){let e=m.onNetworkChange(e=>{e?(console.log("\uD83C\uDF10 オンライン復帰: データ更新を開始"),this._refreshExpiredData()):console.log("\uD83D\uDCF1 オフライン状態: キャッシュデータを使用")});window.addEventListener("beforeunload",e)}async forceRefresh(){try{console.log("\uD83D\uDD04 強制リフレッシュ開始"),await m.forceRefresh(),await this._refreshExpiredData(),console.log("✅ 強制リフレッシュ完了")}catch(e){throw console.error("❌ 強制リフレッシュエラー:",e),e}}getMetrics(){return l.getMetrics()}logMetrics(){l.logMetrics()}isReady(){return this.isInitialized}constructor(){this.isInitialized=!1,this.initPromise=null}}let u=h.getInstance();var x=s(63889),g=s(1780),f=s(41671),y=s(76865),p=s(99388),j=s(42488),w=s(62926),b=s(75395),N=s(91723),v=s(50091),_=s(82431),E=s(98728);function D(e){let{isOpen:t,onClose:s,onRefresh:n,onGoToSettings:l}=e,[c,o]=(0,r.useState)({lastSuccessTime:null,apiRemainingCalls:null,tokenExpirationTime:null,networkStatus:navigator.onLine?"online":"offline",errorCount:0,successCount:0,averageResponseTime:null,lastError:null,systemStatus:"healthy"}),[d,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!t)return;let e=async()=>{try{let e=await fetch("/api/auth/status"),t=e.ok?await e.json():null,s=await fetch("/api/health"),a=s.ok?await s.json():null;o(e=>(0,g._)((0,i._)({},e),{lastSuccessTime:Date.now(),apiRemainingCalls:(null==t?void 0:t.remainingCalls)||null,tokenExpirationTime:(null==t?void 0:t.tokenExpiration)||null,networkStatus:navigator.onLine?"online":"offline",systemStatus:(null==a?void 0:a.status)==="ok"?"healthy":"degraded"}))}catch(e){o(t=>(0,g._)((0,i._)({},t),{lastError:e instanceof Error?e.message:"Unknown error",systemStatus:"critical"}))}};e();let s=setInterval(e,3e4);return()=>clearInterval(s)},[t]);let h=async()=>{m(!0);try{await n(),o(e=>(0,g._)((0,i._)({},e),{lastSuccessTime:Date.now(),errorCount:0,lastError:null,systemStatus:"healthy"}))}catch(e){o(t=>(0,g._)((0,i._)({},t),{errorCount:t.errorCount+1,lastError:e instanceof Error?e.message:"Unknown error",systemStatus:"critical"}))}finally{m(!1)}},u=e=>e?new Date(e).toLocaleString("ja-JP"):"未取得";return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"システム診断"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(p.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"システム状態"}),(e=>{switch(e){case"healthy":return(0,a.jsx)(f.Z,{className:"w-5 h-5 text-green-500"});case"degraded":return(0,a.jsx)(y.Z,{className:"w-5 h-5 text-yellow-500"});case"critical":return(0,a.jsx)(p.Z,{className:"w-5 h-5 text-red-500"});default:return(0,a.jsx)(j.Z,{className:"w-5 h-5 text-gray-500"})}})(c.systemStatus)]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:(e=>{switch(e){case"healthy":return"正常";case"degraded":return"一部機能制限";case"critical":return"重大な問題";default:return"不明"}})(c.systemStatus)})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"ネットワーク"}),"online"===c.networkStatus?(0,a.jsx)(w.Z,{className:"w-5 h-5 text-green-500"}):(0,a.jsx)(b.Z,{className:"w-5 h-5 text-red-500"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"online"===c.networkStatus?"オンライン":"オフライン"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"最後の成功取得"}),(0,a.jsx)(N.Z,{className:"w-5 h-5 text-blue-500"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:u(c.lastSuccessTime)})]}),null!==c.apiRemainingCalls&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"API残呼数"}),(0,a.jsx)(v.Z,{className:"w-5 h-5 text-blue-500"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[c.apiRemainingCalls," 回"]})]}),c.tokenExpirationTime&&(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"トークン期限"}),(0,a.jsx)(N.Z,{className:"w-5 h-5 text-orange-500"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["残り: ",(e=>{if(!e)return"不明";let t=e-Date.now();if(t<=0)return"期限切れ";let s=Math.floor(t/36e5),a=Math.floor(t%36e5/6e4);return s>0?"".concat(s,"時間").concat(a,"分"):"".concat(a,"分")})(c.tokenExpirationTime)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["期限: ",u(c.tokenExpirationTime)]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"統計情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"成功回数"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-green-600",children:c.successCount})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"エラー回数"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-red-600",children:c.errorCount})]})]}),c.averageResponseTime&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"平均応答時間"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:[c.averageResponseTime.toFixed(0),"ms"]})]})]}),c.lastError&&(0,a.jsxs)("div",{className:"bg-red-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-red-900 mb-3",children:"最後のエラー"}),(0,a.jsx)("p",{className:"text-sm text-red-600 break-words",children:c.lastError})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex space-x-3",children:[(0,a.jsxs)("button",{onClick:h,disabled:d,className:"flex-1 flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[d?(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"更新"]}),(0,a.jsxs)("button",{onClick:l,className:"flex-1 flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),"設定"]})]})]})})}):null}var R=s(27648),S=s(70525),T=s(88906),C=s(33276),k=s(58896),I=s(76858),O=s(96215),Z=s(7586),A=s(71769);let M="force-dynamic";function L(){let[e,t]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{t(!0),(async()=>{try{await u.initialize(),i(!0),console.log("✅ キャッシュシステム準備完了")}catch(e){console.error("❌ キャッシュシステム初期化エラー:",e),i(!0)}})()},[]),e)?(0,a.jsx)(x.S,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg",children:(0,a.jsx)(S.Z,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"J-Quants 株価予測システム"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"機械学習による投資判断支援"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>l(!0),className:"text-gray-600 hover:text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"診断"})]}),(0,a.jsxs)(R.default,{href:"/today",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"今すぐ開始"})]})]})]})})}),(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,a.jsxs)("div",{className:"text-center mb-16",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold text-gray-900 mb-6",children:"5分で完了する投資判断"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:"機械学習とリアルタイムデータ分析により、効率的な投資判断をサポートします。 複雑な分析は自動化し、あなたは重要な判断に集中できます。"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,a.jsxs)(R.default,{href:"/today",className:"bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 flex items-center justify-center space-x-2 text-lg font-semibold",children:[(0,a.jsx)(k.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"今日のタスクを開始"}),(0,a.jsx)(I.Z,{className:"h-5 w-5"})]}),(0,a.jsxs)(R.default,{href:"/dashboard",className:"bg-white text-gray-700 px-8 py-4 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center justify-center space-x-2 text-lg font-semibold",children:[(0,a.jsx)(O.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"詳細分析を見る"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 text-center",children:[(0,a.jsx)("div",{className:"bg-green-100 p-3 rounded-lg w-fit mx-auto mb-4",children:(0,a.jsx)(N.Z,{className:"h-8 w-8 text-green-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"5分ルーティン"}),(0,a.jsx)("p",{className:"text-gray-600",children:"毎日の投資判断を5分で完了。データ更新、候補銘柄の確認、保有銘柄の判断を効率的に実行。"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 text-center",children:[(0,a.jsx)("div",{className:"bg-blue-100 p-3 rounded-lg w-fit mx-auto mb-4",children:(0,a.jsx)(O.Z,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"詳細分析"}),(0,a.jsx)("p",{className:"text-gray-600",children:"機械学習モデルの比較、パフォーマンス指標、市場インサイトなど、深い分析機能を提供。"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-6 text-center",children:[(0,a.jsx)("div",{className:"bg-purple-100 p-3 rounded-lg w-fit mx-auto mb-4",children:(0,a.jsx)(T.Z,{className:"h-8 w-8 text-purple-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"リスク管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"リスク評価、ポートフォリオ監視、自動アラート機能で投資を安全にサポート。"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-gray-900 mb-6 text-center",children:"クイックアクセス"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(R.default,{href:"/today",className:"flex items-center space-x-3 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(k.Z,{className:"h-6 w-6 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"今日のタスク"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"5分ルーティン"})]})]}),(0,a.jsxs)(R.default,{href:"/dashboard",className:"flex items-center space-x-3 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(O.Z,{className:"h-6 w-6 text-green-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"詳細分析"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"ダッシュボード"})]})]}),(0,a.jsxs)(R.default,{href:"/listed-data",className:"flex items-center space-x-3 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(Z.Z,{className:"h-6 w-6 text-purple-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"銘柄一覧"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"上場銘柄検索"})]})]}),(0,a.jsxs)(R.default,{href:"/risk",className:"flex items-center space-x-3 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(T.Z,{className:"h-6 w-6 text-red-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"リスク管理"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"ポートフォリオ監視"})]})]}),(0,a.jsxs)(R.default,{href:"/settings",className:"flex items-center space-x-3 p-4 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(E.Z,{className:"h-6 w-6 text-gray-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"設定"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"システム設定"})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-16 bg-white rounded-xl shadow-sm border p-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-gray-900",children:"システム状況"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.Z,{className:"h-5 w-5 text-green-500"}),(0,a.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"正常稼働中"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"99.9%"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"稼働率"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600 mb-2",children:"24/7"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"監視体制"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:"リアルタイム"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"データ更新"})]})]})]})]}),(0,a.jsx)("footer",{className:"bg-white border-t mt-16",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4 md:mb-0",children:[(0,a.jsx)(S.Z,{className:"h-6 w-6 text-blue-600"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"J-Quants 株価予測システム"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)(R.default,{href:"/usage",className:"text-sm text-gray-600 hover:text-gray-900 flex items-center space-x-1",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"使い方"})]}),(0,a.jsx)(R.default,{href:"/troubleshooting",className:"text-sm text-gray-600 hover:text-gray-900",children:"トラブルシューティング"})]})]}),(0,a.jsx)("div",{className:"border-t mt-6 pt-6 text-center",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"\xa9 2024 J-Quants 株価予測システム. 機械学習による投資判断支援ツール."})})]})}),(0,a.jsx)(D,{isOpen:n,onClose:()=>l(!1),onRefresh:()=>{window.location.reload()},onGoToSettings:()=>{window.location.href="/settings"}})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})]})})}},63889:function(e,t,s){"use strict";s.d(t,{S:function(){return d}});var a=s(57437),r=s(2265),i=s(98728),n=s(82431),l=s(76865),c=s(75395),o=s(50091);class d extends r.Component{static getDerivedStateFromError(e){let t=d.categorizeError(e);return{hasError:!0,error:e,errorType:t}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),console.error("ErrorBoundary caught an error:",e,t),this.props.onError&&this.props.onError(e,t)}componentWillUnmount(){this.retryTimeoutId&&clearTimeout(this.retryTimeoutId)}static categorizeError(e){let t=e.message.toLowerCase();return t.includes("401")||t.includes("403")||t.includes("unauthorized")?"AUTH_ERROR":t.includes("429")||t.includes("rate limit")?"RATE_LIMIT":t.includes("5")||t.includes("server error")?"SERVER_ERROR":t.includes("network")||t.includes("fetch")||t.includes("timeout")?"NETWORK_ERROR":t.includes("schema")||t.includes("validation")?"SCHEMA_ERROR":"UNKNOWN_ERROR"}getErrorDetails(){let{errorType:e}=this.state;switch(e){case"AUTH_ERROR":return{type:"AUTH_ERROR",message:"認証に失敗しました",userMessage:"ログイン情報が無効または期限切れです",action:"設定画面で認証情報を確認してください",icon:(0,a.jsx)(i.Z,{className:"w-8 h-8 text-red-500"}),canRetry:!0,canUseSample:!0,canGoToSettings:!0};case"RATE_LIMIT":return{type:"RATE_LIMIT",message:"API呼び出し制限に達しました",userMessage:"しばらく待ってから再試行してください",action:"数分後に自動的に再試行します",icon:(0,a.jsx)(n.Z,{className:"w-8 h-8 text-yellow-500"}),canRetry:!0,canUseSample:!0,canGoToSettings:!1};case"SERVER_ERROR":return{type:"SERVER_ERROR",message:"サーバーエラーが発生しました",userMessage:"サーバー側で問題が発生しています",action:"しばらく待ってから再試行してください",icon:(0,a.jsx)(l.Z,{className:"w-8 h-8 text-red-500"}),canRetry:!0,canUseSample:!0,canGoToSettings:!1};case"NETWORK_ERROR":return{type:"NETWORK_ERROR",message:"ネットワーク接続エラー",userMessage:"インターネット接続を確認してください",action:"接続が回復すると自動的に再試行します",icon:(0,a.jsx)(c.Z,{className:"w-8 h-8 text-orange-500"}),canRetry:!0,canUseSample:!0,canGoToSettings:!1};case"SCHEMA_ERROR":return{type:"SCHEMA_ERROR",message:"データ形式エラー",userMessage:"受信したデータの形式が正しくありません",action:"サンプルデータに切り替えます",icon:(0,a.jsx)(o.Z,{className:"w-8 h-8 text-blue-500"}),canRetry:!1,canUseSample:!0,canGoToSettings:!1};default:return{type:"UNKNOWN_ERROR",message:"予期しないエラーが発生しました",userMessage:"システムで予期しない問題が発生しました",action:"ページを再読み込みしてください",icon:(0,a.jsx)(l.Z,{className:"w-8 h-8 text-gray-500"}),canRetry:!0,canUseSample:!0,canGoToSettings:!1}}}render(){if(this.state.hasError){let e=this.getErrorDetails(),{retryCount:t,lastRetryTime:s}=this.state,{maxRetries:r=3}=this.props;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[e.icon,(0,a.jsx)("h2",{className:"mt-4 text-xl font-semibold text-gray-900",children:e.message}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:e.userMessage}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:e.action})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-3",children:[e.canRetry&&t<r&&(0,a.jsxs)("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4 mr-2"}),"再試行 (",t+1,"/",r,")"]}),e.canUseSample&&(0,a.jsxs)("button",{onClick:this.handleUseSample,className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"サンプルデータを使用"]}),e.canGoToSettings&&(0,a.jsxs)("button",{onClick:this.handleGoToSettings,className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"設定画面へ"]}),(0,a.jsx)("button",{onClick:this.handleReload,className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"ページを再読み込み"})]}),t>0&&(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500 text-center",children:["再試行回数: ",t,"/",r,s&&(0,a.jsxs)("div",{children:["最終再試行: ",new Date(s).toLocaleTimeString()]})]}),!1]})})}return this.props.children}constructor(e){super(e),this.retryTimeoutId=null,this.handleRetry=()=>{let{maxRetries:e=3,retryDelay:t=1e3}=this.props,{retryCount:s}=this.state;if(s>=e){console.warn("最大再試行回数に達しました");return}this.retryTimeoutId=setTimeout(()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1,lastRetryTime:Date.now()}))},t*Math.pow(2,s))},this.handleUseSample=()=>{console.log("サンプルデータに切り替え"),this.setState({hasError:!1,error:null,errorInfo:null})},this.handleGoToSettings=()=>{window.location.href="/settings/auth"},this.handleReload=()=>{window.location.reload()},this.state={hasError:!1,error:null,errorInfo:null,errorType:"UNKNOWN_ERROR",retryCount:0,lastRetryTime:null}}}}},function(e){e.O(0,[1216,1744],function(){return e(e.s=70581)}),_N_E=e.O()}]);