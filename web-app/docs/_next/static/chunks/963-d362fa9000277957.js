"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[963],{60444:function(t,e,a){a.d(e,{M7:function(){return u}});var n=a(22214),s=a(85583);class r{async get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",t,void 0,e)}async post(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",t,e,a)}async put(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",t,e,a)}async delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",t,void 0,e)}async request(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=(0,s._)({},this.defaultConfig,n),i=this.buildUrl(e),c=null;for(let e=0;e<=r.retries;e++)try{return await this.executeRequest(t,i,a,r)}catch(t){if(c=t,e<r.retries){await this.delay(r.retryDelay*Math.pow(2,e));continue}}throw c||Error("Request failed")}async executeRequest(t,e,a,n){let r=new AbortController,i=setTimeout(()=>r.abort(),n.timeout);try{let c=await fetch(e,{method:t,headers:(0,s._)({"Content-Type":"application/json"},n.headers),body:a?JSON.stringify(a):void 0,signal:r.signal});if(clearTimeout(i),!c.ok)throw Error("HTTP ".concat(c.status,": ").concat(c.statusText));return{data:await c.json(),status:c.status,statusText:c.statusText,headers:this.extractHeaders(c)}}catch(t){throw clearTimeout(i),t}}buildUrl(t){return t.startsWith("http")?t:"".concat(this.baseURL).concat(t.startsWith("/")?t:"/".concat(t))}extractHeaders(t){let e={};return t.headers&&"function"==typeof t.headers.forEach&&t.headers.forEach((t,a)=>{e[a]=t}),e}delay(t){return new Promise(e=>setTimeout(e,t))}async testConnection(){if(this.isStaticSite())return{success:!0,message:"静的サイトモード: モックデータを使用中"};try{let t=await fetch("/api/health",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));let e=await t.json();return{success:!0,message:"API接続成功: ".concat(e.status)}}catch(t){return console.error("API接続テストエラー:",t),{success:!1,message:"API接続失敗: ".concat(t instanceof Error?t.message:"Unknown error")}}}isStaticSite(){let t=window.location.hostname;return t.includes("github.io")||t.includes("netlify.app")||t.includes("vercel.app")||t.includes("appadaycreator.github.io")||t.includes("localhost")}async getStockData(t){return this.isStaticSite()?{symbol:t,price:2500,change:2.5,volume:1e6,lastUpdated:new Date().toISOString()}:(await this.get("/stocks/".concat(t))).data}async getMarketData(){return this.isStaticSite()?{marketStatus:"open",topGainers:[],topLosers:[],lastUpdated:new Date().toISOString()}:(await this.get("/market")).data}async getPredictions(){return this.isStaticSite()?{predictions:[],lastUpdated:new Date().toISOString()}:(await this.get("/predictions")).data}async getPersonalInvestmentData(){return this.isStaticSite()?{portfolio:{totalValue:1e6,totalReturn:5.2},positions:[],lastUpdated:new Date().toISOString()}:(await this.get("/personal-investment")).data}constructor(t=""){this.baseURL=t,this.defaultConfig={timeout:1e4,retries:3,retryDelay:1e3,cache:!0,cacheTTL:3e5}}}new r;var i=a(40257);class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}getClient(){return this.client||(this.client=this.isStaticSite()?new n.W:new r),this.client}isStaticSite(){if("true"===i.env.NEXT_PUBLIC_FORCE_REAL_API)return!1;try{let t=new URLSearchParams(window.location.search).get("forceReal");if(t&&["1","true","on","yes"].includes(t.toLowerCase()))return!1}catch(t){}let t=window.location.hostname;return t.includes("github.io")||t.includes("netlify.app")||t.includes("vercel.app")||t.includes("appadaycreator.github.io")}reset(){this.client=null}constructor(){this.client=null}}let o=c.getInstance(),l=()=>o.getClient(),u=async()=>{let t=l();return"testConnection"in t?await t.testConnection():{success:!0,message:"静的サイトモード: モックデータを使用中"}}},22214:function(t,e,a){a.d(e,{G:function(){return s},W:function(){return n}});class n{detectStaticSite(){let t=window.location.hostname;return t.includes("github.io")||t.includes("netlify.app")||t.includes("vercel.app")}async checkHealth(){if(this.isStaticSite)return this.getMockHealthResponse();try{let t=await fetch("".concat(this.baseUrl,"/api/health"));if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));return await t.json()}catch(t){return console.warn("API接続失敗、フォールバックを使用:",t),this.getMockHealthResponse()}}async testJQuantsConnection(){if(this.isStaticSite)return{success:!0,message:"静的サイトモード: モック接続成功"};try{let t=await fetch("".concat(this.baseUrl,"/api/auth/test"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test:!0})});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));let e=await t.json();return{success:e.success||!1,message:e.message||"接続テスト完了"}}catch(t){return console.warn("J-Quants接続テスト失敗、フォールバックを使用:",t),{success:!0,message:"静的サイトモード: モック接続成功"}}}async fetchStockData(){if(this.isStaticSite)return this.getMockStockData();try{let t=await fetch("".concat(this.baseUrl,"/api/routine/candidates"));if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));return await t.json()}catch(t){return console.warn("株価データ取得失敗、フォールバックを使用:",t),this.getMockStockData()}}getMockHealthResponse(){return{status:"ok",timestamp:new Date().toISOString(),environment:{nodeEnv:"production",hasIdToken:!1,hasRefreshToken:!1,hasEmail:!1,hasPassword:!1,envVars:{JQUANTS_ID_TOKEN:"静的サイトモード",JQUANTS_REFRESH_TOKEN:"静的サイトモード",JQUANTS_EMAIL:"静的サイトモード",JQUANTS_PASSWORD:"静的サイトモード"}},api:{jquantsProxy:"/api/jquants-proxy",health:"/api/health"}}}getMockStockData(){return{candidates:[{code:"7203",name:"トヨタ自動車",price:2500,change:50,changePercent:2.04,reason:"モックデータ: 流動性・トレンド・バリュー・クオリティの総合評価で上位",score:85.2,indicators:{volume:"上位70%",trend:"13週>26週",value:"PBR中央値以下",quality:"ROE上位40%"}},{code:"6758",name:"ソニーグループ",price:12e3,change:200,changePercent:1.69,reason:"モックデータ: テクノロジーセクターで強いトレンド",score:78.5,indicators:{volume:"上位70%",trend:"13週>26週",value:"PER下位40%",quality:"ROE上位40%"}}],metadata:{generated_at:new Date().toISOString(),source:"static_fallback",total_candidates:2}}}isStaticSiteMode(){return this.isStaticSite}getFallbackMessage(){return this.isStaticSite?"静的サイトモード: サンプルデータを表示中":"API接続エラー: フォールバックデータを表示中"}constructor(){this.baseUrl=window.location.origin,this.isStaticSite=this.detectStaticSite()}}let s=new n},94076:function(t,e,a){a.d(e,{Q8:function(){return u},Z_:function(){return i},gz:function(){return s},nw:function(){return o},rd:function(){return r}});var n=a(85583);a(2265);class s extends Error{constructor(t,e,a,n){super(t),this.code=e,this.status=a,this.retryHint=n,this.name="AppError"}}async function r(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t=>{try{if(/^https?:\/\//i.test(t))return t;if(t.startsWith("/"))return"".concat("/jquants-stock-prediction").concat(t);return t}catch(e){return t}},{signal:r,timeout:i=1e4,retries:c=3,retryDelay:o=1e3,method:l,headers:u,json:h,idempotencyKey:d}=e,f=new AbortController,g=setTimeout(()=>f.abort(),i);r&&r.addEventListener("abort",()=>f.abort());let p=null;for(let e=0;e<=c;e++)try{let e={"Cache-Control":"no-cache",Pragma:"no-cache"},r=void 0!==h;r&&(e["Content-Type"]="application/json");let i=l||(r?"POST":"GET"),c=/^(POST|PUT|PATCH|DELETE)$/i.test(i),o=!0===d?function(){try{var t,e;let a=globalThis.crypto&&(null===(t=(e=globalThis.crypto).randomUUID)||void 0===t?void 0:t.call(e))||void 0;if(a)return"idem_".concat(a)}catch(t){}let a=Math.random().toString(36).slice(2);return"idem_".concat(Date.now(),"_").concat(a)}():"string"==typeof d?d:void 0;c&&o&&(e["Idempotency-Key"]=o);let p=await fetch(a(t),{signal:f.signal,cache:"no-cache",method:i,headers:(0,n._)({},e,u||{}),body:r?JSON.stringify(h):void 0});if(clearTimeout(g),!p.ok)try{let t=await p.text(),e=JSON.parse(t);if(e&&"object"==typeof e&&e.error_code&&e.user_message)throw new s(e.user_message,String(e.error_code),p.status,e.retry_hint);throw new s("HTTP ".concat(p.status,": ").concat(p.statusText),"HTTP_".concat(p.status),p.status)}catch(t){if(t instanceof s)throw t;throw new s("HTTP ".concat(p.status,": ").concat(p.statusText),"HTTP_".concat(p.status),p.status)}let w=p.headers.get("content-type");if(!w||!w.includes("application/json"))throw new s("レスポンスがJSON形式ではありません","INVALID_CONTENT_TYPE");return await p.json()}catch(a){if(p=a,a instanceof Error&&"AbortError"===a.name)throw new s("リクエストが中断されました","ABORTED");if(e<c){let n=o*Math.pow(2,e);console.warn("Fetch attempt ".concat(e+1," failed for ").concat(t,":"),a),console.log("Retrying in ".concat(n,"ms...")),await new Promise(t=>setTimeout(t,n))}}if(p instanceof s)throw p;throw new s("すべてのリトライ試行が失敗しました: ".concat((null==p?void 0:p.message)||"Unknown error"),"ALL_RETRIES_FAILED")}async function i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={},n=[],s=Object.entries(t).map(async t=>{let[a,s]=t;try{let t=await r(s,e);return{key:a,data:t}}catch(e){let t=e instanceof Error?e.message:"Unknown error";return n.push("".concat(a,": ").concat(t)),{key:a,data:null}}});return(await Promise.all(s)).forEach(t=>{let{key:e,data:n}=t;null!==n&&(a[e]=n)}),n.length>0&&console.warn("一部のデータ取得に失敗しました:",n),a}let c="app_cache:";function o(t){try{let e=function(t){try{let e=localStorage.getItem(c+t);if(!e)return null;let a=JSON.parse(e);return"number"==typeof a.t?a.t:null}catch(t){return null}}(t);if(!e)return{exists:!1,timestamp:null,ageMs:null};return{exists:!0,timestamp:e,ageMs:Date.now()-e}}catch(t){return{exists:!1,timestamp:null,ageMs:null}}}function l(t,e){try{let a=localStorage.getItem(c+t);if(!a)return null;let n=JSON.parse(a);if(e&&Date.now()-n.t>e)return null;return n.v}catch(t){return null}}async function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{cacheKey:a,cacheTtlMs:n}=e;if(a){let t=l(a,n);if(t)return console.log("Using cached data for ".concat(a)),{data:t,fromCache:!0}}try{let n=await r(t,e);return a&&(function(t,e){try{let a={v:e,t:Date.now()};localStorage.setItem(c+t,JSON.stringify(a))}catch(t){}}(a,n),console.log("Cached fresh data for ".concat(a))),{data:n,fromCache:!1}}catch(n){if(console.warn("Fetch failed for ".concat(t,", attempting cache fallback:"),n),a){let t=l(a);if(t)return console.log("Using stale cache for ".concat(a," due to fetch failure")),{data:t,fromCache:!0}}let e=function(t){try{if(t.includes("/api/today"))return{date:new Date().toISOString().split("T")[0],summary:"データ取得中...",status:"loading"};if(t.includes("/api/predictions"))return{predictions:[],status:"loading",message:"予測データを取得中..."};if(t.includes("/api/risk"))return{risk_level:"medium",status:"loading",message:"リスク分析中..."};if(t.includes("/api/dashboard"))return{summary:{},status:"loading",message:"ダッシュボードデータを読み込み中..."};return{status:"loading",message:"データを読み込み中...",timestamp:Date.now()}}catch(t){return null}}(t);if(e)return console.log("Using default data for ".concat(t)),{data:e,fromCache:!0};throw n}}}}]);