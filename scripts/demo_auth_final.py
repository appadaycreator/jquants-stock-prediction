#!/usr/bin/env python3
"""
jQuantsèªè¨¼ç®¡ç†æ©Ÿèƒ½ãƒ‡ãƒ¢ï¼ˆæœ€çµ‚ç‰ˆï¼‰
IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã›ãšã€ä¸€æ™‚ä¿å­˜ã®ã¿ã§ç®¡ç†
"""

import os
import json
from pathlib import Path


def demo_auth_final():
    """æœ€çµ‚ç‰ˆèªè¨¼ç®¡ç†æ©Ÿèƒ½ã®ãƒ‡ãƒ¢"""
    print("jQuantsèªè¨¼ç®¡ç†æ©Ÿèƒ½ãƒ‡ãƒ¢ï¼ˆæœ€çµ‚ç‰ˆï¼‰")
    print("=" * 50)
    print("=== æœ€çµ‚ç‰ˆèªè¨¼ç®¡ç†æ©Ÿèƒ½ãƒ‡ãƒ¢ ===")

    try:
        from jquants_auth_manager_final import JQuantsAuthManagerFinal

        # èªè¨¼ç®¡ç†ã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–
        auth_manager = JQuantsAuthManagerFinal()
        print("âœ… èªè¨¼ç®¡ç†ã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–å®Œäº†")
        print(f"   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: {auth_manager.email}")
        print(f"   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š: {'ã‚ã‚Š' if auth_manager.password else 'ãªã—'}")
        print(f"   - IDãƒˆãƒ¼ã‚¯ãƒ³: ä¸€æ™‚ä¿å­˜ã®ã¿ï¼ˆç’°å¢ƒå¤‰æ•°éä¾å­˜ï¼‰")

        # ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç¢ºèª
        print("\n=== ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ ===")
        cache = auth_manager.load_temp_token_cache()
        if cache:
            print("â„¹ï¸  ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ")
            print(f"   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ—¥æ™‚: {cache.get('cached_at', 'ä¸æ˜')}")
            print(f"   - æœ‰åŠ¹æœŸé™: {cache.get('expires_at', 'ä¸æ˜')}")
        else:
            print("â„¹ï¸  ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã‚ã‚Šã¾ã›ã‚“")

        # ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
        print("\n=== ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯ ===")
        current_token = auth_manager.get_current_token()
        if current_token:
            is_valid = auth_manager.is_token_valid(current_token)
            print(f"ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æ€§: {'æœ‰åŠ¹' if is_valid else 'ç„¡åŠ¹'}")
        else:
            print("ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æ€§: ãƒˆãƒ¼ã‚¯ãƒ³ãªã—")

        # ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ©Ÿèƒ½
        print("\n=== ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ©Ÿèƒ½ ===")
        if auth_manager.clear_temp_token_cache():
            print("âœ… ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")
        else:
            print("âš ï¸  ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ")

        # å¼·åŒ–ã•ã‚ŒãŸèªè¨¼ç®¡ç†æ©Ÿèƒ½ã®ç‰¹å¾´
        print("\n=== æœ€çµ‚ç‰ˆèªè¨¼ç®¡ç†æ©Ÿèƒ½ã®ç‰¹å¾´ ===")
        features = [
            "IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç’°å¢ƒå¤‰æ•°ã«ä¿å­˜ã—ãªã„",
            "ä¸€æ™‚ä¿å­˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ç®¡ç†",
            "ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹æ™‚ã®è‡ªå‹•å†èªè¨¼",
            "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã®å†èªè¨¼",
            "è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ (æœ€å¤§3å›)",
            "ä¸€æ™‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½",
            "è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°",
            "ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯",
            "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: ãƒˆãƒ¼ã‚¯ãƒ³ã®æ°¸ç¶šåŒ–ã‚’é¿ã‘ã‚‹",
        ]

        for feature in features:
            print(f"âœ… {feature}")

        print("\nğŸ‰ ãƒ‡ãƒ¢ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼")
        print("\nå®Ÿéš›ã®jQuants APIã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯:")
        print("1. æ­£ã—ã„èªè¨¼æƒ…å ±ã‚’.envãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š")
        print("2. python scripts/sync_with_jquants_api.py --test ã‚’å®Ÿè¡Œ")
        print("3. ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€æ™‚ä¿å­˜ã®ã¿ã§ã€ç’°å¢ƒå¤‰æ•°ã«ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“")

        return True

    except Exception as e:
        print(f"âŒ ãƒ‡ãƒ¢å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: {e}")
        return False


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    return 0 if demo_auth_final() else 1


if __name__ == "__main__":
    exit(main())
